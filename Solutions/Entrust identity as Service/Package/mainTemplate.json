{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Entrust identity as Service"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "_solutionName": "Entrust identity as Service",
    "_solutionVersion": "3.0.0",
    "solutionId": "azuresentinel.azure-sentinel-solution-entrustidentity",
    "_solutionId": "[variables('solutionId')]",
    "Entrust-BlockUser": "Entrust-BlockUser",
    "_Entrust-BlockUser": "[variables('Entrust-BlockUser')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "Entrust-BlockUser",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookId1": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId1'))),variables('playbookVersion1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "blanks": "[replace('b', 'b', '')]",
    "Entrust-EnrichIncidentWithIPDetails": "Entrust-EnrichIncidentWithIPDetails",
    "_Entrust-EnrichIncidentWithIPDetails": "[variables('Entrust-EnrichIncidentWithIPDetails')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "Entrust-EnrichIncidentWithIPDetails",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))),variables('playbookVersion2')))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "Entrust-EnrichIncidentWithUserDetails": "Entrust-EnrichIncidentWithUserDetails",
    "_Entrust-EnrichIncidentWithUserDetails": "[variables('Entrust-EnrichIncidentWithUserDetails')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "Entrust-EnrichIncidentWithUserDetails",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))),variables('playbookVersion3')))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "Entrust-EnrichIP-EntityTrigger": "Entrust-EnrichIP-EntityTrigger",
    "_Entrust-EnrichIP-EntityTrigger": "[variables('Entrust-EnrichIP-EntityTrigger')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "Entrust-EnrichIP-EntityTrigger",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))),variables('playbookVersion4')))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "Entrust-EnrichUser-EntityTrigger": "Entrust-EnrichUser-EntityTrigger",
    "_Entrust-EnrichUser-EntityTrigger": "[variables('Entrust-EnrichUser-EntityTrigger')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "Entrust-EnrichUser-EntityTrigger",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5'))),variables('playbookVersion5')))]",
    "_playbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId5'),'-', variables('playbookVersion5'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Entrust-BlockUser Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Entrust-BlockUser",
              "type": "string"
            },
            "Entrust App ID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust App ID"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where Entrust secret key is stored"
              }
            },
            "Entrust Secret Key Name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust Secret Key Name"
              }
            },
            "Host End Point": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Host End Point(hostname)"
              }
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Entrust App ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust App ID')]"
                    },
                    "Entrust Secret Key Name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust Secret Key Name')]"
                    },
                    "Host End Point": {
                      "type": "string",
                      "defaultValue": "[[parameters('Host End Point')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_-_check_if_users_account_are_provided_or_not": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_2": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Blocking Activity status :<br>\n<br>\n@{body('Create_HTML_table')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_-_User_accounts_received_from_incident_for_blocking": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('Blocked details')"
                          }
                        },
                        "For_each_-_User_accounts_received_from_incident_for_blocking": {
                          "foreach": "@body('Entities_-_Get_Accounts')?['Accounts']",
                          "actions": {
                            "Condition_-_checking_user_exists_in_entrust_or_not": {
                              "actions": {
                                "Condition_-_check_if_user_already_blocked": {
                                  "actions": {
                                    "Condition_-_check_if_user_blocked": {
                                      "actions": {
                                        "Append_to_array_variable_3": {
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "Blocked details",
                                            "value": {
                                              "Status": "User is Blocked",
                                              "User Name": "@items('For_each_-_User_accounts_received_from_incident_for_blocking')?['Name']"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "HTTP_-_block_user": [
                                          "Succeeded",
                                          "Failed"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_array_variable_4": {
                                            "type": "AppendToArrayVariable",
                                            "inputs": {
                                              "name": "Blocked details",
                                              "value": {
                                                "Status": "Blocking user failed",
                                                "User Name": "@items('For_each_-_User_accounts_received_from_incident_for_blocking')?['Name']"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@outputs('HTTP_-_block_user')['statusCode']",
                                              200
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "HTTP_-_block_user": {
                                      "type": "Http",
                                      "inputs": {
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                        },
                                        "body": {
                                          "lock": true
                                        },
                                        "method": "PUT",
                                        "uri": "https://@{parameters('Host End Point')}/api/web/v3/users/@{body('Parse_JSON_-_Get_UUID_of_user_to_block')?['id']}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_Get_UUID_of_user_to_block": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_to_array_variable_2": {
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "Blocked details",
                                          "value": {
                                            "Status": "User already blocked",
                                            "User Name": "@items('For_each_-_User_accounts_received_from_incident_for_blocking')?['Name']"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@body('Parse_JSON_-_Get_UUID_of_user_to_block')?['locked']",
                                          false
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Parse_JSON_-_Get_UUID_of_user_to_block": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@body('HTTP_-_Get_UUID_of_user_to_block')",
                                    "schema": {
                                      "properties": {
                                        "authenticatorLockoutStatus": {
                                          "items": {
                                            "properties": {
                                              "lockoutDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "lockoutExpiryDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "remainingAuthenticationAttempts": {
                                                "type": [
                                                  "integer",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "lockoutDate",
                                              "lockoutExpiryDate",
                                              "remainingAuthenticationAttempts",
                                              "type"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "directoryDN": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "directoryId": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "directoryName": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "directoryObjectGUID": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "directoryType": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "email": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "externalId": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "externalSource": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "fidoTokens": {
                                          "items": {
                                            "properties": {
                                              "allowedActions": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "createDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "lastUsedDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "state": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userIdStored": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "userUUID": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "allowedActions",
                                              "createDate",
                                              "id",
                                              "lastUsedDate",
                                              "name",
                                              "state",
                                              "userId",
                                              "userIdStored",
                                              "userUUID"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "firstName": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "grids": {
                                          "items": {
                                            "properties": {
                                              "allowedActions": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "assignDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "createDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "expired": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "expiryDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "gridContents": {
                                                "items": {
                                                  "items": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "type": [
                                                    "array",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "groups": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "lastUsedDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "serialNumber": {
                                                "type": [
                                                  "integer",
                                                  "null"
                                                ]
                                              },
                                              "state": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userName": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "allowedActions",
                                              "assignDate",
                                              "createDate",
                                              "expired",
                                              "expiryDate",
                                              "gridContents",
                                              "groups",
                                              "id",
                                              "lastUsedDate",
                                              "serialNumber",
                                              "state",
                                              "userId",
                                              "userName"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "groups": {
                                          "items": {
                                            "properties": {
                                              "externalId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "externalId",
                                              "id",
                                              "name",
                                              "type"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "id": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "lastAuthTime": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "lastName": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "locale": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "locked": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "lockedAuthenticatorTypes": {
                                          "items": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "lockedAuthenticators": {
                                          "items": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "lockoutExpiry": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "migrated": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "mobile": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "oauthRoles": {
                                          "items": {
                                            "properties": {
                                              "ancestorIds": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "descendantIds": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "description": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "inheritedResourceServerScopeIds": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "parentId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "resourceServerScopeIds": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "ancestorIds",
                                              "descendantIds",
                                              "description",
                                              "id",
                                              "inheritedResourceServerScopeIds",
                                              "name",
                                              "parentId",
                                              "resourceServerScopeIds"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "otpCreateTime": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "passwordExpirationTime": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "phone": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "preferredOtpDelivery": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "preferredOtpDeliveryContactAttributes": {
                                          "properties": {
                                            "OTP_EMAIL": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "OTP_SMS": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "OTP_VOICE": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            }
                                          },
                                          "type": [
                                            "object",
                                            "null"
                                          ]
                                        },
                                        "registrationEnabled": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "registrationRequired": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "smartCredentials": {
                                          "items": {
                                            "properties": {
                                              "allowedActions": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "cardDigitalConfig": {
                                                "properties": {
                                                  "allCAGroups": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "caGroups": {
                                                    "items": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  },
                                                  "caId": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "caName": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "caType": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "certTemplates": {
                                                    "items": {
                                                      "properties": {
                                                        "digitalIdConfigId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "name": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "pivContainer": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "required": [
                                                        "digitalIdConfigId",
                                                        "id",
                                                        "name",
                                                        "pivContainer"
                                                      ],
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  },
                                                  "certificateType": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "digitalIdConfigTemplateId": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "directoryEntry": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "dnFormat": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "dnFormatSearchbaseIncluded": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "id": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "name": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "role": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "searchbase": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "subjectAltNames": {
                                                    "items": {
                                                      "properties": {
                                                        "digitalIdConfigId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "type": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "value": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "required": [
                                                        "digitalIdConfigId",
                                                        "id",
                                                        "type",
                                                        "value"
                                                      ],
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  },
                                                  "type": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "userType": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "variables": {
                                                    "items": {
                                                      "properties": {
                                                        "digitalIdConfigId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "includedInDN": {
                                                          "type": [
                                                            "boolean",
                                                            "null"
                                                          ]
                                                        },
                                                        "name": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "type": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "value": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "required": [
                                                        "digitalIdConfigId",
                                                        "id",
                                                        "includedInDN",
                                                        "name",
                                                        "type",
                                                        "value"
                                                      ],
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  }
                                                },
                                                "type": [
                                                  "object",
                                                  "null"
                                                ]
                                              },
                                              "cardDigitalConfigId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "cardDigitalConfigRequired": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "cardHolderDigitalConfig": {
                                                "properties": {
                                                  "allCAGroups": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "caGroups": {
                                                    "items": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  },
                                                  "caId": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "caName": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "caType": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "certTemplates": {
                                                    "items": {
                                                      "properties": {
                                                        "digitalIdConfigId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "name": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "pivContainer": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "required": [
                                                        "digitalIdConfigId",
                                                        "id",
                                                        "name",
                                                        "pivContainer"
                                                      ],
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  },
                                                  "certificateType": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "digitalIdConfigTemplateId": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "directoryEntry": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "dnFormat": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "dnFormatSearchbaseIncluded": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "id": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "name": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "role": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "searchbase": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "subjectAltNames": {
                                                    "items": {
                                                      "properties": {
                                                        "digitalIdConfigId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "type": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "value": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "required": [
                                                        "digitalIdConfigId",
                                                        "id",
                                                        "type",
                                                        "value"
                                                      ],
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  },
                                                  "type": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "userType": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "variables": {
                                                    "items": {
                                                      "properties": {
                                                        "digitalIdConfigId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "includedInDN": {
                                                          "type": [
                                                            "boolean",
                                                            "null"
                                                          ]
                                                        },
                                                        "name": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "type": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "value": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "required": [
                                                        "digitalIdConfigId",
                                                        "id",
                                                        "includedInDN",
                                                        "name",
                                                        "type",
                                                        "value"
                                                      ],
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": [
                                                      "array",
                                                      "null"
                                                    ]
                                                  }
                                                },
                                                "type": [
                                                  "object",
                                                  "null"
                                                ]
                                              },
                                              "cardHolderDigitalConfigId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "cardHolderDigitalConfigRequired": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "certificates": {
                                                "items": {
                                                  "properties": {
                                                    "description": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "digitalIdId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "digitalIdType": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "issuerDN": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "notAfter": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "notBefore": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "pivContainer": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "serialNumber": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "status": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "subjectDN": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "description",
                                                    "digitalIdId",
                                                    "digitalIdType",
                                                    "id",
                                                    "issuerDN",
                                                    "notAfter",
                                                    "notBefore",
                                                    "pivContainer",
                                                    "serialNumber",
                                                    "status",
                                                    "subjectDN"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "chipId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "digitalIds": {
                                                "items": {
                                                  "properties": {
                                                    "certificates": {
                                                      "items": {
                                                        "properties": {
                                                          "description": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "digitalIdId": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "digitalIdType": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "id": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "issuerDN": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "notAfter": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "notBefore": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "pivContainer": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "serialNumber": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "status": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          },
                                                          "subjectDN": {
                                                            "type": [
                                                              "string",
                                                              "null"
                                                            ]
                                                          }
                                                        },
                                                        "required": [
                                                          "description",
                                                          "digitalIdId",
                                                          "digitalIdType",
                                                          "id",
                                                          "issuerDN",
                                                          "notAfter",
                                                          "notBefore",
                                                          "pivContainer",
                                                          "serialNumber",
                                                          "status",
                                                          "subjectDN"
                                                        ],
                                                        "type": [
                                                          "object",
                                                          "null"
                                                        ]
                                                      },
                                                      "type": [
                                                        "array",
                                                        "null"
                                                      ]
                                                    },
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "digitalIdConfigName": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "digitalIdConfigType": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "dn": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "certificates",
                                                    "digitalIdConfigId",
                                                    "digitalIdConfigName",
                                                    "digitalIdConfigType",
                                                    "dn",
                                                    "id"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "encodeMsg": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "encodeState": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "enrollState": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "expiryDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "issueDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "notifyEnabled": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "platform": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "scDefnId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "scDefnName": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "serialNumber": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "state": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userUserId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "variableValues": {
                                                "items": {
                                                  "properties": {
                                                    "scDefnVariable": {
                                                      "properties": {
                                                        "defaultValue": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "displayable": {
                                                          "type": [
                                                            "boolean",
                                                            "null"
                                                          ]
                                                        },
                                                        "generate": {
                                                          "type": [
                                                            "boolean",
                                                            "null"
                                                          ]
                                                        },
                                                        "generateLength": {
                                                          "type": [
                                                            "integer",
                                                            "null"
                                                          ]
                                                        },
                                                        "id": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "modifiable": {
                                                          "type": [
                                                            "boolean",
                                                            "null"
                                                          ]
                                                        },
                                                        "name": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "order": {
                                                          "type": [
                                                            "integer",
                                                            "null"
                                                          ]
                                                        },
                                                        "prompt": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "required": {
                                                          "type": [
                                                            "boolean",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionDigits": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionLower": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionMax": {
                                                          "type": [
                                                            "integer",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionMin": {
                                                          "type": [
                                                            "integer",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionRegex": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionSpecial": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "restrictionUpper": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "scDefnId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "type": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "uniqueness": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        },
                                                        "uniquenessScopeId": {
                                                          "type": [
                                                            "string",
                                                            "null"
                                                          ]
                                                        }
                                                      },
                                                      "type": [
                                                        "object",
                                                        "null"
                                                      ]
                                                    },
                                                    "scDefnVariableId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "scDefnVariable",
                                                    "scDefnVariableId",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "version": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "allowedActions",
                                              "cardDigitalConfig",
                                              "cardDigitalConfigId",
                                              "cardDigitalConfigRequired",
                                              "cardHolderDigitalConfig",
                                              "cardHolderDigitalConfigId",
                                              "cardHolderDigitalConfigRequired",
                                              "certificates",
                                              "chipId",
                                              "digitalIds",
                                              "encodeMsg",
                                              "encodeState",
                                              "enrollState",
                                              "expiryDate",
                                              "id",
                                              "issueDate",
                                              "notifyEnabled",
                                              "platform",
                                              "scDefnId",
                                              "scDefnName",
                                              "serialNumber",
                                              "state",
                                              "userId",
                                              "userUserId",
                                              "variableValues",
                                              "version"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "state": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "tempAccessCode": {
                                          "properties": {
                                            "code": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "createDate": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "expired": {
                                              "type": [
                                                "boolean",
                                                "null"
                                              ]
                                            },
                                            "expiryDate": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "id": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "maxUses": {
                                              "type": [
                                                "integer",
                                                "null"
                                              ]
                                            },
                                            "numUses": {
                                              "type": [
                                                "integer",
                                                "null"
                                              ]
                                            }
                                          },
                                          "type": [
                                            "object",
                                            "null"
                                          ]
                                        },
                                        "tokens": {
                                          "items": {
                                            "properties": {
                                              "algorithmType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "allowedActions": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "description": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "groups": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "label": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "lastUsedDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "loadDate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "logo": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "platform": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "registeredForTransactions": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "serialNumber": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "state": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "supportsChallengeResponse": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "supportsResponse": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "supportsSignature": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "supportsUnlock": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "supportsUnlockTOTP": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "algorithmType",
                                              "allowedActions",
                                              "description",
                                              "groups",
                                              "id",
                                              "label",
                                              "lastUsedDate",
                                              "loadDate",
                                              "logo",
                                              "name",
                                              "platform",
                                              "registeredForTransactions",
                                              "serialNumber",
                                              "state",
                                              "supportsChallengeResponse",
                                              "supportsResponse",
                                              "supportsSignature",
                                              "supportsUnlock",
                                              "supportsUnlockTOTP",
                                              "type",
                                              "userId"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "type": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "userAliases": {
                                          "items": {
                                            "properties": {
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "value": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "id",
                                              "type",
                                              "userId",
                                              "value"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "userAttributeValues": {
                                          "items": {
                                            "properties": {
                                              "editable": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "lastUpdate": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userAttribute": {
                                                "properties": {
                                                  "id": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "mandatory": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "name": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "systemDefined": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  },
                                                  "type": {
                                                    "type": [
                                                      "string",
                                                      "null"
                                                    ]
                                                  },
                                                  "unique": {
                                                    "type": [
                                                      "boolean",
                                                      "null"
                                                    ]
                                                  }
                                                },
                                                "type": [
                                                  "object",
                                                  "null"
                                                ]
                                              },
                                              "userAttributeId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "value": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "editable",
                                              "id",
                                              "lastUpdate",
                                              "userAttribute",
                                              "userAttributeId",
                                              "userId",
                                              "value"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "userExtraAttributes": {
                                          "items": {
                                            "properties": {
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "value": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "required": [
                                              "id",
                                              "name",
                                              "type",
                                              "value"
                                            ],
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "type": [
                                            "array",
                                            "null"
                                          ]
                                        },
                                        "userId": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "userPrincipalName": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "verificationEnabled": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "verificationRequired": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "HTTP_-_Get_UUID_of_user_to_block": [
                                  "Succeeded",
                                  "Failed"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_to_array_variable": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "Blocked details",
                                      "value": {
                                        "Status": "Not available in entrust",
                                        "User Name": "@items('For_each_-_User_accounts_received_from_incident_for_blocking')?['Name']"
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@outputs('HTTP_-_Get_UUID_of_user_to_block')['statusCode']",
                                      200
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "HTTP_-_Get_UUID_of_user_to_block": {
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "userId": "@items('For_each_-_User_accounts_received_from_incident_for_blocking')?['Name']"
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v3/users/userid"
                              }
                            }
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>Account name is not mapped properly in analytic rule , or none account name were provided .</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(body('Entities_-_Get_Accounts')?['Accounts'])",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Entities_-_Get_Accounts": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/account"
                      }
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Initialize_variable_-_collect_blocked_user_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Entrust Secret Key Name'))}/value"
                      }
                    },
                    "HTTP_-_generate_login_token": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "applicationId": "@parameters('Entrust App ID')",
                          "enableWebSession": false,
                          "sharedSecret": "@body('Get_secret')?['value']"
                        },
                        "method": "POST",
                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/adminapi/authenticate"
                      }
                    },
                    "Initialize_variable_-_collect_blocked_user_details": {
                      "runAfter": {
                        "Entities_-_Get_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Blocked details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_generate_login_token": {
                      "runAfter": {
                        "HTTP_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP_-_generate_login_token')",
                        "schema": {
                          "properties": {
                            "authToken": {
                              "type": "string"
                            },
                            "creationTime": {
                              "type": "string"
                            },
                            "expirationTime": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "Entrust-BlockUser",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Entrust identity as Service",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Block Risky/Compromised User From Entrust",
            "description": "This playbook Block the risky user and update the status in comments section of triggered incident so that SOC analysts get aware of the action taken by playbook",
            "prerequisites": [
              "1. User should be having an active subscription of product to open the product documentation.",
              "2. For Json API keys , Kindly login to entrust Identity as a service portal",
              "3. Then click on left burger icon and Go to Applications under Resources",
              "4. click on + Button and search for Administration API",
              "5. Configure that and at the end save the Json object of API keys",
              "6. Make a note of Entrust application id and hostname",
              "7. Store the Shared Secret Key in keyvault Secrets."
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Entrust application id ,Entrust secret key name, host endpoint and Key vault name."
            ],
            "lastUpdateTime": "2023-02-28T00:00:00Z",
            "entities": [
              "account"
            ],
            "tags": [
              "Notification",
              "MFA",
              "Entrust",
              "Identity",
              "Block",
              "User",
              "compromised"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "Playbook",
        "displayName": "Entrust-BlockUser",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Entrust-EnrichIncidentWithIPDetails Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Entrust-EnrichIncidentWithIPDetails",
              "type": "string"
            },
            "Entrust App ID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust App ID"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where Entrust secret key is stored"
              }
            },
            "Entrust Secret Key Name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust Secret Key Name"
              }
            },
            "Host End Point": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Host End Point(hostname)"
              }
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Entrust App ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust App ID')]"
                    },
                    "Entrust Secret Key Name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust Secret Key Name')]"
                    },
                    "Host End Point": {
                      "type": "string",
                      "defaultValue": "[[parameters('Host End Point')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_-_checking_if_IP's_are_provided_or_not": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_2": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>IP Authentication events for last 24 hours :<br>\n@{body('Create_HTML_table')}&nbsp;</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_-_IP_got_from_incident": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('ip_enrich')"
                          }
                        },
                        "For_each_-_IP_got_from_incident": {
                          "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                          "actions": {
                            "Condition_-_To_check_if_provided_IP_has_any_activity_in_last_24_hours": {
                              "actions": {
                                "For_each_-_appending_IP_details": {
                                  "foreach": "@body('Parse_JSON_-_Get_IP_details_from_audit_events')?['results']",
                                  "actions": {
                                    "Append_to_array_variable_-_append_IP_details_to_variable": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ip_enrich",
                                        "value": {
                                          "Login Method": "@items('For_each_-_appending_IP_details')?['token']",
                                          "eventCategory": "@items('For_each_-_appending_IP_details')?['eventCategory']",
                                          "eventOutcome": "@items('For_each_-_appending_IP_details')?['eventOutcome']",
                                          "eventType": "@items('For_each_-_appending_IP_details')?['eventType']",
                                          "eventtime": "@items('For_each_-_appending_IP_details')?['eventTime']",
                                          "sourceIp": "@items('For_each_-_appending_IP_details')?['sourceIp']",
                                          "subjectName": "@items('For_each_-_appending_IP_details')?['subjectName']",
                                          "subjectType": "@items('For_each_-_appending_IP_details')?['subjectType']"
                                        }
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_Get_IP_details_from_audit_events": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_to_array_variable": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "ip_enrich",
                                      "value": {
                                        "Login Method": "Null",
                                        "eventCategory": "No login/authentication activity",
                                        "eventOutcome": "[variables('blanks')]",
                                        "eventType": "Null",
                                        "eventtime": "Null",
                                        "sourceIp": "@items('For_each_-_IP_got_from_incident')?['Address']",
                                        "subjectName": "Null",
                                        "subjectType": "Null"
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Parse_JSON_-_Get_IP_details_from_audit_events')?['results'])",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "HTTP_-_Get_IP_details_from_audit_events": {
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "limit": 100,
                                  "orderByAttribute": {
                                    "ascending": false,
                                    "name": "eventTime"
                                  },
                                  "searchByAttributes": [
                                    {
                                      "name": "sourceIp",
                                      "operator": "EQUALS",
                                      "value": "@items('For_each_-_IP_got_from_incident')?['Address']"
                                    },
                                    {
                                      "name": "eventTime",
                                      "operator": "GREATER_THAN_OR_EQUAL",
                                      "value": "@formatDateTime(subtractFromTime(utcNow(), 24, 'Hour'), 'yyyy-MM-ddTHH:mm:ss')"
                                    }
                                  ]
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v2/reports/auditeventspaged"
                              }
                            },
                            "Parse_JSON_-_Get_IP_details_from_audit_events": {
                              "runAfter": {
                                "HTTP_-_Get_IP_details_from_audit_events": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_Get_IP_details_from_audit_events')",
                                "schema": {
                                  "properties": {
                                    "paging": {
                                      "properties": {
                                        "limit": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        },
                                        "nextCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "prevCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "results": {
                                      "items": {
                                        "properties": {
                                          "accountId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "auditDetails": {
                                            "properties": {
                                              "entityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "messageTokens": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "modifiedEntityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "newValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "oldValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "newValue",
                                                    "oldValue"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "entityAction": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventCategory": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventOutcome": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventTime": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventVersion": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "message": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "requiredPermission": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "sourceIp": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subject": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "token": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "accountId",
                                          "auditDetails",
                                          "entityAction",
                                          "entityId",
                                          "entityName",
                                          "entityType",
                                          "eventCategory",
                                          "eventOutcome",
                                          "eventTime",
                                          "eventType",
                                          "eventVersion",
                                          "id",
                                          "message",
                                          "requiredPermission",
                                          "resourceId",
                                          "resourceName",
                                          "serviceProviderAdminRoleId",
                                          "serviceProviderAdminRoleName",
                                          "sourceIp",
                                          "subject",
                                          "subjectName",
                                          "subjectType",
                                          "subscriberAdminRoleId",
                                          "subscriberAdminRoleName",
                                          "token"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": [
                                    "object",
                                    "null"
                                  ]
                                }
                              }
                            }
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>IP entity didn't mapped properly in analytic rule or None IP provided</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(body('Entities_-_Get_IPs')?['IPs'])",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Entities_-_Get_IPs": {
                      "runAfter": {
                        "Initialize_variable_-_collect_IP_enriched_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Entrust Secret Key Name'))}/value"
                      }
                    },
                    "HTTP_-_generate_login_token": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "applicationId": "@parameters('Entrust App ID')",
                          "enableWebSession": false,
                          "sharedSecret": "@body('Get_secret')?['value']"
                        },
                        "method": "POST",
                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/adminapi/authenticate"
                      }
                    },
                    "Initialize_variable_-_collect_IP_enriched_details": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_enrich",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_generate_login_token": {
                      "runAfter": {
                        "HTTP_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP_-_generate_login_token')",
                        "schema": {
                          "properties": {
                            "authToken": {
                              "type": "string"
                            },
                            "creationTime": {
                              "type": "string"
                            },
                            "expirationTime": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "Entrust-EnrichIncidentWithIPDetails",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Entrust identity as Service",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch IP Details From Entrust",
            "description": "This playbook provides the IP details in comments section of triggered incident so that SOC analysts can directly take corrective measure to stop the attack from unknown/compromised entity",
            "prerequisites": [
              "1. User should be having an active subscription of product to open the product documentation.",
              "2. For Json API keys , Kindly login to entrust Identity as a service portal",
              "3. Then click on left burger icon and Go to Applications under Resources",
              "4. click on + Button and search for Administration API",
              "5. Configure that and at the end save the Json object of API keys",
              "6. Make a note of Entrust application id and hostname",
              "7. Store the Shared Secret Key in keyvault Secrets."
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Entrust application id ,Entrust secret key name, host endpoint and Key vault name."
            ],
            "lastUpdateTime": "2023-02-28T00:00:00Z",
            "entities": [
              "IP"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "MFA",
              "Entrust",
              "Identity"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "Entrust-EnrichIncidentWithIPDetails",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Entrust-EnrichIncidentWithUserDetails Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Entrust-EnrichIncidentWithUserDetails",
              "type": "string"
            },
            "Entrust App ID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust App ID"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where Entrust secret key is stored"
              }
            },
            "Entrust Secret Key Name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust Secret Key Name"
              }
            },
            "Host End Point": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Host End Point"
              }
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Entrust App ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust App ID')]"
                    },
                    "Entrust Secret Key Name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust Secret Key Name')]"
                    },
                    "Host End Point": {
                      "type": "string",
                      "defaultValue": "[[parameters('Host End Point')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>User details fetch from Entrust :<br>\n@{body('Create_HTML_table')}<br>\n</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_-_user_accounts_received_from_incident": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('user_details')"
                          }
                        },
                        "For_each_-_user_accounts_received_from_incident": {
                          "foreach": "@body('Entities_-_Get_Accounts')?['Accounts']",
                          "actions": {
                            "Append_to_array_variable_-_Combining_details": {
                              "runAfter": {
                                "Condition_2_-_to_check_if_user_has_logged_in_last_24_hours": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "user_details",
                                "value": {
                                  "Email": "@body('Parse_JSON_-Get_User')?['email']",
                                  "First Name": "@body('Parse_JSON_-Get_User')?['firstName']",
                                  "Group assigned": "@replace(string(variables('group_collect')),'\"',' ')",
                                  "Last Auth Time": "@body('Parse_JSON_-Get_User')?['lastAuthTime']",
                                  "Last Name": "@body('Parse_JSON_-Get_User')?['lastName']",
                                  "Mobile": "@body('Parse_JSON_-Get_User')?['mobile']",
                                  "Roles": "@replace(string(variables('roles_details')),'\"',' ')",
                                  "Source IP": "@replace(string(union(variables('Ip_collects'),variables('Ip_collects'))),'\"','')",
                                  "State": "@body('Parse_JSON_-Get_User')?['state']",
                                  "UUID": "@body('Parse_JSON_-Get_User')?['id']",
                                  "user ID": "@body('Parse_JSON_-Get_User')?['userId']"
                                }
                              }
                            },
                            "Compose_4": {
                              "runAfter": {
                                "Condition_-_checking_for_null_group_values": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": "@variables('group_collect')"
                            },
                            "Condition_-_checking_for_null_group_values": {
                              "actions": {
                                "For_each_-_fetching_all_group_details": {
                                  "foreach": "@body('Parse_JSON_-Get_User')?['groups']",
                                  "actions": {
                                    "Append_to_array_variable_-_collect_group": {
                                      "runAfter": {
                                        "Parse_JSON_-_Get_group_Details": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "group_collect",
                                        "value": "@body('Parse_JSON_-_Get_group_Details')?['name']"
                                      }
                                    },
                                    "HTTP_-_Get_Group_Details": {
                                      "type": "Http",
                                      "inputs": {
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                        },
                                        "method": "GET",
                                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/groups/@{items('For_each_-_fetching_all_group_details')?['id']}"
                                      }
                                    },
                                    "Parse_JSON_-_Get_group_Details": {
                                      "runAfter": {
                                        "HTTP_-_Get_Group_Details": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ParseJson",
                                      "inputs": {
                                        "content": "@body('HTTP_-_Get_Group_Details')",
                                        "schema": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "type": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "Set_variable_3_-_initializing_null": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Parse_JSON_-Get_User')?['groups'])",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Condition_2_-_to_check_if_user_has_logged_in_last_24_hours": {
                              "actions": {
                                "For_each": {
                                  "foreach": "@body('Parse_JSON_-_collecting_source_IP')?['results']",
                                  "actions": {
                                    "Append_to_array_variable_-_collect_ip_in_array": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "Ip_collects",
                                        "value": "@items('For_each')?['sourceIp']"
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_collecting_source_IP": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Parse_JSON_-_collecting_source_IP')?['results'])",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "For_each_-_collecting_roles_details": {
                              "foreach": "@body('Parse_JSON_-_role_assigned')",
                              "actions": {
                                "Append_to_array_variable_-_collecting_roles_in_array": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "roles_details",
                                    "value": "@items('For_each_-_collecting_roles_details')['name']"
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_role_assigned": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "HTTP_-_Get_User": {
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "userId": "@items('For_each_-_user_accounts_received_from_incident')?['Name']"
                                },
                                "headers": {
                                  "Accept": "application/json",
                                  "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v3/users/userid"
                              }
                            },
                            "HTTP_-_collecting_source_IP_last_24_hours": {
                              "runAfter": {
                                "For_each_-_collecting_roles_details": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "limit": 100,
                                  "orderByAttribute": {
                                    "ascending": false,
                                    "name": "eventTime"
                                  },
                                  "searchByAttributes": [
                                    {
                                      "name": "subjectName",
                                      "operator": "EQUALS",
                                      "value": "@items('For_each_-_user_accounts_received_from_incident')?['Name']"
                                    },
                                    {
                                      "name": "eventTime",
                                      "operator": "GREATER_THAN_OR_EQUAL",
                                      "value": "@formatDateTime(subtractFromTime(utcNow(),24,'Hour'),'yyyy-MM-ddTHH:mm:ss')"
                                    }
                                  ]
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v2/reports/auditeventspaged"
                              }
                            },
                            "HTTP_-_get_roles_assigned": {
                              "runAfter": {
                                "Compose_4": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "method": "GET",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v1/users/@{body('Parse_JSON_-Get_User')?['id']}/roles"
                              }
                            },
                            "Parse_JSON_-Get_User": {
                              "runAfter": {
                                "HTTP_-_Get_User": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_Get_User')",
                                "schema": {
                                  "properties": {
                                    "authenticatorLockoutStatus": {
                                      "items": {
                                        "properties": {
                                          "lockoutDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lockoutExpiryDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "remainingAuthenticationAttempts": {
                                            "type": [
                                              "integer",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "lockoutDate",
                                          "lockoutExpiryDate",
                                          "remainingAuthenticationAttempts",
                                          "type"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "directoryDN": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryId": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryObjectGUID": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryType": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "email": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "externalId": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "externalSource": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "fidoTokens": {
                                      "items": {
                                        "properties": {
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "createDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUsedDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userIdStored": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "userUUID": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "allowedActions",
                                          "createDate",
                                          "id",
                                          "lastUsedDate",
                                          "name",
                                          "state",
                                          "userId",
                                          "userIdStored",
                                          "userUUID"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "firstName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "grids": {
                                      "items": {
                                        "properties": {
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "assignDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "createDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "expired": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "expiryDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "gridContents": {
                                            "items": {
                                              "items": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "type": [
                                                "array",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "groups": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUsedDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serialNumber": {
                                            "type": [
                                              "integer",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "allowedActions",
                                          "assignDate",
                                          "createDate",
                                          "expired",
                                          "expiryDate",
                                          "gridContents",
                                          "groups",
                                          "id",
                                          "lastUsedDate",
                                          "serialNumber",
                                          "state",
                                          "userId",
                                          "userName"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "groups": {
                                      "items": {
                                        "properties": {
                                          "externalId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "externalId",
                                          "id",
                                          "name",
                                          "type"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "id": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "lastAuthTime": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "lastName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "locale": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "locked": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "lockedAuthenticatorTypes": {
                                      "items": {
                                        "type": [
                                          "string",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "lockedAuthenticators": {
                                      "items": {
                                        "type": [
                                          "string",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "lockoutExpiry": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "migrated": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "mobile": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "oauthRoles": {
                                      "items": {
                                        "properties": {
                                          "ancestorIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "descendantIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "description": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "inheritedResourceServerScopeIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "parentId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceServerScopeIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "ancestorIds",
                                          "descendantIds",
                                          "description",
                                          "id",
                                          "inheritedResourceServerScopeIds",
                                          "name",
                                          "parentId",
                                          "resourceServerScopeIds"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "otpCreateTime": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "passwordExpirationTime": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "phone": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "preferredOtpDelivery": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "preferredOtpDeliveryContactAttributes": {
                                      "properties": {
                                        "OTP_EMAIL": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "OTP_SMS": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "OTP_VOICE": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "registrationEnabled": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "registrationRequired": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "smartCredentials": {
                                      "items": {
                                        "properties": {
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "cardDigitalConfig": {
                                            "properties": {
                                              "allCAGroups": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "caGroups": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "caId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caName": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "certTemplates": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "pivContainer": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "name",
                                                    "pivContainer"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "certificateType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "digitalIdConfigTemplateId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "directoryEntry": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "dnFormat": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "dnFormatSearchbaseIncluded": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "role": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "searchbase": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "subjectAltNames": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "variables": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "includedInDN": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "includedInDN",
                                                    "name",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "cardDigitalConfigId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "cardDigitalConfigRequired": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "cardHolderDigitalConfig": {
                                            "properties": {
                                              "allCAGroups": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "caGroups": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "caId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caName": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "certTemplates": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "pivContainer": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "name",
                                                    "pivContainer"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "certificateType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "digitalIdConfigTemplateId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "directoryEntry": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "dnFormat": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "dnFormatSearchbaseIncluded": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "role": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "searchbase": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "subjectAltNames": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "variables": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "includedInDN": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "includedInDN",
                                                    "name",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "cardHolderDigitalConfigId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "cardHolderDigitalConfigRequired": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "certificates": {
                                            "items": {
                                              "properties": {
                                                "description": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdId": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdType": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "id": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "issuerDN": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "notAfter": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "notBefore": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "pivContainer": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "serialNumber": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "status": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "subjectDN": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "required": [
                                                "description",
                                                "digitalIdId",
                                                "digitalIdType",
                                                "id",
                                                "issuerDN",
                                                "notAfter",
                                                "notBefore",
                                                "pivContainer",
                                                "serialNumber",
                                                "status",
                                                "subjectDN"
                                              ],
                                              "type": [
                                                "object",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "chipId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "digitalIds": {
                                            "items": {
                                              "properties": {
                                                "certificates": {
                                                  "items": {
                                                    "properties": {
                                                      "description": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "digitalIdId": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "digitalIdType": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "id": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "issuerDN": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "notAfter": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "notBefore": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "pivContainer": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "serialNumber": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "status": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "subjectDN": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      }
                                                    },
                                                    "required": [
                                                      "description",
                                                      "digitalIdId",
                                                      "digitalIdType",
                                                      "id",
                                                      "issuerDN",
                                                      "notAfter",
                                                      "notBefore",
                                                      "pivContainer",
                                                      "serialNumber",
                                                      "status",
                                                      "subjectDN"
                                                    ],
                                                    "type": [
                                                      "object",
                                                      "null"
                                                    ]
                                                  },
                                                  "type": [
                                                    "array",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdConfigId": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdConfigName": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdConfigType": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "dn": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "id": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "required": [
                                                "certificates",
                                                "digitalIdConfigId",
                                                "digitalIdConfigName",
                                                "digitalIdConfigType",
                                                "dn",
                                                "id"
                                              ],
                                              "type": [
                                                "object",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "encodeMsg": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "encodeState": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "enrollState": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "expiryDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "issueDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "notifyEnabled": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "platform": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "scDefnId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "scDefnName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serialNumber": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userUserId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "variableValues": {
                                            "items": {
                                              "properties": {
                                                "scDefnVariable": {
                                                  "properties": {
                                                    "defaultValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "displayable": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "generate": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "generateLength": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "modifiable": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "order": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "prompt": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "required": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionDigits": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionLower": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionMax": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionMin": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionRegex": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionSpecial": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionUpper": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "scDefnId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "uniqueness": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "uniquenessScopeId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "scDefnVariableId": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "value": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "required": [
                                                "scDefnVariable",
                                                "scDefnVariableId",
                                                "value"
                                              ],
                                              "type": [
                                                "object",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "version": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "allowedActions",
                                          "cardDigitalConfig",
                                          "cardDigitalConfigId",
                                          "cardDigitalConfigRequired",
                                          "cardHolderDigitalConfig",
                                          "cardHolderDigitalConfigId",
                                          "cardHolderDigitalConfigRequired",
                                          "certificates",
                                          "chipId",
                                          "digitalIds",
                                          "encodeMsg",
                                          "encodeState",
                                          "enrollState",
                                          "expiryDate",
                                          "id",
                                          "issueDate",
                                          "notifyEnabled",
                                          "platform",
                                          "scDefnId",
                                          "scDefnName",
                                          "serialNumber",
                                          "state",
                                          "userId",
                                          "userUserId",
                                          "variableValues",
                                          "version"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "state": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "tempAccessCode": {
                                      "properties": {
                                        "code": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "createDate": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "expired": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "expiryDate": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "id": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "maxUses": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        },
                                        "numUses": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "tokens": {
                                      "items": {
                                        "properties": {
                                          "algorithmType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "description": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "groups": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "label": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUsedDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "loadDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "logo": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "platform": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "registeredForTransactions": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "serialNumber": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "supportsChallengeResponse": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsResponse": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsSignature": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsUnlock": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsUnlockTOTP": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "algorithmType",
                                          "allowedActions",
                                          "description",
                                          "groups",
                                          "id",
                                          "label",
                                          "lastUsedDate",
                                          "loadDate",
                                          "logo",
                                          "name",
                                          "platform",
                                          "registeredForTransactions",
                                          "serialNumber",
                                          "state",
                                          "supportsChallengeResponse",
                                          "supportsResponse",
                                          "supportsSignature",
                                          "supportsUnlock",
                                          "supportsUnlockTOTP",
                                          "type",
                                          "userId"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "type": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "userAliases": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "value": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "type",
                                          "userId",
                                          "value"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "userAttributeValues": {
                                      "items": {
                                        "properties": {
                                          "editable": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUpdate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userAttribute": {
                                            "properties": {
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "mandatory": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "systemDefined": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "unique": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "userAttributeId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "value": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "editable",
                                          "id",
                                          "lastUpdate",
                                          "userAttribute",
                                          "userAttributeId",
                                          "userId",
                                          "value"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "userExtraAttributes": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "value": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "name",
                                          "type",
                                          "value"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "userId": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "userPrincipalName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "verificationEnabled": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "verificationRequired": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": [
                                    "object",
                                    "null"
                                  ]
                                }
                              }
                            },
                            "Parse_JSON_-_collecting_source_IP": {
                              "runAfter": {
                                "HTTP_-_collecting_source_IP_last_24_hours": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_collecting_source_IP_last_24_hours')",
                                "schema": {
                                  "properties": {
                                    "paging": {
                                      "properties": {
                                        "limit": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        },
                                        "nextCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "prevCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "results": {
                                      "items": {
                                        "properties": {
                                          "accountId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "auditDetails": {
                                            "properties": {
                                              "entityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "messageTokens": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "modifiedEntityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "newValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "oldValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "newValue",
                                                    "oldValue"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "entityAction": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventCategory": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventOutcome": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventTime": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventVersion": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "message": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "requiredPermission": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "sourceIp": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subject": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "token": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "accountId",
                                          "auditDetails",
                                          "entityAction",
                                          "entityId",
                                          "entityName",
                                          "entityType",
                                          "eventCategory",
                                          "eventOutcome",
                                          "eventTime",
                                          "eventType",
                                          "eventVersion",
                                          "id",
                                          "message",
                                          "requiredPermission",
                                          "resourceId",
                                          "resourceName",
                                          "serviceProviderAdminRoleId",
                                          "serviceProviderAdminRoleName",
                                          "sourceIp",
                                          "subject",
                                          "subjectName",
                                          "subjectType",
                                          "subscriberAdminRoleId",
                                          "subscriberAdminRoleName",
                                          "token"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": [
                                    "object",
                                    "null"
                                  ]
                                }
                              }
                            },
                            "Parse_JSON_-_role_assigned": {
                              "runAfter": {
                                "HTTP_-_get_roles_assigned": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_get_roles_assigned')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "allRoles": {
                                        "type": "boolean"
                                      },
                                      "defaultRole": {
                                        "type": "boolean"
                                      },
                                      "description": {
                                        "type": "string"
                                      },
                                      "groupManagement": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "managedRoles": {
                                        "type": "array"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "permissions": {
                                        "type": "array"
                                      },
                                      "roleType": {
                                        "type": "string"
                                      },
                                      "superAdministrator": {
                                        "type": "boolean"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "description",
                                      "roleType",
                                      "defaultRole",
                                      "superAdministrator",
                                      "permissions",
                                      "allRoles",
                                      "managedRoles",
                                      "groupManagement",
                                      "groupIds"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            },
                            "Set_variable_-_initializing_null": {
                              "runAfter": {
                                "Parse_JSON_-Get_User": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "roles_details",
                                "value": "@null"
                              }
                            },
                            "Set_variable_2_-initializing_null": {
                              "runAfter": {
                                "Set_variable_-_initializing_null": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "group_collect",
                                "value": "@null"
                              }
                            },
                            "Set_variable_3_-_initializing_null": {
                              "runAfter": {
                                "Set_variable_2_-initializing_null": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "Ip_collects",
                                "value": "@null"
                              }
                            }
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 1
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)_2": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>Acount Names entity didn't mapped properly in analytic rule or None accounts provided</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(body('Entities_-_Get_Accounts')?['Accounts'])",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Entities_-_Get_Accounts": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/account"
                      }
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Initialize_variable_-_collect_source_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Entrust Secret Key Name'))}/value"
                      }
                    },
                    "HTTP_-_generate_login_token": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "applicationId": "@parameters('Entrust App ID')",
                          "enableWebSession": false,
                          "sharedSecret": "@body('Get_secret')?['value']"
                        },
                        "headers": {
                          "Accept": "application/json",
                          "Content-Type": "application/json"
                        },
                        "method": "POST",
                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/adminapi/authenticate"
                      }
                    },
                    "Initialize_variable_-_collect_group_details": {
                      "runAfter": {
                        "Initialize_variable_-_collect_user_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "group_collect",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_roles_details": {
                      "runAfter": {
                        "Initialize_variable_-_collect_group_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "roles_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_source_IP": {
                      "runAfter": {
                        "Initialize_variable_-_collect_roles_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Ip_collects",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_user_details": {
                      "runAfter": {
                        "Entities_-_Get_Accounts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "user_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_generate_login_token": {
                      "runAfter": {
                        "HTTP_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP_-_generate_login_token')",
                        "schema": {
                          "properties": {
                            "authToken": {
                              "type": "string"
                            },
                            "creationTime": {
                              "type": "string"
                            },
                            "expirationTime": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "Entrust-EnrichIncidentWithUserDetails",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Entrust identity as Service",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch User Details From Entrust",
            "description": "This playbook provides the user essential details in comments section of triggered incident so that SOC analysts can directly take corrective measure to stop the attack from unknown/compromised entity",
            "prerequisites": [
              "1. User should be having an active subscription of product to open the product documentation.",
              "2. For Json API keys , Kindly login to entrust Identity as a service portal",
              "3. Then click on left burger icon and Go to Applications under Resources",
              "4. click on + Button and search for Administration API",
              "5. Configure that and at the end save the Json object of API keys",
              "6. Make a note of Entrust application id and hostname",
              "7. Store the Shared Secret Key in keyvault Secrets."
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Entrust application id ,Entrust secret key name, host endpoint and Key vault name."
            ],
            "lastUpdateTime": "2023-02-28T00:00:00Z",
            "entities": [
              "account"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "MFA",
              "Entrust",
              "Identity"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "Entrust-EnrichIncidentWithUserDetails",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Entrust-EnrichIP-EntityTrigger Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Entrust-EnrichIP-EntityTrigger",
              "type": "string"
            },
            "Entrust App ID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust App ID"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where Entrust secret key is stored"
              }
            },
            "Entrust Secret Key Name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust Secret Key Name"
              }
            },
            "Host End Point": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Host End Point(Host name)"
              }
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Entrust App ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust App ID')]"
                    },
                    "Entrust Secret Key Name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust Secret Key Name')]"
                    },
                    "Host End Point": {
                      "type": "string",
                      "defaultValue": "[[parameters('Host End Point')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_entity": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/entity/@{encodeURIComponent('IP')}"
                      }
                    }
                  },
                  "actions": {
                    "Condition_-_checking_if_IP's_are_provided_or_not": {
                      "actions": {
                        "Condition_-_check_for_incident_arm_id": {
                          "actions": {
                            "Add_comment_to_incident_(V3)_2": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['IncidentArmID']",
                                  "message": "<p>IP Authentication events for last 24 hours :<br>\n@{body('Create_HTML_table')}&nbsp;</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              }
                            }
                          },
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@triggerBody()?['IncidentArmID']",
                                    "@null"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_-_IP_got_from_incident": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('ip_enrich')"
                          }
                        },
                        "For_each_-_IP_got_from_incident": {
                          "foreach": "@array(triggerBody()?['Entity']?['properties']?['Address'])",
                          "actions": {
                            "Condition_-_To_check_if_provided_IP_has_any_activity_in_last_24_hours": {
                              "actions": {
                                "For_each_-_appending_IP_details": {
                                  "foreach": "@body('Parse_JSON_-_Get_IP_details_from_audit_events')?['results']",
                                  "actions": {
                                    "Append_to_array_variable_-_append_IP_details_to_variable": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ip_enrich",
                                        "value": {
                                          "Login Method": "@items('For_each_-_appending_IP_details')?['token']",
                                          "eventCategory": "@items('For_each_-_appending_IP_details')?['eventCategory']",
                                          "eventOutcome": "@items('For_each_-_appending_IP_details')?['eventOutcome']",
                                          "eventType": "@items('For_each_-_appending_IP_details')?['eventType']",
                                          "eventtime": "@items('For_each_-_appending_IP_details')?['eventTime']",
                                          "sourceIp": "@items('For_each_-_appending_IP_details')?['sourceIp']",
                                          "subjectName": "@items('For_each_-_appending_IP_details')?['subjectName']",
                                          "subjectType": "@items('For_each_-_appending_IP_details')?['subjectType']"
                                        }
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_Get_IP_details_from_audit_events": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_to_array_variable": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "ip_enrich",
                                      "value": {
                                        "Login Method": "Null",
                                        "eventCategory": "No login/authentication activity",
                                        "eventOutcome": "[variables('blanks')]",
                                        "eventType": "Null",
                                        "eventtime": "Null",
                                        "sourceIp": "@items('For_each_-_IP_got_from_incident')?['Address']",
                                        "subjectName": "Null",
                                        "subjectType": "Null "
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Parse_JSON_-_Get_IP_details_from_audit_events')?['results'])",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "HTTP_-_Get_IP_details_from_audit_events": {
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "limit": 100,
                                  "orderByAttribute": {
                                    "ascending": false,
                                    "name": "eventTime"
                                  },
                                  "searchByAttributes": [
                                    {
                                      "name": "sourceIp",
                                      "operator": "EQUALS",
                                      "value": "@triggerBody()?['Entity']?['properties']?['Address']"
                                    },
                                    {
                                      "name": "eventTime",
                                      "operator": "GREATER_THAN_OR_EQUAL",
                                      "value": "@formatDateTime(subtractFromTime(utcNow(), 24, 'Hour'), 'yyyy-MM-ddTHH:mm:ss')"
                                    }
                                  ]
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v2/reports/auditeventspaged"
                              }
                            },
                            "Parse_JSON_-_Get_IP_details_from_audit_events": {
                              "runAfter": {
                                "HTTP_-_Get_IP_details_from_audit_events": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_Get_IP_details_from_audit_events')",
                                "schema": {
                                  "properties": {
                                    "paging": {
                                      "properties": {
                                        "limit": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        },
                                        "nextCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "prevCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "results": {
                                      "items": {
                                        "properties": {
                                          "accountId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "auditDetails": {
                                            "properties": {
                                              "entityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "messageTokens": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "modifiedEntityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "newValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "oldValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "newValue",
                                                    "oldValue"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "entityAction": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventCategory": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventOutcome": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventTime": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventVersion": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "message": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "requiredPermission": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "sourceIp": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subject": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "token": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "accountId",
                                          "auditDetails",
                                          "entityAction",
                                          "entityId",
                                          "entityName",
                                          "entityType",
                                          "eventCategory",
                                          "eventOutcome",
                                          "eventTime",
                                          "eventType",
                                          "eventVersion",
                                          "id",
                                          "message",
                                          "requiredPermission",
                                          "resourceId",
                                          "resourceName",
                                          "serviceProviderAdminRoleId",
                                          "serviceProviderAdminRoleName",
                                          "sourceIp",
                                          "subject",
                                          "subjectName",
                                          "subjectType",
                                          "subscriberAdminRoleId",
                                          "subscriberAdminRoleName",
                                          "token"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": [
                                    "object",
                                    "null"
                                  ]
                                }
                              }
                            }
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Condition_-_check_for_incident_arm_id_2": {
                            "actions": {
                              "Add_comment_to_incident_(V3)": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['IncidentArmID']",
                                    "message": "<p>IP entity didn't mapped properly in analytic rule or None IP provided</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            },
                            "expression": {
                              "and": [
                                {
                                  "not": {
                                    "equals": [
                                      "@triggerBody()?['IncidentArmID']",
                                      "@null"
                                    ]
                                  }
                                }
                              ]
                            },
                            "type": "If"
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(triggerBody()?['Entity']?['properties']?['Address'])",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Initialize_variable_-_collect_IP_enriched_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Entrust Secret Key Name'))}/value"
                      }
                    },
                    "HTTP_-_generate_login_token": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "applicationId": "@parameters('Entrust App ID')",
                          "enableWebSession": false,
                          "sharedSecret": "@body('Get_secret')?['value']"
                        },
                        "method": "POST",
                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/adminapi/authenticate"
                      }
                    },
                    "Initialize_variable_-_collect_IP_enriched_details": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_enrich",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_generate_login_token": {
                      "runAfter": {
                        "HTTP_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP_-_generate_login_token')",
                        "schema": {
                          "properties": {
                            "authToken": {
                              "type": "string"
                            },
                            "creationTime": {
                              "type": "string"
                            },
                            "expirationTime": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "Entrust-EnrichIP-EntityTrigger",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Entrust identity as Service",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch IP Details From Entrust - Entity",
            "description": "This playbook provides the IP details of user authentication and management activity in comments section of incident so that SOC analysts can directly take corrective measure to stop the attack from unknown/compromised entity",
            "prerequisites": [
              "1. User should be having an active subscription of product to open the product documentation.",
              "2. For Json API keys , Kindly login to entrust Identity as a service portal",
              "3. Then click on left burger icon and Go to Applications under Resources",
              "4. click on + Button and search for Administration API",
              "5. Configure that and at the end save the Json object of API keys",
              "6. Make a note of Entrust application id and hostname",
              "7. Store the Shared Secret Key in keyvault Secrets."
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Entrust application id ,Entrust secret key name, host endpoint and Key vault name."
            ],
            "lastUpdateTime": "2023-02-28T00:00:00Z",
            "entities": [
              "IP"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "MFA",
              "Entrust",
              "Identity"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "Entrust-EnrichIP-EntityTrigger",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Entrust-EnrichUser-EntityTrigger Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "Entrust-EnrichUser-EntityTrigger",
              "type": "string"
            },
            "Entrust App ID": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust App ID"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where Entrust secret key is stored"
              }
            },
            "Entrust Secret Key Name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Entrust Secret Key Name"
              }
            },
            "Host End Point": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Host End Point(Hostname)"
              }
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Entrust App ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust App ID')]"
                    },
                    "Entrust Secret Key Name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Entrust Secret Key Name')]"
                    },
                    "Host End Point": {
                      "type": "string",
                      "defaultValue": "[[parameters('Host End Point')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_entity": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/entity/@{encodeURIComponent('Account')}"
                      }
                    }
                  },
                  "actions": {
                    "Condition": {
                      "actions": {
                        "Condition__-_check_for_incident_arm_id": {
                          "actions": {
                            "Add_comment_to_incident_(V3)": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['IncidentArmID']",
                                  "message": "<p>User details fetch from Entrust :<br>\n@{body('Create_HTML_table')}<br>\n</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              }
                            }
                          },
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@triggerBody()?['IncidentArmID']",
                                    "@null"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each_-_user_accounts_received_from_incident": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('user_details')"
                          }
                        },
                        "For_each_-_user_accounts_received_from_incident": {
                          "foreach": "@array(triggerBody()?['Entity']?['properties']?['Name'])",
                          "actions": {
                            "Append_to_array_variable_-_Combining_details": {
                              "runAfter": {
                                "Condition_2_-_to_check_if_user_has_logged_in_last_24_hours": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "user_details",
                                "value": {
                                  "Email": "@body('Parse_JSON_-Get_User')?['email']",
                                  "First Name": "@body('Parse_JSON_-Get_User')?['firstName']",
                                  "Group assigned": "@replace(string(variables('group_collect')),'\"',' ')",
                                  "Last Auth Time": "@body('Parse_JSON_-Get_User')?['lastAuthTime']",
                                  "Last Name": "@body('Parse_JSON_-Get_User')?['lastName']",
                                  "Mobile": "@body('Parse_JSON_-Get_User')?['mobile']",
                                  "Roles": "@replace(string(variables('roles_details')),'\"',' ')",
                                  "Source IP": "@replace(string(union(variables('Ip_collects'),variables('Ip_collects'))),'\"','')",
                                  "State": "@body('Parse_JSON_-Get_User')?['state']",
                                  "UUID": "@body('Parse_JSON_-Get_User')?['id']",
                                  "user ID": "@body('Parse_JSON_-Get_User')?['userId']"
                                }
                              }
                            },
                            "Compose_4": {
                              "runAfter": {
                                "Condition_-_checking_for_null_group_values": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": "@variables('group_collect')"
                            },
                            "Condition_-_checking_for_null_group_values": {
                              "actions": {
                                "For_each_-_fetching_all_group_details": {
                                  "foreach": "@body('Parse_JSON_-Get_User')?['groups']",
                                  "actions": {
                                    "Append_to_array_variable_-_collect_group": {
                                      "runAfter": {
                                        "Parse_JSON_-_Get_group_Details": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "group_collect",
                                        "value": "@body('Parse_JSON_-_Get_group_Details')?['name']"
                                      }
                                    },
                                    "HTTP_-_Get_Group_Details": {
                                      "type": "Http",
                                      "inputs": {
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                        },
                                        "method": "GET",
                                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/groups/@{items('For_each_-_fetching_all_group_details')?['id']}"
                                      }
                                    },
                                    "Parse_JSON_-_Get_group_Details": {
                                      "runAfter": {
                                        "HTTP_-_Get_Group_Details": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ParseJson",
                                      "inputs": {
                                        "content": "@body('HTTP_-_Get_Group_Details')",
                                        "schema": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "type": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "Set_variable_3_-_initializing_null": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Parse_JSON_-Get_User')?['groups'])",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Condition_2_-_to_check_if_user_has_logged_in_last_24_hours": {
                              "actions": {
                                "For_each": {
                                  "foreach": "@body('Parse_JSON_-_collecting_source_IP')?['results']",
                                  "actions": {
                                    "Append_to_array_variable_-_collect_ip_in_array": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "Ip_collects",
                                        "value": "@items('For_each')?['sourceIp']"
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_collecting_source_IP": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@length(body('Parse_JSON_-_collecting_source_IP')?['results'])",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "For_each_-_collecting_roles_details": {
                              "foreach": "@body('Parse_JSON_-_role_assigned')",
                              "actions": {
                                "Append_to_array_variable_-_collecting_roles_in_array": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "roles_details",
                                    "value": "@items('For_each_-_collecting_roles_details')['name']"
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_-_role_assigned": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "HTTP_-_Get_User": {
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "userId": "@body('Parse_JSON_-_sentinel_entity')?['entity']?['properties']?['displayName']"
                                },
                                "headers": {
                                  "Accept": "application/json",
                                  "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v3/users/userid"
                              }
                            },
                            "HTTP_-_collecting_source_IP_last_24_hours": {
                              "runAfter": {
                                "For_each_-_collecting_roles_details": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "body": {
                                  "limit": 100,
                                  "orderByAttribute": {
                                    "ascending": false,
                                    "name": "eventTime"
                                  },
                                  "searchByAttributes": [
                                    {
                                      "name": "subjectName",
                                      "operator": "EQUALS",
                                      "value": "@body('Parse_JSON_-_sentinel_entity')?['entity']?['properties']?['displayName']"
                                    },
                                    {
                                      "name": "eventTime",
                                      "operator": "GREATER_THAN_OR_EQUAL",
                                      "value": "@formatDateTime(subtractFromTime(utcNow(),24,'Hour'),'yyyy-MM-ddTHH:mm:ss')"
                                    }
                                  ]
                                },
                                "method": "POST",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v2/reports/auditeventspaged"
                              }
                            },
                            "HTTP_-_get_roles_assigned": {
                              "runAfter": {
                                "Compose_4": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Http",
                              "inputs": {
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@body('Parse_JSON_-_generate_login_token')?['authToken']"
                                },
                                "method": "GET",
                                "uri": "https://@{parameters('Host End Point')}/api/web/v1/users/@{body('Parse_JSON_-Get_User')?['id']}/roles"
                              }
                            },
                            "Parse_JSON_-Get_User": {
                              "runAfter": {
                                "HTTP_-_Get_User": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_Get_User')",
                                "schema": {
                                  "properties": {
                                    "authenticatorLockoutStatus": {
                                      "items": {
                                        "properties": {
                                          "lockoutDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lockoutExpiryDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "remainingAuthenticationAttempts": {
                                            "type": [
                                              "integer",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "lockoutDate",
                                          "lockoutExpiryDate",
                                          "remainingAuthenticationAttempts",
                                          "type"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "directoryDN": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryId": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryObjectGUID": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "directoryType": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "email": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "externalId": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "externalSource": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "fidoTokens": {
                                      "items": {
                                        "properties": {
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "createDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUsedDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userIdStored": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "userUUID": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "allowedActions",
                                          "createDate",
                                          "id",
                                          "lastUsedDate",
                                          "name",
                                          "state",
                                          "userId",
                                          "userIdStored",
                                          "userUUID"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "firstName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "grids": {
                                      "items": {
                                        "properties": {
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "assignDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "createDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "expired": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "expiryDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "gridContents": {
                                            "items": {
                                              "items": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "type": [
                                                "array",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "groups": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUsedDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serialNumber": {
                                            "type": [
                                              "integer",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "allowedActions",
                                          "assignDate",
                                          "createDate",
                                          "expired",
                                          "expiryDate",
                                          "gridContents",
                                          "groups",
                                          "id",
                                          "lastUsedDate",
                                          "serialNumber",
                                          "state",
                                          "userId",
                                          "userName"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "groups": {
                                      "items": {
                                        "properties": {
                                          "externalId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "externalId",
                                          "id",
                                          "name",
                                          "type"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "id": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "lastAuthTime": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "lastName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "locale": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "locked": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "lockedAuthenticatorTypes": {
                                      "items": {
                                        "type": [
                                          "string",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "lockedAuthenticators": {
                                      "items": {
                                        "type": [
                                          "string",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "lockoutExpiry": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "migrated": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "mobile": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "oauthRoles": {
                                      "items": {
                                        "properties": {
                                          "ancestorIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "descendantIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "description": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "inheritedResourceServerScopeIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "parentId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceServerScopeIds": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "ancestorIds",
                                          "descendantIds",
                                          "description",
                                          "id",
                                          "inheritedResourceServerScopeIds",
                                          "name",
                                          "parentId",
                                          "resourceServerScopeIds"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "otpCreateTime": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "passwordExpirationTime": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "phone": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "preferredOtpDelivery": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "preferredOtpDeliveryContactAttributes": {
                                      "properties": {
                                        "OTP_EMAIL": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "OTP_SMS": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "OTP_VOICE": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "registrationEnabled": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "registrationRequired": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "smartCredentials": {
                                      "items": {
                                        "properties": {
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "cardDigitalConfig": {
                                            "properties": {
                                              "allCAGroups": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "caGroups": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "caId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caName": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "certTemplates": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "pivContainer": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "name",
                                                    "pivContainer"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "certificateType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "digitalIdConfigTemplateId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "directoryEntry": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "dnFormat": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "dnFormatSearchbaseIncluded": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "role": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "searchbase": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "subjectAltNames": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "variables": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "includedInDN": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "includedInDN",
                                                    "name",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "cardDigitalConfigId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "cardDigitalConfigRequired": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "cardHolderDigitalConfig": {
                                            "properties": {
                                              "allCAGroups": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "caGroups": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "caId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caName": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "caType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "certTemplates": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "pivContainer": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "name",
                                                    "pivContainer"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "certificateType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "digitalIdConfigTemplateId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "directoryEntry": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "dnFormat": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "dnFormatSearchbaseIncluded": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "role": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "searchbase": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "subjectAltNames": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "userType": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "variables": {
                                                "items": {
                                                  "properties": {
                                                    "digitalIdConfigId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "includedInDN": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "digitalIdConfigId",
                                                    "id",
                                                    "includedInDN",
                                                    "name",
                                                    "type",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "cardHolderDigitalConfigId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "cardHolderDigitalConfigRequired": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "certificates": {
                                            "items": {
                                              "properties": {
                                                "description": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdId": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdType": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "id": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "issuerDN": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "notAfter": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "notBefore": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "pivContainer": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "serialNumber": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "status": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "subjectDN": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "required": [
                                                "description",
                                                "digitalIdId",
                                                "digitalIdType",
                                                "id",
                                                "issuerDN",
                                                "notAfter",
                                                "notBefore",
                                                "pivContainer",
                                                "serialNumber",
                                                "status",
                                                "subjectDN"
                                              ],
                                              "type": [
                                                "object",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "chipId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "digitalIds": {
                                            "items": {
                                              "properties": {
                                                "certificates": {
                                                  "items": {
                                                    "properties": {
                                                      "description": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "digitalIdId": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "digitalIdType": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "id": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "issuerDN": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "notAfter": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "notBefore": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "pivContainer": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "serialNumber": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "status": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      },
                                                      "subjectDN": {
                                                        "type": [
                                                          "string",
                                                          "null"
                                                        ]
                                                      }
                                                    },
                                                    "required": [
                                                      "description",
                                                      "digitalIdId",
                                                      "digitalIdType",
                                                      "id",
                                                      "issuerDN",
                                                      "notAfter",
                                                      "notBefore",
                                                      "pivContainer",
                                                      "serialNumber",
                                                      "status",
                                                      "subjectDN"
                                                    ],
                                                    "type": [
                                                      "object",
                                                      "null"
                                                    ]
                                                  },
                                                  "type": [
                                                    "array",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdConfigId": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdConfigName": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "digitalIdConfigType": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "dn": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "id": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "required": [
                                                "certificates",
                                                "digitalIdConfigId",
                                                "digitalIdConfigName",
                                                "digitalIdConfigType",
                                                "dn",
                                                "id"
                                              ],
                                              "type": [
                                                "object",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "encodeMsg": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "encodeState": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "enrollState": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "expiryDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "issueDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "notifyEnabled": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "platform": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "scDefnId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "scDefnName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serialNumber": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userUserId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "variableValues": {
                                            "items": {
                                              "properties": {
                                                "scDefnVariable": {
                                                  "properties": {
                                                    "defaultValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "displayable": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "generate": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "generateLength": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "id": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "modifiable": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "order": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "prompt": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "required": {
                                                      "type": [
                                                        "boolean",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionDigits": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionLower": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionMax": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionMin": {
                                                      "type": [
                                                        "integer",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionRegex": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionSpecial": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "restrictionUpper": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "scDefnId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "type": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "uniqueness": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "uniquenessScopeId": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "scDefnVariableId": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "value": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                }
                                              },
                                              "required": [
                                                "scDefnVariable",
                                                "scDefnVariableId",
                                                "value"
                                              ],
                                              "type": [
                                                "object",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "version": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "allowedActions",
                                          "cardDigitalConfig",
                                          "cardDigitalConfigId",
                                          "cardDigitalConfigRequired",
                                          "cardHolderDigitalConfig",
                                          "cardHolderDigitalConfigId",
                                          "cardHolderDigitalConfigRequired",
                                          "certificates",
                                          "chipId",
                                          "digitalIds",
                                          "encodeMsg",
                                          "encodeState",
                                          "enrollState",
                                          "expiryDate",
                                          "id",
                                          "issueDate",
                                          "notifyEnabled",
                                          "platform",
                                          "scDefnId",
                                          "scDefnName",
                                          "serialNumber",
                                          "state",
                                          "userId",
                                          "userUserId",
                                          "variableValues",
                                          "version"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "state": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "tempAccessCode": {
                                      "properties": {
                                        "code": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "createDate": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "expired": {
                                          "type": [
                                            "boolean",
                                            "null"
                                          ]
                                        },
                                        "expiryDate": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "id": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "maxUses": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        },
                                        "numUses": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "tokens": {
                                      "items": {
                                        "properties": {
                                          "algorithmType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "allowedActions": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "description": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "groups": {
                                            "items": {
                                              "type": [
                                                "string",
                                                "null"
                                              ]
                                            },
                                            "type": [
                                              "array",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "label": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUsedDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "loadDate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "logo": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "platform": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "registeredForTransactions": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "serialNumber": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "state": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "supportsChallengeResponse": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsResponse": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsSignature": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsUnlock": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "supportsUnlockTOTP": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "algorithmType",
                                          "allowedActions",
                                          "description",
                                          "groups",
                                          "id",
                                          "label",
                                          "lastUsedDate",
                                          "loadDate",
                                          "logo",
                                          "name",
                                          "platform",
                                          "registeredForTransactions",
                                          "serialNumber",
                                          "state",
                                          "supportsChallengeResponse",
                                          "supportsResponse",
                                          "supportsSignature",
                                          "supportsUnlock",
                                          "supportsUnlockTOTP",
                                          "type",
                                          "userId"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "type": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "userAliases": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "value": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "type",
                                          "userId",
                                          "value"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "userAttributeValues": {
                                      "items": {
                                        "properties": {
                                          "editable": {
                                            "type": [
                                              "boolean",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "lastUpdate": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userAttribute": {
                                            "properties": {
                                              "id": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "mandatory": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "name": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "systemDefined": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              },
                                              "type": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              },
                                              "unique": {
                                                "type": [
                                                  "boolean",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "userAttributeId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "userId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "value": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "editable",
                                          "id",
                                          "lastUpdate",
                                          "userAttribute",
                                          "userAttributeId",
                                          "userId",
                                          "value"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "userExtraAttributes": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "name": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "type": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "value": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "name",
                                          "type",
                                          "value"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    },
                                    "userId": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "userPrincipalName": {
                                      "type": [
                                        "string",
                                        "null"
                                      ]
                                    },
                                    "verificationEnabled": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    },
                                    "verificationRequired": {
                                      "type": [
                                        "boolean",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": [
                                    "object",
                                    "null"
                                  ]
                                }
                              }
                            },
                            "Parse_JSON_-_collecting_source_IP": {
                              "runAfter": {
                                "HTTP_-_collecting_source_IP_last_24_hours": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_collecting_source_IP_last_24_hours')",
                                "schema": {
                                  "properties": {
                                    "paging": {
                                      "properties": {
                                        "limit": {
                                          "type": [
                                            "integer",
                                            "null"
                                          ]
                                        },
                                        "nextCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        },
                                        "prevCursor": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": [
                                        "object",
                                        "null"
                                      ]
                                    },
                                    "results": {
                                      "items": {
                                        "properties": {
                                          "accountId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "auditDetails": {
                                            "properties": {
                                              "entityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "value": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "value"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "messageTokens": {
                                                "items": {
                                                  "type": [
                                                    "string",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              },
                                              "modifiedEntityAttributes": {
                                                "items": {
                                                  "properties": {
                                                    "name": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "newValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    },
                                                    "oldValue": {
                                                      "type": [
                                                        "string",
                                                        "null"
                                                      ]
                                                    }
                                                  },
                                                  "required": [
                                                    "name",
                                                    "newValue",
                                                    "oldValue"
                                                  ],
                                                  "type": [
                                                    "object",
                                                    "null"
                                                  ]
                                                },
                                                "type": [
                                                  "array",
                                                  "null"
                                                ]
                                              }
                                            },
                                            "type": [
                                              "object",
                                              "null"
                                            ]
                                          },
                                          "entityAction": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "entityType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventCategory": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventOutcome": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventTime": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "eventVersion": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "id": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "message": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "requiredPermission": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "resourceName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "serviceProviderAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "sourceIp": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subject": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subjectType": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleId": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "subscriberAdminRoleName": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          },
                                          "token": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "required": [
                                          "accountId",
                                          "auditDetails",
                                          "entityAction",
                                          "entityId",
                                          "entityName",
                                          "entityType",
                                          "eventCategory",
                                          "eventOutcome",
                                          "eventTime",
                                          "eventType",
                                          "eventVersion",
                                          "id",
                                          "message",
                                          "requiredPermission",
                                          "resourceId",
                                          "resourceName",
                                          "serviceProviderAdminRoleId",
                                          "serviceProviderAdminRoleName",
                                          "sourceIp",
                                          "subject",
                                          "subjectName",
                                          "subjectType",
                                          "subscriberAdminRoleId",
                                          "subscriberAdminRoleName",
                                          "token"
                                        ],
                                        "type": [
                                          "object",
                                          "null"
                                        ]
                                      },
                                      "type": [
                                        "array",
                                        "null"
                                      ]
                                    }
                                  },
                                  "type": [
                                    "object",
                                    "null"
                                  ]
                                }
                              }
                            },
                            "Parse_JSON_-_role_assigned": {
                              "runAfter": {
                                "HTTP_-_get_roles_assigned": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@body('HTTP_-_get_roles_assigned')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "allRoles": {
                                        "type": "boolean"
                                      },
                                      "defaultRole": {
                                        "type": "boolean"
                                      },
                                      "description": {
                                        "type": "string"
                                      },
                                      "groupManagement": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "managedRoles": {
                                        "type": "array"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "permissions": {
                                        "type": "array"
                                      },
                                      "roleType": {
                                        "type": "string"
                                      },
                                      "superAdministrator": {
                                        "type": "boolean"
                                      }
                                    },
                                    "required": [
                                      "id",
                                      "name",
                                      "description",
                                      "roleType",
                                      "defaultRole",
                                      "superAdministrator",
                                      "permissions",
                                      "allRoles",
                                      "managedRoles",
                                      "groupManagement",
                                      "groupIds"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            },
                            "Set_variable_-_initializing_null": {
                              "runAfter": {
                                "Parse_JSON_-Get_User": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "roles_details",
                                "value": "@null"
                              }
                            },
                            "Set_variable_2_-initializing_null": {
                              "runAfter": {
                                "Set_variable_-_initializing_null": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "group_collect",
                                "value": "@null"
                              }
                            },
                            "Set_variable_3_-_initializing_null": {
                              "runAfter": {
                                "Set_variable_2_-initializing_null": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "Ip_collects",
                                "value": "@null"
                              }
                            }
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 1
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Condition_-_check_for_incident_arm_id2": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['IncidentArmID']",
                                    "message": "<p>Acount Names entity didn't mapped properly in analytic rule or None accounts provided</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            },
                            "expression": {
                              "and": [
                                {
                                  "not": {
                                    "equals": [
                                      "@triggerBody()?['IncidentArmID']",
                                      ""
                                    ]
                                  }
                                }
                              ]
                            },
                            "type": "If"
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(triggerBody()?['Entity']?['properties']?['Name'])",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Initialize_variable_-_collect_source_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault_1']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Entrust Secret Key Name'))}/value"
                      }
                    },
                    "HTTP_-_generate_login_token": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "applicationId": "@parameters('Entrust App ID')",
                          "enableWebSession": false,
                          "sharedSecret": "@body('Get_secret')?['value']"
                        },
                        "headers": {
                          "Accept": "application/json",
                          "Content-Type": "application/json"
                        },
                        "method": "POST",
                        "uri": "https://@{parameters('Host End Point')}/api/web/v1/adminapi/authenticate"
                      }
                    },
                    "Initialize_variable_-_collect_group_details": {
                      "runAfter": {
                        "Initialize_variable_-_collect_user_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "group_collect",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_roles_details": {
                      "runAfter": {
                        "Initialize_variable_-_collect_group_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "roles_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_source_IP": {
                      "runAfter": {
                        "Initialize_variable_-_collect_roles_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Ip_collects",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_collect_user_details": {
                      "runAfter": {
                        "Parse_JSON_-_sentinel_entity": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "user_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_generate_login_token": {
                      "runAfter": {
                        "HTTP_-_generate_login_token": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP_-_generate_login_token')",
                        "schema": {
                          "properties": {
                            "authToken": {
                              "type": "string"
                            },
                            "creationTime": {
                              "type": "string"
                            },
                            "expirationTime": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_JSON_-_sentinel_entity": {
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()",
                        "schema": {
                          "properties": {
                            "entity": {
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "kind": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "properties": {
                                  "properties": {
                                    "Name": {
                                      "type": "string"
                                    },
                                    "displayName": {
                                      "type": "string"
                                    },
                                    "friendlyName": {
                                      "type": "string"
                                    },
                                    "isDomainJoined": {
                                      "type": "boolean"
                                    },
                                    "upnSuffix": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "type": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            },
                            "tenantId": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "Entrust-EnrichUser-EntityTrigger",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Entrust identity as Service",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch User Details From Entrust - Entity",
            "description": "This playbook provides the user essential details in comments section of incident so that SOC analysts can directly take corrective measure to stop the attack from unknown/compromised entity",
            "prerequisites": [
              "1. User should be having an active subscription of product to open the product documentation.",
              "2. For Json API keys , Kindly login to entrust Identity as a service portal",
              "3. Then click on left burger icon and Go to Applications under Resources",
              "4. click on + Button and search for Administration API",
              "5. Configure that and at the end save the Json object of API keys",
              "6. Make a note of Entrust application id and hostname",
              "7. Store the Shared Secret Key in keyvault Secrets."
            ],
            "postDeployment": [
              "1. During deployment you need to provide your Entrust application id ,Entrust secret key name, host endpoint and Key vault name."
            ],
            "lastUpdateTime": "2023-02-28T00:00:00Z",
            "entities": [
              "account"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "MFA",
              "Entrust",
              "Identity"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId5')]",
        "contentKind": "Playbook",
        "displayName": "Entrust-EnrichUser-EntityTrigger",
        "contentProductId": "[variables('_playbookcontentProductId5')]",
        "id": "[variables('_playbookcontentProductId5')]",
        "version": "[variables('playbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Entrust identity as Service",
        "publisherDisplayName": "Microsoft Sentinel, Microsoft Corporation",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>Entrust  offers Cloud-based identity and access management (IAM) solution with multi-factor authentication (MFA), credential-based password less access, and single sign-on (SSO). Integrating it with Microsoft Sentinel will give the ability to enrich incidents and mangae user entity access as part of incident remediation process.</p>\n<p><strong>Playbooks:</strong> 5</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Entrustlogo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Entrust identity as Service",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "Playbook",
              "contentId": "[variables('_Entrust-BlockUser')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Entrust-EnrichIncidentWithIPDetails')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Entrust-EnrichIncidentWithUserDetails')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Entrust-EnrichIP-EntityTrigger')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_Entrust-EnrichUser-EntityTrigger')]",
              "version": "[variables('playbookVersion5')]"
            }
          ]
        },
        "firstPublishDate": "2023-05-22",
        "providers": [
          "Entrust"
        ],
        "categories": {
          "domains": [
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
