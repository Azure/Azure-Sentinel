{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace-location": {
            "type": "string"
        },
        "workspace": {
            "type": "string"
        },
        "Organisation": {
            "type": "string"
        },
        "ApiKey": {
            "type": "string"
        },
        "Index": {
            "type": "string",
            "defaultValue": "NetskopeCCP"
        },
        "dcrConfig": {
            "type": "object"
        }
    },
    "resources": [
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_alerts_watchlist')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeAlerts_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeAlerts",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/alerts/watchlist?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_alerts_content')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeAlerts_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeAlerts",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/alerts/content?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_alerts_device')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeAlerts_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeAlerts",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/alerts/device?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_application')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsApplication_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsApplication",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/application?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_audit')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsAudit_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsAudit",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/audit?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_connection')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsConnection_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsConnection",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/connection?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_dlp')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsDLP_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsDLP",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/incident?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_endpoint')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsEndpoint_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsEndpoint",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/endpoint?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_infrastructure')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsInfrastructure_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsInfrastructure",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/infrastructure?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_network')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsNetwork_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsNetwork",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/network?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
            "apiVersion": "2023-02-01-preview",
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/NetskopeCCP_events_page')]",
            "location": "[parameters('workspace-location')]",
            "kind": "RestApiPoller",
            "properties": {
                "connectorDefinitionName": "NetskopeCCP",
                "dataType": "NetskopeEventsPage_CL",
                "dcrConfig": {
                    "streamName": "Custom-NetskopeEventsPage",
                    "dataCollectionEndpoint": "[parameters('dcrConfig').dataCollectionEndpoint]",
                    "dataCollectionRuleImmutableId": "[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                    "type": "APIKey",
                    "ApiKeyName": "Netskope-Api-Token",
                    "ApiKey": "[parameters('ApiKey')]"
                },
                "request": {
                    "apiEndpoint": "[concat('https://', parameters('Organisation'), '.goskope.com/api/v2/events/dataexport/events/page?operation=next&index=', parameters('Index'))]",
                    "httpMethod": "GET",
                    "queryWindowInMin": 5,
                    "queryTimeFormat": "UnixTimestamp",
                    "rateLimitQps": 10,
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                        "Accept": "application/json"
                    }
                },
                "response": {
                    "eventsJsonPaths": [
                        "$.result"
                    ]
                }
            }
        }
    ]
}