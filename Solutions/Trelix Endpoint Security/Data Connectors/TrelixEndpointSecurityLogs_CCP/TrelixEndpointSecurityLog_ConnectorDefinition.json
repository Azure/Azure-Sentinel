{
    "name": "TrelixEndpointSecurityCCPDefinition",
    "apiVersion": "2022-09-01-preview",
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": 
    {

        "connectorUiConfig": {
            "id": "TrelixEndpointSecurityCCPDefinition",
            "title": " TrelixEndpointSecurity Connector",
            "publisher" : "Microsoft",
            "descriptionMarkdown" : "Provides capability to ingest the Endpoint Security from Trelix API's",
            "graphQueriesTableName" : "TrelixEndpointSecurityEvents_CL",
            "graphQueries": [
                { 
                    "metricName":"Total EndpointSecurity Events",
                    "legend":"Trelix EndpointSecurity Events Logs",
                    "baseQuery": "{{graphQueriesTableName}}"
                },

                {
                    "metricName":"Total EndpointSecurity Audit",
                    "legend":"Trelix EndpointSecurity Audit Logs",
                    "baseQuery": "TrelixEndpointSecurityAudit_CL"
                },
                {
                    "metricName":"Total EndpointSecurity Threats",
                    "legend":"Trelix EndpointSecurity Threats Logs",
                    "baseQuery": "TrelixEndpointSecurityThreats_CL"
                }
            ],
            "sampleQueries":[
                {
                    "description": "Sample of EndpointSecurity Events",
                    "query": "{{graphQueriesTableName}}\n| take 10"
                },
                {
                    "description": "Sample of EndpointSecurity Audit",
                    "query": "TrelixEndpointSecurityAudit_CL\n| take 10"
                },
                {
                    "description": "Sample of EndpointSecurity Threats",
                    "query": "TrelixEndpointSecurityThreats_CL\n| take 10"
                }
            ],
            "dataTypes":[
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | summarize Time=max(TimeGenerated) \n | where isnotempty(Time)"
                },
                {
                    "name": "TrelixEndpointSecurityAudit_CL",
                    "lastDataReceivedQuery": "TrelixEndpointSecurityAudit_CL\n | summarize Time=max(TimeGenerated) \n | where isnotempty(Time)"
                },
                {
                    "name": "TrelixEndpointSecurityThreats_CL",
                    "lastDataReceivedQuery": "TrelixEndpointSecurityThreats_CL\n | summarize Time=max(TimeGenerated) \n | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria":[
                {
                    "type": "HasDataConnectors"
                }
            ],
            "permissions":{
                "resourceProvider":[
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText":"Read and Write permission are required",
                        "providerDisplayName":"Workspace",
                        "scope":"Workspace",
                        "requiredPermissions":{
                            "write": true,
                            "read":true,
                            "delete": true
                        }
                    }
                ],
                "customs":[
                    {
                        "name": "Trelix EndpointSecurity API Access",
                        "description":"Trelix EndpointSecurity API requires a client id and client secret to authenticate"
                    }
                ]
            },
            "instructionSteps":[
                {
                    "description": ">Note: Configurations to connect to Trelix EndpointSecurity Rest API\n"
                },
                {
                    "description": "Step 1: Create credentials from Trelix EndpointSecurity console. Refer this doc for steps:-  https://docs.trellix.com\n"
                },
                {
                    "description": "Step 2: Enter the hostname. For public cloud its apis.Trelix EndpointSecurity.com\n"
                },
                {
                    "description": "Step 3: Enter client id and client secret key\n"
                },
                {
                    "description": "Provide required values:\n",
                    "instructions":[

                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "x-api-key",
                                "placeholder": "Example:QUJaYW8rYTM2SXNXbkdTcVZFcGhYZy8xSG4zL0ZVbU5aZTBJenk3NWh1QTp1cy13ZXN0LTI",
                                "type": "text",
                                "name": "x-api-key"
                            }
                        },

                        {
                            "type": "OAuthForm",
                            "parameters":{
                                "clientIdLabel":"Client ID",
                                "clientSecretLabel" : "Client Secret",
                                "connectButtonLabel":"Connect",
                                "disconnectButtonLabel": "Disconnect"

                            }
                        }
                    ],
                    "title": "Connect to Trelix EndpointSecurity API to start collecting logs in Microsoft Sentinel"
                }
            ]             
        }
    }
}