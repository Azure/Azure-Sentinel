[
    {
        "name": "TrelixEndpointSecurityEvents",
        "apiVersion": "2022-12-01-preview",
        "type": "Microsoft.SecurityInsights/dataConnectors",
        "location": "{{location}}",
        "kind": "RestApiPoller",
        "properties": {
            "connectorDefinitionName": "TrelixEndpointSecurityCCPDefinition",
            "dataType": "TrelixEndpointSecurityEvents_CL",
            "dcrConfig": {
                "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
                "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}",
                "streamName": "Custom-TrelixESecurityEvents"
            },
            "auth": {
                "type": "OAuth2",
                "clientSecret": "{{clientSecret}}",
                "clientId": "{{clientId}}",
                "tokenEndpoint": "https://auth.trellix.com/auth/realms/IAM/protocol/openid-connect/token",
                "tokenEndpointHeaders": {
                    "Accept": "application/json",
                    "Content-Type": "application/x-www-form-urlencoded",
                    "x-api-key": "{{x-api-key}}",
                    "scope":"epo.evt.r",
                    "Authorization": "[[concat('Basic ', base64(concat(parameters('ClientId'), ':', parameters('ClientSecret'))))]"
                },
                "TokenEndpointQueryParameters": {},
                "grantType": "client_credentials"
            },
            "request": {
                "apiEndpoint": "https://api.manage.trellix.com/epo/v2/events",
                "rateLimitQPS": 10,
                "queryWindowInMin": 15,
                "httpMethod": "GET",
                "retryCount": 3,
                "timeoutInSeconds": 30,
                "headers": {
                    "Accept": "application/json",
                    "x-api-key": "{{x-api-key}}"
                }
            },
            "paging": {
                "pagingType": "NextPageToken",
                "nextPageParaName": "cursor"
            },
            "response": {
                "eventsJsonPaths": [
                    "$.data"
                ],
                "format": "json"
            }
        }
    },
    {
        "name": "TrelixEndpointSecurityAudit",
        "apiVersion": "2022-12-01-preview",
        "type": "Microsoft.SecurityInsights/dataConnectors",
        "location": "{{location}}",
        "kind": "RestApiPoller",
        "properties": {
            "connectorDefinitionName": "TrelixEndpointSecurityCCPDefinition",
            "dataType": "TrelixEndpointSecurityAudit_CL",
            "dcrConfig": {
                "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
                "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}",
                "streamName": "Custom-TrelixESAudit"
            },
            "auth": {
                "type": "OAuth2",
                "clientSecret": "{{clientSecret}}",
                "clientId": "{{clientId}}",
                "tokenEndpoint": "https://auth.trellix.com/auth/realms/IAM/protocol/openid-connect/token",
                "tokenEndpointHeaders": {
                    "Accept": "application/json",
                    "Content-Type": "application/x-www-form-urlencoded",
                    "x-api-key": "{{x-api-key}}",
                    "scope":"audit.svc.r",
                    "Authorization": "[[concat('Basic ', base64(concat(parameters('ClientId'), ':', parameters('ClientSecret'))))]"
                },
                "TokenEndpointQueryParameters": {},
                "grantType": "client_credentials"
            },
            "request": {
                "apiEndpoint": "https://api.manage.trellix.com/epo/v2/auditLogs",
                "rateLimitQPS": 10,
                "queryWindowInMin": 15,
                "httpMethod": "GET",
                "retryCount": 3,
                "timeoutInSeconds": 30,
                "headers": {
                    "Accept": "application/json",
                    "x-api-key": "{{x-api-key}}"
                }
            },
            "paging": {
                "pagingType": "NextPageToken",
                "nextPageParaName": "cursor"
            },
            "response": {
                "eventsJsonPaths": [
                    "$.data"
                ],
                "format": "json"
            }
        }
    },
    {
        "name": "TrelixEndpointSecurityThreat",
        "apiVersion": "2022-12-01-preview",
        "type": "Microsoft.SecurityInsights/dataConnectors",
        "location": "{{location}}",
        "kind": "RestApiPoller",
        "properties": {
            "connectorDefinitionName": "TrelixEndpointSecurityCCPDefinition",
            "dataType": "TrelixEndpointSecurityThreats_CL",
            "dcrConfig": {
                "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
                "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}",
                "streamName": "Custom-TrelixESThreats"
            },
            "auth": {
                "type": "OAuth2",
                "clientSecret": "{{clientSecret}}",
                "clientId": "{{clientId}}",
                "tokenEndpoint": "https://auth.trellix.com/auth/realms/IAM/protocol/openid-connect/token",
                "tokenEndpointHeaders": {
                    "Accept": "application/json",
                    "Content-Type": "application/x-www-form-urlencoded",
                    "x-api-key": "{{x-api-key}}",
                    "scope":"soc.act.tg",
                    "Authorization": "[[concat('Basic ', base64(concat(parameters('ClientId'), ':', parameters('ClientSecret'))))]"
                },
                "TokenEndpointQueryParameters": {},
                "grantType": "client_credentials"
            },
            "request": {
                "apiEndpoint": "https://api.manage.trellix.com/epo/v2/threats",
                "rateLimitQPS": 10,
                "queryWindowInMin": 15,
                "httpMethod": "GET",
                "retryCount": 3,
                "timeoutInSeconds": 30,
                "headers": {
                    "Accept": "application/json",
                    "x-api-key": "{{x-api-key}}"
                }
            },
            "paging": {
                "pagingType": "NextPageToken",
                "nextPageParaName": "cursor"
            },
            "response": {
                "eventsJsonPaths": [
                    "$.data"
                ],
                "format": "json"
            }
        }
    }
]