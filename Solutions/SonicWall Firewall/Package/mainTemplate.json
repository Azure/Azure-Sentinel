{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "SonicWall",
    "comments": "Solution template for SonicWall Firewall"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "SonicWall Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "SonicWall Firewall",
    "_solutionVersion": "3.1.0",
    "solutionId": "sonicwall-inc.sonicwall-networksecurity-azure-sentinal",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "SonicWallFirewall",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "SonicWallFirewall",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "uiConfigId2": "SonicWallFirewallAma",
    "_uiConfigId2": "[variables('uiConfigId2')]",
    "dataConnectorContentId2": "SonicWallFirewallAma",
    "_dataConnectorContentId2": "[variables('dataConnectorContentId2')]",
    "dataConnectorId2": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
    "_dataConnectorId2": "[variables('dataConnectorId2')]",
    "dataConnectorTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId2'))))]",
    "dataConnectorVersion2": "1.0.0",
    "_dataConnectorcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId2'),'-', variables('dataConnectorVersion2'))))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "SonicWallWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "27f1a570-5f20-496b-88f6-a9aa2c5c9534",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '27f1a570-5f20-496b-88f6-a9aa2c5c9534')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('27f1a570-5f20-496b-88f6-a9aa2c5c9534')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','27f1a570-5f20-496b-88f6-a9aa2c5c9534','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "3db9f99e-a459-41e0-8e02-8b332f5fcb2c",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '3db9f99e-a459-41e0-8e02-8b332f5fcb2c')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('3db9f99e-a459-41e0-8e02-8b332f5fcb2c')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','3db9f99e-a459-41e0-8e02-8b332f5fcb2c','-', '1.0.0')))]"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "dedb8fb9-3caa-4b00-ae88-1898eed78917",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('dedb8fb9-3caa-4b00-ae88-1898eed78917')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SonicWall Firewall data connector with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "[Deprecated] SonicWall Firewall via Legacy Agent",
                  "publisher": "SonicWall",
                  "descriptionMarkdown": "Common Event Format (CEF) is an industry standard format on top of Syslog messages, used by SonicWall to allow event interoperability among different platforms. By connecting your CEF logs to Microsoft Sentinel, you can take advantage of search & correlation, alerting, and threat intelligence enrichment for each log.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "SonicWall",
                      "baseQuery": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\""
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Summarize by destination IP and port",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize count() by DestinationIP, DestinationPort, TimeGenerated\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Show all dropped traffic from the SonicWall Firewall",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| where AdditionalExtensions contains \"fw_action='drop'\""
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog (SonicWall)",
                      "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize LastLogReceived = max(TimeGenerated)\n| project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                      "innerSteps": [
                        {
                          "title": "1.1 Select or create a Linux machine",
                          "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                        },
                        {
                          "title": "1.2 Install the CEF collector on the Linux machine",
                          "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                          "instructions": [
                            {
                              "parameters": {
                                "fillWith": [
                                  "WorkspaceId",
                                  "PrimaryKey"
                                ],
                                "label": "Run the following command to install and apply the CEF collector:",
                                "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                              },
                              "type": "CopyableLabel"
                            }
                          ]
                        }
                      ],
                      "title": "1. Linux Syslog agent configuration"
                    },
                    {
                      "description": "Set your SonicWall Firewall to send Syslog messages in CEF format to the proxy machine. Make sure you send the logs to port 514 TCP on the machine's IP address.\n\n Follow Instructions . Then Make sure you select local use 4 as the facility. Then select ArcSight as the Syslog format.",
                      "title": "2. Forward SonicWall Firewall Common Event Format (CEF) logs to Syslog agent"
                    },
                    {
                      "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Run the following command to validate your connectivity:",
                            "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "3. Validate connection"
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "4. Secure your machine "
                    }
                  ],
                  "metadata": {
                    "id": "bbe6d9ef-2581-41b8-95b0-9d50c919d377",
                    "version": "1.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "SonicWall"
                    },
                    "support": {
                      "name": "SonicWall",
                      "link": "https://www.sonicwall.com/support/",
                      "tier": "developer"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "SonicWall Firewall",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SonicWall"
                },
                "support": {
                  "name": "SonicWall",
                  "tier": "Partner",
                  "link": "https://www.sonicwall.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "[Deprecated] SonicWall Firewall via Legacy Agent",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "SonicWall Firewall",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "SonicWall"
        },
        "support": {
          "name": "SonicWall",
          "tier": "Partner",
          "link": "https://www.sonicwall.com/support/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[Deprecated] SonicWall Firewall via Legacy Agent",
          "publisher": "SonicWall",
          "descriptionMarkdown": "Common Event Format (CEF) is an industry standard format on top of Syslog messages, used by SonicWall to allow event interoperability among different platforms. By connecting your CEF logs to Microsoft Sentinel, you can take advantage of search & correlation, alerting, and threat intelligence enrichment for each log.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "SonicWall",
              "baseQuery": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\""
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog (SonicWall)",
              "lastDataReceivedQuery": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize LastLogReceived = max(TimeGenerated)\n| project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| sort by TimeGenerated desc"
            },
            {
              "description": "Summarize by destination IP and port",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize count() by DestinationIP, DestinationPort, TimeGenerated\n| sort by TimeGenerated desc"
            },
            {
              "description": "Show all dropped traffic from the SonicWall Firewall",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| where AdditionalExtensions contains \"fw_action='drop'\""
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
              "innerSteps": [
                {
                  "title": "1.1 Select or create a Linux machine",
                  "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds."
                },
                {
                  "title": "1.2 Install the CEF collector on the Linux machine",
                  "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                  "instructions": [
                    {
                      "parameters": {
                        "fillWith": [
                          "WorkspaceId",
                          "PrimaryKey"
                        ],
                        "label": "Run the following command to install and apply the CEF collector:",
                        "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                      },
                      "type": "CopyableLabel"
                    }
                  ]
                }
              ],
              "title": "1. Linux Syslog agent configuration"
            },
            {
              "description": "Set your SonicWall Firewall to send Syslog messages in CEF format to the proxy machine. Make sure you send the logs to port 514 TCP on the machine's IP address.\n\n Follow Instructions . Then Make sure you select local use 4 as the facility. Then select ArcSight as the Syslog format.",
              "title": "2. Forward SonicWall Firewall Common Event Format (CEF) logs to Syslog agent"
            },
            {
              "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Run the following command to validate your connectivity:",
                    "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "3. Validate connection"
            },
            {
              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
              "title": "4. Secure your machine "
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SonicWall Firewall data connector with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId2')]",
                  "title": "[Recommended] SonicWall Firewall via AMA",
                  "publisher": "SonicWall",
                  "descriptionMarkdown": "Common Event Format (CEF) is an industry standard format on top of Syslog messages, used by SonicWall to allow event interoperability among different platforms. By connecting your CEF logs to Microsoft Sentinel, you can take advantage of search & correlation, alerting, and threat intelligence enrichment for each log.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "SonicWall",
                      "baseQuery": "CommonSecurityLog\n |where DeviceVendor =~ 'SonicWall'\n  |extend sent_by_ama = column_ifexists('CollectorHostName','')\n |where isnotempty(sent_by_ama)"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Summarize by destination IP and port",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize count() by DestinationIP, DestinationPort, TimeGenerated\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "Show all dropped traffic from the SonicWall Firewall",
                      "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| where AdditionalExtensions contains \"fw_action='drop'\""
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CommonSecurityLog (SonicWall)",
                      "lastDataReceivedQuery": "CommonSecurityLog\n |where DeviceVendor =~ 'SonicWall'\n  |extend sent_by_ama = column_ifexists('CollectorHostName','')\n |where isnotempty(sent_by_ama)\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "CommonSecurityLog\n |where DeviceVendor =~ 'SonicWall'\n  |extend sent_by_ama = column_ifexists('CollectorHostName','')\n |where isnotempty(sent_by_ama)\n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "description": "To collect data from non-Azure VMs, they must have Azure Arc installed and enabled. [Learn more](https://docs.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-install?tabs=ARMAgentPowerShell,PowerShellWindows,PowerShellWindowsArc,CLIWindows,CLIWindowsArc)"
                      },
                      {
                        "description": "Common Event Format (CEF) via AMA and Syslog via AMA data connectors must be installed [Learn more](https://learn.microsoft.com/azure/sentinel/connect-cef-ama#open-the-connector-page-and-create-the-dcr)"
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "instructions": [
                        {
                          "parameters": {
                            "title": "1. Kindly follow the steps to configure the data connector",
                            "instructionSteps": [
                              {
                                "title": "Step A. Configure the Common Event Format (CEF) via AMA data connector",
                                "description": "_Note:- CEF logs are collected only from Linux Agents_\n\n1. Navigate to Microsoft Sentinel workspace ---> configuration ---> Data connector blade .\n\n2. Search for 'Common Event Format (CEF) via AMA' data connector and open it.\n\n3. Check If there is no existing DCR configured to collect required facility of logs, Create a new DCR (Data Collection Rule)\n\n\t_Note:- It is recommended to install minimum 1.27 version of AMA agent [Learn more](https://learn.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-manage?tabs=azure-portal ) and ensure there is no duplicate DCR as it can cause log duplicacy_\n\n4. Run the command provided in the CEF via AMA data connector page to configure the CEF collector on the machine"
                              },
                              {
                                "title": "Step B. Forward SonicWall Firewall Common Event Format (CEF) logs to Syslog agent",
                                "description": "Set your SonicWall Firewall to send Syslog messages in CEF format to the proxy machine. Make sure you send the logs to port 514 TCP on the machine's IP address.\n\n Follow Instructions . Then Make sure you select local use 4 as the facility. Then select ArcSight as the Syslog format."
                              },
                              {
                                "title": "Step C. Validate connection",
                                "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\nIt may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n 1. Make sure that you have Python on your machine using the following command: python -version\n\n2. You must have elevated permissions (sudo) on your machine",
                                "instructions": [
                                  {
                                    "parameters": {
                                      "label": "Run the following command to validate your connectivity:",
                                      "value": "sudo wget -O Sentinel_AMA_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/Syslog/Sentinel_AMA_troubleshoot.py&&sudo python Sentinel_AMA_troubleshoot.py --cef"
                                    },
                                    "type": "CopyableLabel"
                                  }
                                ]
                              }
                            ]
                          },
                          "type": "InstructionStepsGroup"
                        }
                      ]
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "2. Secure your machine "
                    }
                  ],
                  "metadata": {
                    "id": "bbe6d9ef-2581-41b8-95b0-9d50c919d377",
                    "version": "1.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "SonicWall"
                    },
                    "support": {
                      "name": "SonicWall",
                      "link": "https://www.sonicwall.com/support/",
                      "tier": "developer"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
                "contentId": "[variables('_dataConnectorContentId2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "SonicWall Firewall",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SonicWall"
                },
                "support": {
                  "name": "SonicWall",
                  "tier": "Partner",
                  "link": "https://www.sonicwall.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "contentKind": "DataConnector",
        "displayName": "[Recommended] SonicWall Firewall via AMA",
        "contentProductId": "[variables('_dataConnectorcontentProductId2')]",
        "id": "[variables('_dataConnectorcontentProductId2')]",
        "version": "[variables('dataConnectorVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId2'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId2')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId2'))]",
        "contentId": "[variables('_dataConnectorContentId2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "SonicWall Firewall",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "SonicWall"
        },
        "support": {
          "name": "SonicWall",
          "tier": "Partner",
          "link": "https://www.sonicwall.com/support/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId2'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[Recommended] SonicWall Firewall via AMA",
          "publisher": "SonicWall",
          "descriptionMarkdown": "Common Event Format (CEF) is an industry standard format on top of Syslog messages, used by SonicWall to allow event interoperability among different platforms. By connecting your CEF logs to Microsoft Sentinel, you can take advantage of search & correlation, alerting, and threat intelligence enrichment for each log.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "SonicWall",
              "baseQuery": "CommonSecurityLog\n |where DeviceVendor =~ 'SonicWall'\n  |extend sent_by_ama = column_ifexists('CollectorHostName','')\n |where isnotempty(sent_by_ama)"
            }
          ],
          "dataTypes": [
            {
              "name": "CommonSecurityLog (SonicWall)",
              "lastDataReceivedQuery": "CommonSecurityLog\n |where DeviceVendor =~ 'SonicWall'\n  |extend sent_by_ama = column_ifexists('CollectorHostName','')\n |where isnotempty(sent_by_ama)\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "CommonSecurityLog\n |where DeviceVendor =~ 'SonicWall'\n  |extend sent_by_ama = column_ifexists('CollectorHostName','')\n |where isnotempty(sent_by_ama)\n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All logs",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| sort by TimeGenerated desc"
            },
            {
              "description": "Summarize by destination IP and port",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| summarize count() by DestinationIP, DestinationPort, TimeGenerated\n| sort by TimeGenerated desc"
            },
            {
              "description": "Show all dropped traffic from the SonicWall Firewall",
              "query": "CommonSecurityLog\n| where DeviceVendor == \"SonicWall\"\n| where AdditionalExtensions contains \"fw_action='drop'\""
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "description": "To collect data from non-Azure VMs, they must have Azure Arc installed and enabled. [Learn more](https://docs.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-install?tabs=ARMAgentPowerShell,PowerShellWindows,PowerShellWindowsArc,CLIWindows,CLIWindowsArc)"
              },
              {
                "description": "Common Event Format (CEF) via AMA and Syslog via AMA data connectors must be installed [Learn more](https://learn.microsoft.com/azure/sentinel/connect-cef-ama#open-the-connector-page-and-create-the-dcr)"
              }
            ]
          },
          "instructionSteps": [
            {
              "instructions": [
                {
                  "parameters": {
                    "title": "1. Kindly follow the steps to configure the data connector",
                    "instructionSteps": [
                      {
                        "title": "Step A. Configure the Common Event Format (CEF) via AMA data connector",
                        "description": "_Note:- CEF logs are collected only from Linux Agents_\n\n1. Navigate to Microsoft Sentinel workspace ---> configuration ---> Data connector blade .\n\n2. Search for 'Common Event Format (CEF) via AMA' data connector and open it.\n\n3. Check If there is no existing DCR configured to collect required facility of logs, Create a new DCR (Data Collection Rule)\n\n\t_Note:- It is recommended to install minimum 1.27 version of AMA agent [Learn more](https://learn.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-manage?tabs=azure-portal ) and ensure there is no duplicate DCR as it can cause log duplicacy_\n\n4. Run the command provided in the CEF via AMA data connector page to configure the CEF collector on the machine"
                      },
                      {
                        "title": "Step B. Forward SonicWall Firewall Common Event Format (CEF) logs to Syslog agent",
                        "description": "Set your SonicWall Firewall to send Syslog messages in CEF format to the proxy machine. Make sure you send the logs to port 514 TCP on the machine's IP address.\n\n Follow Instructions . Then Make sure you select local use 4 as the facility. Then select ArcSight as the Syslog format."
                      },
                      {
                        "title": "Step C. Validate connection",
                        "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\nIt may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n 1. Make sure that you have Python on your machine using the following command: python -version\n\n2. You must have elevated permissions (sudo) on your machine",
                        "instructions": [
                          {
                            "parameters": {
                              "label": "Run the following command to validate your connectivity:",
                              "value": "sudo wget -O Sentinel_AMA_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/Syslog/Sentinel_AMA_troubleshoot.py&&sudo python Sentinel_AMA_troubleshoot.py --cef"
                            },
                            "type": "CopyableLabel"
                          }
                        ]
                      }
                    ]
                  },
                  "type": "InstructionStepsGroup"
                }
              ]
            },
            {
              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
              "title": "2. Secure your machine "
            }
          ],
          "id": "[variables('_uiConfigId2')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SonicWallFirewall Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "A collection of queries to provide visibility into the events reported by your SonicWall firewalls."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## SonicWall Workbook for Microsoft Sentinel\\n---\\n\\nWelcome! We've included a collection of queries to provide visibility into the events reported by your SonicWall firewalls.\\n\\nUse the available filters to update the data on the dashboard. Note that not all filters apply to every query. Edit the queries as needed to suit your needs.\"},\"name\":\"title-text\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"8a6a764e-51f5-4acb-b31e-18c8b1007249\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"description\":\"Select a time range to filter the dashboard's data\",\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"8ad6df39-cd24-4c7c-99fd-789b502d433e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SourceDevice\",\"label\":\"Source Device\",\"type\":2,\"description\":\"Specify the source devices on which to filter\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where Computer != \\\"127.0.0.1\\\"\\r\\n| distinct Computer\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":2592000000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"Source_IP\",\"label\":\"Source IP\",\"type\":2,\"description\":\"Specify the source IP addresses on which to filter\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| summarize Count = count()/1000 by SourceIP\\r\\n| where SourceIP != \\\"\\\"\\r\\n| order by Count desc, SourceIP asc\\r\\n| project Value = SourceIP, Label = strcat(SourceIP, \\\" - \\\", Count, \\\"k\\\"), Selected = false\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"id\":\"bb5d62ef-6b04-4b76-a04c-b745c54a7993\",\"value\":[\"value::all\"]},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"Destination_IP\",\"label\":\"Destination IP\",\"type\":2,\"description\":\"Specify the destination IP addresses on which to filter\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| summarize Count = count()/1000 by DestinationIP\\r\\n| where DestinationIP != \\\"\\\"\\r\\n| order by Count desc, DestinationIP asc\\r\\n| project Value = DestinationIP, Label = strcat(DestinationIP, \\\" - \\\", Count, \\\"k\\\"), Selected = false\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"id\":\"44c56b4f-4ec2-4a5a-8cbc-36482af1321a\",\"value\":[\"value::all\"]},{\"id\":\"87a1dba0-3daf-4cc0-bf75-056c83fac52f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ActivitySelection\",\"label\":\"Activity\",\"type\":2,\"description\":\"Select the type of log activity on which to filter\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| distinct Activity\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":2592000000},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"workbook-parameters\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Firewall Security\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Failed CLI login attempts\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where EventOriginalType == 200\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| extend HitCounter = 1 // Assigns a count to each record\\r\\n| summarize Users = makeset(trim('\\\"', SrcUsername)), Count = sum(HitCounter) by SrcIpAddr\\r\\n| project SrcIpAddr, Count, UserCount = array_length(split(Users, \\\",\\\")), Users\\r\\n| sort by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Failed CLI Login Attempts ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventOriginalType == 200\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize by SrcIpAddr, Time = TimeGenerated, User = SrcUsername\\r\\n| project Time, SrcIpAddr, User\\r\\n| sort by Time desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Failed CLI Login Attempt Details ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"SourceIP\"],\"expandTopLevel\":false}}},\"customWidth\":\"50\",\"name\":\"query2\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Failed web login attempts\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where EventOriginalType in (30, 32, 33, 243, 245, 745, 1552, 1554)\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| extend HitCounter = 1 // Assigns a count to each record\\r\\n| summarize Users = makeset(trim('\\\"', SrcUsername)), Reasons = makeset(EventMessage), Count = sum(HitCounter) by SrcIpAddr\\r\\n| project SrcIpAddr, Count, UserCount = array_length(split(Users, \\\",\\\")), Reasons, Users\\r\\n| sort by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Failed Web Login Attempts ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventOriginalType in (30, 32, 33, 243, 245, 745, 1552, 1554)\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize by SrcIpAddr, Time = TimeGenerated, User = SrcUsername, EventMessage\\r\\n| project Time, SrcIpAddr, User, EventMessage\\r\\n| sort by Time desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Failed Web Login Attempt Details ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"SourceIP\"],\"expandTopLevel\":true}}},\"customWidth\":\"50\",\"name\":\"query4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| extend\\r\\n    LogMsgSeverity = tostring(AdditionalFields['LogMsgSeverity']),\\r\\n    LogMsgCategory = tostring(AdditionalFields['LogMsgCategory'])\\r\\n| where LogMsgSeverity == \\\"Alert (1)\\\"\\r\\n| summarize Count = count() by EventMessage, Severity = LogMsgSeverity, Category = LogMsgCategory, ID = EventOriginalType\\r\\n| project-reorder ID, Severity, Category\\r\\n| sort by Count desc\\r\\n//| summarize by LogMsgID, LogMsgSeverity, LogMsgCategory, LegacyMessageCategory, Activity\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"High Priority Events\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query5\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (82, 83)\\r\\n| summarize Ports = makeset(DstPortNumber), Count = count() by EventMessage, SrcIpAddr, SrcPortNumber, DstIpAddr\\r\\n| sort by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Port Scan Activity ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query6\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (82, 83)\\r\\n| summarize Count = count() by SrcIpAddr\\r\\n| sort by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Port Scan Totals by IP ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"20\",\"name\":\"query7\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (82, 83, 177, 178, 179)\\r\\n| summarize Count = count() by EventMessage\\r\\n| sort by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Scan Totals by Activity ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}}]}},\"customWidth\":\"20\",\"name\":\"query8\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (82, 83, 177, 178, 179)\\r\\n| summarize Count = count() by SrcIpAddr, EventMessage\\r\\n| sort by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Scan Totals by IP ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"SrcIpAddr\"],\"expandTopLevel\":true}}},\"customWidth\":\"40\",\"name\":\"query9\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  let HighRiskPorts = datatable (Port:int, Protocol:string, RiskType:string, RiskDescription:string)[\\r\\n  13,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Daytime protocol used in reflection/amplification attacks\\\",\\r\\n  17,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"QOTD protocol, reflection/amplification attacks\\\",\\r\\n  19,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Chargen protocol, reflection/amplification attacks\\\",\\r\\n  20,\\\"tcp\\\",\\\"Unencrypted\\\",\\\"Unencrypted FTP Traffic\\\",\\r\\n  21,\\\"tcp\\\",\\\"Unencrypted\\\",\\\"Unencrypted FTP Traffic\\\",\\r\\n  22,\\\"tcp\\\",\\\"Management\\\",\\\"SSH, brute force attacks common\\\",\\r\\n  23,\\\"tcp\\\",\\\"Management\\\",\\\"Telnet, allows unauthenticated and/or unencrypted\\\",\\r\\n  53,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"DNS, reflection/amplification attacks\\\",\\r\\n  69,\\\"udp\\\",\\\"Management\\\",\\\"TFTP, allows unauthenticated and/or unencrypted\\\",\\r\\n  111,\\\"udp\\\",\\\"Management\\\",\\\"RPC, unencrypted authentication allowed\\\",\\r\\n  111,\\\"tcp\\\",\\\"Management\\\",\\\"RPC, unencrypted authentication allowed\\\",\\r\\n  119,\\\"tcp\\\",\\\"Unsecure\\\",\\\"NNTP, unencrypted authentication\\\",\\r\\n  123,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Network Time Protocol, reflection/amplification attacks\\\",\\r\\n  135,\\\"tcp\\\",\\\"Management\\\",\\\"End Point Mapper, multiple remote management srvcs\\\",\\r\\n  135,\\\"udp\\\",\\\"Management\\\",\\\"End Point Mapper, multiple remote management srvcs\\\",\\r\\n  137,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Name Service\\\",\\r\\n  137,\\\"udp\\\",\\\"Hacker Recon\\\",\\\"Netbios Name Service\\\",\\r\\n  138,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Datagram Service\\\",\\r\\n  138,\\\"udp\\\",\\\"Hacker Recon\\\",\\\"Netbios Datagram Service\\\",\\r\\n  139,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Session Service\\\",\\r\\n  161,\\\"tcp\\\",\\\"Unsecure/3rd Party Attacks\\\",\\\"SNMP, unsecure / no authentication UDP Reflection attacks\\\",\\r\\n  161,\\\"udp\\\",\\\"Unsecure/3rd Party Attacks\\\",\\\"SNMP, unsecure / no authentication UDP Reflection attacks\\\",\\r\\n  162,\\\"tcp\\\",\\\"Unsecure\\\",\\\"SNMP Trap, unsecure / no authentication\\\",\\r\\n  162,\\\"udp\\\",\\\"Unsecure\\\",\\\"SNMP Trap, unsecure / no authentication\\\",\\r\\n  389,\\\"tcp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"LDAP/CLDAP\\\",\\r\\n  389,\\\"udp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"LDAP/CLDAP\\\",\\r\\n  443,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"UDP Reflection / Amplification attacks\\\",\\r\\n  445,\\\"tcp\\\",\\\"Unsecure\\\",\\\"SMB - well known attack vector\\\",\\r\\n  512,\\\"tcp\\\",\\\"Management\\\",\\\"Rexec on Linux, remote commands w/o encrypt auth\\\",\\r\\n  514,\\\"tcp\\\",\\\"Management\\\",\\\"Remote Shell, remote commands w/o auth or encrypt\\\",\\r\\n  593,\\\"tcp\\\",\\\"Management\\\",\\\"HTTP RPC EPMAP, unencrypted remote procedure call\\\",\\r\\n  593,\\\"udp\\\",\\\"Management\\\",\\\"HTTP RPC EPMAP, unencrypted remote procedure call\\\",\\r\\n  636,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Lightweight Directory Access Protocol\\\",\\r\\n  873,\\\"tcp\\\",\\\"Management\\\",\\\"Rsync, unencrypted file transfer\\\",\\r\\n  1433,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MS SQL Management & Data Access\\\",\\r\\n  1434,\\\"udp\\\",\\\"Data Access/Mgmt\\\",\\\"MS SQL Monitor Port\\\",\\r\\n  1900,\\\"udp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"Simple Service Discovery Protocol, unencrypted\\\",\\r\\n  2049,\\\"tcp\\\",\\\"Unsecure\\\",\\\"Network File System\\\",\\r\\n  2049,\\\"udp\\\",\\\"Unsecure\\\",\\\"Network File System\\\",\\r\\n  2301,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Compaq Management Service, no recent incidents\\\",\\r\\n  2381,\\\"tcp\\\",\\\"Management\\\",\\\"Compaq Management Service, no recent incidents\\\",\\r\\n  3268,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Microsoft Global Catalog LDAP\\\",\\r\\n  3306,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MySQL Database Management Port\\\",\\r\\n  3389,\\\"tcp\\\",\\\"Management/3rd Party Attacks\\\",\\\"RDP, Common brute force attack port\\\",\\r\\n  3389,\\\"udp\\\",\\\"Management/3rd Party Attacks\\\",\\\"RDP, Common brute force attack port\\\",\\r\\n  4333,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MSql\\\",\\r\\n  5353,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"mDNS\\\",\\r\\n  5432,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"PostgresSQL Database Management\\\",\\r\\n  5800,\\\"tcp\\\",\\\"Management\\\",\\\"VNC Remote Frame Buffer over HTTP\\\",\\r\\n  5900,\\\"tcp\\\",\\\"Management\\\",\\\"VNC Remote Frame Buffer over HTTP\\\",\\r\\n  5985,\\\"tcp\\\",\\\"Management\\\",\\\"Windows Powershell\\\",\\r\\n  5986,\\\"tcp\\\",\\\"Management\\\",\\\"Windows Powershell\\\",\\r\\n  6379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  7000,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  7001,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  7199,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9042,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9160,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9200,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Elastic Search\\\",\\r\\n  9300,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Elastic Search\\\",\\r\\n  9987,\\\"udp\\\",\\\"3rd Party Attack\\\",\\\"DSM/SCM Target Interface\\\",\\r\\n  11211,\\\"udp\\\",\\\"Unencrypted\\\",\\\"Memcached\\\",\\r\\n  16379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  26379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  27017,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MongoDB\\\",\\r\\n  ];\\r\\n  HighRiskPorts\\r\\n  | join kind=inner(\\r\\n  ASimNetworkSessionSonicWallFirewall\\r\\n    | where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n    | where NetworkBytes > 0\\r\\n    | extend NetworkProtocol = tolower(NetworkProtocol)\\r\\n) on $left.Port == $right.DstPortNumber and $left.Protocol == $right.NetworkProtocol\\r\\n| summarize Count = count() by RiskType, RiskDescription, Protocol, Port, Direction = NetworkDirection\\r\\n| sort by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"High Risk Ports/Protocols Summary ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"RiskType\",\"formatter\":5},{\"columnMatch\":\"RiskDescription\",\"formatter\":5},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"RiskType\"],\"expandTopLevel\":true,\"finalBy\":\"RiskDescription\"}}},\"customWidth\":\"50\",\"name\":\"query10\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  let HighRiskPorts = datatable (Port:int, Protocol:string, RiskType:string, RiskDescription:string)[\\r\\n  13,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Daytime protocol used in reflection/amplification attacks\\\",\\r\\n  17,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"QOTD protocol, reflection/amplification attacks\\\",\\r\\n  19,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Chargen protocol, reflection/amplification attacks\\\",\\r\\n  20,\\\"tcp\\\",\\\"Unencrypted\\\",\\\"Unencrypted FTP Traffic\\\",\\r\\n  21,\\\"tcp\\\",\\\"Unencrypted\\\",\\\"Unencrypted FTP Traffic\\\",\\r\\n  22,\\\"tcp\\\",\\\"Management\\\",\\\"SSH, brute force attacks common\\\",\\r\\n  23,\\\"tcp\\\",\\\"Management\\\",\\\"Telnet, allows unauthenticated and/or unencrypted\\\",\\r\\n  53,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"DNS, reflection/amplification attacks\\\",\\r\\n  69,\\\"udp\\\",\\\"Management\\\",\\\"TFTP, allows unauthenticated and/or unencrypted\\\",\\r\\n  111,\\\"udp\\\",\\\"Management\\\",\\\"RPC, unencrypted authentication allowed\\\",\\r\\n  111,\\\"tcp\\\",\\\"Management\\\",\\\"RPC, unencrypted authentication allowed\\\",\\r\\n  119,\\\"tcp\\\",\\\"Unsecure\\\",\\\"NNTP, unencrypted authentication\\\",\\r\\n  123,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Network Time Protocol, reflection/amplification attacks\\\",\\r\\n  135,\\\"tcp\\\",\\\"Management\\\",\\\"End Point Mapper, multiple remote management srvcs\\\",\\r\\n  135,\\\"udp\\\",\\\"Management\\\",\\\"End Point Mapper, multiple remote management srvcs\\\",\\r\\n  137,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Name Service\\\",\\r\\n  137,\\\"udp\\\",\\\"Hacker Recon\\\",\\\"Netbios Name Service\\\",\\r\\n  138,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Datagram Service\\\",\\r\\n  138,\\\"udp\\\",\\\"Hacker Recon\\\",\\\"Netbios Datagram Service\\\",\\r\\n  139,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Session Service\\\",\\r\\n  161,\\\"tcp\\\",\\\"Unsecure/3rd Party Attacks\\\",\\\"SNMP, unsecure / no authentication UDP Reflection attacks\\\",\\r\\n  161,\\\"udp\\\",\\\"Unsecure/3rd Party Attacks\\\",\\\"SNMP, unsecure / no authentication UDP Reflection attacks\\\",\\r\\n  162,\\\"tcp\\\",\\\"Unsecure\\\",\\\"SNMP Trap, unsecure / no authentication\\\",\\r\\n  162,\\\"udp\\\",\\\"Unsecure\\\",\\\"SNMP Trap, unsecure / no authentication\\\",\\r\\n  389,\\\"tcp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"LDAP/CLDAP\\\",\\r\\n  389,\\\"udp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"LDAP/CLDAP\\\",\\r\\n  443,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"UDP Reflection / Amplification attacks\\\",\\r\\n  445,\\\"tcp\\\",\\\"Unsecure\\\",\\\"SMB - well known attack vector\\\",\\r\\n  512,\\\"tcp\\\",\\\"Management\\\",\\\"Rexec on Linux, remote commands w/o encrypt auth\\\",\\r\\n  514,\\\"tcp\\\",\\\"Management\\\",\\\"Remote Shell, remote commands w/o auth or encrypt\\\",\\r\\n  593,\\\"tcp\\\",\\\"Management\\\",\\\"HTTP RPC EPMAP, unencrypted remote procedure call\\\",\\r\\n  593,\\\"udp\\\",\\\"Management\\\",\\\"HTTP RPC EPMAP, unencrypted remote procedure call\\\",\\r\\n  636,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Lightweight Directory Access Protocol\\\",\\r\\n  873,\\\"tcp\\\",\\\"Management\\\",\\\"Rsync, unencrypted file transfer\\\",\\r\\n  1433,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MS SQL Management & Data Access\\\",\\r\\n  1434,\\\"udp\\\",\\\"Data Access/Mgmt\\\",\\\"MS SQL Monitor Port\\\",\\r\\n  1900,\\\"udp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"Simple Service Discovery Protocol, unencrypted\\\",\\r\\n  2049,\\\"tcp\\\",\\\"Unsecure\\\",\\\"Network File System\\\",\\r\\n  2049,\\\"udp\\\",\\\"Unsecure\\\",\\\"Network File System\\\",\\r\\n  2301,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Compaq Management Service, no recent incidents\\\",\\r\\n  2381,\\\"tcp\\\",\\\"Management\\\",\\\"Compaq Management Service, no recent incidents\\\",\\r\\n  3268,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Microsoft Global Catalog LDAP\\\",\\r\\n  3306,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MySQL Database Management Port\\\",\\r\\n  3389,\\\"tcp\\\",\\\"Management/3rd Party Attacks\\\",\\\"RDP, Common brute force attack port\\\",\\r\\n  3389,\\\"udp\\\",\\\"Management/3rd Party Attacks\\\",\\\"RDP, Common brute force attack port\\\",\\r\\n  4333,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MSql\\\",\\r\\n  5353,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"mDNS\\\",\\r\\n  5432,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"PostgresSQL Database Management\\\",\\r\\n  5800,\\\"tcp\\\",\\\"Management\\\",\\\"VNC Remote Frame Buffer over HTTP\\\",\\r\\n  5900,\\\"tcp\\\",\\\"Management\\\",\\\"VNC Remote Frame Buffer over HTTP\\\",\\r\\n  5985,\\\"tcp\\\",\\\"Management\\\",\\\"Windows Powershell\\\",\\r\\n  5986,\\\"tcp\\\",\\\"Management\\\",\\\"Windows Powershell\\\",\\r\\n  6379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  7000,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  7001,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  7199,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9042,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9160,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9200,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Elastic Search\\\",\\r\\n  9300,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Elastic Search\\\",\\r\\n  9987,\\\"udp\\\",\\\"3rd Party Attack\\\",\\\"DSM/SCM Target Interface\\\",\\r\\n  11211,\\\"udp\\\",\\\"Unencrypted\\\",\\\"Memcached\\\",\\r\\n  16379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  26379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  27017,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MongoDB\\\",\\r\\n  ];\\r\\n  HighRiskPorts\\r\\n  | join kind=inner(\\r\\n  ASimNetworkSessionSonicWallFirewall\\r\\n    | where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n    | where NetworkBytes > 0\\r\\n    | where NetworkDirection == \\\"Inbound\\\"\\r\\n    | extend NetworkProtocol = tolower(NetworkProtocol)\\r\\n) on $left.Port == $right.DstPortNumber and $left.Protocol == $right.NetworkProtocol\\r\\n| summarize Count = count() by SrcIpAddr, DstIpAddr, Protocol, Port, RiskType, RiskDescription\\r\\n| sort by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Inbound High Risk Ports/Protocols ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"query11\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  let HighRiskPorts = datatable (Port:int, Protocol:string, RiskType:string, RiskDescription:string)[\\r\\n  13,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Daytime protocol used in reflection/amplification attacks\\\",\\r\\n  17,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"QOTD protocol, reflection/amplification attacks\\\",\\r\\n  19,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Chargen protocol, reflection/amplification attacks\\\",\\r\\n  20,\\\"tcp\\\",\\\"Unencrypted\\\",\\\"Unencrypted FTP Traffic\\\",\\r\\n  21,\\\"tcp\\\",\\\"Unencrypted\\\",\\\"Unencrypted FTP Traffic\\\",\\r\\n  22,\\\"tcp\\\",\\\"Management\\\",\\\"SSH, brute force attacks common\\\",\\r\\n  23,\\\"tcp\\\",\\\"Management\\\",\\\"Telnet, allows unauthenticated and/or unencrypted\\\",\\r\\n  53,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"DNS, reflection/amplification attacks\\\",\\r\\n  69,\\\"udp\\\",\\\"Management\\\",\\\"TFTP, allows unauthenticated and/or unencrypted\\\",\\r\\n  111,\\\"udp\\\",\\\"Management\\\",\\\"RPC, unencrypted authentication allowed\\\",\\r\\n  111,\\\"tcp\\\",\\\"Management\\\",\\\"RPC, unencrypted authentication allowed\\\",\\r\\n  119,\\\"tcp\\\",\\\"Unsecure\\\",\\\"NNTP, unencrypted authentication\\\",\\r\\n  123,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"Network Time Protocol, reflection/amplification attacks\\\",\\r\\n  135,\\\"tcp\\\",\\\"Management\\\",\\\"End Point Mapper, multiple remote management srvcs\\\",\\r\\n  135,\\\"udp\\\",\\\"Management\\\",\\\"End Point Mapper, multiple remote management srvcs\\\",\\r\\n  137,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Name Service\\\",\\r\\n  137,\\\"udp\\\",\\\"Hacker Recon\\\",\\\"Netbios Name Service\\\",\\r\\n  138,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Datagram Service\\\",\\r\\n  138,\\\"udp\\\",\\\"Hacker Recon\\\",\\\"Netbios Datagram Service\\\",\\r\\n  139,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Netbios Session Service\\\",\\r\\n  161,\\\"tcp\\\",\\\"Unsecure/3rd Party Attacks\\\",\\\"SNMP, unsecure / no authentication UDP Reflection attacks\\\",\\r\\n  161,\\\"udp\\\",\\\"Unsecure/3rd Party Attacks\\\",\\\"SNMP, unsecure / no authentication UDP Reflection attacks\\\",\\r\\n  162,\\\"tcp\\\",\\\"Unsecure\\\",\\\"SNMP Trap, unsecure / no authentication\\\",\\r\\n  162,\\\"udp\\\",\\\"Unsecure\\\",\\\"SNMP Trap, unsecure / no authentication\\\",\\r\\n  389,\\\"tcp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"LDAP/CLDAP\\\",\\r\\n  389,\\\"udp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"LDAP/CLDAP\\\",\\r\\n  443,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"UDP Reflection / Amplification attacks\\\",\\r\\n  445,\\\"tcp\\\",\\\"Unsecure\\\",\\\"SMB - well known attack vector\\\",\\r\\n  512,\\\"tcp\\\",\\\"Management\\\",\\\"Rexec on Linux, remote commands w/o encrypt auth\\\",\\r\\n  514,\\\"tcp\\\",\\\"Management\\\",\\\"Remote Shell, remote commands w/o auth or encrypt\\\",\\r\\n  593,\\\"tcp\\\",\\\"Management\\\",\\\"HTTP RPC EPMAP, unencrypted remote procedure call\\\",\\r\\n  593,\\\"udp\\\",\\\"Management\\\",\\\"HTTP RPC EPMAP, unencrypted remote procedure call\\\",\\r\\n  636,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Lightweight Directory Access Protocol\\\",\\r\\n  873,\\\"tcp\\\",\\\"Management\\\",\\\"Rsync, unencrypted file transfer\\\",\\r\\n  1433,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MS SQL Management & Data Access\\\",\\r\\n  1434,\\\"udp\\\",\\\"Data Access/Mgmt\\\",\\\"MS SQL Monitor Port\\\",\\r\\n  1900,\\\"udp\\\",\\\"Hacker Recon/3rd Party Attacks\\\",\\\"Simple Service Discovery Protocol, unencrypted\\\",\\r\\n  2049,\\\"tcp\\\",\\\"Unsecure\\\",\\\"Network File System\\\",\\r\\n  2049,\\\"udp\\\",\\\"Unsecure\\\",\\\"Network File System\\\",\\r\\n  2301,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Compaq Management Service, no recent incidents\\\",\\r\\n  2381,\\\"tcp\\\",\\\"Management\\\",\\\"Compaq Management Service, no recent incidents\\\",\\r\\n  3268,\\\"tcp\\\",\\\"Hacker Recon\\\",\\\"Microsoft Global Catalog LDAP\\\",\\r\\n  3306,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MySQL Database Management Port\\\",\\r\\n  3389,\\\"tcp\\\",\\\"Management/3rd Party Attacks\\\",\\\"RDP, Common brute force attack port\\\",\\r\\n  3389,\\\"udp\\\",\\\"Management/3rd Party Attacks\\\",\\\"RDP, Common brute force attack port\\\",\\r\\n  4333,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MSql\\\",\\r\\n  5353,\\\"udp\\\",\\\"3rd Party Attacks\\\",\\\"mDNS\\\",\\r\\n  5432,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"PostgresSQL Database Management\\\",\\r\\n  5800,\\\"tcp\\\",\\\"Management\\\",\\\"VNC Remote Frame Buffer over HTTP\\\",\\r\\n  5900,\\\"tcp\\\",\\\"Management\\\",\\\"VNC Remote Frame Buffer over HTTP\\\",\\r\\n  5985,\\\"tcp\\\",\\\"Management\\\",\\\"Windows Powershell\\\",\\r\\n  5986,\\\"tcp\\\",\\\"Management\\\",\\\"Windows Powershell\\\",\\r\\n  6379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  7000,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  7001,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  7199,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9042,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9160,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Cassandra\\\",\\r\\n  9200,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Elastic Search\\\",\\r\\n  9300,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Elastic Search\\\",\\r\\n  9987,\\\"udp\\\",\\\"3rd Party Attack\\\",\\\"DSM/SCM Target Interface\\\",\\r\\n  11211,\\\"udp\\\",\\\"Unencrypted\\\",\\\"Memcached\\\",\\r\\n  16379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  26379,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"Redis\\\",\\r\\n  27017,\\\"tcp\\\",\\\"Data Access/Mgmt\\\",\\\"MongoDB\\\",\\r\\n  ];\\r\\n  HighRiskPorts\\r\\n  | join kind=inner(\\r\\n  ASimNetworkSessionSonicWallFirewall\\r\\n    | where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n    | where NetworkBytes > 0\\r\\n    | where NetworkDirection == \\\"Outbound\\\"\\r\\n    | extend NetworkProtocol = tolower(NetworkProtocol)\\r\\n) on $left.Port == $right.DstPortNumber and $left.Protocol == $right.NetworkProtocol\\r\\n| summarize Count = count() by SrcIpAddr, DstIpAddr, Protocol, Port, RiskType, RiskDescription\\r\\n| sort by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Outbound High Risk Ports/Protocols ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"query12\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"Tip: Edit the query to modify the list of suspicious TLDs.\",\"style\":\"info\"},\"name\":\"text - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let SuspiciousTLDs = datatable (TLD:string, Description:string) [\\r\\n    \\\"sbs\\\", \\\"Special Broadcasting Service Corporation\\\",\\r\\n    \\\"cyou\\\", \\\"ShortDot SA\\\",\\r\\n    \\\"quest\\\", \\\"Quest ION Limited\\\",\\r\\n    \\\"autos\\\", \\\"Autos\\\",\\r\\n    \\\"top\\\", \\\"Jiangsu Bangning Science and Technology Co\\\",\\r\\n    \\\"skin\\\", \\\"XYZ.COM LLC\\\",\\r\\n    \\\"cfd\\\", \\\"CFD\\\",\\r\\n    \\\"best\\\", \\\"Best\\\",\\r\\n    \\\"bio\\\", \\\"Bio\\\",\\r\\n    \\\"cloud\\\", \\\"Cloud\\\",\\r\\n    \\\"makeup\\\", \\\"XYZ.COM LLC\\\",\\r\\n    \\\"icu\\\", \\\"ICU\\\",\\r\\n    \\\"shop\\\", \\\"Shop\\\",\\r\\n    \\\"ltd\\\", \\\"Ltd\\\",\\r\\n    \\\"xyz\\\", \\\"XYZ\\\",\\r\\n    \\\"help\\\", \\\"Help\\\",\\r\\n    \\\"monster\\\", \\\"Monster\\\",\\r\\n    \\\"ink\\\", \\\"Ink\\\",\\r\\n    \\\"pro\\\", \\\"Pro\\\",\\r\\n    \\\"bd\\\", \\\"Bangladesh\\\",\\r\\n    \\\"run\\\", \\\"Run\\\",\\r\\n    \\\"live\\\", \\\"Rightside\\\",\\r\\n    \\\"life\\\", \\\"Life\\\",\\r\\n    \\\"pics\\\", \\\"Pics\\\",\\r\\n    \\\"th\\\", \\\"Thailand\\\",\\r\\n    \\\"py\\\", \\\"Paraguay\\\",\\r\\n    \\\"club\\\", \\\"Club\\\",\\r\\n    \\\"id\\\", \\\"Indonesia\\\",\\r\\n    \\\"today\\\", \\\"Today\\\",\\r\\n    \\\"pk\\\", \\\"Pakistan\\\",\\r\\n    \\\"ng\\\", \\\"Nigeria\\\",\\r\\n    \\\"website\\\", \\\"Website\\\",\\r\\n    \\\"to\\\", \\\"Tonga\\\",\\r\\n    \\\"store\\\", \\\"Store\\\",\\r\\n    \\\"beauty\\\", \\\"Beauty\\\",\\r\\n    \\\"space\\\", \\\"Space\\\",\\r\\n    \\\"tz\\\", \\\"Tanzania\\\",\\r\\n    \\\"link\\\", \\\"Link\\\",\\r\\n    \\\"lol\\\", \\\"Lol\\\",\\r\\n    \\\"mk\\\", \\\"Macedonia\\\",\\r\\n    \\\"click\\\", \\\"Click\\\",\\r\\n    \\\"site\\\", \\\"Site\\\",\\r\\n    \\\"cc\\\", \\\"Cocos (Keeling) Islands\\\",\\r\\n    \\\"su\\\", \\\"Russian Federation\\\",\\r\\n    \\\"cam\\\", \\\"Cam\\\",\\r\\n    \\\"cn\\\", \\\"China\\\",\\r\\n    \\\"buzz\\\", \\\"Buzz\\\",\\r\\n    \\\"lk\\\", \\\"Sri Lanka\\\",\\r\\n    \\\"in\\\", \\\"India\\\",\\r\\n    \\\"tr\\\", \\\"Turkey\\\",\\r\\n    \\\"tk\\\", \\\"Tokelau\\\",\\r\\n    \\\"pw\\\", \\\"Palau\\\",\\r\\n    \\\"ws\\\", \\\"Samoa\\\",\\r\\n    \\\"ml\\\", \\\"Mali\\\",\\r\\n    \\\"ga\\\", \\\"Gabon\\\",\\r\\n    \\\"cf\\\", \\\"Central African Republic\\\",\\r\\n    \\\"gq\\\", \\\"Equatorial Guinea\\\",\\r\\n    \\\"zw\\\", \\\"Zimbabwe\\\",\\r\\n    \\\"am\\\", \\\"Armenia\\\",\\r\\n    \\\"date\\\", \\\"Date\\\",\\r\\n    \\\"cd\\\", \\\"Congo, Democratic Republic\\\",\\r\\n    \\\"bid\\\", \\\"Bid\\\",\\r\\n    \\\"tokyo\\\", \\\"Tokyo\\\",\\r\\n    \\\"cm\\\", \\\"Cameroon\\\",\\r\\n    \\\"uno\\\", \\\"Uno\\\",\\r\\n    \\\"email\\\", \\\"Email\\\",\\r\\n    \\\"stream\\\", \\\"Stream\\\",\\r\\n    \\\"info\\\", \\\"Info\\\",\\r\\n    \\\"rest\\\", \\\"Rest\\\",\\r\\n    \\\"casa\\\", \\\"Casa\\\",\\r\\n    \\\"support\\\", \\\"Support\\\",\\r\\n    \\\"win\\\", \\\"Win\\\"\\r\\n];\\r\\nASimWebSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where NetworkBytes > 0\\r\\n| where isnotempty(Url)\\r\\n| extend Domain = extract(@\\\"([a-zA-Z0-9-.]+)+(?:\\\\/.*)?\\\", 1, Url)\\r\\n| where not(Domain matches regex (@\\\"\\\\b\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\b\\\")) and Domain contains \\\".\\\"\\r\\n| extend TLD = extract(@\\\"(?:[a-zA-Z0-9-]*\\\\.)+([a-zA-Z0-9-]+)(?:\\\\/.*)?\\\", 1, Url)\\r\\n| lookup SuspiciousTLDs on TLD\\r\\n| where isnotempty(Description)\\r\\n| extend IANA = strcat(\\\"https://www.iana.org/domains/root/db/\\\", TLD)\\r\\n| project Time = TimeGenerated, TLD = toupper(TLD), Description, IANA, Domain, EventMessage, SrcIpAddr, EventResult, DvcAction\",\"size\":0,\"showAnalytics\":true,\"title\":\"Detailed Suspicious TLD Activity ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IANA\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"IANA Infomation\"}}],\"filter\":true}},\"name\":\"query13\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let SuspiciousTLDs = datatable (TLD:string, Description:string) [\\r\\n    \\\"sbs\\\", \\\"Special Broadcasting Service Corporation\\\",\\r\\n    \\\"cyou\\\", \\\"ShortDot SA\\\",\\r\\n    \\\"quest\\\", \\\"Quest ION Limited\\\",\\r\\n    \\\"autos\\\", \\\"Autos\\\",\\r\\n    \\\"top\\\", \\\"Jiangsu Bangning Science and Technology Co\\\",\\r\\n    \\\"skin\\\", \\\"XYZ.COM LLC\\\",\\r\\n    \\\"cfd\\\", \\\"CFD\\\",\\r\\n    \\\"best\\\", \\\"Best\\\",\\r\\n    \\\"bio\\\", \\\"Bio\\\",\\r\\n    \\\"cloud\\\", \\\"Cloud\\\",\\r\\n    \\\"makeup\\\", \\\"XYZ.COM LLC\\\",\\r\\n    \\\"icu\\\", \\\"ICU\\\",\\r\\n    \\\"shop\\\", \\\"Shop\\\",\\r\\n    \\\"ltd\\\", \\\"Ltd\\\",\\r\\n    \\\"xyz\\\", \\\"XYZ\\\",\\r\\n    \\\"help\\\", \\\"Help\\\",\\r\\n    \\\"monster\\\", \\\"Monster\\\",\\r\\n    \\\"ink\\\", \\\"Ink\\\",\\r\\n    \\\"pro\\\", \\\"Pro\\\",\\r\\n    \\\"bd\\\", \\\"Bangladesh\\\",\\r\\n    \\\"run\\\", \\\"Run\\\",\\r\\n    \\\"live\\\", \\\"Rightside\\\",\\r\\n    \\\"life\\\", \\\"Life\\\",\\r\\n    \\\"pics\\\", \\\"Pics\\\",\\r\\n    \\\"th\\\", \\\"Thailand\\\",\\r\\n    \\\"py\\\", \\\"Paraguay\\\",\\r\\n    \\\"club\\\", \\\"Club\\\",\\r\\n    \\\"id\\\", \\\"Indonesia\\\",\\r\\n    \\\"today\\\", \\\"Today\\\",\\r\\n    \\\"pk\\\", \\\"Pakistan\\\",\\r\\n    \\\"ng\\\", \\\"Nigeria\\\",\\r\\n    \\\"website\\\", \\\"Website\\\",\\r\\n    \\\"to\\\", \\\"Tonga\\\",\\r\\n    \\\"store\\\", \\\"Store\\\",\\r\\n    \\\"beauty\\\", \\\"Beauty\\\",\\r\\n    \\\"space\\\", \\\"Space\\\",\\r\\n    \\\"tz\\\", \\\"Tanzania\\\",\\r\\n    \\\"link\\\", \\\"Link\\\",\\r\\n    \\\"lol\\\", \\\"Lol\\\",\\r\\n    \\\"mk\\\", \\\"Macedonia\\\",\\r\\n    \\\"click\\\", \\\"Click\\\",\\r\\n    \\\"site\\\", \\\"Site\\\",\\r\\n    \\\"cc\\\", \\\"Cocos (Keeling) Islands\\\",\\r\\n    \\\"su\\\", \\\"Russian Federation\\\",\\r\\n    \\\"cam\\\", \\\"Cam\\\",\\r\\n    \\\"cn\\\", \\\"China\\\",\\r\\n    \\\"buzz\\\", \\\"Buzz\\\",\\r\\n    \\\"lk\\\", \\\"Sri Lanka\\\",\\r\\n    \\\"in\\\", \\\"India\\\",\\r\\n    \\\"tr\\\", \\\"Turkey\\\",\\r\\n    \\\"tk\\\", \\\"Tokelau\\\",\\r\\n    \\\"pw\\\", \\\"Palau\\\",\\r\\n    \\\"ws\\\", \\\"Samoa\\\",\\r\\n    \\\"ml\\\", \\\"Mali\\\",\\r\\n    \\\"ga\\\", \\\"Gabon\\\",\\r\\n    \\\"cf\\\", \\\"Central African Republic\\\",\\r\\n    \\\"gq\\\", \\\"Equatorial Guinea\\\",\\r\\n    \\\"zw\\\", \\\"Zimbabwe\\\",\\r\\n    \\\"am\\\", \\\"Armenia\\\",\\r\\n    \\\"date\\\", \\\"Date\\\",\\r\\n    \\\"cd\\\", \\\"Congo, Democratic Republic\\\",\\r\\n    \\\"bid\\\", \\\"Bid\\\",\\r\\n    \\\"tokyo\\\", \\\"Tokyo\\\",\\r\\n    \\\"cm\\\", \\\"Cameroon\\\",\\r\\n    \\\"uno\\\", \\\"Uno\\\",\\r\\n    \\\"email\\\", \\\"Email\\\",\\r\\n    \\\"stream\\\", \\\"Stream\\\",\\r\\n    \\\"info\\\", \\\"Info\\\",\\r\\n    \\\"rest\\\", \\\"Rest\\\",\\r\\n    \\\"casa\\\", \\\"Casa\\\",\\r\\n    \\\"support\\\", \\\"Support\\\",\\r\\n    \\\"win\\\", \\\"Win\\\"\\r\\n];\\r\\nASimWebSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where NetworkBytes > 0\\r\\n| where isnotempty(Url)\\r\\n| extend Domain = extract(@\\\"([a-zA-Z0-9-.]+)+(?:\\\\/.*)?\\\", 1, Url)\\r\\n| where not(Domain matches regex (@\\\"\\\\b\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\.\\\\d{1,3}\\\\b\\\")) and Domain contains \\\".\\\"\\r\\n| extend TLD = extract(@\\\"(?:[a-zA-Z0-9-]*\\\\.)+([a-zA-Z0-9-]+)(?:\\\\/.*)?\\\", 1, Url)\\r\\n| lookup SuspiciousTLDs on TLD\\r\\n| where isnotempty(Description)\\r\\n| extend IANA = strcat(\\\"https://www.iana.org/domains/root/db/\\\", TLD)\\r\\n| summarize Count = count() by TLD = toupper(TLD), Description, Domain, IANA\\r\\n| sort by Count desc\\r\\n//  SuspiciousTLDs\\r\\n//  | join kind=inner(\\r\\n//  ASimNetworkSessionSonicWallFirewall\\r\\n//) on $right.RequestedURL contains $left.TopLevelDomain\\r\\n//| project TimeGenerated, SourceIP, SourcePort, DestinationIP, DestinationPort, FirewallAction\\r\\n//| summarize Count = count() by Activity, SourceIP, DestinationIP, DestinationPort\\r\\n//| sort by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Suspicious TLD Activity by TLD ({TimeRange})\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IANA\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"IANA Infomation\"}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"TLD\"],\"expandTopLevel\":false}}},\"customWidth\":\"55\",\"name\":\"query14\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"firewall-security\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Activity Breakdown\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Get insight into the types, severity, and volume of events. Use the filters at the top of the workbook to adjust time ranges and more.\",\"style\":\"info\"},\"name\":\"text - 8\"},{\"type\":1,\"content\":{\"json\":\"These are breakdowns of the various activities.\\r\\n - Activity Breakdown displays the variety of events by their count. A tile and table view are provided.\\r\\n - Event Breakdown displays the number of events by severity in a chart view\"},\"name\":\"text - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{ActivitySelection:lable}\\\" == \\\"All\\\" or EventMessage in ({ActivitySelection})\\r\\n| extend\\r\\n    LogMsgSeverity = tostring(AdditionalFields['LogMsgSeverity']),\\r\\n    LogMsgCategory = tostring(AdditionalFields['LogMsgCategory'])\\r\\n| summarize Count=count() by EventMessage, LogMsgSeverity, LogMsgCategory\",\"size\":0,\"showAnalytics\":true,\"title\":\"Activity Breakdown ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"LogMsgCategory\"},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"LogMsgSeverity\"},\"showBorder\":false}},\"name\":\"query1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{ActivitySelection:lable}\\\" == \\\"All\\\" or EventMessage in ({ActivitySelection})\\r\\n| extend\\r\\n    LogMsgSeverity = tostring(AdditionalFields['LogMsgSeverity']),\\r\\n    LogMsgCategory = tostring(AdditionalFields['LogMsgCategory'])\\r\\n| summarize Count = count() by EventMessage, EventOriginalType, LogMsgSeverity, LogMsgCategory\\r\\n| project-rename ID = EventOriginalType, Severity = LogMsgSeverity, Category = LogMsgCategory\\r\\n| order by Count desc\\r\\n\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Activity Breakdown ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\",\"compositeBarSettings\":{\"labelText\":\"\",\"columnSettings\":[{\"columnName\":\"Count\",\"color\":\"orange\"}]}}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"55\",\"name\":\"query2\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| where \\\"{ActivitySelection:lable}\\\" == \\\"All\\\" or EventMessage in ({ActivitySelection})\\r\\n| extend\\r\\n    LogMsgSeverity = tostring(AdditionalFields['LogMsgSeverity'])\\r\\n| summarize Count=count() by LogMsgSeverity\",\"size\":0,\"showAnalytics\":true,\"title\":\"Event Severity Breakdown ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"30\",\"name\":\"query3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| extend\\r\\n    LogMsgSeverity = tostring(AdditionalFields['LogMsgSeverity']),\\r\\n    LogMsgCategory = tostring(AdditionalFields['LogMsgCategory'])\\r\\n| summarize Count = count() by EventMessage, EventOriginalType, LogMsgSeverity, LogMsgCategory\\r\\n| project-rename ID = EventOriginalType, Severity = LogMsgSeverity, Category = LogMsgCategory\\r\\n| order by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Activities grouped by Severity, then Category\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Severity\",\"Category\"],\"expandTopLevel\":true},\"sortBy\":[{\"itemKey\":\"$gen_count_$gen_group_0\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"$gen_count_$gen_group_0\",\"sortOrder\":1}]},\"customWidth\":\"75\",\"name\":\"query4\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"activity-breakdown\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Content Filtering\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"View blocked websites, categories, and more at a glance. Use the filters at the top of the workbook to customize your view.\\r\\n\\r\\nTo verify SonicWall Content Filtering ratings or to request a rating review, please visit the [Capture Labs CFS Lookup page](https://capturelabs.sonicwall.com/m/feature/cfs)\",\"style\":\"info\"},\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b7c2d4df-007d-433e-8695-352fc0a8284f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"CFSCategory\",\"label\":\"CFS Category\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"ASimWebSessionSonicWallFirewall(false)\\r\\n| extend\\r\\n    CFSCategoryID = tostring(AdditionalFields['CFSCategoryID']),\\r\\n    CFSCategoryName = tostring(AdditionalFields['CFSCategoryName'])\\r\\n| where isnotempty(CFSCategoryID)\\r\\n| summarize by CFSCategoryID, CFSCategoryName\\r\\n| sort by CFSCategoryName asc\\r\\n| project value = CFSCategoryID, label = coalesce(trim('\\\"', CFSCategoryName), \\\"N/A\\\")\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Top 50 CFS Domains Blocked with blocked Usernames and CFS Policies\\r\\nASimWebSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| extend\\r\\n    CFSCategoryID = tostring(AdditionalFields['CFSCategoryID']),\\r\\n    CFSCategoryName = tostring(AdditionalFields['CFSCategoryName']),\\r\\n    CFSPolicyName = tostring(AdditionalFields['CFSPolicyName'])\\r\\n| where \\\"{CFSCategory:lable}\\\" == \\\"All\\\" or CFSCategoryID in ({CFSCategory:value})\\r\\n| where EventMessage == \\\"Website Blocked\\\"\\r\\n| extend Url = trim(@\\\"(/.*)\\\", Url)\\r\\n| extend HitCounter = 1\\r\\n| summarize Users = makeset(trim('\\\"', SrcUsername)), Policies = makeset(trim('\\\"', CFSPolicyName)), Count = sum(HitCounter) by Url, Category = CFSCategoryName\\r\\n| top 50 by Count desc\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 50 CFS Domains Blocked ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimWebSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where EventMessage == \\\"Website Blocked\\\"\\r\\n| extend\\r\\n    CFSCategoryName = tostring(AdditionalFields['CFSCategoryName']),\\r\\n    CFSPolicyName = tostring(AdditionalFields['CFSPolicyName'])\\r\\n| summarize Policies = makeset(CFSPolicyName), BlockedCount = count() by CFSCategoryName\\r\\n| project-rename Category = CFSCategoryName\\r\\n| sort by BlockedCount\\r\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"CFS Categories Blocked ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":500}},\"customWidth\":\"50\",\"name\":\"query2\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Computer in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity == \\\"Website Blocked\\\"\\r\\n| extend\\r\\n    CFSCategoryID = extract(@'(\\\\d+)\\\\s', 1, column_ifexists(\\\"Reason\\\", \\\"\\\"))\\r\\n    , CFSCategoryName = extract(@'.*-(\\\"(.*))', 1, column_ifexists(\\\"Reason\\\", \\\"\\\"))\\r\\n    , CFSPolicyName = extract(@'Policy: (.*), Info:', 1, column_ifexists(\\\"DeviceCustomString6\\\", \\\"\\\"))\\r\\n| summarize BlockedCount = count() by CFSPolicyName\\r\\n| sort by BlockedCount desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"CFS Blocked Sites by Policy ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"query3\",\"styleSettings\":{\"maxWidth\":\"25\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// CFS Blocks by User\\r\\nASimWebSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventMessage == \\\"Website Blocked\\\"\\r\\n| extend\\r\\n    CFSCategoryName = tostring(AdditionalFields['CFSCategoryName']),\\r\\n    CFSPolicyName = tostring(AdditionalFields['CFSPolicyName'])\\r\\n| extend SrcUsername = coalesce(SrcUsername, \\\"No username\\\")\\r\\n| summarize Policies = makeset(CFSPolicyName), Categories = makeset(trim('\\\"', CFSCategoryName)), BlockedCount = count() by User = SrcUsername\\r\\n| sort by BlockedCount\",\"size\":1,\"showAnalytics\":true,\"title\":\"CFS Blocks by User ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query4\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"cfs\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Denied By Country\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"A window into denied inbound/outbound traffic by country. Use the filters at the top of the workbook to adjust time ranges and more.\\r\\n\\r\\n**Country data is available from SonicOS log message IDs 1199 and 1198.**\",\"style\":\"info\"},\"name\":\"text - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| where SrcZone == \\\"WAN\\\" and EventResult == \\\"Failure\\\"\\r\\n| where EventOriginalType in (1199, 1198)\\r\\n| summarize DeniedCount = count(), NetworkBytes = sum(NetworkBytes) by Country = coalesce(SrcGeoCountry, \\\"#N/A\\\")\\r\\n| order by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Denied Inbound Traffic by Country ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"30\",\"name\":\"query1\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n// Look for dropped inbound traffic\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| where SrcZone == \\\"WAN\\\" and EventResult == \\\"Failure\\\"\\r\\n| where EventOriginalType in (1199, 1198)\\r\\n// Summarize the data by number of messages and the sum of the received bytes.\\r\\n| summarize DeniedCount = count(), NetworkBytes = sum(NetworkBytes) by Country = coalesce(SrcGeoCountry, \\\"#N/A\\\")\\r\\n| top 10 by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Denied Inbound Traffic by Country ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"30\",\"name\":\"query2\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n// Look for dropped inbound traffic\\r\\n| where SrcZone == \\\"WAN\\\" and EventResult == \\\"Failure\\\"\\r\\n| where EventOriginalType in (1199, 1198)\\r\\n// Summarize the data by number of messages and the sum of the received bytes.\\r\\n| summarize Events = makeset(EventMessage), DeniedCount = count(), NetworkBytes = sum(NetworkBytes) by Country = coalesce(SrcGeoCountry, \\\"#N/A\\\"), Protocol = NetworkProtocol, DstPort = DstPortNumber, SrcIpAddr\\r\\n| order by DeniedCount desc\\r\\n//TotalDeniedCount = sum(DeniedCount)\\r\\n\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Denied Inbound Traffic Detail by Country ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Group\",\"formatter\":1},{\"columnMatch\":\"DeniedCount\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}},{\"columnMatch\":\"TotalBytesReceived\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Country\"],\"expandTopLevel\":true}},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"75\",\"name\":\"query3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Denied outbound traffic by country\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n// Look for dropped outbound traffic traffic\\r\\n| where DstZone == \\\"WAN\\\" and SrcZone != \\\"WAN\\\" and EventResult == \\\"Failure\\\"\\r\\n| where EventOriginalType in (1199, 1198)\\r\\n// Summarize the data by number of messages\\r\\n| summarize Events = makeset(EventMessage), DeniedCount = count() by Country = coalesce(DstGeoCountry, \\\"#N/A\\\"), Protocol = NetworkProtocol, DstPort = DstPortNumber, DstIpAddr\\r\\n| order by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Denied Outbound Traffic Detail by Country ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Group\",\"formatter\":1},{\"columnMatch\":\"DeniedCount\",\"formatter\":0,\"formatOptions\":{\"aggregation\":\"Sum\"}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Country\"],\"expandTopLevel\":true}},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"country_name\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"DeniedCount\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"75\",\"name\":\"query4\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Denied outbound traffic by country\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n// Look for dropped outbound traffic traffic\\r\\n| where DstZone == \\\"WAN\\\" and SrcZone != \\\"WAN\\\" and EventResult == \\\"Failure\\\"\\r\\n| where EventOriginalType in (1199, 1198)\\r\\n// Summarize the data by number of messages\\r\\n| summarize DeniedCount = count() by Country = coalesce(DstGeoCountry, \\\"#N/A\\\")\\r\\n| order by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Denied Outbound Traffic by Country ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"query5\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}}]},\"name\":\"denied-by-country\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Security Services\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n//| where Activity in (\\\"Application Control Detection Alert\\\", \\\"Application Control Prevention Alert\\\")\\r\\n| where EventOriginalType in (1154, 1155, 794, 795, 1200, 1201, 1476, 1477, 1518, 1519, 14, 809, 1631, 1198, 1199, 1474, 1475, 789, 790, 608, 609, 797, 798, 799)\\r\\n| summarize Count = count() by EventMessage, EventOriginalType\\r\\n//| summarize Count = count() by AppSignatureID, AppSignatureName, AppCategoryName\\r\\n//| project-reorder AppSignatureName\",\"size\":0,\"showAnalytics\":true,\"title\":\"Observed Threats\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"Geo IP Responder Blocked\",\"label\":\"Geo Responders Blocked\",\"comment\":\"Responder IPs blocked by Geo-IP\"},{\"seriesName\":\"Application Control Detection Alert\",\"label\":\"App Control Detections\",\"comment\":\"App Control 'Log' Events\"},{\"seriesName\":\"Geo IP Initiator Blocked\",\"label\":\"Geo Initiators Blocked\",\"comment\":\"Initiator IPs blocked by Geo-IP\"},{\"seriesName\":\"IPS Detection Alert\",\"label\":\"Intrusions Detected\",\"comment\":\"IPS 'Log' Events\"},{\"seriesName\":\"Website Blocked\",\"label\":\"Websites Blocked\",\"comment\":\"Websites blocked by Content Filtering\"},{\"seriesName\":\"IPS Prevention Alert\",\"label\":\"Intrusions Prevented\",\"comment\":\"IPS 'Block' Events\"},{\"seriesName\":\"Application Control Prevention Alert\",\"label\":\"App Control Preventions\",\"comment\":\"App Control 'Block' Events\"},{\"seriesName\":\"Capture ATP Sandbox Verdict\",\"label\":\"File Verdicts Received\",\"comment\":\"Verdicts received from Capture ATP\"},{\"seriesName\":\"Gateway Anti-Virus Alert\",\"label\":\"Malware Blocked\",\"comment\":\"Malware blocked by Gateway Anti-Virus\"}]}},\"name\":\"query1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (1154, 795, 809, 1631, 789, 608, 797, 798, 799)\\r\\n| extend CaptureATPVerdict = tostring(AdditionalFields['CaptureATPVerdict'])\\r\\n| summarize Count = count() by EventMessage, EventOriginalType, CaptureATPVerdict\\r\\n//| summarize Count = count() by AppSignatureID, AppSignatureName, AppCategoryName\\r\\n//| project-reorder AppSignatureName\",\"size\":0,\"showAnalytics\":true,\"title\":\"Observed Detections ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"EventMessage\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"EventOriginalType\"},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"chartSettings\":{\"showLegend\":true,\"seriesLabelSettings\":[{\"seriesName\":\"Geo IP Responder Blocked\",\"label\":\"Geo Responders Blocked\",\"comment\":\"Responder IPs blocked by Geo-IP\"},{\"seriesName\":\"Application Control Detection Alert\",\"label\":\"App Control Detections\",\"comment\":\"App Control 'Log' Events\"},{\"seriesName\":\"Geo IP Initiator Blocked\",\"label\":\"Geo Initiators Blocked\",\"comment\":\"Initiator IPs blocked by Geo-IP\"},{\"seriesName\":\"IPS Detection Alert\",\"label\":\"Intrusions Detected\",\"comment\":\"IPS 'Log' Events\"},{\"seriesName\":\"Website Blocked\",\"label\":\"Websites Blocked\",\"comment\":\"Websites blocked by Content Filtering\"},{\"seriesName\":\"IPS Prevention Alert\",\"label\":\"Intrusions Prevented\",\"comment\":\"IPS 'Block' Events\"},{\"seriesName\":\"Application Control Prevention Alert\",\"label\":\"App Control Preventions\",\"comment\":\"App Control 'Block' Events\"},{\"seriesName\":\"Capture ATP Sandbox Verdict\",\"label\":\"File Verdicts Received\",\"comment\":\"Verdicts received from Capture ATP\"},{\"seriesName\":\"Gateway Anti-Virus Alert\",\"label\":\"Malware Blocked\",\"comment\":\"Malware blocked by Gateway Anti-Virus\"}]}},\"name\":\"query2\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"App Control\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventMessage == \\\"Application Control Detection Alert\\\"\\r\\n| extend\\r\\n    AppSignatureID = coalesce(SrcAppId, DstAppId, ThreatId),\\r\\n    AppSignatureName = coalesce(SrcAppName, DstAppName)\\r\\n| extend\\r\\n    AppIDName = extract(@' (.*) --', 1, AppSignatureName), // this should be the name of the application in app control (already in the src/dst appname.)\\r\\n    AppCategoryName = extract(@'^[\\\"]([a-zA-Z-]+)', 1, AppSignatureName)\\r\\n| extend\\r\\n    AppSignatureName = trim('\\\"', extract(@'.*-- (.*\\\\S)', 1, AppSignatureName))\\r\\n| summarize Count = count() by AppSignatureID, AppSignatureName, AppIDName, AppCategoryName\\r\\n| top 25 by Count desc\\r\\n| project-reorder AppSignatureName\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 25 Signatures Detected\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"AppSignatureName\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"AppIDName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"AppCategoryName\",\"formatter\":1},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query1ac\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventMessage == \\\"Application Control Prevention Alert\\\"\\r\\n| extend\\r\\n    AppSignatureID = coalesce(SrcAppId, DstAppId, ThreatId),\\r\\n    AppSignatureName = coalesce(SrcAppName, DstAppName)\\r\\n| extend\\r\\n    AppIDName = extract(@' (.*) --', 1, AppSignatureName), // this should be the name of the application in app control (already in the src/dst appname.)\\r\\n    AppCategoryName = extract(@'^[\\\"]([a-zA-Z-]+)', 1, AppSignatureName)\\r\\n| extend\\r\\n    AppSignatureName = trim('\\\"', extract(@'.*-- (.*\\\\S)', 1, AppSignatureName))\\r\\n| summarize Count = count() by AppSignatureID, AppSignatureName, AppIDName, AppCategoryName\\r\\n| top 25 by Count desc\\r\\n| project-reorder AppSignatureName\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 25 Signatures Prevented\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"AppSignatureName\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"AppIDName\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"AppCategoryName\"},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"query2ac\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventMessage == \\\"Application Control Detection Alert\\\"\\r\\n| extend\\r\\n    AppSignatureName = coalesce(SrcAppName, DstAppName)\\r\\n| extend\\r\\n    AppIDName = extract(@' (.*) --', 1, AppSignatureName), // this should be the name of the application in app control (already in the src/dst appname.)\\r\\n    AppCategoryName = extract(@'^[\\\"]([a-zA-Z-]+)', 1, AppSignatureName)\\r\\n| extend\\r\\n    AppSignatureName = trim('\\\"', extract(@'.*-- (.*\\\\S)', 1, AppSignatureName))\\r\\n| summarize Count = count() by Signature = AppSignatureName, Category = AppCategoryName, App = AppIDName\\r\\n| project-reorder Category, App, Signature\\r\\n| order by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"App Control Detections by App and Signature\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"customWidth\":\"60\",\"name\":\"query3ac\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventMessage == \\\"Application Control Detection Alert\\\"\\r\\n| extend\\r\\n    AppSignatureName = coalesce(SrcAppName, DstAppName)\\r\\n| extend\\r\\n    AppIDName = extract(@' (.*) --', 1, AppSignatureName), // this should be the name of the application in app control (already in the src/dst appname.)\\r\\n    AppCategoryName = extract(@'^[\\\"]([a-zA-Z-]+)', 1, AppSignatureName)\\r\\n| summarize Count = count() by App = AppIDName, Category = AppCategoryName\\r\\n| project-reorder Category, App\\r\\n| order by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"App Control Detections by App\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Count\",\"sortOrder\":2}]},\"customWidth\":\"40\",\"name\":\"query4ac\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventMessage == \\\"Application Control Prevention Alert\\\"\\r\\n| extend\\r\\n    AppSignatureName = coalesce(SrcAppName, DstAppName)\\r\\n| extend\\r\\n    AppIDName = extract(@' (.*) --', 1, AppSignatureName), // this should be the name of the application in app control (already in the src/dst appname.)\\r\\n    AppCategoryName = extract(@'^[\\\"]([a-zA-Z-]+)', 1, AppSignatureName)\\r\\n| extend\\r\\n    AppSignatureName = trim('\\\"', extract(@'.*-- (.*\\\\S)', 1, AppSignatureName))\\r\\n| summarize Count = count() by Signature = AppSignatureName, Category = AppCategoryName, App = AppIDName\\r\\n| project-reorder Category, App, Signature\\r\\n| order by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"App Control Preventions by App and Signature\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query5ac\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where EventMessage == \\\"Application Control Prevention Alert\\\"\\r\\n| extend\\r\\n    AppSignatureName = coalesce(SrcAppName, DstAppName)\\r\\n| extend\\r\\n    AppIDName = extract(@' (.*) --', 1, AppSignatureName), // this should be the name of the application in app control (already in the src/dst appname.)\\r\\n    AppCategoryName = extract(@'^[\\\"]([a-zA-Z-]+)', 1, AppSignatureName)\\r\\n| summarize Count = count() by App = AppIDName, Category = AppCategoryName\\r\\n| project-reorder Category, App\\r\\n| order by Count desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"App Control Preventions by App\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"40\",\"name\":\"query6ac\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"ss-app-control\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Intrusion Prevention Service\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where Activity == \\\"IPS Detection Alert\\\"\\r\\n| parse-kv AdditionalExtensions as (['sid']:string, ['ipscat']:string, ['ipspri']:string) with (pair_delimiter=\\\";\\\", kv_delimiter=\\\"=\\\")\\r\\n| extend\\r\\n    IPSPriority = case(ipspri == 1, \\\"High (1)\\\",\\r\\n                        ipspri == 2, \\\"Medium (2)\\\",\\r\\n                        ipspri == 3, \\\"Low (3)\\\",\\r\\n                        \\\"\\\"\\r\\n                        )\\r\\n| extend\\r\\n    IPSCategoryName = extract(@'^\\\"?([a-zA-Z-\\\\/]+)', 1, ipscat),\\r\\n    IPSSignatureName = extract(@'[ ](.*)\\\\S', 1, ipscat)\\r\\n| summarize Count = count() by IPSCategoryName, IPSPriority, IPSSignatureName\\r\\n| project-rename Priority = IPSPriority, Category = IPSCategoryName, Signature = IPSSignatureName\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"IPS Detections\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query1ips\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where Activity == \\\"IPS Prevention Alert\\\"\\r\\n| parse-kv AdditionalExtensions as (['sid']:string, ['ipscat']:string, ['ipspri']:string) with (pair_delimiter=\\\";\\\", kv_delimiter=\\\"=\\\")\\r\\n| extend\\r\\n    IPSPriority = case(ipspri == 1, \\\"High (1)\\\",\\r\\n                        ipspri == 2, \\\"Medium (2)\\\",\\r\\n                        ipspri == 3, \\\"Low (3)\\\",\\r\\n                        \\\"\\\"\\r\\n                        )\\r\\n| extend\\r\\n    IPSCategoryName = extract(@'^\\\"?([a-zA-Z-\\\\/]+)', 1, ipscat),\\r\\n    IPSSignatureName = extract(@'[ ](.*)\\\\S', 1, ipscat)\\r\\n| summarize Count = count() by IPSCategoryName, IPSPriority, IPSSignatureName\\r\\n| project-rename Priority = IPSPriority, Category = IPSCategoryName, Signature = IPSSignatureName\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"IPS Preventions\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query2ips\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"7cbecf32-b9ea-497d-83a7-9b5f7f0a640a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IPS_Action\",\"label\":\"IPS Action\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"608\\\", \\\"label\\\": \\\"Detection/Logged\\\"},\\r\\n    {\\\"value\\\": \\\"609\\\", \\\"label\\\": \\\"Prevention/Blocked\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\r\\n\\r\\nCommonSecurityLog\\r\\n| where \\\"{SourceDevice:label}\\\" == \\\"All\\\" or Computer in ({SourceDevice})\\r\\n| where DeviceEventClassID in ({IPS_Action:value})\\r\\n| parse-kv AdditionalExtensions as (['sid']:string, ['ipscat']:string, ['ipspri']:string) with (pair_delimiter=\\\";\\\", kv_delimiter=\\\"=\\\")\\r\\n| extend\\r\\n    IPSPriority = case(ipspri == 1, \\\"High (1)\\\",\\r\\n                        ipspri == 2, \\\"Medium (2)\\\",\\r\\n                        ipspri == 3, \\\"Low (3)\\\",\\r\\n                        \\\"\\\"\\r\\n                        )\\r\\n| extend\\r\\n    IPSCategoryName = extract(@'^\\\"?([a-zA-Z-\\\\/]+)', 1, ipscat),\\r\\n    IPSSignatureName = extract(@'[ ](.*)\\\\S', 1, ipscat)\\r\\n| extend Action = case(DeviceEventClassID == 608, \\\"Detection\\\", DeviceEventClassID == 609, \\\"Prevention\\\", \\\"\\\")\\r\\n| summarize by Time = TimeGenerated, Priority = IPSPriority, Category = IPSCategoryName, Signature = IPSSignatureName, SrcIP = SourceIP, SrcPort = SourcePort, DstIP = DestinationIP, DstPort = DestinationPort, Action\\r\\n| project-reorder Time, Action\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"IPS Detection/Prevention Details\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"query3ipa\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"ss-ips\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Anti-Spyware\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where Activity == \\\"Anti-Spyware Detection Alert\\\"\\r\\n| parse-kv AdditionalExtensions as (['sid']:string, ['catid']:string, ['spycat']:string, ['spypri']:string) with (pair_delimiter=\\\";\\\", kv_delimiter=\\\"=\\\")\\r\\n| extend\\r\\n    AntiSpywareCategory = spycat,\\r\\n    AntiSpywarePriority = case(spypri == 1, \\\"High (1)\\\",\\r\\n                                spypri == 2, \\\"Medium (2)\\\",\\r\\n                                spypri == 3, \\\"Low (3)\\\",\\r\\n                                \\\"\\\"\\r\\n                                )\\r\\n| summarize Count = count() by AntiSpywareCategory, AntiSpywarePriority\\r\\n| project-rename Category = AntiSpywareCategory, Priority = AntiSpywarePriority\",\"size\":0,\"showAnalytics\":true,\"title\":\"Anti-Spyware Detections\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"query1asw\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where Activity == \\\"Anti-Spyware Prevention Alert\\\"\\r\\n| parse-kv AdditionalExtensions as (['sid']:string, ['catid']:string, ['spycat']:string, ['spypri']:string) with (pair_delimiter=\\\";\\\", kv_delimiter=\\\"=\\\")\\r\\n| extend\\r\\n    AntiSpywareCategory = spycat,\\r\\n    AntiSpywarePriority = case(spypri == 1, \\\"High (1)\\\",\\r\\n                                spypri == 2, \\\"Medium (2)\\\",\\r\\n                                spypri == 3, \\\"Low (3)\\\",\\r\\n                                \\\"\\\"\\r\\n                                )\\r\\n| summarize Count = count() by AntiSpywareCategory, AntiSpywarePriority\\r\\n| project-rename Category = AntiSpywareCategory, Priority = AntiSpywarePriority\",\"size\":0,\"showAnalytics\":true,\"title\":\"Anti-Spyware Preventions\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"query2asw\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"ss-antispyware\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Gateway Anti-Virus\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (809, 1462)\\r\\n| extend Message = tostring(AdditionalFields['EventMessageDetail'])\\r\\n| extend Threat = iff(Message contains \\\"Capture ATP detected virus\\\", \\\"Capture ATP Detection\\\", extract(@'.*\\\\) (.*) blocked.*', 1, Message))\\r\\n| extend ThreatURL = iff(Message contains \\\"URL:\\\", strcat('\\\"', extract(@'.*URL: (.*)', 1, Message)), \\\"\\\")\\r\\n| extend CloudAVID = iff(Message contains \\\"Cloud Id:\\\", extract(@'.*Cloud Id: (.*\\\\d)\\\\)', 1, Message), \\\"\\\")\\r\\n| summarize by Threat, Time = TimeGenerated, CloudAVID, SrcIP = SrcIpAddr, SrcPort = SrcPortNumber, DstIP = DstIpAddr, DstPort = DstPortNumber, ThreatURL\\r\\n| project-reorder Time, Threat\",\"size\":0,\"showAnalytics\":true,\"title\":\"Gateway Anti-Virus Detailed Alerts {TimeRange}\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"query1gav\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where EventOriginalType in (809, 1462)\\r\\n| extend Message = tostring(AdditionalFields['EventMessageDetail'])\\r\\n| extend Threat = iff(Message contains \\\"Capture ATP detected virus\\\", \\\"Capture ATP Detection\\\", extract(@'.*\\\\) (.*) blocked.*', 1, Message))\\r\\n| extend ThreatDomain = iff(Message contains \\\"URL:\\\", strcat('\\\"', extract(@':\\\\/\\\\/([^\\\\/]+)\\\\/', 1, Message), '\\\"'), \\\"\\\")\\r\\n| extend CloudAVID = iff(Message contains \\\"Cloud Id:\\\", extract(@'.*Cloud Id: (.*\\\\d)\\\\)', 1, Message), \\\"\\\")\\r\\n| summarize Count = count() by Threat, CloudAVID, ThreatDomain\\r\\n| order by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Gateway Anti-Virus Alerts by Threat {TimeRange}\",\"noDataMessageStyle\":3,\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"40\",\"name\":\"query2gav\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"ss-gav\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Capture ATP Insights\",\"expandable\":true,\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f3ca7626-b769-48ac-91d4-f7f32e80c832\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Capture_ATP_Verdict\",\"label\":\"File Verdict\",\"type\":2,\"description\":\"Filter Capture ATP verdicts with this drop down\",\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\",\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"BAD\\\", \\\"label\\\": \\\"Malicious\\\"},\\r\\n    {\\\"value\\\": \\\"GOOD\\\", \\\"label\\\": \\\"Benign\\\"},\\r\\n    {\\\"value\\\": \\\"CloudAV Detection\\\", \\\"label\\\": \\\"CloudAV Detection\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"defaultValue\":\"value::all\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceEventClassID in (1631, 1460)\\r\\n| extend Verdict = extract(@'Gateway Anti-Virus Status: (.*)\\\\. ', 1, Message)\\r\\n| where isnotempty(Verdict)\\r\\n| parse-kv AdditionalExtensions as (['arg']:string, ['susr']:string, ['fileid']:string) with (pair_delimiter=\\\";\\\", kv_delimiter=\\\"=\\\")\\r\\n| extend\\r\\n    User = coalesce(susr, SourceUserName),\\r\\n    NetworkProtocol = toupper(iff(Protocol contains \\\"-\\\" and Protocol !contains \\\"/\\\", toupper(trim_start(@\\\".*-\\\", Protocol)), toupper(trim_end(@\\\"/.*\\\", Protocol))))\\r\\n| project-rename \\r\\n    Dvc = Computer,\\r\\n    FileIdentifier = fileid,\\r\\n    Url = RequestURL\\r\\n| extend File = split(Url, '/')[-1]\\r\\n| where \\\"{Capture_ATP_Verdict:lable}\\\" == \\\"All\\\" or Verdict in ({Capture_ATP_Verdict:value})\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| project Time = TimeGenerated, Dvc, User, NetworkProtocol, Verdict, Url, File, Hash = FileIdentifier\\r\\n| sort by Time desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Verdicts from Capture ATP\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Time\",\"formatter\":6}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"Time\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Time\",\"sortOrder\":2}]},\"name\":\"query1catp\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceEventClassID in (1631, 1460)\\r\\n| extend Verdict = extract(@'Gateway Anti-Virus Status: (.*)\\\\. ', 1, Message)\\r\\n| where isnotempty(Verdict)\\r\\n| project-rename Dvc = Computer\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize Count=count() by Verdict, bin(TimeGenerated, {TimeRange:grain})\\r\\n| sort by TimeGenerated desc\\r\\n| project-rename Date = TimeGenerated\\r\\n| project-reorder Date\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Files Scanned over time\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":5,\"dateFormat\":{\"formatName\":\"longDatePattern\"}},{\"columnMatch\":\"Date\",\"formatter\":6,\"dateFormat\":{\"formatName\":\"longDatePattern\"}},{\"columnMatch\":\"Group\",\"formatter\":6,\"dateFormat\":{\"formatName\":\"longDatePattern\"}}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Date\"],\"expandTopLevel\":true}}},\"customWidth\":\"40\",\"name\":\"query2catp\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceEventClassID in (1631, 1460)\\r\\n| extend Verdict = extract(@'Gateway Anti-Virus Status: (.*)\\\\. ', 1, Message)\\r\\n| where isnotempty(Verdict)\\r\\n| project-rename \\r\\n    Dvc = Computer\\r\\n| where \\\"{Capture_ATP_Verdict:lable}\\\" == \\\"All\\\" or Verdict in ({Capture_ATP_Verdict:value})\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize LogVolume=count() by Verdict, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\\r\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"Verdict Breakdown\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"GOOD\",\"label\":\"Benign\",\"color\":\"blue\"},{\"seriesName\":\"File too big\",\"color\":\"orange\"},{\"seriesName\":\"BAD\",\"label\":\"Malicious\",\"color\":\"redBright\"},{\"seriesName\":\"CloudAV Detection\",\"color\":\"yellow\"},{\"seriesName\":\"Server error. This firewall is sending packets too fast for it to reassemble.\",\"color\":\"turquoise\"}]}},\"customWidth\":\"50\",\"name\":\"query3catp\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"capture-atp\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"security-services\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Traffic and Events\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Additional traffic and event insights. Use the filters at the top of the workbook to adjust time ranges and more.\",\"style\":\"info\"},\"name\":\"text - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| project-rename\\r\\n    SrcZone = DeviceCustomString3Label,\\r\\n    DstZone = DeviceCustomString4Label,\\r\\n    DstIpAddr = DestinationIP,\\r\\n    Dvc = Computer\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| extend NetworkDirection = case(SrcZone == \\\"\\\" and DstZone == \\\"\\\", \\\"NA\\\"\\r\\n                            , SrcZone == \\\"WAN\\\" and (DstZone == \\\"WAN\\\" and DstIpAddr !has \\\".255\\\"), \\\"Inbound\\\"\\r\\n                            , SrcZone == \\\"WAN\\\" and DstZone == \\\"WAN\\\", \\\"External\\\"\\r\\n                            , SrcZone == \\\"WAN\\\" and DstZone != \\\"WAN\\\", \\\"Inbound\\\"\\r\\n                            , SrcZone == \\\"VPN\\\" and DstZone == \\\"WAN\\\", \\\"Outbound\\\"\\r\\n                            , SrcZone == \\\"VPN\\\" and DstZone != \\\"WAN\\\", \\\"Inbound\\\"\\r\\n                            , DstZone == \\\"MULTICAST\\\", \\\"NA\\\"\\r\\n                            , DstZone == \\\"WAN\\\", \\\"Outbound\\\"\\r\\n                            , \\\"Local\\\"\\r\\n                            )\\r\\n| summarize TotalSentBytes = sum(SentBytes), TotalReceivedBytes = sum(ReceivedBytes) by NetworkDirection\\r\\n| extend TotalBytes = TotalSentBytes + TotalReceivedBytes\\r\\n| project NetworkDirection, TotalSentBytes, TotalReceivedBytes, TotalBytes\\r\\n| order by TotalBytes desc\",\"size\":4,\"showAnalytics\":true,\"title\":\"Network Traffic by Direction ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"yAxis\":[\"TotalBytes\"],\"ySettings\":{\"numberFormatSettings\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}}}},\"name\":\"query1te\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| project-rename\\r\\n    SrcZone = DeviceCustomString3Label,\\r\\n    DstZone = DeviceCustomString4Label,\\r\\n    DstIpAddr = DestinationIP,\\r\\n    Dvc = Computer\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| extend NetworkDirection = case(SrcZone == \\\"\\\" and DstZone == \\\"\\\", \\\"NA\\\"\\r\\n                            , SrcZone == \\\"WAN\\\" and (DstZone == \\\"WAN\\\" and DstIpAddr !has \\\".255\\\"), \\\"Inbound\\\"\\r\\n                            , SrcZone == \\\"WAN\\\" and DstZone == \\\"WAN\\\", \\\"External\\\"\\r\\n                            , SrcZone == \\\"WAN\\\" and DstZone != \\\"WAN\\\", \\\"Inbound\\\"\\r\\n                            , SrcZone == \\\"VPN\\\" and DstZone == \\\"WAN\\\", \\\"Outbound\\\"\\r\\n                            , SrcZone == \\\"VPN\\\" and DstZone != \\\"WAN\\\", \\\"Inbound\\\"\\r\\n                            , DstZone == \\\"MULTICAST\\\", \\\"NA\\\"\\r\\n                            , DstZone == \\\"WAN\\\", \\\"Outbound\\\"\\r\\n                            , \\\"Local\\\"\\r\\n                            )\\r\\n| summarize TotalSentBytes = sum(SentBytes), TotalReceivedBytes = sum(ReceivedBytes) by NetworkDirection\\r\\n| extend TotalBytes = TotalSentBytes + TotalReceivedBytes\\r\\n| project NetworkDirection, TotalSentBytes, TotalReceivedBytes, TotalBytes\\r\\n| order by TotalBytes desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Bytes Transferred by Direction ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TotalSentBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"TotalReceivedBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true,\"maximumFractionDigits\":2}}}],\"labelSettings\":[{\"columnId\":\"NetworkDirection\",\"label\":\"Direction\"},{\"columnId\":\"TotalSentBytes\",\"label\":\"Total Sent\"},{\"columnId\":\"TotalReceivedBytes\",\"label\":\"Total Received\"},{\"columnId\":\"TotalBytes\",\"label\":\"Total Transferred\"}]}},\"name\":\"query2te\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Events by Action\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| summarize count() by Action = DvcAction\\r\\n| project-rename Count = count_\",\"size\":4,\"showAnalytics\":true,\"title\":\"Events by Action ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query3te\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"40\",\"name\":\"te-group1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| project-rename\\r\\n    SrcIpAddr = SourceIP,\\r\\n    Dvc = Computer\\r\\n| where \\\"{SourceDevice:label}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize TotalSentBytes = sum(SentBytes), TotalReceivedBytes = sum(ReceivedBytes) by SrcIpAddr\\r\\n| extend TotalBytes = TotalSentBytes + TotalReceivedBytes\\r\\n| project SrcIpAddr, TotalSentBytes, TotalReceivedBytes, TotalBytes\\r\\n| order by TotalBytes desc\\r\\n| top 25 by TotalBytes\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top Sent/Received Bytes by IP ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TotalSentBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalReceivedBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"SentReceivedRatio\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TotalSentBytes\",\"label\":\"Sent\"},{\"columnId\":\"TotalReceivedBytes\",\"label\":\"Received\"},{\"columnId\":\"TotalBytes\",\"label\":\"Total\"}]}},\"customWidth\":\"30\",\"name\":\"query4te\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| project-rename Dvc = Computer\\r\\n| where \\\"{SourceDevice:label}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize TotalSentBytes = sum(SentBytes), TotalReceivedBytes = sum(ReceivedBytes) by Protocol\\r\\n| extend TotalBytes = TotalSentBytes + TotalReceivedBytes\\r\\n| project Protocol, TotalSentBytes, TotalReceivedBytes, TotalBytes\\r\\n| order by TotalBytes desc\\r\\n| top 25 by TotalBytes\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top Sent/Received Bytes by Protocol ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TotalSentBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalReceivedBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"SentReceivedRatio\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TotalSentBytes\",\"label\":\"Sent\"},{\"columnId\":\"TotalReceivedBytes\",\"label\":\"Received\"},{\"columnId\":\"TotalBytes\",\"label\":\"Total\"}]}},\"customWidth\":\"30\",\"name\":\"query5te\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| project-rename\\r\\n    Dvc = Computer,\\r\\n    SrcIpAddr = SourceIP,\\r\\n    DstIpAddr = DestinationIP\\r\\n| where \\\"{SourceDevice:label}\\\" == \\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| summarize TotalSentBytes = sum(SentBytes), TotalReceivedBytes = sum(ReceivedBytes) by SrcIpAddr, DstIpAddr, Protocol\\r\\n| extend TotalBytes = TotalSentBytes + TotalReceivedBytes\\r\\n| project SrcIpAddr, DstIpAddr, Protocol, TotalSentBytes, TotalReceivedBytes, TotalBytes\\r\\n| order by TotalBytes desc\\r\\n| top 25 by TotalBytes\",\"size\":1,\"showAnalytics\":true,\"title\":\"Top 25 Flows by Sent/Received Bytes ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TotalSentBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalReceivedBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"TotalBytes\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}},{\"columnMatch\":\"SentReceivedRatio\",\"formatter\":0,\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"TotalSentBytes\",\"label\":\"Sent\"},{\"columnId\":\"TotalReceivedBytes\",\"label\":\"Received\"},{\"columnId\":\"TotalBytes\",\"label\":\"Total\"}]}},\"customWidth\":\"50\",\"name\":\"query6te\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"traffic-and-events\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Denied IPs and Ports\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"A view of the top denied addresses and ports/protocols. Use the filters at the top of the workbook to adjust time ranges and more.\\r\\n\\r\\nThe Events refer to the Activity column of the CommonSecurityLog table.\",\"style\":\"info\"},\"name\":\"text - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Top 10 denied inbound source IPs\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where EventResult == \\\"Failure\\\" and NetworkDirection == \\\"Inbound\\\"\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| summarize Events = makeset(EventMessage), DeniedCount = count() by SrcIpAddr, SrcZone\\r\\n| top 10 by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Denied Inbound Source IP\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"DeniedCount\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"DeniedCount\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"name\":\"query1proto\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Top 10 denied outbound destination IPs\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where EventResult == \\\"Failure\\\" and NetworkDirection == \\\"Outbound\\\"\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| summarize Events = makeset(EventMessage), DeniedCount = count() by DstIpAddr, DstZone\\r\\n| top 10 by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Denied Outbound Destination IPs\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query2proto\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Top 25 denied inbound ports\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where EventResult == \\\"Failure\\\" and NetworkDirection == \\\"Inbound\\\"\\r\\n| where isnotempty(DstPortNumber)\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| project-rename IPVersion = NetworkProtocolVersion, Port = DstPortNumber\\r\\n| summarize Events = makeset(EventMessage), DeniedCount = count() by Port, NetworkProtocol, IPVersion, SrcZone\\r\\n| top 25 by DeniedCount desc\\r\\n\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 25 Denied Inbound Ports ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query3proto\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Top 25 denied outbound ports\\r\\nASimNetworkSessionSonicWallFirewall\\r\\n| where EventResult == \\\"Failure\\\" and NetworkDirection == \\\"Outbound\\\"\\r\\n| where isnotempty(DstPortNumber)\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{Destination_IP:lable}\\\" == \\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| project-rename IPVersion = NetworkProtocolVersion, Port = DstPortNumber\\r\\n| summarize Events = makeset(EventMessage), DeniedCount = count() by Port, Protocol = NetworkProtocol, IPVersion, SrcZone\\r\\n| top 25 by DeniedCount desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 25 Denied Outbound Ports\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query4proto\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}}]},\"name\":\"denied-ips-and-ports\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Trends, by time\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Various insights into hourly trends. Use the filters at the top of the workbook to adjust time ranges and more.\",\"style\":\"info\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceVendor == 'SonicWall'\\r\\n| where \\\"{SourceDevice:lable}\\\"==\\\"All\\\" or Computer in ({SourceDevice})\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{ActivitySelection:lable}\\\" == \\\"All\\\" or Activity in ({ActivitySelection})\\r\\n| summarize LogVolume=count() by Activity, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"aggregation\":3,\"title\":\"Activity by time ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query1trends\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\"==\\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{ActivitySelection:lable}\\\" == \\\"All\\\" or EventMessage in ({ActivitySelection})\\r\\n| summarize LogVolume=count() by DvcAction, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"aggregation\":3,\"title\":\"Device Action by time ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query2trends\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ASimNetworkSessionSonicWallFirewall\\r\\n| where \\\"{SourceDevice:lable}\\\"==\\\"All\\\" or Dvc in ({SourceDevice})\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DstIpAddr in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SrcIpAddr in ({Source_IP})\\r\\n| where \\\"{ActivitySelection:lable}\\\" == \\\"All\\\" or EventMessage in ({ActivitySelection})\\r\\n| extend LogMsgSeverity = tostring(AdditionalFields['LogMsgSeverity'])\\r\\n| summarize LogVolume=count() by LogMsgSeverity, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"aggregation\":3,\"title\":\"Event Severity by time ({TimeRange})\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query3trends\",\"styleSettings\":{\"maxWidth\":\"50\",\"showBorder\":true}}]},\"name\":\"trends\",\"styleSettings\":{\"showBorder\":true}}],\"fromTemplateId\":\"sentinel-SonicWallWorkbook1\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=SonicWallWorkbook; logoFileName=sonicwall_logo.svg; description=A collection of queries to provide visibility into the events reported by your SonicWall firewalls.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=SonicWall Workbook; templateRelativePath=SonicWallFirewall.json; subtitle=; provider=SonicWall}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "SonicWall Firewall",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SonicWall"
                },
                "support": {
                  "name": "SonicWall",
                  "tier": "Partner",
                  "link": "https://www.sonicwall.com/support/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "CommonSecurityLog",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ASimNetworkSessionSonicWallFirewall",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "SonicWallFirewall",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "AllowedInboundSSHTelnetRDPConnections_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule identifies allowed inbound SSH, Telnet, and RDP connections. This analytic rule leverages the SonicWall Firewall ASIM Network Session parser (ASimNetworkSessionSonicWallFirewall).",
                "displayName": "SonicWall - Allowed SSH, Telnet, and RDP Connections",
                "enabled": false,
                "query": "ASimNetworkSessionSonicWallFirewall(false)\n| where NetworkDirection == \"Inbound\" and EventResult in (\"NA\", \"Success\")\n| where EventOriginalType != 1370\n| where SrcAppName contains \"Windows Remote Desktop Services\"\n    or SrcAppName contains \"Telnet\"\n    or (SrcAppName contains \"SSH Protocol\" and ThreatId != 446) // Filters out SSH server responses.\n    or SrcAppName contains \"Bitvise SSH\"\n    or DstPortNumber in (22, 23, 3389)\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Experimental",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CEF",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  },
                  {
                    "connectorId": "SonicWallFirewall",
                    "dataTypes": [
                      "ASimNetworkSessionSonicWallFirewall"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "Exfiltration",
                  "Impact"
                ],
                "techniques": [
                  "T1190",
                  "T1133",
                  "T1059",
                  "T1110",
                  "T1003",
                  "T1087",
                  "T1018",
                  "T1021",
                  "T1005",
                  "T1048",
                  "T1041",
                  "T1011",
                  "T1567",
                  "T1490"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SrcIpAddr",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "DstIpAddr",
                        "identifier": "Address"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "SonicWall Firewall Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "SonicWall Firewall",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SonicWall"
                },
                "support": {
                  "name": "SonicWall",
                  "tier": "Partner",
                  "link": "https://www.sonicwall.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "SonicWall - Allowed SSH, Telnet, and RDP Connections",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "CaptureATPMaliciousFileDetection_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule identifies malicious file verdicts from the SonicWall Capture ATP service. This analytic rule leverages the SonicWall Firewall ASIM Network Session parser (ASimNetworkSessionSonicWallFirewall).\n  Ref: https://www.sonicwall.com/products/capture-advanced-threat-protection/\n  Ref: https://www.sonicwall.com/support/knowledge-base/how-to-view-threat-reports-capture-atp/170505384715913/",
                "displayName": "SonicWall - Capture ATP Malicious File Detection",
                "enabled": false,
                "query": "CommonSecurityLog\n| where DeviceEventClassID == 1631\n| extend CaptureATPVerdict = extract(@'Gateway Anti-Virus Status: (.*)\\. ', 1, Message)\n| where CaptureATPVerdict == \"BAD\"\n| parse-kv AdditionalExtensions as (['susr']:string, ['fileid']:string) with (pair_delimiter=\";\", kv_delimiter=\"=\")\n| extend\n    NetworkProtocol = toupper(iff(Protocol contains \"-\" and Protocol !contains \"/\", toupper(trim_start(@\".*-\", Protocol)), toupper(trim_end(@\"/.*\", Protocol)))),\n    NetworkApplicationProtocol = tostring(toupper(trim_start(@\".*/\", Protocol)))\n| project\n    TimeGenerated,\n    DeviceModel = DeviceProduct,\n    SerialNumber = Computer,\n    SrcIpAddr = SourceIP,\n    SrcUsername = coalesce(susr, SourceUserName),\n    NetworkProtocol,\n    NetworkApplicationProtocol,\n    RequestURL,\n    File = url_decode(tostring(split(RequestURL, '/')[-1])),\n    Hash = fileid,\n    Verdict = CaptureATPVerdict\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Experimental",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CEF",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  },
                  {
                    "connectorId": "SonicWallFirewall",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "tactics": [
                  "Execution"
                ],
                "techniques": [
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "entityType": "File",
                    "fieldMappings": [
                      {
                        "columnName": "File",
                        "identifier": "Name"
                      }
                    ]
                  },
                  {
                    "entityType": "Url",
                    "fieldMappings": [
                      {
                        "columnName": "RequestURL",
                        "identifier": "Url"
                      }
                    ]
                  },
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "SrcUsername",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SrcIpAddr",
                        "identifier": "Address"
                      }
                    ]
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "SonicWall Firewall Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "SonicWall Firewall",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SonicWall"
                },
                "support": {
                  "name": "SonicWall",
                  "tier": "Partner",
                  "link": "https://www.sonicwall.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "SonicWall - Capture ATP Malicious File Detection",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "OutboundSSHConnections_HuntingQueries Hunting Query with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "SonicWall_Firewall_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Outbound SSH/SCP Connections",
                "category": "Hunting Queries",
                "query": "ASimNetworkSessionSonicWallFirewall\n| where NetworkBytes > 0 and NetworkDirection == \"Outbound\"\n| extend ServiceName = coalesce(SrcAppName, DstAppName)\n| where ( DstPortNumber == 22 and NetworkProtocol in (\"TCP\", \"UDP\") ) or ServiceName contains \"General SSH\" or ServiceName == \"SSH Protocol\" or ServiceName == \"Bitvise SSH\"\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query looks for outbound SSH/SCP connections identified by the expected port number (22) or by the SonicWall Deep Packet Inspection services. This query leverages the SonicWall Firewall ASIM Network Session parser."
                  },
                  {
                    "name": "tactics",
                    "value": "Exfiltration"
                  },
                  {
                    "name": "techniques",
                    "value": "T1020,T1048"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "SonicWall Firewall Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "SonicWall Firewall",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SonicWall"
                },
                "support": {
                  "name": "SonicWall",
                  "tier": "Partner",
                  "link": "https://www.sonicwall.com/support/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Outbound SSH/SCP Connections",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.1.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "SonicWall Firewall",
        "publisherDisplayName": "SonicWall",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/SonicWall%20Firewall/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.sonicwall.com/products/firewalls/\">SonicWall Firewall</a> solution for Microsoft Sentinel enables ingestion of events using the Common Event Format (CEF) into Microsoft Sentinel for <a href=\"https://www.sonicwall.com/support/technical-documentation/?q=CEF&amp;language=English\">SonicWall Firewalls</a>.</p>\n<ol>\n<li><p><strong>SonicWall Firewall via AMA</strong> - This data connector helps in ingesting SonicWall Firewall logs into your Log Analytics Workspace using the new Azure Monitor Agent. Learn more about ingesting using the new Azure Monitor Agent <a href=\"https://learn.microsoft.com/azure/sentinel/connect-cef-ama\">here</a>. <strong>Microsoft recommends using this Data Connector</strong>.</p>\n</li>\n<li><p><strong>SonicWall Firewall via Legacy Agent</strong> - This data connector helps in ingesting SonicWall Firewall logs into your Log Analytics Workspace using the legacy Log Analytics agent.</p>\n</li>\n</ol>\n<p><strong>NOTE:</strong> Microsoft recommends installation of SonicWall Firewall via AMA Connector. Legacy connector uses the Log Analytics agent which is about to be deprecated by <strong>Aug 31, 2024,</strong> and thus should only be installed where AMA is not supported. Using MMA and AMA on same machine can cause log duplication and extra ingestion cost <a href=\"https://learn.microsoft.com/en-us/azure/sentinel/ama-migrate\">more details</a>.</p>\n<p><strong>Data Connectors:</strong> 2, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 2, <strong>Hunting Queries:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/sonicwall_logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "SonicWall Firewall",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "SonicWall"
        },
        "support": {
          "name": "SonicWall",
          "tier": "Partner",
          "link": "https://www.sonicwall.com/support/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId2')]",
              "version": "[variables('dataConnectorVersion2')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            }
          ]
        },
        "firstPublishDate": "2022-05-06",
        "providers": [
          "SonicWall"
        ],
        "categories": {
          "domains": [
            "Security - Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
