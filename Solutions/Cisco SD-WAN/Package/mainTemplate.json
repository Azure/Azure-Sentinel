{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Cisco Systems - support@cisco.com",
    "comments": "Solution template for Cisco SD-WAN"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "CiscoSDWANDashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "cisco.cisco-catalyst-sdwan-sentinel",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@cisco.com",
    "_email": "[variables('email')]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "CiscoSdwanWorkbook",
    "analyticRuleVersion1": "1.0.0",
    "analyticRulecontentId1": "232a1c75-63fc-4c81-8b18-b4a739fccba8",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "analyticRuleVersion2": "1.0.0",
    "analyticRulecontentId2": "dc3627c3-f9de-4f17-bfd3-ba99b64a0a67",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
    "analyticRuleVersion3": "1.0.0",
    "analyticRulecontentId3": "cb14defd-3415-4420-a2e4-2dd0f3e07a86",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
    "analyticRuleVersion4": "1.0.0",
    "analyticRulecontentId4": "a62a207e-62be-4a74-acab-4466d5b3854f",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
    "CiscoSDWANIntrusionLogicAPP": "CiscoSDWANIntrusionLogicAPP",
    "_CiscoSDWANIntrusionLogicAPP": "[variables('CiscoSDWANIntrusionLogicAPP')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "CiscoSDWANIntrusionLogicAPP",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookId1": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId1')))]",
    "blanks": "[replace('b', 'b', '')]",
    "CiscoSDWANLogicAPP": "CiscoSDWANLogicAPP",
    "_CiscoSDWANLogicAPP": "[variables('CiscoSDWANLogicAPP')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "CiscoSDWANLogicAPP",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "CiscoSDWANReport": "CiscoSDWANReport",
    "_CiscoSDWANReport": "[variables('CiscoSDWANReport')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "CiscoSDWANReport",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "uiConfigId1": "CiscoSDWAN",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "CiscoSDWAN",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0",
    "parserVersion1": "1.0.0",
    "parserContentId1": "CiscoSDWANNetflow-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "parserName1": "CiscoSDWANNetflow",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "parserVersion2": "1.0.0",
    "parserContentId2": "CiscoSyslogFW6LogSummary-Parser",
    "_parserContentId2": "[variables('parserContentId2')]",
    "parserName2": "CiscoSyslogFW6LogSummary",
    "_parserName2": "[concat(parameters('workspace'),'/',variables('parserName2'))]",
    "parserId2": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
    "_parserId2": "[variables('parserId2')]",
    "parserTemplateSpecName2": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId2')))]",
    "parserVersion3": "1.0.0",
    "parserContentId3": "CiscoSyslogUTD-Parser",
    "_parserContentId3": "[variables('parserContentId3')]",
    "parserName3": "CiscoSyslogUTD",
    "_parserName3": "[concat(parameters('workspace'),'/',variables('parserName3'))]",
    "parserId3": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
    "_parserId3": "[variables('parserId3')]",
    "parserTemplateSpecName3": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId3')))]",
    "parserVersion4": "1.0.0",
    "parserContentId4": "MapNetflowUsername-Parser",
    "_parserContentId4": "[variables('parserContentId4')]",
    "parserName4": "MapNetflowUsername",
    "_parserName4": "[concat(parameters('workspace'),'/',variables('parserName4'))]",
    "parserId4": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
    "_parserId4": "[variables('parserId4')]",
    "parserTemplateSpecName4": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId4')))]",
    "signatureid": "SignatureId",
    "_signatureid": "[variables('signatureid')]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Cisco SD-WAN Analytics Rule 1 with template",
        "displayName": "Cisco SD-WAN Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CiscoSDWANSentinelIntrusionEvents_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This Analytic rule will monitor Intrusion events in Cisco syslog data based on the provided Signature ID. This will create an incident if that Signature ID is found in the specified time range.",
                "displayName": "Cisco SDWAN - Intrusion Events",
                "enabled": false,
                "query": "CiscoSyslogUTD\n| where SignatureId == \"Enter SignatureId\"\n| distinct SignatureId,SourceIP\n",
                "queryFrequency": "PT3H",
                "queryPeriod": "PT3H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CiscoSDWAN",
                    "dataTypes": [
                      "CiscoSyslogUTD"
                    ]
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "entityMappings": [
                  {
                    "entityType": "RegistryKey",
                    "fieldMappings": [
                      {
                        "columnName": "SignatureId",
                        "identifier": "Key"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "signatureid": "[variables('_signatureid')]"
                },
                "incidentConfiguration": {
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "Cisco SD-WAN Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Cisco SD-WAN Analytics Rule 2 with template",
        "displayName": "Cisco SD-WAN Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "CiscoSDWANSentinelIPSEventThreshold_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytic rule will monitor specific IPS event in the data.",
                "displayName": "Cisco SDWAN - IPS Event Threshold",
                "enabled": false,
                "query": "CiscoSyslogUTD \n| where Classification == \"Enter classification\" \n| summarize count() by Classification \n| where count_ > 10\n",
                "queryFrequency": "PT3H",
                "queryPeriod": "PT3H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CiscoSDWAN",
                    "dataTypes": [
                      "CiscoSyslogUTD"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "entityMappings": [
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "columnName": "Classification",
                        "identifier": "Name"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "classification_count": "count_",
                  "classification": "Classification"
                },
                "incidentConfiguration": {
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "Cisco SD-WAN Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Cisco SD-WAN Analytics Rule 3 with template",
        "displayName": "Cisco SD-WAN Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "CiscoSDWANSentinelMalwareEvents_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytic rule will monitor Malware Events in Syslog and Netflow Data",
                "displayName": "Cisco SDWAN - Maleware Events",
                "enabled": false,
                "query": "CiscoSyslogUTD\n| where isnotempty(Malware) and Malware != \"None\"\n| distinct Malware, SourceIP\n| join kind=inner (CiscoSDWANNetflow\n| where isnotempty(NetflowUsername)\n| summarize arg_max(TimeStamp, NetflowUsername) by NetflowFwSrcAddrIpv4\n| distinct \n    [\"Username\"] = NetflowUsername,\n    [\"SourceIP\"] = NetflowFwSrcAddrIpv4) on SourceIP\n| project Malware, SourceIP, Username\n",
                "queryFrequency": "PT3H",
                "queryPeriod": "PT3H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CiscoSDWAN",
                    "dataTypes": [
                      "CiscoSyslogUTD"
                    ]
                  },
                  {
                    "connectorId": "CiscoSDWAN",
                    "dataTypes": [
                      "CiscoSDWANNetflow"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "Malware",
                    "fieldMappings": [
                      {
                        "columnName": "Malware",
                        "identifier": "Name"
                      }
                    ]
                  },
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "Username",
                        "identifier": "Name"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "mal_username": "Username",
                  "mal_malware": "Malware",
                  "mal_src_ip": "SourceIP"
                },
                "incidentConfiguration": {
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "Cisco SD-WAN Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "properties": {
        "description": "Cisco SD-WAN Analytics Rule 4 with template",
        "displayName": "Cisco SD-WAN Analytics Rule template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "AnalyticsRule"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "CiscoSDWANSentinelMonitorCriticalIP_AnalyticalRules Analytics Rule with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('AnalyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytic rule will monitor critical IPs in Syslog and Netflow Data.",
                "displayName": "Cisco SDWAN - Monitor Critical IPs",
                "enabled": false,
                "query": "CiscoSyslogUTD\n| union (CiscoSDWANNetflow)\n| where isnotempty(SourceIP) or isnotempty(NetflowFwSrcAddrIpv4)\n| extend SourceIP = coalesce(SourceIP, NetflowFwSrcAddrIpv4)\n| where ipv4_is_in_any_range(SourceIP, \"Enter comma-separated IPs\")\n| summarize count() by SourceIP\n",
                "queryFrequency": "PT3H",
                "queryPeriod": "PT3H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "CiscoSDWAN",
                    "dataTypes": [
                      "CiscoSyslogUTD"
                    ]
                  },
                  {
                    "connectorId": "CiscoSDWAN",
                    "dataTypes": [
                      "CiscoSDWANNetflow"
                    ]
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "critical_ip": "SourceIP"
                },
                "incidentConfiguration": {
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "Cisco SD-WAN Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "CiscoSDWANIntrusionLogicAPP playbook",
        "displayName": "CiscoSDWANIntrusionLogicAPP playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CiscoSDWANIntrusionLogicAPP Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CiscoSDWANIntrusionLogicAPP",
              "type": "string"
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Set_variable_signature_id": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Intrusion Event is Found with this signature_id: @{variables('signature_id')}<br>\nPlease visit this link for more details : https://www.snort.org/rule_docs/@{variables('signature_id')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')?['properties']?['additionalData']?['Custom Details']",
                            "schema": {
                              "properties": {
                                "signatureid": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          }
                        },
                        "Set_variable_signature_id": {
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "signature_id",
                            "value": "@{body('Parse_JSON')?['signatureid'][0]}"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_signature_id": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable_signature_id": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "signature_id",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "CiscoSDWANIntrusionLogicAPP",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ],
          "metadata": {
            "title": "CiscoSDWANIntrusionLogicAPP",
            "description": "This playbook provides an end-to-end example of adding a comment in the generated incident.",
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize MicrosoftSentinel connection.",
              "1. Click the MicrosoftSentinel connection resource",
              "2. Click edit API connections",
              "3. Click Authorize",
              "4. Sign in",
              "5. Click Save",
              "**b. Assign Role to add comment in incident**",
              "After authorizing each connection, assign role to this playbook.",
              "1. Go to Log Analytics Workspace → <your workspace> → Access Control → Add",
              "2.Add role assignment",
              "3.Assignment type: Job function roles",
              "4.Role: Microsoft Sentinel Contributor",
              "5.Members: select managed identity for assigned access to and add your logic app as member.",
              "6.Click on review+assign"
            ],
            "lastUpdateTime": "2023-07-03T00:00:00Z",
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "CiscoSDWANLogicAPP playbook",
        "displayName": "CiscoSDWANLogicAPP playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "CiscoSDWANLogicAPP Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CiscoSDWANLogicAPP",
              "type": "string"
            },
            "3rd_Party_Ticket_System": {
              "type": "string",
              "metadata": {
                "description": "Select 3rd Party Ticketing System."
              },
              "allowedValues": [
                "Jira",
                "ServiceNow"
              ],
              "defaultValue": "Jira"
            },
            "Jira_Instance": {
              "type": "string",
              "metadata": {
                "description": "Enter the URL of Jira Instance if you have selected Jira as 3rd Party Ticketing system."
              },
              "defaultValue": ""
            },
            "Jira_Project_Key": {
              "type": "string",
              "metadata": {
                "description": "Enter Jira Project Key if you have selected Jira as 3rd Party Ticketing system."
              },
              "defaultValue": ""
            },
            "Email": {
              "type": "string",
              "metadata": {
                "description": "Enter comma-separated email addresses on which alert details will be sent."
              }
            },
            "From_Mobile_No": {
              "type": "string",
              "metadata": {
                "description": "Enter the source mobile number with the Country code for sending SMS."
              }
            },
            "To_Mobile_No": {
              "type": "string",
              "metadata": {
                "description": "Enter the destination mobile number with the Country code for sending SMS."
              }
            },
            "Teams_Channel_ID": {
              "type": "string",
              "metadata": {
                "description": "Enter the ID of the Microsoft Teams channel on which alert details will be sent."
              }
            },
            "Teams_Group_ID": {
              "type": "string",
              "metadata": {
                "description": "Enter the ID of the Microsoft Teams channel group on which alert details will be sent."
              }
            }
          },
          "variables": {
            "AzurecommunicationservicessmsConnectionName": "[[concat('Azurecommunicationservicessms-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "JiraConnectionName": "[[concat('Jira-', parameters('PlaybookName'))]",
            "OutlookConnectionName": "[[concat('Outlook-', parameters('PlaybookName'))]",
            "Service-NowConnectionName": "[[concat('Service-Now-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('Teams-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azurecommunicationservicessms')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Jira')]",
            "_connection-4": "[[variables('connection-4')]",
            "connection-5": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Outlook')]",
            "_connection-5": "[[variables('connection-5')]",
            "connection-6": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Service-Now')]",
            "_connection-6": "[[variables('connection-6')]",
            "connection-7": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Teams')]",
            "_connection-7": "[[variables('connection-7')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "3rd_Party_Ticket_System": {
                      "type": "string",
                      "defaultValue": "[[parameters('3rd_Party_Ticket_System')]"
                    },
                    "Email": {
                      "type": "string",
                      "defaultValue": "[[parameters('Email')]"
                    },
                    "From_Mobile_No": {
                      "type": "string",
                      "defaultValue": "[[parameters('From_Mobile_No')]"
                    },
                    "Jira_Instance": {
                      "type": "string",
                      "defaultValue": "[[parameters('Jira_Instance')]"
                    },
                    "Jira_Project_Key": {
                      "type": "string",
                      "defaultValue": "[[parameters('Jira_Project_Key')]"
                    },
                    "Teams_Channel_ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Teams_Channel_ID')]"
                    },
                    "Teams_Group_ID": {
                      "type": "string",
                      "defaultValue": "[[parameters('Teams_Group_ID')]"
                    },
                    "To_Mobile_No": {
                      "type": "string",
                      "defaultValue": "[[parameters('To_Mobile_No')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel_1']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@triggerBody()?['object']?['properties']?['Alerts']",
                      "actions": {
                        "IPS_Event_Threshold": {
                          "actions": {
                            "Create_a_Ticket": {
                              "actions": {
                                "Create_a_new_issue_(V3)_2": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "fields": {
                                        "description": "IPS event found in the data:\n@{variables('classification')} : @{variables('classification_count')}",
                                        "summary": "Warning: IPS Event Found"
                                      }
                                    },
                                    "headers": {
                                      "X-Request-Jirainstance": "@parameters('Jira_Instance')"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['jira_2']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v3/issue",
                                    "queries": {
                                      "issueTypeIds": "10001",
                                      "projectKey": "@parameters('Jira_Project_Key')"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Set_html_ips_event_threshold": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Create_Record_2": {
                                    "type": "ApiConnection",
                                    "inputs": {
                                      "body": {
                                        "description": "IPS event found in the data:\n@{variables('classification')} : @{variables('classification_count')}",
                                        "priority": "High"
                                      },
                                      "host": {
                                        "connection": {
                                          "name": "@parameters('$connections')['service-now_1']['connectionId']"
                                        }
                                      },
                                      "method": "post",
                                      "path": "/api/now/v2/table/@{encodeURIComponent('ticket')}",
                                      "queries": {
                                        "sysparm_display_value": false,
                                        "sysparm_exclude_reference_link": true
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@parameters('3rd_Party_Ticket_System')",
                                      "Jira"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Post_message_in_a_chat_or_channel_2": {
                              "runAfter": {
                                "Set_html_ips_event_threshold": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "messageBody": "<p>Hi Team,<br>\n<br>\nIPS event found in the data:<br>\n@{variables('classification')} : @{variables('classification_count')}<br>\n</p>",
                                  "recipient": {
                                    "channelId": "@parameters('Teams_Channel_ID')",
                                    "groupId": "@parameters('Teams_Group_ID')"
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['teams']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/beta/teams/conversation/message/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                              }
                            },
                            "Send_SMS_2": {
                              "runAfter": {
                                "Set_html_ips_event_threshold": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "from": "@parameters('From_Mobile_No')",
                                  "message": "Hi Team,\nIPS event found in the data:\n@{variables('classification')} : @{variables('classification_count')}",
                                  "smsRecipients": [
                                    {
                                      "to": "@parameters('To_Mobile_No')"
                                    }
                                  ],
                                  "smsSendOptions": {
                                    "enableDeliveryReport": false
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azurecommunicationservicessms']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/v2/sms"
                              }
                            },
                            "Send_an_email_(V2)_2": {
                              "runAfter": {
                                "Set_html_ips_event_threshold": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "Body": "<p>Hi Team,<br>\n<br>\nIPS event found in the data:<br>\n@{variables('html')}</p>",
                                  "Importance": "Normal",
                                  "Subject": "Warning: IPS Event Found",
                                  "To": "@parameters('Email')"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['outlook_2']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/v2/Mail"
                              }
                            },
                            "Set_classification": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "classification",
                                "value": "@{body('Parse_JSON')?['classification'][0]}"
                              }
                            },
                            "Set_classification_count": {
                              "runAfter": {
                                "Set_classification": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "classification_count",
                                "value": "@{body('Parse_JSON')?['classification_count'][0]}"
                              }
                            },
                            "Set_html_ips_event_threshold": {
                              "runAfter": {
                                "Set_classification_count": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "html",
                                "value": "<!DOCTYPE html>\n<html>\n\n<head>\n    <title>Black Border Table</title>\n    <style>\n        table {\n            border-collapse: collapse;\n            border-spacing: 0;\n        }\n\n        table th, table td {\n            border: 1px solid black;\n            padding: 10px;\n            font-weight: normal;\n        }\n\n        .heading_table {\n            background-color: lightgrey;\n            font-weight: bold;\n        }\n    </style>\n</head>\n\n<body>\n    <table>\n        <tr class=\"heading_table\">\n            <td class=\"heading_table\">Classification</td>\n            <td class=\"heading_table\">Count</td>\n        </tr>\n<tr><td>@{variables('classification')}</td><td>@{variables('classification_count')}</td></tr>         \n\n    </table>\n</body>\n\n</html>"
                              }
                            },
                            "reset__HTML": {
                              "runAfter": {
                                "Create_a_Ticket": [
                                  "Succeeded"
                                ],
                                "Post_message_in_a_chat_or_channel_2": [
                                  "Succeeded"
                                ],
                                "Send_SMS_2": [
                                  "Succeeded"
                                ],
                                "Send_an_email_(V2)_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "html",
                                "value": "@{null}"
                              }
                            },
                            "reset_classification": {
                              "runAfter": {
                                "reset__HTML": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "classification",
                                "value": "@{null}"
                              }
                            },
                            "reset_classification_count": {
                              "runAfter": {
                                "reset_classification": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "classification_count",
                                "value": "@{null}"
                              }
                            }
                          },
                          "runAfter": {
                            "Monitor_Critical_IP": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@empty(body('Parse_JSON')?['classification'])",
                                  false
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Malware_Events": {
                          "actions": {
                            "Create_Jira_ServiceNow_Ticket": {
                              "actions": {
                                "Create_Jira_Ticket": {
                                  "foreach": "@body('Parse_JSON_data_list')",
                                  "actions": {
                                    "Create_a_new_issue_(V3)_3": {
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "fields": {
                                            "description": "Malware event found in the data: \nMalware : @{items('Create_Jira_Ticket')['malware']}\nSource IP : @{items('Create_Jira_Ticket')['source_ip']}\nUsername : @{items('Create_Jira_Ticket')['username']}",
                                            "summary": "Warning: Malware Event Found"
                                          }
                                        },
                                        "headers": {
                                          "X-Request-Jirainstance": "@parameters('Jira_Instance')"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['jira_2']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/v3/issue",
                                        "queries": {
                                          "issueTypeIds": "10001",
                                          "projectKey": "@parameters('Jira_Project_Key')"
                                        }
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "runAfter": {
                                "For_each_2": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Create_ServiceNow_Record": {
                                    "foreach": "@body('Parse_JSON_data_list')",
                                    "actions": {
                                      "Create_Record_3": {
                                        "type": "ApiConnection",
                                        "inputs": {
                                          "body": {
                                            "description": "Malware event found in the data:\nMalware : @{items('Create_ServiceNow_Record')['malware']}\nSource IP : @{items('Create_ServiceNow_Record')['source_ip']}\nUsername : @{items('Create_ServiceNow_Record')['username']}",
                                            "priority": "High"
                                          },
                                          "host": {
                                            "connection": {
                                              "name": "@parameters('$connections')['service-now_1']['connectionId']"
                                            }
                                          },
                                          "method": "post",
                                          "path": "/api/now/v2/table/@{encodeURIComponent('ticket')}",
                                          "queries": {
                                            "sysparm_display_value": false,
                                            "sysparm_exclude_reference_link": true
                                          }
                                        }
                                      }
                                    },
                                    "type": "Foreach"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@parameters('3rd_Party_Ticket_System')",
                                      "Jira"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "For_each_2": {
                              "foreach": "@body('Parse_JSON_data_list')",
                              "actions": {
                                "set__html": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "html",
                                    "value": "<!DOCTYPE html>\n<html>\n<head>\n    <title>Black Border Table</title>\n    <style>\n        table {\n            border-collapse: collapse;\n            border-spacing: 0;\n        }\n\n       table th, table td {\n            border: 1px solid black;\n            padding: 10px;\n        }\n.heading_table {\n            background-color: lightgrey;\nfont-weight: bold;\n        }\n    </style>\n</head>\n<body>\n    <table>\n        <thead class=\"heading_table\">\n        <td>Malware</td>\n        <td>Source IP</td>\n        <td>Username</td>\n      </thead>\n        <tr>\n        <td>@{items('For_each_2')['malware']}</td>\n        <td>@{items('For_each_2')['source_ip']}</td>\n        <td>@{items('For_each_2')['username']}</td>\n      </tr>\n\n    </table>\n</body>\n</html>"
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_JSON_data_list": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Parse_JSON_data_list": {
                              "runAfter": {
                                "for_each_malware": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@variables('data_list')",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "malware": {
                                        "type": "string"
                                      },
                                      "source_ip": {
                                        "type": "string"
                                      },
                                      "username": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "malware",
                                      "source_ip",
                                      "username"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            },
                            "Post_Message_Into_Microsoft_Teams_Channel": {
                              "foreach": "@body('Parse_JSON_data_list')",
                              "actions": {
                                "Post_message_in_a_chat_or_channel_3": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "messageBody": "<p>Hi Team,<br>\nMalware event found in the data:<br>\n<br>\nMalware Name : @{items('Post_Message_Into_Microsoft_Teams_Channel')['malware']}<br>\nSource IP &nbsp;: @{items('Post_Message_Into_Microsoft_Teams_Channel')['source_ip']}<br>\nUsername : @{items('Post_Message_Into_Microsoft_Teams_Channel')['username']}</p>",
                                      "recipient": {
                                        "channelId": "@parameters('Teams_Channel_ID')",
                                        "groupId": "@parameters('Teams_Group_ID')"
                                      }
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/beta/teams/conversation/message/poster/Flow bot/location/@{encodeURIComponent('Channel')}"
                                  }
                                }
                              },
                              "runAfter": {
                                "For_each_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Send__SMS": {
                              "foreach": "@body('Parse_JSON_data_list')",
                              "actions": {
                                "Send_SMS_3": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "from": "@parameters('From_Mobile_No')",
                                      "message": "Hi Team, Malware Event found in the data:\nMalware : @{items('Send__SMS')['malware']}\nSource IP : @{items('Send__SMS')['source_ip']}\nUsername : @{items('Send__SMS')['username']}",
                                      "smsRecipients": [
                                        {
                                          "to": "@parameters('To_Mobile_No')"
                                        }
                                      ],
                                      "smsSendOptions": {
                                        "enableDeliveryReport": false
                                      }
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azurecommunicationservicessms']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v2/sms"
                                  }
                                }
                              },
                              "runAfter": {
                                "For_each_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Send_an_email_(V2)_3": {
                              "runAfter": {
                                "For_each_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "Body": "<p>Hi Team,<br>\n<br>\nMalware event found in the data:<br>\n@{variables('html')}</p>",
                                  "Subject": "Warning: Malware Event Found",
                                  "To": "@parameters('Email')"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['outlook_2']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/v2/Mail"
                              }
                            },
                            "for_each_malware": {
                              "foreach": "@body('Parse_JSON')?['mal_malware']",
                              "actions": {
                                "Append_to_array_datalist": {
                                  "runAfter": {
                                    "Set_data_object": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "data_list",
                                    "value": "@variables('data_object')"
                                  }
                                },
                                "Set_data_object": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "data_object",
                                    "value": {
                                      "malware": "@{body('Parse_JSON')?['mal_malware'][0]}",
                                      "source_ip": "@{body('Parse_JSON')?['mal_src_ip'][0]}",
                                      "username": "@{body('Parse_JSON')?['mal_username'][0]}"
                                    }
                                  }
                                },
                                "reset_data_object": {
                                  "runAfter": {
                                    "Append_to_array_datalist": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "data_object",
                                    "value": "@null"
                                  }
                                }
                              },
                              "type": "Foreach"
                            },
                            "reset___HTML": {
                              "runAfter": {
                                "Create_Jira_ServiceNow_Ticket": [
                                  "Succeeded"
                                ],
                                "Post_Message_Into_Microsoft_Teams_Channel": [
                                  "Succeeded"
                                ],
                                "Send__SMS": [
                                  "Succeeded"
                                ],
                                "Send_an_email_(V2)_3": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "html",
                                "value": "@{null}"
                              }
                            },
                            "reset_datalist": {
                              "runAfter": {
                                "reset___HTML": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "data_list",
                                "value": "@null"
                              }
                            }
                          },
                          "runAfter": {
                            "IPS_Event_Threshold": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@empty(body('Parse_JSON')?['mal_malware'])",
                                  false
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Monitor_Critical_IP": {
                          "actions": {
                            "Compose_tablerow": {
                              "runAfter": {
                                "Create_HTML_table_criticalip": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": "@join(variables('table_row'),'')"
                            },
                            "Convert_criticalipforticket_list_to_string": {
                              "runAfter": {
                                "For_each_create_critical_ip_list": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "criticalipforticketstring",
                                "value": "@{join(variables('criticalipforticket'),', ')}"
                              }
                            },
                            "Create_HTML_table_criticalip": {
                              "runAfter": {
                                "For_each_create_table_row": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Table",
                              "inputs": {
                                "columns": [
                                  {
                                    "header": "Critical_IP(s)_List",
                                    "value": "@item()"
                                  }
                                ],
                                "format": "HTML",
                                "from": "@variables('criticaliplist')"
                              }
                            },
                            "Create_Ticket": {
                              "actions": {
                                "Create_a_new_issue_(V3)": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "fields": {
                                        "description": "Following are the Critical IP(S) found in the data:\n  @{variables('criticalipforticketstring')}\n",
                                        "summary": "Warning: Critical IP(s) found"
                                      }
                                    },
                                    "headers": {
                                      "X-Request-Jirainstance": "@parameters('Jira_Instance')"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['jira_2']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v3/issue",
                                    "queries": {
                                      "issueTypeIds": "10001",
                                      "projectKey": "@parameters('Jira_Project_Key')"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Set_html": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Create_Record": {
                                    "type": "ApiConnection",
                                    "inputs": {
                                      "body": {
                                        "description": "Following are the Critical IP(S) found in the data:\n@{variables('criticalipforticketstring')}",
                                        "priority": "High"
                                      },
                                      "host": {
                                        "connection": {
                                          "name": "@parameters('$connections')['service-now_1']['connectionId']"
                                        }
                                      },
                                      "method": "post",
                                      "path": "/api/now/v2/table/@{encodeURIComponent('ticket')}",
                                      "queries": {
                                        "sysparm_display_value": true,
                                        "sysparm_exclude_reference_link": true
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@parameters('3rd_Party_Ticket_System')",
                                      "Jira"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "For_each_create_critical_ip_list": {
                              "foreach": "@body('Parse_JSON')?['critical_ip']",
                              "actions": {
                                "Append_to_array_criticalipforticket": {
                                  "runAfter": {
                                    "Append_to_array_criticaliplist": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "criticalipforticket",
                                    "value": "@variables('critical_ip')"
                                  }
                                },
                                "Append_to_array_criticaliplist": {
                                  "runAfter": {
                                    "set_critical_ip": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "criticaliplist",
                                    "value": "@variables('critical_ip')"
                                  }
                                },
                                "set_critical_ip": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "critical_ip",
                                    "value": "@{items('For_each_create_critical_ip_list')}"
                                  }
                                }
                              },
                              "type": "Foreach"
                            },
                            "For_each_create_table_row": {
                              "foreach": "@variables('criticaliplist')",
                              "actions": {
                                "Append_to_array_table_row": {
                                  "runAfter": {
                                    "Compose_table_row": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "table_row",
                                    "value": "@outputs('Compose_table_row')"
                                  }
                                },
                                "Compose_table_row": {
                                  "type": "Compose",
                                  "inputs": "<tr><td>@{item()}</td></tr>"
                                }
                              },
                              "runAfter": {
                                "Convert_criticalipforticket_list_to_string": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Post_message_in_a_chat_or_channel": {
                              "runAfter": {
                                "Set_html": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "messageBody": "<p>Hi Team,<br>\n<br>\nFollowing are the Critical IP(S) found in the data:<br>\n@{body('Create_HTML_table_criticalip')}<br>\n<br>\n</p>",
                                  "recipient": {
                                    "channelId": "@parameters('Teams_Channel_ID')",
                                    "groupId": "@parameters('Teams_Group_ID')"
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['teams']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/beta/teams/conversation/message/poster/@{encodeURIComponent('Flow bot')}/location/@{encodeURIComponent('Channel')}"
                              }
                            },
                            "Send_SMS": {
                              "runAfter": {
                                "Set_html": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "from": "@parameters('From_Mobile_No')",
                                  "message": "Hi Team,\nFollowing are the Critical IP(S) found in the data:\n@{body('Create_HTML_table_criticalip')}",
                                  "smsRecipients": [
                                    {
                                      "to": "@parameters('To_Mobile_No')"
                                    }
                                  ],
                                  "smsSendOptions": {
                                    "enableDeliveryReport": false
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azurecommunicationservicessms']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/v2/sms"
                              }
                            },
                            "Send_an_email_(V2)": {
                              "runAfter": {
                                "Set_html": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "Body": "<p>Hi Team,<br>\n<br>\nFollowing are the Critical IP(S) found in the data:<br>\n@{variables('html')}</p>",
                                  "Importance": "Normal",
                                  "Subject": "Warning: Critical IP(s) found",
                                  "To": "@parameters('Email')"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['outlook_2']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/v2/Mail"
                              }
                            },
                            "Set_html": {
                              "runAfter": {
                                "Compose_tablerow": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "html",
                                "value": "<!DOCTYPE html>\n<html>\n\n<head>\n    <title>Black Border Table</title>\n    <style>\n        table {\n            border-collapse: collapse;\n            border-spacing: 0;\n        }\n\n        table th, table td {\n            border: 1px solid black;\n            padding: 10px;\n            font-weight: normal;\n        }\n\n        .heading_table {\n            background-color: lightgrey;\n            font-weight: bold;\n        }\n    </style>\n</head>\n\n<body>\n    <table>\n        <tr class=\"heading_table\">\n            <td class=\"heading_table\">Critical IP List</td>\n        </tr>\n         @{outputs('Compose_tablerow')}\n    </table>\n</body>\n\n</html>"
                              }
                            },
                            "reset_critical_ip": {
                              "runAfter": {
                                "reset_criticaliplist": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "critical_ip",
                                "value": "@{null}"
                              }
                            },
                            "reset_criticaliplist": {
                              "runAfter": {
                                "reset_table_row": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "criticaliplist",
                                "value": "@null"
                              }
                            },
                            "reset_html": {
                              "runAfter": {
                                "Create_Ticket": [
                                  "Succeeded"
                                ],
                                "Post_message_in_a_chat_or_channel": [
                                  "Succeeded"
                                ],
                                "Send_SMS": [
                                  "Succeeded"
                                ],
                                "Send_an_email_(V2)": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "html",
                                "value": "@{null}"
                              }
                            },
                            "reset_table_row": {
                              "runAfter": {
                                "reset_html": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "table_row",
                                "value": "@null"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@empty(body('Parse_JSON')?['critical_ip'])",
                                  false
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')?['properties']?['additionalData']?['Custom Details']",
                            "schema": {
                              "properties": {
                                "classification": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "classification_count": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "critical_ip": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "criticalipforticket": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "criticaliplist": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "mal_malware": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "mal_src_ip": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                },
                                "mal_username": {
                                  "items": {
                                    "type": "string"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_list_table_row": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_list_criticalipforticket": {
                      "runAfter": {
                        "Initialize_list_criticaliplist": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "criticalipforticket",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_list_criticaliplist": {
                      "runAfter": {
                        "Initialize_variable_criticalip": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "criticaliplist",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_list_datalist": {
                      "runAfter": {
                        "Initialize_object_dataobject": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "data_list",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_list_table_row": {
                      "runAfter": {
                        "Initialize_variable_html": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "table_row",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_object_dataobject": {
                      "runAfter": {
                        "Initialize_variable_classification_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "data_object",
                            "type": "object"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_classification": {
                      "runAfter": {
                        "Initialize_variable_criticalipforticketstring": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "classification",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_classification_count": {
                      "runAfter": {
                        "Initialize_variable_classification": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "classification_count",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_criticalip": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "critical_ip",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_criticalipforticketstring": {
                      "runAfter": {
                        "Initialize_list_criticalipforticket": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "criticalipforticketstring",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_html": {
                      "runAfter": {
                        "Initialize_variable_malware_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "html",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_malware_count": {
                      "runAfter": {
                        "Initialize_list_datalist": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "malware_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azurecommunicationservicessms": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzurecommunicationservicessmsConnectionName'))]",
                        "connectionName": "[[variables('AzurecommunicationservicessmsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azurecommunicationservicessms')]"
                      },
                      "azuresentinel_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "jira_2": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('JiraConnectionName'))]",
                        "connectionName": "[[variables('JiraConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Jira')]"
                      },
                      "outlook_2": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('OutlookConnectionName'))]",
                        "connectionName": "[[variables('OutlookConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Outlook')]"
                      },
                      "service-now_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Service-NowConnectionName'))]",
                        "connectionName": "[[variables('Service-NowConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Service-Now')]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Teams')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "CiscoSDWANLogicAPP4",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzurecommunicationservicessmsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('JiraConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('OutlookConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('Service-NowConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzurecommunicationservicessmsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzurecommunicationservicessmsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('JiraConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('JiraConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-4')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('OutlookConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('OutlookConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-5')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Service-NowConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('Service-NowConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-6')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('TeamsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-7')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ],
          "metadata": {
            "title": "CiscoSDWANLogicAPP",
            "description": "This playbook provides an end-to-end example of sending an email, posting a message to the Microsoft Teams channel, and creating 3rd party ticket for the suspicious activity found in the data.",
            "postDeployment": [
              "**Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Click the AzureCommunicationService connection resource",
              "2. Click edit API connections",
              "3. Click Authorize",
              "4. Provide Required Parameters",
              "5. Click Save",
              "6. Repeat steps for other connections"
            ],
            "lastUpdateTime": "2023-07-03T00:00:00Z",
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "CiscoSDWANReport playbook",
        "displayName": "CiscoSDWANReport playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "CiscoSDWANReport Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "CiscoSDWANReport",
              "type": "string"
            },
            "Azure_Resource_Group": {
              "type": "string",
              "metadata": {
                "description": "Enter the Azure Resource Group name in which you want to deploy the Logic App."
              }
            },
            "Azure_Subscription_ID": {
              "type": "string",
              "metadata": {
                "description": "Enter Azure Subscription ID which is present in the subscription tab in Microsoft Sentinel."
              }
            },
            "Azure_Workspace_Name": {
              "type": "string",
              "metadata": {
                "description": "Enter Microsoft Sentinel Workspace Name of Log Analytics workspace."
              }
            },
            "Email": {
              "type": "string",
              "metadata": {
                "description": "Enter comma-separated email addresses on which reports will be sent."
              }
            }
          },
          "variables": {
            "AzuremonitorlogsConnectionName": "[[concat('Azuremonitorlogs-', parameters('PlaybookName'))]",
            "OutlookConnectionName": "[[concat('Outlook-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuremonitorlogs')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Outlook')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Disabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "ResourceGroup": {
                      "defaultValue": "[[parameters('Azure_Resource_Group')]",
                      "type": "string"
                    },
                    "SubscriptionID": {
                      "defaultValue": "[[parameters('Azure_Subscription_ID')]",
                      "type": "string"
                    },
                    "WorkSpaceName": {
                      "defaultValue": "[[parameters('Azure_Workspace_Name')]",
                      "type": "string"
                    },
                    "Email": {
                      "defaultValue": "[[parameters('Email')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "Chart_for_AMP_Events": {
                      "runAfter": {
                        "Table_for_AMP_Events": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "query": "CiscoSyslogUTD \n| where isnotempty(FileInspectionLogs) and isnotempty(SourceIP)\n| project FileInspectionLogs, SourceIP\n| join kind=inner MapNetflowUsername on SourceIP\n| summarize [\"Count\"] =count() by FileInspectionLogs",
                          "timerange": {
                            "relativeTimeRange": "Last 24 hours"
                          },
                          "timerangetype": "2"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/visualizeQueryV2",
                        "queries": {
                          "resourcegroups": "@variables('ResourceGroup')",
                          "resourcename": "@variables('WorkspaceName')",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@variables('SubscriptionID')",
                          "visType": "Pie Chart"
                        }
                      }
                    },
                    "Chart_for_IPS_Events": {
                      "runAfter": {
                        "Table_for_IPS_Events": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "query": "CiscoSyslogUTD \n| where isnotempty(Classification) and isnotempty(SourceIP)\n| project Classification, SourceIP\n| join kind=inner MapNetflowUsername on SourceIP\n| summarize ['Count']=count() by Classification",
                          "timerange": {
                            "relativeTimeRange": "Last 24 hours"
                          },
                          "timerangetype": "2"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/visualizeQueryV2",
                        "queries": {
                          "resourcegroups": "@variables('ResourceGroup')",
                          "resourcename": "@variables('WorkspaceName')",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@variables('SubscriptionID')",
                          "visType": "Pie Chart"
                        }
                      }
                    },
                    "Initialize_variable_ResourceGroup": {
                      "runAfter": {
                        "Initialize_variable_SubscriptionID": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ResourceGroup",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_SubscriptionID": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "SubscriptionID",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_WorkspaceName": {
                      "runAfter": {
                        "Initialize_variable_ResourceGroup": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "WorkspaceName",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Send_an_email_(V2)": {
                      "runAfter": {
                        "Table_for_Application_Used": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "Attachments": [
                            {
                              "ContentBytes": "@{body('Chart_for_AMP_Events')?['attachmentContent']}",
                              "Name": "@body('Chart_for_AMP_Events')?['attachmentName']"
                            },
                            {
                              "ContentBytes": "@{body('Chart_for_IPS_Events')?['attachmentContent']}",
                              "Name": "@body('Chart_for_IPS_Events')?['attachmentName']"
                            }
                          ],
                          "Body": "<p>Hi team, please find the following reports:<br>\n<br>\nReport of IPS Events by Classification (Last 24 hours)<br>\n@{base64ToString(body('Table_for_IPS_Events')?['attachmentContent'])}<br>\n<br>\nReport of AMP Events by AMP Disposition (Last 24 hours)<br>\n@{base64ToString(body('Table_for_AMP_Events')?['attachmentContent'])}<br>\n<br>\nReport of Internet Browsing done by User (Last 24 hours)<br>\n@{base64ToString(body('Table_for_Internet_Browsing')?['attachmentContent'])}<br>\n<br>\nReport of Application Usage (Last 24 hours)<br>\n@{base64ToString(body('Table_for_Application_Used')?['attachmentContent'])}<br>\n<br>\nSee the attached files for more details</p>",
                          "Importance": "Normal",
                          "Subject": "Reports of Internet Browsing, Threat and Application",
                          "To": "@parameters('Email')"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['outlook_1']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/v2/Mail"
                      }
                    },
                    "Set_variable_ResourceGroup": {
                      "runAfter": {
                        "Set_variable_SubscriptionID": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "ResourceGroup",
                        "value": "@parameters('ResourceGroup')"
                      }
                    },
                    "Set_variable_SubscriptionID": {
                      "runAfter": {
                        "Initialize_variable_WorkspaceName": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "SubscriptionID",
                        "value": "@parameters('SubscriptionID')"
                      }
                    },
                    "Set_variable_WorkspaceName": {
                      "runAfter": {
                        "Set_variable_ResourceGroup": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "WorkspaceName",
                        "value": "@parameters('WorkSpaceName')"
                      }
                    },
                    "Table_for_AMP_Events": {
                      "runAfter": {
                        "Chart_for_IPS_Events": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "query": "CiscoSyslogUTD\n| where isnotempty(FileInspectionLogs) and isnotempty(SourceIP)\n| project FileInspectionLogs, SourceIP\n| join kind=inner MapNetflowUsername on SourceIP\n| summarize [\"Count\"] = count() by [\"AMP_Disposition\"] = FileInspectionLogs,Username\n| sort by Count",
                          "timerange": {
                            "relativeTimeRange": "Last 24 hours"
                          },
                          "timerangetype": "2"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/visualizeQueryV2",
                        "queries": {
                          "resourcegroups": "@variables('ResourceGroup')",
                          "resourcename": "@variables('WorkspaceName')",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@variables('SubscriptionID')",
                          "visType": "Html Table"
                        }
                      }
                    },
                    "Table_for_Application_Used": {
                      "runAfter": {
                        "Table_for_Internet_Browsing": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "query": "CiscoSyslogUTD\n| where isnotempty(Category) and isnotempty(Reputation) and isnotempty(SourceIP)\n| distinct Category, Reputation, SourceIP\n| join kind=inner(\nCiscoSDWANNetflow\n| where isnotempty(NetflowApplicationTag) and isnotempty(NetflowFwSrcAddrIpv4)\n| project [\"SourceIP\"]=NetflowFwSrcAddrIpv4, NetflowApplicationTag\n| join kind=inner(CiscoSDWANNetflow\n| where isnotempty(NetflowApplicationTag) and isnotempty(NetflowApplicationName)\n| distinct NetflowApplicationTag, NetflowApplicationName,TimeGenerated) on NetflowApplicationTag ) on SourceIP\n| project Category, Reputation, NetflowApplicationName, TimeGenerated\n| summarize [\"Count\"]=count(), arg_max(TimeGenerated, *) by [\"Application\"] = NetflowApplicationName\n| project Application, Category, Reputation, Count\n| sort by Count",
                          "timerange": {
                            "relativeTimeRange": "Last 24 hours"
                          },
                          "timerangetype": "2"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/visualizeQueryV2",
                        "queries": {
                          "resourcegroups": "@variables('ResourceGroup')",
                          "resourcename": "@variables('WorkspaceName')",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@variables('SubscriptionID')",
                          "visType": "Html Table"
                        }
                      }
                    },
                    "Table_for_IPS_Events": {
                      "runAfter": {
                        "Set_variable_WorkspaceName": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "query": "CiscoSyslogUTD\n| where isnotempty(Classification) and isnotempty(SourceIP)\n| project Classification, SourceIP\n| join kind=inner MapNetflowUsername on SourceIP\n| summarize [\"Count\"] = count() by [\"Classification\"] = Classification,Username\n| sort by Count",
                          "timerange": {
                            "relativeTimeRange": "Last 24 hours"
                          },
                          "timerangetype": "2"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/visualizeQueryV2",
                        "queries": {
                          "resourcegroups": "@variables('ResourceGroup')",
                          "resourcename": "@variables('WorkspaceName')",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@variables('SubscriptionID')",
                          "visType": "Html Table"
                        }
                      }
                    },
                    "Table_for_Internet_Browsing": {
                      "runAfter": {
                        "Chart_for_AMP_Events": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "query": "CiscoSyslogUTD\n| where isnotempty(Category) and isnotempty(URL) and isnotempty(Reputation) and isnotempty(SourceIP)\n| project Category, URL, Reputation,SourceIP\n| join kind=inner MapNetflowUsername on SourceIP\n| summarize [\"Count\"]=count() by Category, URL, Reputation,SourceIP, Username\n| sort by Count",
                          "timerange": {
                            "relativeTimeRange": "Last 24 hours"
                          },
                          "timerangetype": "2"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/visualizeQueryV2",
                        "queries": {
                          "resourcegroups": "@variables('ResourceGroup')",
                          "resourcename": "@variables('WorkspaceName')",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "@variables('SubscriptionID')",
                          "visType": "Html Table"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzuremonitorlogsConnectionName'))]",
                        "connectionName": "[[variables('AzuremonitorlogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuremonitorlogs')]"
                      },
                      "outlook_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('OutlookConnectionName'))]",
                        "connectionName": "[[variables('OutlookConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Outlook')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "CiscoSDWANReport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzuremonitorlogsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('OutlookConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzuremonitorlogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzuremonitorlogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('OutlookConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('OutlookConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ],
          "metadata": {
            "title": "CiscoSDWANReport",
            "description": "This playbook provides an end-to-end example of sending an email for suspicious activity found in the data.",
            "postDeployment": [
              "**Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Click the Azuremonitorlogs connection resource",
              "2. Click edit API connections",
              "3. Click Authorize",
              "4. Sign in",
              "5. Click Save",
              "6. Repeat steps for other connections"
            ],
            "lastUpdateTime": "2023-07-03T00:00:00Z",
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "Cisco SD-WAN Workbook with template",
        "displayName": "Cisco SD-WAN workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CiscoSDWANWorkbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": ""
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"36eea26a-45af-4622-b95f-d7342cb71417\",\"cellValue\":\"setTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"SOC Overview\",\"subTarget\":\"SOC Overview\",\"style\":\"link\"},{\"id\":\"9684bccd-cbc3-4e97-9779-73a282bd2dd3\",\"cellValue\":\"setTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Threat Inspection\",\"subTarget\":\"Threat Inspection\",\"style\":\"link\"},{\"id\":\"ab231130-8792-4feb-850d-7f9d418c1c90\",\"cellValue\":\"setTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Flow Analysis\",\"subTarget\":\"Flow Analysis\",\"style\":\"link\"}]},\"name\":\"links - 1\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# SOC Overview\\r\\n\\r\\nIt is designed to provide insight into the security operations center (SOC) based on key metrics, workflows, and dispositions so that you can monitor the efficiency of the SOC and ensure that all security operations (detections, analysis, and responses) are on track.\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"7d22e45d-e280-44d6-b766-13111e69d885\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_range\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"98b9186b-1d73-453c-a4f3-bff6c1dc0d78\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"source_router\",\"label\":\"Source Router\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| union CiscoSDWANNetflow\\r\\n| where isnotempty(Host) or isnotempty(NetflowHostname)\\r\\n| extend hosts = coalesce(Host, NetflowHostname)\\r\\n| distinct hosts\\r\\n| sort by hosts asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":1,\"content\":{\"json\":\"💡 Click on the data points in the each of the below panels to view more details.\\r\\n\\r\\n\"},\"name\":\"text - 39\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| summarize count() by Threat\\r\\n| sort by count_\\r\\n| limit 10\",\"size\":3,\"showAnalytics\":true,\"title\":\"Top 10 Threats\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"threat\",\"exportDefaultValue\":\"None\",\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"yAxis\":[\"count_\"],\"group\":\"Threat\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 0\",\"styleSettings\":{\"padding\":\"0px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| summarize count() by System_IP\\r\\n| sort by count_\\r\\n| limit 10\",\"size\":3,\"showAnalytics\":true,\"title\":\"Top 10 Devices by Threat\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"device\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"System_IP\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 1\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Threat Details for \\\"{threat}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"threat\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 20\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"7660c654-705e-4fd4-826a-92236babaf2c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| where Threat == '{threat}'\\r\\n| distinct System_IP\\r\\n| order by System_IP asc\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"7760355d-a483-4a19-b4de-19bf94d6d4b6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| where Threat == '{threat}'\\r\\n| distinct Hostname\\r\\n| order by Hostname asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"c37acb94-48b9-4590-b910-ccb4941c1326\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| where Threat == '{threat}'\\r\\n| distinct Action\\r\\n| order by Action asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"7543b97f-3c7f-4d79-ac0f-8484b21184ef\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"defaultValue\":\"\",\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"d134d35a-2b1a-4506-8326-83d666dcda08\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"defaultValue\":\"\",\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"df13f5d5-3a86-479e-b292-859f56e6711b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"defaultValue\":\"*\",\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"04ec7cbb-538e-406f-affc-715cc1e6ab63\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"defaultValue\":\"*\",\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"threat\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| where Threat == '{threat}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and (   '*' == '{src_ip}' or SourceIP contains '{src_ip}' )\\r\\n    and (  '*' == '{src_port}' or SourcePort contains '{src_port}' )\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| order by TimeGenerated desc\\r\\n| project\\r\\n    [\\\"TimeStamp\\\"] = TimeGenerated,\\r\\n    [\\\"Device IP\\\"] = System_IP,\\r\\n    [\\\"Device Name\\\"] = Hostname,\\r\\n    Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"] = DestinationIP,\\r\\n    [\\\"Destination Port\\\"] = DestinationPort,\\r\\n    SyslogMessage\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"threat\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Device Details for \\\"{device}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"device\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 21\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"a25f2503-9ed8-4f63-a31e-1684dfcb3b0f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"threat_name\",\"label\":\"Threat\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n| where System_IP == '{device}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| distinct Threat\\r\\n| order by Threat asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"fdf218c8-8484-4683-864f-a28801ea276a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n    and ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and System_IP == '{device}'\\r\\n| distinct Hostname\\r\\n| order by Hostname asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"22ec09ea-f56b-44d3-acc5-b7ef5587c475\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| where System_IP == '{device}'\\r\\n| distinct Action\\r\\n| order by Action\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"5dea320c-5261-4e7b-80dc-cd0931fc11cc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"df97cf92-3031-4c6b-b562-f37e56eb25bc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"78f708ab-1198-42ce-8f58-c096e4dd4b93\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"6d1861dc-9628-486c-8fb2-0f7e0ebd6c40\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"device\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| where (isnotempty(Classification) or (isnotempty(Malware) and Malware != \\\"None\\\"))\\r\\n| where '*' == '{source_router}' or Host == '{source_router}'\\r\\n| extend Threat = coalesce(Classification, Malware)\\r\\n| where ('*' == '{threat_name}' or Threat == '{threat_name}')\\r\\n    and System_IP == '{device}'\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and (   '*' == '{src_ip}' or SourceIP contains '{src_ip}' )\\r\\n    and (  '*' == '{src_port}' or SourcePort contains '{src_port}' )\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| order by TimeGenerated desc\\r\\n| project\\r\\n    [\\\"TimeStamp\\\"] = TimeGenerated,\\r\\n    Threat,\\r\\n    [\\\"Device Name\\\"] = Hostname,\\r\\n    Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"] = DestinationIP,\\r\\n    [\\\"Destination Port\\\"] = DestinationPort,\\r\\n    SyslogMessage\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"device\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 5\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range}\\r\\n| where ('*' == '{source_router}' or NetflowHostname == '{source_router}')\\r\\n    and isnotempty(NetflowElement_9_2239)\\r\\n    and isnotempty(NetflowApplicationTag)\\r\\n| summarize count() by NetflowApplicationTag\\r\\n| top 10 by count_\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowApplicationName) and isnotempty(NetflowApplicationTag)\\r\\n    | distinct NetflowApplicationName, NetflowApplicationTag)\\r\\n    on NetflowApplicationTag\\r\\n| top 10 by count_\\r\\n| project Application = NetflowApplicationName, NetflowApplicationTag, Count = count_\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Applications\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"NetflowApplicationTag\",\"parameterName\":\"app_tag\",\"defaultValue\":\"None\"},{\"fieldName\":\"Application\",\"parameterName\":\"app_name\",\"parameterType\":1,\"defaultValue\":\"None\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Application\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"15%\"}},{\"columnMatch\":\"NetflowApplicationTag\",\"formatter\":5},{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"10%\"}}],\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"50\",\"name\":\"query - 19\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range}\\r\\n| where ('*' == '{source_router}' or NetflowHostname == '{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239)\\r\\n    and NetflowFwPolicy != 0\\r\\n    and isnotempty(NetflowFwAction)\\r\\n| summarize count() by NetflowFwPolicy\\r\\n| top 10 by count_\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule)\\r\\n        and isnotempty(NetflowFwPolicy)\\r\\n        and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    on NetflowFwPolicy\\r\\n| top 10 by count_\\r\\n| project NetflowFwPolicyRule, count_\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top 10 Policy Hits\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"policy_details\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"xAxis\":\"NetflowFwPolicyRule\",\"yAxis\":[\"count_\"],\"group\":\"NetflowFwPolicyRule\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 20\",\"styleSettings\":{\"padding\":\"20px\",\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Application Details for \\\"{app_name}\\\"\"},\"conditionalVisibilities\":[{\"parameterName\":\"app_name\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"app_tag\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"text - 22\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"a5c14b91-9e0e-48a6-af81-a3e8595585d4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowFwSrcAddrIpv4_p\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"eec963a4-d364-41e8-a103-5a0dd5a804f3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowFwSrcPort_p\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"1f584365-0ef1-4769-b448-84d049935e8f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowFwDestAddrIpv4_p\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"ea948941-aea1-4876-9fff-21d345e6c7ec\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowFwDestPort_p\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"69f5b4c1-c488-4061-b4bb-08f36f42506b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowInputSNMPIDX_p\",\"label\":\"Input Snmpidx\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"3974d9e8-3560-458b-8a01-6374dfe35419\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowOutputSNMPIDX_p\",\"label\":\"Output Snmpidx\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"88ad3e98-c1d3-4b54-83d9-165afa085cd3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowUsername_p\",\"label\":\"Username\",\"type\":1,\"value\":\"*\"},{\"id\":\"0612bf6b-4dbc-4d2f-a4d9-dd52447c917e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowIngressVRFID_p\",\"label\":\"Ingress VRF ID\",\"type\":1,\"value\":\"*\"},{\"id\":\"ede46daa-ed41-418d-9858-ea587409d96a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowEgressVRFID_p\",\"label\":\"Egress VRF ID\",\"type\":1,\"value\":\"*\"},{\"id\":\"409fada2-b6d0-418b-99e7-69f8007b7d24\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetflowFlowFieldSGT_p\",\"label\":\"Source SGT\",\"type\":1,\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibilities\":[{\"parameterName\":\"app_name\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"app_tag\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"parameters - 21\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range}\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n    and isnotempty(NetflowElement_9_2239)\\r\\n    and NetflowApplicationTag == '{app_tag}'\\r\\n    and ('*' == '{NetflowFwSrcAddrIpv4_p}' or tostring(NetflowFwSrcAddrIpv4) contains '{NetflowFwSrcAddrIpv4_p}')\\r\\n    and ('*' == '{NetflowFwSrcPort_p}' or tostring(NetflowFwSrcPort) contains '{NetflowFwSrcPort_p}')\\r\\n    and ('*' == '{NetflowFwDestAddrIpv4_p}' or tostring(NetflowFwDestAddrIpv4) contains '{NetflowFwDestAddrIpv4_p}')\\r\\n    and ('*' == '{NetflowFwDestPort_p}' or tostring(NetflowFwDestPort) contains '{NetflowFwDestPort_p}')\\r\\n    and ('*' == '{NetflowInputSNMPIDX_p}' or tostring(NetflowInputSNMPIDX) contains '{NetflowInputSNMPIDX_p}')\\r\\n    and ('*' == '{NetflowOutputSNMPIDX_p}' or tostring(NetflowOutputSNMPIDX) contains '{NetflowOutputSNMPIDX_p}')\\r\\n    and ('*' == '{NetflowUsername_p}' or tostring(NetflowUsername) contains '{NetflowUsername_p}')\\r\\n    and ('*' == '{NetflowIngressVRFID_p}' or tostring(NetflowIngressVRFID) contains '{NetflowIngressVRFID_p}')\\r\\n    and ('*' == '{NetflowEgressVRFID_p}' or tostring(NetflowEgressVRFID) contains '{NetflowEgressVRFID_p}')\\r\\n    and ('*' == '{NetflowFlowFieldSGT_p}' or tostring(NetflowFlowFieldSGT) contains '{NetflowFlowFieldSGT_p}')\\r\\n| distinct\\r\\n    TimeStamp,\\r\\n    NetflowFwSrcAddrIpv4,\\r\\n    NetflowFwSrcPort,\\r\\n    NetflowFwDestAddrIpv4,\\r\\n    NetflowFwDestPort,\\r\\n    NetflowInputSNMPIDX,\\r\\n    NetflowOutputSNMPIDX,\\r\\n    NetflowApplicationTag,\\r\\n    NetflowUsername,\\r\\n    NetflowIngressVRFID,\\r\\n    NetflowEgressVRFID,\\r\\n    NetflowFlowFieldSGT\\r\\n| project\\r\\n    TimeStamp,\\r\\n    [\\\"Source IP\\\"]= NetflowFwSrcAddrIpv4,\\r\\n    [\\\"Source Port\\\"]=NetflowFwSrcPort,\\r\\n    [\\\"Destination IP\\\"]=NetflowFwDestAddrIpv4,\\r\\n    [\\\"Destination Port\\\"]=NetflowFwDestPort,\\r\\n    [\\\"Input Snmpidx\\\"]=NetflowInputSNMPIDX,\\r\\n    [\\\"Output Snmpidx\\\"]=NetflowOutputSNMPIDX,\\r\\n    [\\\"Username\\\"] = NetflowUsername,\\r\\n    [\\\"Ingress VRF ID\\\"] = NetflowIngressVRFID,\\r\\n    [\\\"Egress VRF ID\\\"] = NetflowEgressVRFID,\\r\\n    [\\\"Source SGT\\\"] = NetflowFlowFieldSGT\\r\\n| order by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"app_tag\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 22\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Policy Details for \\\"{policy_details}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"policy_details\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 23\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"ffb686f7-2537-4535-924f-e2200dda8af7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"let policy_name = toscalar((CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule) and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    | where NetflowFwPolicyRule == '{policy_details}'\\r\\n    | distinct NetflowFwPolicy);\\r\\nCiscoSDWANNetflow\\r\\n| where TimeStamp {time_range}\\r\\n| where ('*' == '{source_router}' or NetflowHostname == '{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239)\\r\\n    and NetflowFwPolicy != 0\\r\\n    and isnotempty(NetflowFwAction)\\r\\n    and NetflowFwPolicy == policy_name\\r\\n| distinct NetflowFwAction\\r\\n| join (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwActionRule)\\r\\n    | distinct NetflowFwAction, NetflowFwActionRule)\\r\\n    on NetflowFwAction\\r\\n| project NetflowFwActionRule\\r\\n| order by NetflowFwActionRule asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"d45b6d9c-15dd-4740-ae8f-d415c932112b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"0620b5fa-6a8e-4744-8c1e-dfde992bf95c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"92fc8d32-a3af-4310-a798-4b0b13a95720\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"ecad6e3c-2c81-4262-90ee-6c2fa62ed0c7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"99c11d5a-ed6a-43ae-a890-f7b8037eae6d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_input_snmpidx\",\"label\":\"Input Snmpidx\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"331add36-d4a0-4ac8-b65c-38c033e1ec64\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_output_snmpidx\",\"label\":\"Output Snmpidx\",\"type\":1,\"timeContext\":{\"durationMs\":86400000},\"value\":\"*\"},{\"id\":\"74596419-b891-45b1-8552-82a7aea6e390\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_username\",\"label\":\"Username\",\"type\":1,\"value\":\"*\"},{\"id\":\"0b8ff954-4af9-46ba-9fdc-ee21459d545f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_ingress_vrfid\",\"label\":\"Ingress VRF ID\",\"type\":1,\"value\":\"*\"},{\"id\":\"f998035e-1efd-47b5-9b57-00d84800671c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_egress_vrfid\",\"label\":\"Egress VRF ID\",\"type\":1,\"value\":\"*\"},{\"id\":\"8c2965bc-5a8d-4094-ac1f-6b59458655da\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"policy_source_sgt\",\"label\":\"Source SGT\",\"type\":1,\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"policy_details\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 21 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let policy_name = toscalar((CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule) and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    | where NetflowFwPolicyRule == '{policy_details}'\\r\\n    | project NetflowFwPolicy);\\r\\nCiscoSDWANNetflow\\r\\n| where TimeStamp\\r\\n{time_range}\\r\\n| where ('*' == '{source_router}' or NetflowHostname == '{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239)\\r\\n    and NetflowFwPolicy != 0\\r\\n    and isnotempty(NetflowFwAction)\\r\\n| where NetflowFwPolicy == policy_name\\r\\n    and ('*' == '{policy_src_ip}' or tostring(NetflowFwSrcAddrIpv4) contains '{policy_src_ip}')\\r\\n    and ('*' == '{policy_src_port}' or tostring(NetflowFwSrcPort) contains '{policy_src_port}')\\r\\n    and ('*' == '{policy_dest_ip}' or tostring(NetflowFwDestAddrIpv4) contains '{policy_dest_ip}')\\r\\n    and ('*' == '{policy_dest_port}' or tostring(NetflowFwDestPort) contains '{policy_dest_port}')\\r\\n    and ('*' == '{policy_input_snmpidx}' or tostring(NetflowInputSNMPIDX) contains '{policy_input_snmpidx}')\\r\\n    and ('*' == '{policy_output_snmpidx}' or tostring(NetflowOutputSNMPIDX) contains '{policy_output_snmpidx}')\\r\\n    and ('*' == '{policy_username}' or tostring(NetflowUsername) contains '{policy_username}')\\r\\n    and ('*' == '{policy_ingress_vrfid}' or tostring(NetflowIngressVRFID) contains '{policy_ingress_vrfid}')\\r\\n    and ('*' == '{policy_egress_vrfid}' or tostring(NetflowEgressVRFID) contains '{policy_egress_vrfid}')\\r\\n    and ('*' == '{policy_source_sgt}' or tostring(NetflowFlowFieldSGT) contains '{policy_source_sgt}')\\r\\n| distinct\\r\\n    TimeStamp,\\r\\n    NetflowFwSrcAddrIpv4,\\r\\n    NetflowFwSrcPort,\\r\\n    NetflowFwDestAddrIpv4,\\r\\n    NetflowFwDestPort,\\r\\n    NetflowInputSNMPIDX,\\r\\n    NetflowOutputSNMPIDX,\\r\\n    NetflowFwAction, \\r\\n    NetflowFwPolicy,\\r\\n    NetflowUsername,\\r\\n    NetflowIngressVRFID,\\r\\n    NetflowEgressVRFID,\\r\\n    NetflowFlowFieldSGT\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwActionRule)\\r\\n    | distinct NetflowFwAction, NetflowFwActionRule)\\r\\n    on NetflowFwAction\\r\\n| where ('*' == '{policy_action}' or tostring(NetflowFwActionRule) == '{policy_action}')\\r\\n| project\\r\\n    TimeStamp,\\r\\n    Action = NetflowFwActionRule,\\r\\n    [\\\"Source IP\\\"]= NetflowFwSrcAddrIpv4,\\r\\n    [\\\"Source Port\\\"]=NetflowFwSrcPort,\\r\\n    [\\\"Destination IP\\\"]=NetflowFwDestAddrIpv4,\\r\\n    [\\\"Destination Port\\\"]=NetflowFwDestPort,\\r\\n    [\\\"Input Snmpidx\\\"]=NetflowInputSNMPIDX,\\r\\n    [\\\"Output Snmpidx\\\"]=NetflowOutputSNMPIDX,\\r\\n    [\\\"Username\\\"] = NetflowUsername,\\r\\n    [\\\"Ingress VRF ID\\\"] = NetflowIngressVRFID,\\r\\n    [\\\"Egress VRF ID\\\"] = NetflowEgressVRFID,\\r\\n    [\\\"Source SGT\\\"] = NetflowFlowFieldSGT\\r\\n| order by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"policy_details\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 27\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range} and NetflowFirewallEvent == 3 and (('*' == '{source_router}' or NetflowHostname == '{source_router}'))\\r\\n| summarize count() by NetflowFwSrcAddrIpv4, NetflowFwDestAddrIpv4, NetflowFwPolicy\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule)\\r\\n        and isnotempty(NetflowFwPolicy)\\r\\n        and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    on NetflowFwPolicy\\r\\n| project\\r\\n    [\\\"Source IP\\\"] = NetflowFwSrcAddrIpv4,\\r\\n    [\\\"Destination IP\\\"] = NetflowFwDestAddrIpv4,\\r\\n    [\\\"Policy Rule\\\"] = NetflowFwPolicyRule,\\r\\n    [\\\"Flow Class Name\\\"] = NetflowFwPolicy,\\r\\n    Count = count_\\r\\n| order by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Dropped ZBFW Flows\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"Source IP\",\"parameterName\":\"source_ip\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Destination IP\",\"parameterName\":\"destination_ip\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Flow Class Name\",\"parameterName\":\"fw_policy\",\"parameterType\":1,\"defaultValue\":\"None\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 17\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range} and ( ('*' == '{source_router}' or NetflowHostname == '{source_router}'))\\r\\n| where NetflowFwSrcAddrIpv4 == '{source_ip}'\\r\\n    and NetflowFwDestAddrIpv4 == '{destination_ip}'\\r\\n    and NetflowFwPolicy == '{fw_policy}'\\r\\n    and NetflowFirewallEvent == 3\\r\\n| extend TimeStamp = bin(TimeStamp, 1ms)\\r\\n| distinct\\r\\n    TimeStamp,\\r\\n    NetflowFwSrcAddrIpv4,\\r\\n    NetflowFwDestAddrIpv4,\\r\\n    NetflowFwSrcPort,\\r\\n    NetflowFwDestPort,\\r\\n    NetflowApplicationTag,\\r\\n    NetflowUsername,\\r\\n    NetflowIngressVRFID,\\r\\n    NetflowEgressVRFID,\\r\\n    NetflowFlowFieldSGT,\\r\\n    NetflowFwPolicy\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowApplicationTag)\\r\\n    | distinct NetflowApplicationName, NetflowApplicationTag)\\r\\n    on NetflowApplicationTag\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule)\\r\\n        and isnotempty(NetflowFwPolicy)\\r\\n        and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    on NetflowFwPolicy\\r\\n| project\\r\\n    TimeStamp,\\r\\n    [\\\"Source IP\\\"] = NetflowFwSrcAddrIpv4,\\r\\n    [\\\"Destination IP\\\"] = NetflowFwDestAddrIpv4,\\r\\n    [\\\"Source Port\\\"] = NetflowFwSrcPort,\\r\\n    [\\\"Destination Port\\\"]=NetflowFwDestPort,\\r\\n    Application = NetflowApplicationName,\\r\\n    [\\\"Username\\\"] = NetflowUsername,\\r\\n    [\\\"Ingress VRF ID\\\"] = NetflowIngressVRFID,\\r\\n    [\\\"Egress VRF ID\\\"] = NetflowEgressVRFID,\\r\\n    [\\\"Source SGT\\\"] = NetflowFlowFieldSGT,\\r\\n    [\\\"Policy Rule\\\"] = NetflowFwPolicyRule,\\r\\n    [\\\"Flow Class Name\\\"] = NetflowFwPolicy\\r\\n| order by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"title\":\"Dropped Flow Details Between \\\"{source_ip}\\\" and \\\"{destination_ip}\\\"\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"NetflowFwPolicy\",\"formatter\":5},{\"columnMatch\":\"NetflowFwPolicy1\",\"formatter\":5}],\"rowLimit\":10000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"TimeStamp\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeStamp\",\"sortOrder\":2}]},\"conditionalVisibility\":{\"parameterName\":\"source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 24\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"50\",\"name\":\"group - 31\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range} and NetflowFirewallEvent in (1, 2) and ( ('*' == '{source_router}' or NetflowHostname == '{source_router}') )\\r\\n| summarize count() by NetflowFwSrcAddrIpv4, NetflowFwDestAddrIpv4, NetflowFwPolicy\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule)\\r\\n        and isnotempty(NetflowFwPolicy)\\r\\n        and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    on NetflowFwPolicy\\r\\n| project\\r\\n    [\\\"Source IP\\\"] = NetflowFwSrcAddrIpv4,\\r\\n    [\\\"Destination IP\\\"] = NetflowFwDestAddrIpv4,\\r\\n    [\\\"Policy Rule\\\"] = NetflowFwPolicyRule,\\r\\n    [\\\"Flow Class Name\\\"] = NetflowFwPolicy,\\r\\n    Count = count_\\r\\n| order by Count\",\"size\":0,\"showAnalytics\":true,\"title\":\"Inspected ZBFW Flows\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"Source IP\",\"parameterName\":\"source_ip2\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Destination IP\",\"parameterName\":\"destination_ip2\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Flow Class Name\",\"parameterName\":\"fw_policy2\",\"parameterType\":1,\"defaultValue\":\"None\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 18\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range} and (('*' == '{source_router}' or NetflowHostname == '{source_router}'))\\r\\n| where NetflowFwSrcAddrIpv4 == '{source_ip2}'\\r\\n    and NetflowFwDestAddrIpv4 == '{destination_ip2}'\\r\\n    and NetflowFirewallEvent in (1, 2)\\r\\n| extend TimeStamp = bin(TimeStamp, 1ms)\\r\\n| distinct\\r\\n    TimeStamp,\\r\\n    NetflowFwSrcAddrIpv4,\\r\\n    NetflowFwDestAddrIpv4,\\r\\n    NetflowFwSrcPort,\\r\\n    NetflowFwDestPort,\\r\\n    NetflowApplicationTag,\\r\\n    NetflowUsername,\\r\\n    NetflowIngressVRFID,\\r\\n    NetflowEgressVRFID,\\r\\n    NetflowFlowFieldSGT,\\r\\n    NetflowFwPolicy\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowApplicationTag)\\r\\n    | distinct NetflowApplicationName, NetflowApplicationTag)\\r\\n    on NetflowApplicationTag\\r\\n| join kind=leftouter (CiscoSDWANNetflow\\r\\n    | where isnotempty(NetflowFwPolicyRule)\\r\\n        and isnotempty(NetflowFwPolicy)\\r\\n        and NetflowFwPolicy != 0\\r\\n    | distinct NetflowFwPolicy, NetflowFwPolicyRule)\\r\\n    on NetflowFwPolicy\\r\\n| project\\r\\n    TimeStamp,\\r\\n    [\\\"Source IP\\\"] = NetflowFwSrcAddrIpv4,\\r\\n    [\\\"Destination IP\\\"] = NetflowFwDestAddrIpv4,\\r\\n    [\\\"Source Port\\\"] = NetflowFwSrcPort,\\r\\n    [\\\"Destination Port\\\"]=NetflowFwDestPort,\\r\\n    Application = NetflowApplicationName,\\r\\n    [\\\"Username\\\"] = NetflowUsername,\\r\\n    [\\\"Ingress VRF ID\\\"] = NetflowIngressVRFID,\\r\\n    [\\\"Egress VRF ID\\\"] = NetflowEgressVRFID,\\r\\n    [\\\"Source SGT\\\"] = NetflowFlowFieldSGT,\\r\\n    [\\\"Policy Rule\\\"] = NetflowFwPolicyRule,\\r\\n    [\\\"Flow Class Name\\\"] = NetflowFwPolicy\\r\\n| order by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"title\":\"Inspected Flow Details Between \\\"{source_ip2}\\\" and \\\"{destination_ip2}\\\"\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"TimeStamp\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeStamp\",\"sortOrder\":2}]},\"conditionalVisibilities\":[{\"parameterName\":\"source_ip2\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"fw_policy2\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"destination_ip2\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"query - 24 - Copy\",\"styleSettings\":{\"showBorder\":true}}]},\"customWidth\":\"50\",\"name\":\"group - 30\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range}\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowUsername)\\r\\n| summarize arg_max(TimeStamp, NetflowFwSrcAddrIpv4) by NetflowUsername\\r\\n| order by NetflowUsername asc\\r\\n| project\\r\\n    [\\\"Username\\\"] = NetflowUsername,\\r\\n    [\\\"Source IP\\\"] = NetflowFwSrcAddrIpv4\",\"size\":0,\"showAnalytics\":true,\"title\":\"Network Users\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"Username\",\"parameterName\":\"network_username\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Source IP\",\"parameterName\":\"network_source_ip\",\"parameterType\":1,\"defaultValue\":\"None\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Username\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"10%\"}},{\"columnMatch\":\"Source IP\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"10%\"}}],\"rowLimit\":10000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"Username\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Username\",\"sortOrder\":1}]},\"name\":\"query - 22\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where TimeStamp {time_range}\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where NetflowUsername=='{network_username}' and NetflowFwSrcAddrIpv4=='{network_source_ip}'\\r\\n| order by TimeStamp\\r\\n| project-away Agent*, _ResourceId, _SubscriptionId, ECSVersion, Host*, RawData\",\"size\":0,\"showAnalytics\":true,\"title\":\"Netflow Events (Network Users: {network_username} (Username) and {network_source_ip} (Source IP))\",\"noDataMessage\":\"No data was found in the selected time range.\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"network_username\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"network_source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"query - 23\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"📝 Refresh the web page to fetch details of recently collected events.\"},\"name\":\"text - 30\"}]},\"conditionalVisibility\":{\"parameterName\":\"setTab\",\"comparison\":\"isEqualTo\",\"value\":\"SOC Overview\"},\"name\":\"group - 3\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Threat Inspection\\r\\n\\r\\nProvide tactical guidance and insights to detect, investigate and respond to the latest threats.\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"737a8536-a564-4489-afbd-a7c299a57ced\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_range\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"cca7c133-e440-46d9-991f-48b08cf72c17\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"source_router\",\"label\":\"Source Router\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where isnotempty(Host) | distinct Host | order by Host asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"💡 Click on the data points in the each of the below panels to view more details.\\r\\n\\r\\n\"},\"name\":\"text - 39\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD   | where ('*' == '{source_router}' or Host =='{source_router}')  and isnotempty(Classification) | summarize count() by Classification\",\"size\":3,\"showAnalytics\":true,\"title\":\"Blocked Connections Over IPS event\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"malicious_file\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"Classification\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 2\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD  | where ('*' == '{source_router}' or Host =='{source_router}') and (isnotempty(Malware) and Malware!=\\\"None\\\") | summarize count() by Malware\",\"size\":3,\"showAnalytics\":true,\"title\":\"Malicious Files by Malware\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"malware\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"Malware\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Classification details for \\\"{malicious_file}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"malicious_file\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 5\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"7660c654-705e-4fd4-826a-92236babaf2c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Classification == '{malicious_file}' | distinct System_IP | order by System_IP asc\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"7760355d-a483-4a19-b4de-19bf94d6d4b6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Malware == '{malicious_file}'  | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"c37acb94-48b9-4590-b910-ccb4941c1326\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Malware == '{malicious_file}'  | distinct Action | order by Action asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"7543b97f-3c7f-4d79-ac0f-8484b21184ef\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\",\"id\":\"2dd32f3a-5f9e-407e-a8ff-72f813f14b13\"},{\"id\":\"d134d35a-2b1a-4506-8326-83d666dcda08\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"df13f5d5-3a86-479e-b292-859f56e6711b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"04ec7cbb-538e-406f-affc-715cc1e6ab63\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"malicious_file\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and isnotempty(Classification)\\r\\n    and Classification == '{malicious_file}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    Classification,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Username\\\"] = Username,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, Classification\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"malicious_file\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Malware details for \\\"{malware}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"malware\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 5 - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f3e76ea5-ce9d-4e40-af70-59768e4a5a95\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Malware == '{malware}' | distinct System_IP | order by System_IP asc \\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"2cfb22f3-dffb-45e6-9332-82c30c9a912b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Malware == '{malware}' | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"d9aedaa7-0c62-479b-a139-dab52c19f8cc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Malware == '{malware}' | distinct Action | order by Action asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"73b536df-36d4-4bc0-85fd-1c7f929f60b7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\",\"id\":\"d193cabd-8fe0-4604-b8ce-85b5c349748c\"},{\"id\":\"fc94f3b9-99de-4cc5-87a3-5e8eeae10a0e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"6e0e26d3-a3fe-4356-91d3-64dc99248095\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"8adf631e-66e7-42ff-b13e-ea879c28b3d6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"malware\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and (isnotempty(Malware) and Malware != \\\"None\\\")\\r\\n    and Malware == '{malware}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    Malware,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Username\\\"] = Username,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, Malware\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"malware\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD  | where ('*' == '{source_router}' or Host =='{source_router}') and Malware!=\\\"None\\\" and isnotempty(Filetype) | summarize count() by Filetype\",\"size\":3,\"showAnalytics\":true,\"title\":\"Malicious Files by Type\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"file_type\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"Filetype\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 3 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD  | where ('*' == '{source_router}' or Host =='{source_router}') and isnotempty(FileInspectionLogs) | summarize count() by FileInspectionLogs\",\"size\":3,\"showAnalytics\":true,\"title\":\"File Scan Results by Disposition\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"disposition\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"FileInspectionLogs\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 3 - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Filetype details for \\\"{file_type}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"file_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 5 - Copy - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9057f621-352d-472f-86f3-e554315cd704\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Filetype == '{file_type}' | distinct System_IP | order by System_IP asc \\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"17c9d41d-72d2-4f6e-aa29-6c4d5190927e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Filetype == '{file_type}' | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"595ca5f5-022e-4553-b06f-9591d81c8e05\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and Filetype == '{file_type}' | distinct Action | order by Action asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"11514103-b05f-4de1-bc05-ba007b253aa6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"73b536df-36d4-4bc0-85fd-1c7f929f60b7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"891b25ac-1227-407f-a5ed-3a9ab2868e97\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"ebec113c-c650-47de-8414-f8fa4321a57b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"58f0eaa7-c41d-4842-924a-060ac2a3a37e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"file_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and Malware != \\\"None\\\"\\r\\n    and isnotempty(Filetype)\\r\\n    and Filetype == '{file_type}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    Filetype,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Username\\\"] = Username,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, Filetype\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"file_type\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3 - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### UTD Amp Disposition details for \\\"{disposition}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"disposition\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 5 - Copy - Copy - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f9db287c-d5e5-4884-8073-0bf92effb28b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and FileInspectionLogs == '{disposition}' | distinct System_IP | order by System_IP asc \\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"66524b51-4ac6-461e-bc00-a8bcd3a0573a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and FileInspectionLogs == '{disposition}' | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"ecb113b5-fc7e-4cc9-85db-12f43db01d88\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where '*' == '{source_router}' or Host =='{source_router}' and FileInspectionLogs == '{disposition}' | distinct Action | order by Action asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"4be369b6-0da3-4284-91af-5cdfe2f3ebfa\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"73b536df-36d4-4bc0-85fd-1c7f929f60b7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"0551b3e7-3746-4e6a-a98b-e60f22c811f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"2afadb3f-51d1-4f6f-8ace-ee04c5f5d153\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"84d38235-1b15-4867-979f-1ddf1565f1fc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"disposition\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2 - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and isnotempty(FileInspectionLogs)\\r\\n    and FileInspectionLogs == '{disposition}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    FileInspectionLogs,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Username\\\"] = Username,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, FileInspectionLogs\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"disposition\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3 - Copy - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and Malware !=\\\"None\\\" and (isnotempty(FileInspectionLogs) and isnotempty(Filetype) and isnotempty(Malware) and isnotempty(Filename)) | summarize count() by Filename, Filetype, Malware, FileInspectionLogs | sort by count_\",\"size\":0,\"showAnalytics\":true,\"title\":\"Malicious Files\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"Filename\",\"parameterName\":\"filename\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Filetype\",\"parameterName\":\"filetype\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"Malware\",\"parameterName\":\"malware\",\"parameterType\":1,\"defaultValue\":\"None\"},{\"fieldName\":\"FileInspectionLogs\",\"parameterName\":\"fileinspectionlogs\",\"parameterType\":1,\"defaultValue\":\"None\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"FileInspectionLogs\",\"label\":\"UTD Amp Disposition\"},{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"name\":\"query - 18\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and Malware == '{malware}'\\r\\n    and Filetype == '{filetype}'\\r\\n    and Filename == '{filename}'\\r\\n    and FileInspectionLogs == '{fileinspectionlogs}'\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| project-away SourceIP1\\r\\n| sort by TimeGenerated\",\"size\":0,\"showAnalytics\":true,\"title\":\"Syslog Events (Malicious File: {filename} (File Name), {filetype} (File Type), {malware} (Malware), {fileinspectionlogs} (UTD Amp Disposition) )\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"FileInspectionLogs\",\"label\":\"UTD Amp Disposition\"}]}},\"conditionalVisibility\":{\"parameterName\":\"filename\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 18 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"50\",\"name\":\"text - 36\"},{\"type\":1,\"content\":{\"json\":\"#### Blocked Connections Over URL\"},\"customWidth\":\"50\",\"name\":\"text - 42\"},{\"type\":1,\"content\":{\"json\":\"\"},\"customWidth\":\"50\",\"name\":\"text - 36\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0af8dc1a-4e2d-484c-bac6-a6c9e26c5270\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"filter_url\",\"label\":\"URLs\",\"type\":2,\"multiSelect\":true,\"isRequired\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter==\\\"Blacklist\\\" and ('*' == '{source_router}' or Host == '{source_router}')| distinct URL | order by URL asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 35\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter==\\\"Category/Reputation\\\" and ('*' == '{source_router}' or Host == '{source_router}') | summarize count() by Category\",\"size\":3,\"showAnalytics\":true,\"title\":\"Blocked Connections Over Category\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"category\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"Category\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"query - 20 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter==\\\"Blacklist\\\" and ('*' == '{source_router}' or Host == '{source_router}') and ('*' in ({filter_url}) or URL in ({filter_url})) | summarize count() by URL\",\"size\":3,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"url\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"URL\",\"createOtherGroup\":10}},\"customWidth\":\"50\",\"name\":\"Blocked Connections Over URL\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter==\\\"Category/Reputation\\\" and ('*' == '{source_router}' or Host == '{source_router}') and Category=='{category}' | summarize count() by URL,Reputation \\r\\n| extend Reputation = case(toint(Reputation)>80, \\\"Trustworthy\\\", \\r\\n                    toint(Reputation)>60, \\\"Low Risk\\\", \\r\\n                    toint(Reputation)>40, \\\"Moderate Risk\\\", \\r\\n                    toint(Reputation)>20, \\\"Suspicious\\\", \\r\\n                    toint(Reputation)>=0, \\\"High Risk\\\", \\\"Invalid Reputation\\\") | sort by Reputation asc, count_ desc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Url Details for Category: \\\"{category}\\\"\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"URL\",\"exportParameterName\":\"url_details\",\"exportDefaultValue\":\"None\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Reputation\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Trustworthy\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low Risk\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Moderate Risk\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Suspicious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High Risk\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]},\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true}},\"conditionalVisibility\":{\"parameterName\":\"category\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 20 - Copy - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### URL Details for \\\"{url_details}\\\"\"},\"conditionalVisibilities\":[{\"parameterName\":\"url_details\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"category\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"text - 22 - Copy - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"774960fd-0da7-4fb2-9f06-659822d898dd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and URL=='{url_details}' | distinct System_IP | order by System_IP asc \\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"918d7c04-d94c-4292-9e48-1fabe04b6400\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and URL=='{url_details}' | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"288e9214-6e80-4853-aa63-3a9ce76a0a39\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and URL=='{url_details}' | distinct Action | order by Action asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"6abbf82f-ae0d-4ede-8693-67dc9671d702\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"73b536df-36d4-4bc0-85fd-1c7f929f60b7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"b5b59219-cdf2-4da6-99e4-3ef12b91e20e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"f40c288c-490c-4bf2-a237-5bcf6425c00d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"2869236b-9f76-43db-846c-2d20208158c9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibilities\":[{\"parameterName\":\"url_details\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"category\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"parameters - 2 - Copy - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and URL == '{url_details}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    URL,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Username\\\"] = Username,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, URL\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"url_details\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},{\"parameterName\":\"category\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"}],\"name\":\"query - 3 - Copy - Copy - Copy - Copy - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### URL Details for \\\"{url}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"url\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 22 - Copy\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0f9d61a8-c945-46bf-be43-c5c67de7fa8d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and UTDWebfilter =='Blacklist' and URL=='{url}' | distinct System_IP | order by System_IP asc \\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"ff654403-9675-4d92-b927-8cf4895ed0a1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and UTDWebfilter =='Blacklist' and URL=='{url}' | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"7f85fb1e-737b-4086-a2ca-0f1bda79e76d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and UTDWebfilter =='Blacklist' and URL=='{url}' | distinct Action | order by Action asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"005efe9b-2ef2-46ac-b031-5910e7a05f31\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_ip\",\"label\":\"Source IP\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"73b536df-36d4-4bc0-85fd-1c7f929f60b7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"13f22a3c-472b-41be-9806-452b0192129c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"d6c2ca9a-ee3e-4adf-9820-e3144deba9e9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"f7ba2479-77a2-425b-b1f3-2aeccf6545d4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"url\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2 - Copy - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and UTDWebfilter == \\\"Blacklist\\\"\\r\\n    and URL == '{url}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    URL,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    [\\\"Source IP\\\"] = SourceIP,\\r\\n    [\\\"Username\\\"] = Username,\\r\\n    [\\\"Source Port\\\"] = SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, URL\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"url\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3 - Copy - Copy - Copy - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Blocked Connections Over Source\"},\"customWidth\":\"50\",\"name\":\"text - 41\"},{\"type\":1,\"content\":{\"json\":\"#### URL Reputation\"},\"customWidth\":\"50\",\"name\":\"text - 40\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6c263e37-5f29-4f77-b8aa-a9db63ff51d9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"filter_url_source\",\"label\":\"Source IPs\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter contains \\\"Blacklist\\\" and ('*' == '{source_router}' or Host == '{source_router}') and isnotempty(SourceIP) | distinct SourceIP | order by SourceIP asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 38\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"1d84e6fb-eb45-4b3c-93aa-1d9aac1604c6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"filter_url_reputation\",\"label\":\"URLs\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"isRequired\":true,\"delimiter\":\",\",\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host == '{source_router}') and UTDWebfilter==\\\"Category/Reputation\\\" and isnotempty(URL)| distinct URL | order by URL asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 35 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter contains \\\"Blacklist\\\" and ('*' == '{source_router}' or Host == '{source_router}') and ('*' in ({filter_url_source}) or SourceIP in ({filter_url_source})) | summarize count() by SourceIP\",\"size\":3,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"series\",\"exportParameterName\":\"source_ip\",\"exportDefaultValue\":\"None\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"group\":\"SourceIP\",\"createOtherGroup\":10,\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"name\":\"Blocked Connections Over Source\",\"styleSettings\":{\"padding\":\"70px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD | where UTDWebfilter==\\\"Category/Reputation\\\" and ('*' == '{source_router}' or Host == '{source_router}') and ('*' in ({filter_url_reputation}) or URL in ({filter_url_reputation})) | summarize count() by URL,Reputation \\r\\n| extend Reputation = case(toint(Reputation)>80, \\\"Trustworthy\\\", \\r\\n                    toint(Reputation)>60, \\\"Low Risk\\\", \\r\\n                    toint(Reputation)>40, \\\"Moderate Risk\\\", \\r\\n                    toint(Reputation)>20, \\\"Suspicious\\\", \\r\\n                    toint(Reputation)>=0, \\\"High Risk\\\", \\\"Invalid Reputation\\\") | sort by Reputation asc, count_ desc \\r\\n\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"URL\",\"exportParameterName\":\"url_reputation\",\"exportDefaultValue\":\"None\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Reputation\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Trustworthy\",\"representation\":\"greenDark\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Low Risk\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Moderate Risk\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Suspicious\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High Risk\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"}}],\"rowLimit\":10000,\"filter\":true,\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"50\",\"name\":\"query - 33\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Source IP Details for \\\"{source_ip}\\\"\"},\"conditionalVisibility\":{\"parameterName\":\"source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"text - 22\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"46234550-0061-4378-81ff-a9dea7eb977d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_ip\",\"label\":\"Device IP\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and UTDWebfilter =='Blacklist' and SourceIP=='{source_ip}' | distinct System_IP | order by System_IP asc \\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"c1fd5338-e958-49c2-8f35-8b127dd8efc4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"device_name\",\"label\":\"Device Name\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and UTDWebfilter =='Blacklist' and SourceIP=='{source_ip}' | distinct Hostname | order by Hostname asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"e4d208b9-5767-47fd-a220-f07228828859\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"action\",\"label\":\"Action\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogUTD | where ('*' == '{source_router}' or Host =='{source_router}') and UTDWebfilter =='Blacklist' and SourceIP=='{source_ip}' | distinct Action | order by Action asc \",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"},{\"id\":\"73b536df-36d4-4bc0-85fd-1c7f929f60b7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"username\",\"label\":\"Username\",\"type\":1,\"timeContext\":{\"durationMs\":604800000},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"c7fb714c-667b-45a1-9676-eaf18b8a348a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"src_port\",\"label\":\"Source Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"bd0e29cf-220f-45d8-956c-338dfe49b301\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_ip\",\"label\":\"Destination IP\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"},{\"id\":\"bb05d23d-fd3c-49fb-bf34-9329df458c75\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"dest_port\",\"label\":\"Destination Port\",\"type\":1,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"value\":\"*\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"parameters - 2 - Copy - Copy - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD\\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP\\r\\n| where ('*' == '{source_router}' or Host == '{source_router}')\\r\\n    and UTDWebfilter == 'Blacklist'\\r\\n    and SourceIP == '{source_ip}'\\r\\n    and ('*' == '{device_ip}' or System_IP == '{device_ip}')\\r\\n    and ('*' == '{device_name}' or Hostname == '{device_name}')\\r\\n    and ('*' == '{action}' or Action == '{action}')\\r\\n    and ('*' == '{src_ip}' or SourceIP contains '{src_ip}')\\r\\n    and ('*' == '{username}' or Username contains '{username}')\\r\\n    and ('*' == '{src_port}' or SourcePort contains '{src_port}')\\r\\n    and ('*' == '{dest_ip}' or DestinationIP contains '{dest_ip}')\\r\\n    and ('*' == '{dest_port}' or DestinationPort contains '{dest_port}')\\r\\n| summarize count()\\r\\n    by\\r\\n    [\\\"TimeStamp\\\"]=TimeGenerated,\\r\\n    [\\\"Device IP\\\"]=System_IP,\\r\\n    [\\\"Device Name\\\"]=Hostname,\\r\\n    [\\\"Action\\\"]=Action,\\r\\n    SourceIP,\\r\\n    [\\\"Username\\\"]=Username,\\r\\n    [\\\"Source Port\\\"]=SourcePort,\\r\\n    [\\\"Destination IP\\\"]=DestinationIP,\\r\\n    [\\\"Destination Port\\\"]=DestinationPort,\\r\\n    SyslogMessage\\r\\n| project-away count_, SourceIP\\r\\n| sort by TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 3 - Copy - Copy - Copy - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogUTD \\r\\n| where UTDWebfilter==\\\"Category/Reputation\\\" and ('*' == '{source_router}' or Host == '{source_router}') and URL==\\\"{url_reputation}\\\" \\r\\n| join kind=leftouter (MapNetflowUsername) on SourceIP \\r\\n| project-away SourceIP1 \\r\\n| sort by TimeGenerated\",\"size\":0,\"showAnalytics\":true,\"title\":\"Syslog Events (URL Reputation: {url_reputation} (URL))\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"url_reputation\",\"comparison\":\"isNotEqualTo\",\"value\":\"None\"},\"name\":\"query - 33 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"📝 Refresh the web page to fetch details of recently collected events.\"},\"name\":\"text - 39\"}]},\"conditionalVisibility\":{\"parameterName\":\"setTab\",\"comparison\":\"isEqualTo\",\"value\":\"Threat Inspection\"},\"name\":\"group - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Flow Analysis\\r\\n\\r\\nThe dashboard provides information related to \\\"Netflow\\\" data such as top network talkers and top source and destination countries.\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"43bb623f-9355-4d9f-a770-ca24a9332998\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_range\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"ee84313f-a519-478d-bc9b-2cf19d079792\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"source_router\",\"label\":\"Source Router\",\"type\":2,\"isRequired\":true,\"query\":\"let HostName = CiscoSDWANNetflow | where isnotempty(NetflowHostname) | distinct NetflowHostname | project Host=NetflowHostname;\\nCiscoSyslogFW6LogSummary | where isnotempty(Host) | union HostName | distinct Host | order by Host asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":\"value::all\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"value::all\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":1,\"content\":{\"json\":\"💡 Click on the data points in the each of the below panels to view more details.\\r\\n\\r\\n\"},\"name\":\"text - 39\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowPacketsIn)\\r\\n| summarize total_packets = sum(toint(NetflowPacketsIn)) by Type\\r\\n| extend title = \\\"Netflow Packets\\\", subtitle = \\\"                   \\\"\",\"size\":3,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportFieldName\":\"total_packets\",\"exportParameterName\":\"netflow_packets\",\"exportDefaultValue\":\"none\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"text\":\"{0}{1}\"}]}},\"subtitleContent\":{\"columnMatch\":\"subtitle\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"total_packets\",\"formatter\":12,\"formatOptions\":{\"palette\":\"none\"}},\"showBorder\":false,\"size\":\"full\"}},\"name\":\"query - 2\",\"styleSettings\":{\"padding\":\"5px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowPacketsIn) | sort by TimeStamp | project-away Agent*, _ResourceId, _SubscriptionId, ECSVersion, Host*, RawData\",\"size\":0,\"showAnalytics\":true,\"title\":\"Netflow Events for Netflow Packets\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"netflow_packets\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"},\"name\":\"query - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### NetFlow Packets Timeline\"},\"name\":\"text - 19\"},{\"type\":1,\"content\":{\"json\":\"💡 This chart displays the latest 10000 events over time.\"},\"name\":\"text - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowPacketsIn)\\r\\n| sort by TimeStamp | limit 10000\\r\\n| summarize total_packets = sum(toint(NetflowPacketsIn)) by EventVendor, TimeStamp\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"x\",\"parameterName\":\"TimeGeneratedTimeChart\",\"parameterType\":1,\"defaultValue\":\"none\"},{\"fieldName\":\"series\",\"parameterName\":\"TypeTimeChart\",\"parameterType\":1,\"defaultValue\":\"none\"}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"gridSettings\":{\"rowLimit\":10000},\"chartSettings\":{\"xAxis\":\"TimeStamp\",\"yAxis\":[\"total_packets\"],\"seriesLabelSettings\":[{\"seriesName\":\"CiscoSD-WAN\",\"label\":\"Packets\"}]}},\"name\":\"query - 4\",\"styleSettings\":{\"padding\":\"10px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let converted_time_packets = todatetime(extract(@\\\"\\\\w{3}\\\\s\\\\d{1,2}\\\\s\\\\d{4}\\\\s\\\\d{1,2}:\\\\d{1,2}:\\\\d{1,2}\\\\sGMT\\\\S{5}\\\", 0,'{TimeGeneratedTimeChart}'));\\r\\nCiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowPacketsIn)\\r\\n| where EventVendor=='{TypeTimeChart}' and bin(TimeStamp,1s) == converted_time_packets | sort by TimeStamp | project-away Agent*, _ResourceId, _SubscriptionId, ECSVersion, Host*, RawData\",\"size\":0,\"showAnalytics\":true,\"title\":\"Netflow Events (NetFlow Packets Timeline: {TimeGeneratedTimeChart} (Time Generated))\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"TimeGeneratedTimeChart\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"},{\"parameterName\":\"TypeTimeChart\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"}],\"name\":\"query - 5\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IP_Data = external_data(network:string,geoname_id:long,continent_code:string,continent_name:string ,country_iso_code:string,country_name:string,is_anonymous_proxy:bool,is_satellite_provider:bool)\\r\\n    ['https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv']\\r\\n    with (ignoreFirstRecord=true, format=\\\"csv\\\");\\r\\nCiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowFwSrcAddrIpv4)\\r\\n| evaluate ipv4_lookup(IP_Data, NetflowFwSrcAddrIpv4, network)\\r\\n| summarize count() by network, country_name\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top Source Countries\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"CountryRegion\",\"locInfoColumn\":\"country_name\",\"latitude\":\"src_ip_s\",\"longitude\":\"src_ip_s\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"query - 6\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IP_Data = external_data(network:string,geoname_id:long,continent_code:string,continent_name:string ,country_iso_code:string,country_name:string,is_anonymous_proxy:bool,is_satellite_provider:bool)\\r\\n    ['https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv']\\r\\n    with (ignoreFirstRecord=true, format=\\\"csv\\\");\\r\\nCiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowFwDestAddrIpv4)\\r\\n| evaluate ipv4_lookup(IP_Data, NetflowFwDestAddrIpv4, network)\\r\\n| summarize count() by network, country_name\",\"size\":0,\"showAnalytics\":true,\"title\":\"Top Destination Countries\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"CountryRegion\",\"locInfoColumn\":\"country_name\",\"latitude\":\"src_ip_s\",\"longitude\":\"src_ip_s\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"numberOfMetrics\":10,\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"count_\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"query - 6 - Copy\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Top Network Talkers\"},\"name\":\"text - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"3ae21293-a377-4817-a6e4-eb0f842a61d3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"top_network_talkers_count\",\"label\":\"Top\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n    { \\\"value\\\":10, \\\"label\\\":\\\" 10   \\\", \\\"selected\\\":true },\\r\\n    { \\\"value\\\":25, \\\"label\\\":\\\" 25  \\\" },\\r\\n    { \\\"value\\\":50, \\\"label\\\":\\\" 50   \\\" }\\r\\n]\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname=='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowBytesIn)\\r\\n| summarize [\\\"Total Bytes (MB)\\\"] = round((sum(toint(NetflowBytesIn))/1024)/1024, 2) by NetflowFwSrcAddrIpv4, NetflowFwDestAddrIpv4\\r\\n| sort by [\\\"Total Bytes (MB)\\\"] | limit toint('{top_network_talkers_count}')\\r\\n| project [\\\"Source IP Address\\\"] = NetflowFwSrcAddrIpv4, [\\\"Destination IP Address\\\"] = NetflowFwDestAddrIpv4, [\\\"Total Bytes (MB)\\\"]\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"Source IP Address\",\"parameterName\":\"tnt_source_ip\",\"parameterType\":1,\"defaultValue\":\"none\"},{\"fieldName\":\"Destination IP Address\",\"parameterName\":\"tnt_dest_ip\",\"parameterType\":1,\"defaultValue\":\"none\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Total Bytes (MB)\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 9\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSDWANNetflow\\r\\n| where ('*'=='{source_router}' or NetflowHostname =='{source_router}')\\r\\n| where isnotempty(NetflowElement_9_2239) and isnotempty(NetflowBytesIn)\\r\\n| where NetflowFwSrcAddrIpv4 == '{tnt_source_ip}' and NetflowFwDestAddrIpv4 == '{tnt_dest_ip}' | sort by TimeStamp | project-away Agent*, _ResourceId, _SubscriptionId, ECSVersion, Host*, RawData\",\"size\":0,\"showAnalytics\":true,\"title\":\"Netflow Events (Top Network Talkers: {tnt_source_ip} (Source IP) and {tnt_dest_ip} (Destination IP))\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"tnt_source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"},{\"parameterName\":\"tnt_dest_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"}],\"name\":\"query - 10\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"#### Communications Map between Sources and Destinations\"},\"name\":\"text - 11\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6d1a0b73-fd46-4f95-a7e7-87dfe1cca2e5\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ls_protocol\",\"label\":\"Protocol\",\"type\":2,\"isRequired\":true,\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*'=='{source_router}' or Host=='{source_router}')\\r\\n| distinct Protocol\\r\\n | order by Protocol asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"defaultValue\":\"value::all\",\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"time_range\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"c98dedf3-2399-4470-8700-c9023529c2e9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ls_top_count\",\"label\":\"Top\",\"type\":2,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n    { \\\"value\\\":10, \\\"label\\\":\\\" 10   \\\", \\\"selected\\\":true },\\r\\n    { \\\"value\\\":25, \\\"label\\\":\\\" 25  \\\" },\\r\\n    { \\\"value\\\":50, \\\"label\\\":\\\" 50   \\\" }\\r\\n]\"},{\"id\":\"90a0db3a-bf45-4b6b-b466-e8b25efab754\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ls_target\",\"label\":\"Target\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*' == '{source_router}' or Host=='{source_router}') and ('*' == '{ls_protocol}' or Protocol=='{ls_protocol}')\\r\\n| where isnotempty(SyslogTarget) | distinct SyslogTarget | order by SyslogTarget asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"280cf7c3-5dad-4aee-ae9c-cbb20d239f21\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ls_class\",\"label\":\"Class\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*' == '{source_router}' or Host=='{source_router}') and ('*' == '{ls_protocol}' or Protocol=='{ls_protocol}')\\r\\n| where isnotempty(SyslogClass) | distinct SyslogClass | order by SyslogClass asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":2419200000},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 12\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"af0794f0-b24f-43fb-b43f-9271c784f280\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ls_source_ip\",\"label\":\"Source IPs\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*' == '{source_router}' or Host=='{source_router}') and ('*' == '{ls_protocol}' or Protocol=='{ls_protocol}') and ('*' in ({ls_target}) or SyslogTarget in ({ls_target})) and ('*' in ({ls_class}) or SyslogClass in ({ls_class}))\\r\\n| distinct SourceIP | order by SourceIP asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]},{\"id\":\"1896111d-9468-453b-848e-6697e42a2b67\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ls_dest_ip\",\"label\":\"Destination IPs\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*' == '{source_router}' or Host=='{source_router}') and ('*' == '{ls_protocol}' or Protocol=='{ls_protocol}') and ('*' in ({ls_target}) or SyslogTarget in ({ls_target})) and ('*' in ({ls_class}) or SyslogClass in ({ls_class}))\\r\\n| distinct DestinationIP | order by DestinationIP asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\",\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_range\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*' == '{source_router}' or Host=='{source_router}') and ('*' == '{ls_protocol}' or Protocol=='{ls_protocol}') and ('*' in ({ls_target}) or SyslogTarget in ({ls_target})) and ('*' in ({ls_class}) or SyslogClass in ({ls_class})) and ('*' in ({ls_source_ip}) or SourceIP in ({ls_source_ip})) and ('*' in ({ls_dest_ip}) or DestinationIP in ({ls_dest_ip}))\\r\\n| summarize count() by SourceIP, DestinationIP\\r\\n| sort by count_ | limit toint('{ls_top_count}')\\r\\n| project ['Source IP Address'] = SourceIP, ['Destination IP Address'] = DestinationIP, ['Connections'] = count_\",\"size\":0,\"showAnalytics\":true,\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"exportedParameters\":[{\"fieldName\":\"Source IP Address\",\"parameterName\":\"cm_source_ip\",\"parameterType\":1,\"defaultValue\":\"none\"},{\"fieldName\":\"Destination IP Address\",\"parameterName\":\"cm_dest_ip\",\"parameterType\":1,\"defaultValue\":\"none\"}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Connections\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\",\"customColumnWidthSetting\":\"10%\"}}],\"rowLimit\":10000,\"filter\":true}},\"name\":\"query - 14\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoSyslogFW6LogSummary\\r\\n| where ('*' == '{source_router}' or Host=='{source_router}') and ('*' == '{ls_protocol}' or Protocol=='{ls_protocol}') and ('*' in ({ls_target}) or SyslogTarget in ({ls_target})) and ('*' in ({ls_class}) or SyslogClass in ({ls_class})) and ('*' in ({ls_source_ip}) or SourceIP in ({ls_source_ip})) and ('*' in ({ls_dest_ip}) or DestinationIP in ({ls_dest_ip}))\\r\\n| where SourceIP == '{cm_source_ip}' and DestinationIP == '{cm_dest_ip}'\\r\\n| sort by TimeGenerated\",\"size\":0,\"showAnalytics\":true,\"title\":\"Syslog Events (Communications Map between Sources and Destinations: {cm_source_ip} (Source IP) and {cm_dest_ip} (Destination IP))\",\"noDataMessage\":\"No data was found in the selected time range.\",\"timeContextFromParameter\":\"time_range\",\"showRefreshButton\":true,\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"conditionalVisibilities\":[{\"parameterName\":\"cm_source_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"},{\"parameterName\":\"cm_dest_ip\",\"comparison\":\"isNotEqualTo\",\"value\":\"none\"}],\"name\":\"query - 15\",\"styleSettings\":{\"showBorder\":true}},{\"type\":1,\"content\":{\"json\":\"📝 Refresh the web page to fetch details of recently collected events.\"},\"name\":\"text - 17\"}]},\"conditionalVisibility\":{\"parameterName\":\"setTab\",\"comparison\":\"isEqualTo\",\"value\":\"Flow Analysis\"},\"name\":\"group - 4\"}],\"fromTemplateId\":\"sentinel-CiscoSDWAN\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": ".description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "Cisco SD-WAN data connector with template",
        "displayName": "Cisco SD-WAN template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "Cisco SD-WAN data connector with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Cisco Software Defined WAN",
                  "publisher": "Cisco",
                  "descriptionMarkdown": "The Cisco Software Defined WAN(SD-WAN) data connector provides the capability to ingest [Cisco SD-WAN](https://www.cisco.com/c/en_in/solutions/enterprise-networks/sd-wan/index.html) Syslog and Netflow data into Microsoft Sentinel.",
                  "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. Follow the steps to use this Kusto functions alias **CiscoSyslogUTD** in queries and workbooks [Follow steps to get this CiscoSyslogUTD Kusto functions>](https://aka.ms/sentinel-CiscoSyslogUTD-parser), **CiscoSyslogFW6LogSummary** in queries and workbooks [Follow steps to get this CiscoSyslogFW6LogSummary Kusto functions>](https://aka.ms/sentinel-CiscoSyslogFW6LogSummary-parser) and **CiscoSDWANNetflow** in queries and workbooks [Follow steps to get this CiscoSDWANNetflow Kusto functions>](https://aka.ms/sentinel-CiscoSDWANNetflow-parser).",
                  "graphQueries": [
                    {
                      "metricName": "Total Syslog data received",
                      "legend": "Syslog",
                      "baseQuery": "Syslog"
                    },
                    {
                      "metricName": "Total Netflow data received",
                      "legend": "CiscoSDWANNetflow_CL",
                      "baseQuery": "CiscoSDWANNetflow_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Syslog Events - All Syslog Events.",
                      "query": "Syslog\n | sort by TimeGenerated desc"
                    },
                    {
                      "description": "Cisco SD-WAN Netflow Events - All Netflow Events.",
                      "query": "CiscoSDWANNetflow_CL\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Syslog",
                      "lastDataReceivedQuery": "Syslog\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "CiscoSDWANNetflow_CL",
                      "lastDataReceivedQuery": "CiscoSDWANNetflow_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Syslog\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    },
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "CiscoSDWANNetflow_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "write permission is required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "delete": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "**To ingest Cisco SD-WAN Syslog and Netflow data into Microsoft Sentinel follow the steps below.**"
                    },
                    {
                      "description": "Azure Monitor Agent will be used to collect the syslog data into Microsoft sentinel. For that first need to create an azure arc server for the VM from which syslog data will be sent.\n",
                      "title": "1. Steps to ingest Syslog data to Microsoft sentinel"
                    },
                    {
                      "description": "1. In Azure portal, go to Servers - Azure Arc and click on Add.\n2. Select Generate Script under Add a single server section. A User can also generate scripts for Multiple Servers as well.\n3. Review the information on the Prerequisites page, then select Next.\n4. On the Resource details page, provide the subscription and resource group of the Microsoft Sentinel, Region, Operating system and Connectivity method. Then select Next.\n5. On the Tags page, review the default Physical location tags suggested and enter a value, or specify one or more Custom tags to support your standards. Then select Next\n6. Select Download to save the script file. \n7. Now that you have generated the script, the next step is to run it on the server that you want to onboard to Azure Arc. \n8. If you have Azure VM follow the steps mentioned in the [link](https://learn.microsoft.com/azure/azure-arc/servers/plan-evaluate-on-azure-virtual-machine) before running the script. \n9. Run the script by the following command: `./<ScriptName>.sh`\n10. After you install the agent and configure it to connect to Azure Arc-enabled servers, go to the Azure portal to verify that the server has successfully connected. View your machine in the Azure portal.\n> **Reference link:** [https://learn.microsoft.com/azure/azure-arc/servers/learn/quick-enable-hybrid-vm](https://learn.microsoft.com/azure/azure-arc/servers/learn/quick-enable-hybrid-vm)",
                      "title": "1.1 Steps to Add Azure Arc Server"
                    },
                    {
                      "description": "1. In Azure Portal search for Monitor. Under Settings, select Data Collection Rules and Select Create.\n2. On the Basics panel, enter the Rule Name, Subscription, Resource group, Region and Platform Type.\n3. Select Next: Resources.\n4. Select Add resources.Use the filters to find the virtual machine that you&#39;ll use to collect logs.\n5. Select the virtual machine. Select Apply.\n6. Select Next: Collect and deliver.\n7. Select Add data source. For Data source type, select Linux syslog. \n8. For Minimum log level, leave the default values LOG_DEBUG.\n9. Select Next: Destination.\n10. Select Add destination and add Destination type, Subscription and Account or namespace.\n11. Select Add data source. Select Next: Review + create.\n12. Select Create. Wait for 20 minutes. In Microsoft Sentinel or Azure Monitor, verify that the Azure Monitor agent is running on your VM.\n> **Reference link:** [https://learn.microsoft.com/azure/sentinel/forward-syslog-monitor-agent](https://learn.microsoft.com/azure/sentinel/forward-syslog-monitor-agent)",
                      "title": "1.2 Steps to Create Data Collection Rule (DCR)"
                    },
                    {
                      "description": "To Ingest Netflow data into Microsoft sentinel, Filebeat and Logstash needs to be installed and configured on the VM. After the configuration, vm will be able to receive netflow data on the configured port and that data will be ingested into the workspace of Microsoft sentinel.\n",
                      "title": "2. Steps to ingest Netflow data to Microsoft sentinel"
                    },
                    {
                      "description": "1. For the installation of filebeat and logstash using apt refer to this doc: \n 1. Filebeat: [https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html). \n 2. Logstash: [https://www.elastic.co/guide/en/logstash/current/installing-logstash.html](https://www.elastic.co/guide/en/logstash/current/installing-logstash.html). \n2. For the installation of filebeat and logstash for RedHat based Linux (yum) steps are as follows: \n 1. Filebeat: [https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html#_yum](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html#_yum). \n 2. Logstash: [https://www.elastic.co/guide/en/logstash/current/installing-logstash.html#_yum](https://www.elastic.co/guide/en/logstash/current/installing-logstash.html#_yum)",
                      "title": "2.1 Install filebeat and logstash"
                    },
                    {
                      "description": "1. Edit filebeat.yml file: `vi /etc/filebeat/filebeat.yml` \n2. Comment out the Elasticsearch Output section. \n3. Uncomment Logstash Output section (Uncomment out only these two lines)-\n\t\toutput.logstash\n\t\thosts: [\"localhost:5044\"] \n3. In the Logstash Output section, if you want to send the data other than the default port i.e. 5044 port, then replace the port number in the hosts field. (Note: This port should be added in the conf file, while configuring logstash.) \n4. In the 'filebeat.inputs' section comment out existing configuration and add the following configuration: \n\t\t- type: netflow\n\t\t  max_message_size: 10KiB\n\t\t  host: \"0.0.0.0:2055\"\n\t\t  protocols: [ v5, v9, ipfix ]\n\t\t  expiration_timeout: 30m\n\t\t  queue_size: 8192\n\t\t  custom_definitions:\n\t\t  - /etc/filebeat/custom.yml\n\t\t  detect_sequence_reset: true\n\t\t  enabled: true \n6. In the Filebeat inputs section, if you want to receive the data other than the default port i.e. 2055 port, then replace the port number in the host field. \n7. Add the provided [custom.yml](https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Cisco%20SD-WAN/Data%20Connectors/custom.yml) file inside the /etc/filebeat/ directory. \n8. Open the filebeat input and output port in the firewall. \n 1. Run command: `firewall-cmd --zone=public --permanent --add-port=2055/udp` \n 2. Run command: `firewall-cmd --zone=public --permanent --add-port=5044/udp` \n> Note: if a custom port is added for filebeat input/output, then open that port in the firewall.",
                      "title": "2.2 Configure Filebeat to send events to Logstash"
                    },
                    {
                      "description": "1. Install the Azure Log Analytics plugin: \n 1. Run Command: `sudo /usr/share/logstash/bin/logstash-plugin install microsoft-logstash-output-azure-loganalytics` \n3. Store the Log Analytics workspace key in the Logstash key store. The workspace key can be found in Azure Portal under Log analytic workspace > Select workspace > Under Settings select Agent > Log Analytics agent instructions. \n4. Copy the Primary key and run the following commands: \n 1. `sudo /usr/share/logstash/bin/logstash-keystore --path.settings /etc/logstash create LogAnalyticsKey` \n 2. `sudo /usr/share/logstash/bin/logstash-keystore --path.settings /etc/logstash add LogAnalyticsKey` \n5. Create the configuration file /etc/logstash/cisco-netflow-to-sentinel.conf: \n\t\tinput {\n\t\t    beats {\n\t\t        port => <port_number> #(Enter output port number which has been configured during filebeat configuration i.e. filebeat.yml file .)\n\t\t     }\n\t\t}\n\t\toutput {\n\t\t    microsoft-logstash-output-azure-loganalytics {\n\t\t        workspace_id => \"<workspace_id>\"\n\t\t        workspace_key => \"${LogAnalyticsKey}\"\n\t\t        custom_log_table_name => \"CiscoSDWANNetflow\"\n\t\t    }\n\t\t} \n> Note: If table is not present in Microsoft sentinel, then it will create a new table in sentinel.",
                      "title": "2.3 Configure Logstash to send events to Microsoft Sentinel"
                    },
                    {
                      "description": "1. Open a terminal and run the command: \n> `systemctl start filebeat` \n2. This command will start running filebeat in the background. To see the logs stop the filebeat (`systemctl stop filebeat`) then run the following command: \n> `filebeat run -e`",
                      "title": "2.4 Run Filebeat:"
                    },
                    {
                      "description": "1. In another terminal run the command: \n> `/usr/share/logstash/bin/logstash --path.settings /etc/logstash -f /etc/logstash/cisco-netflow-to-sentinel.conf &` \n2. This command will start running the logstash in the background. To see the logs of logstash kill the above process and run the following command : \n> `/usr/share/logstash/bin/logstash --path.settings /etc/logstash -f /etc/logstash/cisco-netflow-to-sentinel.conf`",
                      "title": "2.5 Run Logstash:"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco SD-WAN",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco SD-WAN",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Cisco Systems",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cisco Systems",
          "email": "support@cisco.com",
          "tier": "Partner",
          "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Cisco Software Defined WAN",
          "publisher": "Cisco",
          "descriptionMarkdown": "The Cisco Software Defined WAN(SD-WAN) data connector provides the capability to ingest [Cisco SD-WAN](https://www.cisco.com/c/en_in/solutions/enterprise-networks/sd-wan/index.html) Syslog and Netflow data into Microsoft Sentinel.",
          "graphQueries": [
            {
              "metricName": "Total Syslog data received",
              "legend": "Syslog",
              "baseQuery": "Syslog"
            },
            {
              "metricName": "Total Netflow data received",
              "legend": "CiscoSDWANNetflow_CL",
              "baseQuery": "CiscoSDWANNetflow_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "Syslog",
              "lastDataReceivedQuery": "Syslog\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "CiscoSDWANNetflow_CL",
              "lastDataReceivedQuery": "CiscoSDWANNetflow_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "Syslog\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            },
            {
              "type": "IsConnectedQuery",
              "value": [
                "CiscoSDWANNetflow_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Syslog Events - All Syslog Events.",
              "query": "Syslog\n | sort by TimeGenerated desc"
            },
            {
              "description": "Cisco SD-WAN Netflow Events - All Netflow Events.",
              "query": "CiscoSDWANNetflow_CL\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "write permission is required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "delete": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "**To ingest Cisco SD-WAN Syslog and Netflow data into Microsoft Sentinel follow the steps below.**"
            },
            {
              "description": "Azure Monitor Agent will be used to collect the syslog data into Microsoft sentinel. For that first need to create an azure arc server for the VM from which syslog data will be sent.\n",
              "title": "1. Steps to ingest Syslog data to Microsoft sentinel"
            },
            {
              "description": "1. In Azure portal, go to Servers - Azure Arc and click on Add.\n2. Select Generate Script under Add a single server section. A User can also generate scripts for Multiple Servers as well.\n3. Review the information on the Prerequisites page, then select Next.\n4. On the Resource details page, provide the subscription and resource group of the Microsoft Sentinel, Region, Operating system and Connectivity method. Then select Next.\n5. On the Tags page, review the default Physical location tags suggested and enter a value, or specify one or more Custom tags to support your standards. Then select Next\n6. Select Download to save the script file. \n7. Now that you have generated the script, the next step is to run it on the server that you want to onboard to Azure Arc. \n8. If you have Azure VM follow the steps mentioned in the [link](https://learn.microsoft.com/azure/azure-arc/servers/plan-evaluate-on-azure-virtual-machine) before running the script. \n9. Run the script by the following command: `./<ScriptName>.sh`\n10. After you install the agent and configure it to connect to Azure Arc-enabled servers, go to the Azure portal to verify that the server has successfully connected. View your machine in the Azure portal.\n> **Reference link:** [https://learn.microsoft.com/azure/azure-arc/servers/learn/quick-enable-hybrid-vm](https://learn.microsoft.com/azure/azure-arc/servers/learn/quick-enable-hybrid-vm)",
              "title": "1.1 Steps to Add Azure Arc Server"
            },
            {
              "description": "1. In Azure Portal search for Monitor. Under Settings, select Data Collection Rules and Select Create.\n2. On the Basics panel, enter the Rule Name, Subscription, Resource group, Region and Platform Type.\n3. Select Next: Resources.\n4. Select Add resources.Use the filters to find the virtual machine that you&#39;ll use to collect logs.\n5. Select the virtual machine. Select Apply.\n6. Select Next: Collect and deliver.\n7. Select Add data source. For Data source type, select Linux syslog. \n8. For Minimum log level, leave the default values LOG_DEBUG.\n9. Select Next: Destination.\n10. Select Add destination and add Destination type, Subscription and Account or namespace.\n11. Select Add data source. Select Next: Review + create.\n12. Select Create. Wait for 20 minutes. In Microsoft Sentinel or Azure Monitor, verify that the Azure Monitor agent is running on your VM.\n> **Reference link:** [https://learn.microsoft.com/azure/sentinel/forward-syslog-monitor-agent](https://learn.microsoft.com/azure/sentinel/forward-syslog-monitor-agent)",
              "title": "1.2 Steps to Create Data Collection Rule (DCR)"
            },
            {
              "description": "To Ingest Netflow data into Microsoft sentinel, Filebeat and Logstash needs to be installed and configured on the VM. After the configuration, vm will be able to receive netflow data on the configured port and that data will be ingested into the workspace of Microsoft sentinel.\n",
              "title": "2. Steps to ingest Netflow data to Microsoft sentinel"
            },
            {
              "description": "1. For the installation of filebeat and logstash using apt refer to this doc: \n 1. Filebeat: [https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html). \n 2. Logstash: [https://www.elastic.co/guide/en/logstash/current/installing-logstash.html](https://www.elastic.co/guide/en/logstash/current/installing-logstash.html). \n2. For the installation of filebeat and logstash for RedHat based Linux (yum) steps are as follows: \n 1. Filebeat: [https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html#_yum](https://www.elastic.co/guide/en/beats/filebeat/current/setup-repositories.html#_yum). \n 2. Logstash: [https://www.elastic.co/guide/en/logstash/current/installing-logstash.html#_yum](https://www.elastic.co/guide/en/logstash/current/installing-logstash.html#_yum)",
              "title": "2.1 Install filebeat and logstash"
            },
            {
              "description": "1. Edit filebeat.yml file: `vi /etc/filebeat/filebeat.yml` \n2. Comment out the Elasticsearch Output section. \n3. Uncomment Logstash Output section (Uncomment out only these two lines)-\n\t\toutput.logstash\n\t\thosts: [\"localhost:5044\"] \n3. In the Logstash Output section, if you want to send the data other than the default port i.e. 5044 port, then replace the port number in the hosts field. (Note: This port should be added in the conf file, while configuring logstash.) \n4. In the 'filebeat.inputs' section comment out existing configuration and add the following configuration: \n\t\t- type: netflow\n\t\t  max_message_size: 10KiB\n\t\t  host: \"0.0.0.0:2055\"\n\t\t  protocols: [ v5, v9, ipfix ]\n\t\t  expiration_timeout: 30m\n\t\t  queue_size: 8192\n\t\t  custom_definitions:\n\t\t  - /etc/filebeat/custom.yml\n\t\t  detect_sequence_reset: true\n\t\t  enabled: true \n6. In the Filebeat inputs section, if you want to receive the data other than the default port i.e. 2055 port, then replace the port number in the host field. \n7. Add the provided [custom.yml](https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Cisco%20SD-WAN/Data%20Connectors/custom.yml) file inside the /etc/filebeat/ directory. \n8. Open the filebeat input and output port in the firewall. \n 1. Run command: `firewall-cmd --zone=public --permanent --add-port=2055/udp` \n 2. Run command: `firewall-cmd --zone=public --permanent --add-port=5044/udp` \n> Note: if a custom port is added for filebeat input/output, then open that port in the firewall.",
              "title": "2.2 Configure Filebeat to send events to Logstash"
            },
            {
              "description": "1. Install the Azure Log Analytics plugin: \n 1. Run Command: `sudo /usr/share/logstash/bin/logstash-plugin install microsoft-logstash-output-azure-loganalytics` \n3. Store the Log Analytics workspace key in the Logstash key store. The workspace key can be found in Azure Portal under Log analytic workspace > Select workspace > Under Settings select Agent > Log Analytics agent instructions. \n4. Copy the Primary key and run the following commands: \n 1. `sudo /usr/share/logstash/bin/logstash-keystore --path.settings /etc/logstash create LogAnalyticsKey` \n 2. `sudo /usr/share/logstash/bin/logstash-keystore --path.settings /etc/logstash add LogAnalyticsKey` \n5. Create the configuration file /etc/logstash/cisco-netflow-to-sentinel.conf: \n\t\tinput {\n\t\t    beats {\n\t\t        port => <port_number> #(Enter output port number which has been configured during filebeat configuration i.e. filebeat.yml file .)\n\t\t     }\n\t\t}\n\t\toutput {\n\t\t    microsoft-logstash-output-azure-loganalytics {\n\t\t        workspace_id => \"<workspace_id>\"\n\t\t        workspace_key => \"${LogAnalyticsKey}\"\n\t\t        custom_log_table_name => \"CiscoSDWANNetflow\"\n\t\t    }\n\t\t} \n> Note: If table is not present in Microsoft sentinel, then it will create a new table in sentinel.",
              "title": "2.3 Configure Logstash to send events to Microsoft Sentinel"
            },
            {
              "description": "1. Open a terminal and run the command: \n> `systemctl start filebeat` \n2. This command will start running filebeat in the background. To see the logs stop the filebeat (`systemctl stop filebeat`) then run the following command: \n> `filebeat run -e`",
              "title": "2.4 Run Filebeat:"
            },
            {
              "description": "1. In another terminal run the command: \n> `/usr/share/logstash/bin/logstash --path.settings /etc/logstash -f /etc/logstash/cisco-netflow-to-sentinel.conf &` \n2. This command will start running the logstash in the background. To see the logs of logstash kill the above process and run the following command : \n> `/usr/share/logstash/bin/logstash --path.settings /etc/logstash -f /etc/logstash/cisco-netflow-to-sentinel.conf`",
              "title": "2.5 Run Logstash:"
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "These queries and workbooks are dependent on a parser based on Kusto to work as expected. Follow the steps to use this Kusto functions alias **CiscoSyslogUTD** in queries and workbooks [Follow steps to get this CiscoSyslogUTD Kusto functions>](https://aka.ms/sentinel-CiscoSyslogUTD-parser), **CiscoSyslogFW6LogSummary** in queries and workbooks [Follow steps to get this CiscoSyslogFW6LogSummary Kusto functions>](https://aka.ms/sentinel-CiscoSyslogFW6LogSummary-parser) and **CiscoSDWANNetflow** in queries and workbooks [Follow steps to get this CiscoSDWANNetflow Kusto functions>](https://aka.ms/sentinel-CiscoSDWANNetflow-parser)."
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "CiscoSDWANNetflow Data Parser with template",
        "displayName": "CiscoSDWANNetflow Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CiscoSDWANNetflow Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "CiscoSDWANNetflow",
                "category": "Samples",
                "functionAlias": "CiscoSDWANNetflow",
                "query": "\nlet ConvertNetflowApplicationTag = (ApplicationTag: string) {\r\n    let raw_application_tag = todynamic(ApplicationTag);\r\n    let application_tag_number_0 = toint((raw_application_tag)[0]);\r\n    let application_tag_number_1 = toint((raw_application_tag)[1]);\r\n    let application_tag_number_2 = toint((raw_application_tag)[2]);\r\n    let application_tag_number_3 = toint((raw_application_tag)[3]);\r\n    let hex_application_tag = strcat(tohex(application_tag_number_1, 2), tohex(application_tag_number_2, 2), tohex(application_tag_number_3, 2));\r\n    case(application_tag_number_0 == 0, strcat(\"Invalid\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 1, strcat(\"IANA-L3\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 2, strcat(\"PANA-L3\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 3, strcat(\"IANA-L4\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 4, strcat(\"PANA-L4\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 5, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 6, strcat(\"USER-Defined\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 7, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 8, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 9, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 10, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 11, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 12, strcat(\"PANA-L2\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 13, strcat(\"PANA-L7\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 14, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 15, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 16, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 17, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 18, strcat(\"ETHERTYPE\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 19, strcat(\"LLC\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 20, strcat(\"PANA-L7-PEN\", \" : \", hex_application_tag), \"unclassified\");\r\n};\r\nlet CiscoSDWANNetflow_view = view() {\r\n    CiscoSDWANNetflow_CL\r\n    | extend\r\n        EventVendor=\"CiscoSD-WAN\",\r\n        EventProduct=\"Netflow\",\r\n        ApplicationTag = coalesce(column_ifexists('netflow_application_tag_s', ''), column_ifexists('netflow_options_application_tag_s', ''), column_ifexists('netflow_scope_application_tag_s', '')),\r\n        NetflowBytesIn = column_ifexists('netflow_bytes_in_d', ''),\r\n        NetflowElement_9_2239 = coalesce(toint(column_ifexists('netflow_element_9_2239_d', '')), toint(column_ifexists('netflow_scope_element_9_2239_d', ''))),\r\n        NetflowEgressVRFID = column_ifexists('netflow_egress_vrf_id_d', '' ),\r\n        NetflowIngressVRFID = column_ifexists('netflow_ingress_vrf_id_d', ''),\r\n        NetflowExporterAddress = column_ifexists('netflow_exporter_address_s', ''),\r\n        NetflowExporterSourceID = column_ifexists('netflow_exporter_source_id_d', ''),\r\n        NetflowExporterTimestamp = column_ifexists('netflow_exporter_timestamp_t', ''),\r\n        NetflowExporterUptimeMillis = column_ifexists('netflow_exporter_uptime_millis_d', ''),\r\n        NetflowExporterVersion = column_ifexists('netflow_exporter_version_d', ''),\r\n        NetflowFirewallEvent = column_ifexists('netflow_firewall_event_d', ''),\r\n        NetflowFlowFieldDestDSAID = column_ifexists('netflow_flow_field_dst_dsa_id_d', ''),\r\n        NetflowFlowFieldSGT = column_ifexists('netflow_flow_field_sgt_d', ''),\r\n        NetflowFlowFieldSrcDSAID = column_ifexists('netflow_flow_field_src_dsa_id_d', ''),\r\n        NetflowFlowEndMilliseconds = column_ifexists('netflow_flow_end_milliseconds_t', ''),\r\n        NetflowFlowEndReason = column_ifexists('netflow_flow_end_reason_d', ''),\r\n        NetflowFlowStartMilliseconds = column_ifexists('netflow_flow_start_milliseconds_t', ''),\r\n        NetflowFwAction = coalesce(toint(column_ifexists('netflow_fw_action_d', '')), toint(column_ifexists('netflow_scope_fw_action_d', ''))),\r\n        NetflowFwDestAddrIpv4 = column_ifexists('netflow_fw_dest_addr_ipv4_s', ''),\r\n        NetflowFwDestPort = column_ifexists('netflow_fw_dest_port_d', ''),\r\n        NetflowFwEventTimeMsec = column_ifexists('netflow_fw_event_time_msec_d', ''),\r\n        NetflowFwICMPCode = column_ifexists('netflow_fw_icmp_code_d', ''),\r\n        NetflowFwICMPType = column_ifexists('netflow_fw_icmp_type_d', ''),\r\n        NetflowFwInitiatorOctets = column_ifexists('netflow_fw_initiator_octets_d', ''),\r\n        NetflowFwIpv4Ident = column_ifexists('netflow_fw_ipv4_ident_d', ''),\r\n        NetflowFwPolicy = coalesce(toint(column_ifexists('netflow_fw_policy_d', '')), toint(column_ifexists('netflow_options_fw_policy_d', '')), toint(column_ifexists('netflow_scope_fw_policy_d', ''))),\r\n        NetflowFwProtocol = column_ifexists('netflow_fw_protocol_d', ''),\r\n        NetflowFwResponderOctets = column_ifexists('netflow_fw_responder_octets_d', ''),\r\n        NetflowFwSrcAddrIpv4 = column_ifexists('netflow_fw_src_addr_ipv4_s', ''),\r\n        NetflowFwSrcPort = column_ifexists('netflow_fw_src_port_d', ''),\r\n        NetflowFwSummaryPktCnt = column_ifexists('netflow_fw_summary_pkt_cnt_d', ''),\r\n        NetflowFwTCPAck = column_ifexists('netflow_fw_tcp_ack_d', ''),\r\n        NetflowFwTCPFlags = column_ifexists('netflow_fw_tcp_flags_d', ''),\r\n        NetflowFwTCPSeq = column_ifexists('netflow_fw_tcp_seq_d', ''),\r\n        NetflowFwXlateDestAddrIpv4 = column_ifexists('netflow_fw_xlate_dst_addr_ipv4_s', ''),\r\n        NetflowFwXlateDestPort = column_ifexists('netflow_fw_xlate_dst_port_d', ''),\r\n        NetflowFwXlateSrcAddrIpv4 = column_ifexists('netflow_fw_xlate_src_addr_ipv4_s', ''),\r\n        NetflowFwXlateSrcPort = column_ifexists('netflow_fw_xlate_src_port_d', ''),\r\n        NetflowInputSNMPIDX = column_ifexists('netflow_input_snmpidx_d', ''),\r\n        NetflowOutputSNMPIDX = column_ifexists('netflow_output_snmpidx_d', ''),\r\n        NetflowIpDiffServCodePoint = column_ifexists('netflow_ip_diff_serv_code_point_d', ''),\r\n        NetflowApplicationDescription = column_ifexists('netflow_options_application_description_s', ''),\r\n        NetflowApplicationName = column_ifexists('netflow_options_application_name_s', ''),\r\n        NetflowEncryptedTechnology = column_ifexists('netflow_options_encrypted_technology_s', ''),\r\n        NetflowFwActionRule = column_ifexists('netflow_options_fw_action_rule_s', ''),\r\n        NetflowFwExtEvent = coalesce(toint(column_ifexists('netflow_fw_ext_event_d', '')), toint(column_ifexists('netflow_options_fw_ext_event_d', ''))),\r\n        NetflowFwExtEventDesc = column_ifexists('netflow_options_fw_ext_event_desc_s', ''),\r\n        NetflowFwPolicyRule = column_ifexists('netflow_options_fw_policy_rule_s', ''),\r\n        NetflowFwPolicyType = column_ifexists('netflow_options_fw_policy_type_s', ''),\r\n        NetflowFwZonepairID = coalesce(toint(column_ifexists('netflow_fw_zonepair_id_d', '')),toint(column_ifexists('netflow_options_fw_zonepair_id_d', ''))),\r\n        NetflowFwZonepairName = column_ifexists('netflow_options_fw_zonepair_name_s', ''),\r\n        NetflowInterfaceDescription = column_ifexists('netflow_options_interface_description_s', ''),\r\n        NetflowInterfaceName = column_ifexists('netflow_options_interface_name_s', ''),\r\n        NetflowP2pTechnology = column_ifexists('netflow_options_p2p_technology_s', ''),\r\n        NetflowTunnelTechnology = column_ifexists('netflow_options_tunnel_technology_s', ''),\r\n        NetflowPacketsIn = column_ifexists('netflow_packets_in_d', ''),\r\n        NetflowPostIpDiffServCodePoint = column_ifexists('netflow_post_ip_diff_serv_code_point_d', ''),\r\n        NetflowSrcTOS = column_ifexists('netflow_src_tos_d', ''),\r\n        NetflowType = column_ifexists('netflow_type_s', ''),\r\n        NetflowUsername = column_ifexists('netflow_username_s', ''),\r\n        NetworkCommunityID = column_ifexists('network_community_id_s', ''),\r\n        NetworkDirection = column_ifexists('network_direction_s', ''),\r\n        ObserverIp = column_ifexists('observer_ip_s', ''),\r\n        HostArchitecture = column_ifexists('host_architecture_s', ''),\r\n        HostContainerized = column_ifexists('host_containerized_b', ''),\r\n        NetflowHostname = coalesce(column_ifexists('host_hostname_s', ''), column_ifexists('host_name_s', '')),\r\n        HostID = column_ifexists('host_id_g', ''),\r\n        HostIp = column_ifexists('host_ip_s', ''),\r\n        HostMac = column_ifexists('host_mac_s', ''),\r\n        Hostname = column_ifexists('host_name_s', ''),\r\n        HostOSCodename = column_ifexists('host_os_codename_s', ''),\r\n        HostOSFamily = column_ifexists('host_os_family_s', ''),\r\n        HostOSKernel = column_ifexists('host_os_kernel_s', ''),\r\n        HostOSName = column_ifexists('host_os_name_s', ''),\r\n        HostOSPlatform = column_ifexists('host_os_platform_s', ''),\r\n        HostOSType = column_ifexists('host_os_type_s', ''),\r\n        HostOSVersion = column_ifexists('host_os_version_s', ''),\r\n        InputType = column_ifexists('input_type_s', ''),\r\n        Tags = column_ifexists('tags_s', ''),\r\n        TimeStamp = column_ifexists('_timestamp_t', ''),\r\n        Version = column_ifexists('_version_s', ''),\r\n        AgentEphemeralID = column_ifexists('agent_ephemeral_id_g', ''),\r\n        AgentID = column_ifexists('agent_id_g', ''),\r\n        AgentName = column_ifexists('agent_name_s', ''),\r\n        AgentType = column_ifexists('agent_type_s', ''),\r\n        AgentVersion = column_ifexists('agent_version_s', ''),\r\n        ECSVersion = column_ifexists('ecs_version_s', ''),\r\n        EventAction = column_ifexists('event_action_s', ''),\r\n        EventCategory = column_ifexists('event_category_s', ''),\r\n        EventCreated = column_ifexists('event_created_t', ''),\r\n        EventKind = column_ifexists('event_kind_s', ''),\r\n        EventType = column_ifexists('event_type_s', ''),\r\n        FlowID = column_ifexists('flow_id_s', ''),\r\n        FlowLocality = column_ifexists('flow_locality_s', '')\r\n    | extend NetflowApplicationTag = iff(isnotempty(ApplicationTag),ConvertNetflowApplicationTag(ApplicationTag), ApplicationTag)\r\n    | project\r\n        EventVendor,\r\n        EventProduct,\r\n        TimeStamp,\r\n        TimeGenerated = TimeStamp,\r\n        NetflowApplicationTag,\r\n        NetflowApplicationName,\r\n        NetflowApplicationDescription,\r\n        NetflowBytesIn,\r\n        NetflowElement_9_2239,\r\n        NetflowEgressVRFID,\r\n        NetflowIngressVRFID,\r\n        NetflowExporterAddress,\r\n        NetflowExporterSourceID,\r\n        NetflowExporterTimestamp,\r\n        NetflowExporterUptimeMillis,\r\n        NetflowExporterVersion,\r\n        NetflowFirewallEvent,\r\n        NetflowFlowFieldDestDSAID,\r\n        NetflowFlowFieldSGT,\r\n        NetflowFlowFieldSrcDSAID,\r\n        NetflowFlowEndMilliseconds,\r\n        NetflowFlowEndReason,\r\n        NetflowFlowStartMilliseconds,\r\n        NetflowFwAction,\r\n        NetflowFwDestAddrIpv4,\r\n        NetflowFwDestPort,\r\n        NetflowFwEventTimeMsec,\r\n        NetflowFwICMPCode,\r\n        NetflowFwICMPType,\r\n        NetflowFwInitiatorOctets,\r\n        NetflowFwResponderOctets,\r\n        NetflowFwIpv4Ident,\r\n        NetflowFwPolicy,\r\n        NetflowFwProtocol,\r\n        NetflowFwSrcAddrIpv4,\r\n        NetflowFwSrcPort,\r\n        NetflowFwSummaryPktCnt,\r\n        NetflowFwTCPAck,\r\n        NetflowFwTCPFlags,\r\n        NetflowFwTCPSeq,\r\n        NetflowFwXlateDestAddrIpv4,\r\n        NetflowFwXlateDestPort,\r\n        NetflowFwXlateSrcAddrIpv4,\r\n        NetflowFwXlateSrcPort,\r\n        NetflowInputSNMPIDX,\r\n        NetflowOutputSNMPIDX,\r\n        NetflowIpDiffServCodePoint,\r\n        NetflowEncryptedTechnology,\r\n        NetflowFwActionRule,\r\n        NetflowFwExtEvent,\r\n        NetflowFwExtEventDesc,\r\n        NetflowFwPolicyRule,\r\n        NetflowFwPolicyType,\r\n        NetflowFwZonepairID,\r\n        NetflowFwZonepairName,\r\n        NetflowInterfaceDescription,\r\n        NetflowInterfaceName,\r\n        NetflowP2pTechnology,\r\n        NetflowTunnelTechnology,\r\n        NetflowPacketsIn,\r\n        NetflowPostIpDiffServCodePoint,\r\n        NetflowSrcTOS,\r\n        NetflowType,\r\n        NetflowUsername,\r\n        NetworkCommunityID,\r\n        NetworkDirection,\r\n        ObserverIp,\r\n        HostArchitecture,\r\n        HostContainerized,\r\n        NetflowHostname,\r\n        HostID,\r\n        HostIp,\r\n        HostMac,\r\n        Hostname,\r\n        HostOSCodename,\r\n        HostOSFamily,\r\n        HostOSKernel,\r\n        HostOSName,\r\n        HostOSPlatform,\r\n        HostOSType,\r\n        HostOSVersion,\r\n        InputType,\r\n        Tags,\r\n        Version,\r\n        AgentEphemeralID,\r\n        AgentID,\r\n        AgentName,\r\n        AgentType,\r\n        AgentVersion,\r\n        Computer,\r\n        ECSVersion,\r\n        EventAction,\r\n        EventCategory,\r\n        EventCreated,\r\n        EventKind,\r\n        EventType,\r\n        FlowID,\r\n        FlowLocality,\r\n        RawData,\r\n        Type,\r\n        _ResourceId,\r\n        _SubscriptionId\r\n};\r\nCiscoSDWANNetflow_view",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "CiscoSDWANNetflow"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "Cisco SD-WAN",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "CiscoSDWANNetflow",
        "category": "Samples",
        "functionAlias": "CiscoSDWANNetflow",
        "query": "\nlet ConvertNetflowApplicationTag = (ApplicationTag: string) {\r\n    let raw_application_tag = todynamic(ApplicationTag);\r\n    let application_tag_number_0 = toint((raw_application_tag)[0]);\r\n    let application_tag_number_1 = toint((raw_application_tag)[1]);\r\n    let application_tag_number_2 = toint((raw_application_tag)[2]);\r\n    let application_tag_number_3 = toint((raw_application_tag)[3]);\r\n    let hex_application_tag = strcat(tohex(application_tag_number_1, 2), tohex(application_tag_number_2, 2), tohex(application_tag_number_3, 2));\r\n    case(application_tag_number_0 == 0, strcat(\"Invalid\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 1, strcat(\"IANA-L3\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 2, strcat(\"PANA-L3\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 3, strcat(\"IANA-L4\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 4, strcat(\"PANA-L4\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 5, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 6, strcat(\"USER-Defined\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 7, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 8, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 9, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 10, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 11, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 12, strcat(\"PANA-L2\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 13, strcat(\"PANA-L7\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 14, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 15, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 16, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 17, strcat(\"Reserved\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 18, strcat(\"ETHERTYPE\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 19, strcat(\"LLC\", \" : \", hex_application_tag),\r\n        application_tag_number_0 == 20, strcat(\"PANA-L7-PEN\", \" : \", hex_application_tag), \"unclassified\");\r\n};\r\nlet CiscoSDWANNetflow_view = view() {\r\n    CiscoSDWANNetflow_CL\r\n    | extend\r\n        EventVendor=\"CiscoSD-WAN\",\r\n        EventProduct=\"Netflow\",\r\n        ApplicationTag = coalesce(column_ifexists('netflow_application_tag_s', ''), column_ifexists('netflow_options_application_tag_s', ''), column_ifexists('netflow_scope_application_tag_s', '')),\r\n        NetflowBytesIn = column_ifexists('netflow_bytes_in_d', ''),\r\n        NetflowElement_9_2239 = coalesce(toint(column_ifexists('netflow_element_9_2239_d', '')), toint(column_ifexists('netflow_scope_element_9_2239_d', ''))),\r\n        NetflowEgressVRFID = column_ifexists('netflow_egress_vrf_id_d', '' ),\r\n        NetflowIngressVRFID = column_ifexists('netflow_ingress_vrf_id_d', ''),\r\n        NetflowExporterAddress = column_ifexists('netflow_exporter_address_s', ''),\r\n        NetflowExporterSourceID = column_ifexists('netflow_exporter_source_id_d', ''),\r\n        NetflowExporterTimestamp = column_ifexists('netflow_exporter_timestamp_t', ''),\r\n        NetflowExporterUptimeMillis = column_ifexists('netflow_exporter_uptime_millis_d', ''),\r\n        NetflowExporterVersion = column_ifexists('netflow_exporter_version_d', ''),\r\n        NetflowFirewallEvent = column_ifexists('netflow_firewall_event_d', ''),\r\n        NetflowFlowFieldDestDSAID = column_ifexists('netflow_flow_field_dst_dsa_id_d', ''),\r\n        NetflowFlowFieldSGT = column_ifexists('netflow_flow_field_sgt_d', ''),\r\n        NetflowFlowFieldSrcDSAID = column_ifexists('netflow_flow_field_src_dsa_id_d', ''),\r\n        NetflowFlowEndMilliseconds = column_ifexists('netflow_flow_end_milliseconds_t', ''),\r\n        NetflowFlowEndReason = column_ifexists('netflow_flow_end_reason_d', ''),\r\n        NetflowFlowStartMilliseconds = column_ifexists('netflow_flow_start_milliseconds_t', ''),\r\n        NetflowFwAction = coalesce(toint(column_ifexists('netflow_fw_action_d', '')), toint(column_ifexists('netflow_scope_fw_action_d', ''))),\r\n        NetflowFwDestAddrIpv4 = column_ifexists('netflow_fw_dest_addr_ipv4_s', ''),\r\n        NetflowFwDestPort = column_ifexists('netflow_fw_dest_port_d', ''),\r\n        NetflowFwEventTimeMsec = column_ifexists('netflow_fw_event_time_msec_d', ''),\r\n        NetflowFwICMPCode = column_ifexists('netflow_fw_icmp_code_d', ''),\r\n        NetflowFwICMPType = column_ifexists('netflow_fw_icmp_type_d', ''),\r\n        NetflowFwInitiatorOctets = column_ifexists('netflow_fw_initiator_octets_d', ''),\r\n        NetflowFwIpv4Ident = column_ifexists('netflow_fw_ipv4_ident_d', ''),\r\n        NetflowFwPolicy = coalesce(toint(column_ifexists('netflow_fw_policy_d', '')), toint(column_ifexists('netflow_options_fw_policy_d', '')), toint(column_ifexists('netflow_scope_fw_policy_d', ''))),\r\n        NetflowFwProtocol = column_ifexists('netflow_fw_protocol_d', ''),\r\n        NetflowFwResponderOctets = column_ifexists('netflow_fw_responder_octets_d', ''),\r\n        NetflowFwSrcAddrIpv4 = column_ifexists('netflow_fw_src_addr_ipv4_s', ''),\r\n        NetflowFwSrcPort = column_ifexists('netflow_fw_src_port_d', ''),\r\n        NetflowFwSummaryPktCnt = column_ifexists('netflow_fw_summary_pkt_cnt_d', ''),\r\n        NetflowFwTCPAck = column_ifexists('netflow_fw_tcp_ack_d', ''),\r\n        NetflowFwTCPFlags = column_ifexists('netflow_fw_tcp_flags_d', ''),\r\n        NetflowFwTCPSeq = column_ifexists('netflow_fw_tcp_seq_d', ''),\r\n        NetflowFwXlateDestAddrIpv4 = column_ifexists('netflow_fw_xlate_dst_addr_ipv4_s', ''),\r\n        NetflowFwXlateDestPort = column_ifexists('netflow_fw_xlate_dst_port_d', ''),\r\n        NetflowFwXlateSrcAddrIpv4 = column_ifexists('netflow_fw_xlate_src_addr_ipv4_s', ''),\r\n        NetflowFwXlateSrcPort = column_ifexists('netflow_fw_xlate_src_port_d', ''),\r\n        NetflowInputSNMPIDX = column_ifexists('netflow_input_snmpidx_d', ''),\r\n        NetflowOutputSNMPIDX = column_ifexists('netflow_output_snmpidx_d', ''),\r\n        NetflowIpDiffServCodePoint = column_ifexists('netflow_ip_diff_serv_code_point_d', ''),\r\n        NetflowApplicationDescription = column_ifexists('netflow_options_application_description_s', ''),\r\n        NetflowApplicationName = column_ifexists('netflow_options_application_name_s', ''),\r\n        NetflowEncryptedTechnology = column_ifexists('netflow_options_encrypted_technology_s', ''),\r\n        NetflowFwActionRule = column_ifexists('netflow_options_fw_action_rule_s', ''),\r\n        NetflowFwExtEvent = coalesce(toint(column_ifexists('netflow_fw_ext_event_d', '')), toint(column_ifexists('netflow_options_fw_ext_event_d', ''))),\r\n        NetflowFwExtEventDesc = column_ifexists('netflow_options_fw_ext_event_desc_s', ''),\r\n        NetflowFwPolicyRule = column_ifexists('netflow_options_fw_policy_rule_s', ''),\r\n        NetflowFwPolicyType = column_ifexists('netflow_options_fw_policy_type_s', ''),\r\n        NetflowFwZonepairID = coalesce(toint(column_ifexists('netflow_fw_zonepair_id_d', '')),toint(column_ifexists('netflow_options_fw_zonepair_id_d', ''))),\r\n        NetflowFwZonepairName = column_ifexists('netflow_options_fw_zonepair_name_s', ''),\r\n        NetflowInterfaceDescription = column_ifexists('netflow_options_interface_description_s', ''),\r\n        NetflowInterfaceName = column_ifexists('netflow_options_interface_name_s', ''),\r\n        NetflowP2pTechnology = column_ifexists('netflow_options_p2p_technology_s', ''),\r\n        NetflowTunnelTechnology = column_ifexists('netflow_options_tunnel_technology_s', ''),\r\n        NetflowPacketsIn = column_ifexists('netflow_packets_in_d', ''),\r\n        NetflowPostIpDiffServCodePoint = column_ifexists('netflow_post_ip_diff_serv_code_point_d', ''),\r\n        NetflowSrcTOS = column_ifexists('netflow_src_tos_d', ''),\r\n        NetflowType = column_ifexists('netflow_type_s', ''),\r\n        NetflowUsername = column_ifexists('netflow_username_s', ''),\r\n        NetworkCommunityID = column_ifexists('network_community_id_s', ''),\r\n        NetworkDirection = column_ifexists('network_direction_s', ''),\r\n        ObserverIp = column_ifexists('observer_ip_s', ''),\r\n        HostArchitecture = column_ifexists('host_architecture_s', ''),\r\n        HostContainerized = column_ifexists('host_containerized_b', ''),\r\n        NetflowHostname = coalesce(column_ifexists('host_hostname_s', ''), column_ifexists('host_name_s', '')),\r\n        HostID = column_ifexists('host_id_g', ''),\r\n        HostIp = column_ifexists('host_ip_s', ''),\r\n        HostMac = column_ifexists('host_mac_s', ''),\r\n        Hostname = column_ifexists('host_name_s', ''),\r\n        HostOSCodename = column_ifexists('host_os_codename_s', ''),\r\n        HostOSFamily = column_ifexists('host_os_family_s', ''),\r\n        HostOSKernel = column_ifexists('host_os_kernel_s', ''),\r\n        HostOSName = column_ifexists('host_os_name_s', ''),\r\n        HostOSPlatform = column_ifexists('host_os_platform_s', ''),\r\n        HostOSType = column_ifexists('host_os_type_s', ''),\r\n        HostOSVersion = column_ifexists('host_os_version_s', ''),\r\n        InputType = column_ifexists('input_type_s', ''),\r\n        Tags = column_ifexists('tags_s', ''),\r\n        TimeStamp = column_ifexists('_timestamp_t', ''),\r\n        Version = column_ifexists('_version_s', ''),\r\n        AgentEphemeralID = column_ifexists('agent_ephemeral_id_g', ''),\r\n        AgentID = column_ifexists('agent_id_g', ''),\r\n        AgentName = column_ifexists('agent_name_s', ''),\r\n        AgentType = column_ifexists('agent_type_s', ''),\r\n        AgentVersion = column_ifexists('agent_version_s', ''),\r\n        ECSVersion = column_ifexists('ecs_version_s', ''),\r\n        EventAction = column_ifexists('event_action_s', ''),\r\n        EventCategory = column_ifexists('event_category_s', ''),\r\n        EventCreated = column_ifexists('event_created_t', ''),\r\n        EventKind = column_ifexists('event_kind_s', ''),\r\n        EventType = column_ifexists('event_type_s', ''),\r\n        FlowID = column_ifexists('flow_id_s', ''),\r\n        FlowLocality = column_ifexists('flow_locality_s', '')\r\n    | extend NetflowApplicationTag = iff(isnotempty(ApplicationTag),ConvertNetflowApplicationTag(ApplicationTag), ApplicationTag)\r\n    | project\r\n        EventVendor,\r\n        EventProduct,\r\n        TimeStamp,\r\n        TimeGenerated = TimeStamp,\r\n        NetflowApplicationTag,\r\n        NetflowApplicationName,\r\n        NetflowApplicationDescription,\r\n        NetflowBytesIn,\r\n        NetflowElement_9_2239,\r\n        NetflowEgressVRFID,\r\n        NetflowIngressVRFID,\r\n        NetflowExporterAddress,\r\n        NetflowExporterSourceID,\r\n        NetflowExporterTimestamp,\r\n        NetflowExporterUptimeMillis,\r\n        NetflowExporterVersion,\r\n        NetflowFirewallEvent,\r\n        NetflowFlowFieldDestDSAID,\r\n        NetflowFlowFieldSGT,\r\n        NetflowFlowFieldSrcDSAID,\r\n        NetflowFlowEndMilliseconds,\r\n        NetflowFlowEndReason,\r\n        NetflowFlowStartMilliseconds,\r\n        NetflowFwAction,\r\n        NetflowFwDestAddrIpv4,\r\n        NetflowFwDestPort,\r\n        NetflowFwEventTimeMsec,\r\n        NetflowFwICMPCode,\r\n        NetflowFwICMPType,\r\n        NetflowFwInitiatorOctets,\r\n        NetflowFwResponderOctets,\r\n        NetflowFwIpv4Ident,\r\n        NetflowFwPolicy,\r\n        NetflowFwProtocol,\r\n        NetflowFwSrcAddrIpv4,\r\n        NetflowFwSrcPort,\r\n        NetflowFwSummaryPktCnt,\r\n        NetflowFwTCPAck,\r\n        NetflowFwTCPFlags,\r\n        NetflowFwTCPSeq,\r\n        NetflowFwXlateDestAddrIpv4,\r\n        NetflowFwXlateDestPort,\r\n        NetflowFwXlateSrcAddrIpv4,\r\n        NetflowFwXlateSrcPort,\r\n        NetflowInputSNMPIDX,\r\n        NetflowOutputSNMPIDX,\r\n        NetflowIpDiffServCodePoint,\r\n        NetflowEncryptedTechnology,\r\n        NetflowFwActionRule,\r\n        NetflowFwExtEvent,\r\n        NetflowFwExtEventDesc,\r\n        NetflowFwPolicyRule,\r\n        NetflowFwPolicyType,\r\n        NetflowFwZonepairID,\r\n        NetflowFwZonepairName,\r\n        NetflowInterfaceDescription,\r\n        NetflowInterfaceName,\r\n        NetflowP2pTechnology,\r\n        NetflowTunnelTechnology,\r\n        NetflowPacketsIn,\r\n        NetflowPostIpDiffServCodePoint,\r\n        NetflowSrcTOS,\r\n        NetflowType,\r\n        NetflowUsername,\r\n        NetworkCommunityID,\r\n        NetworkDirection,\r\n        ObserverIp,\r\n        HostArchitecture,\r\n        HostContainerized,\r\n        NetflowHostname,\r\n        HostID,\r\n        HostIp,\r\n        HostMac,\r\n        Hostname,\r\n        HostOSCodename,\r\n        HostOSFamily,\r\n        HostOSKernel,\r\n        HostOSName,\r\n        HostOSPlatform,\r\n        HostOSType,\r\n        HostOSVersion,\r\n        InputType,\r\n        Tags,\r\n        Version,\r\n        AgentEphemeralID,\r\n        AgentID,\r\n        AgentName,\r\n        AgentType,\r\n        AgentVersion,\r\n        Computer,\r\n        ECSVersion,\r\n        EventAction,\r\n        EventCategory,\r\n        EventCreated,\r\n        EventKind,\r\n        EventType,\r\n        FlowID,\r\n        FlowLocality,\r\n        RawData,\r\n        Type,\r\n        _ResourceId,\r\n        _SubscriptionId\r\n};\r\nCiscoSDWANNetflow_view",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco SD-WAN",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Cisco Systems",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cisco Systems",
          "email": "support@cisco.com",
          "tier": "Partner",
          "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "CiscoSyslogFW6LogSummary Data Parser with template",
        "displayName": "CiscoSyslogFW6LogSummary Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName2'),'/',variables('parserVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "CiscoSyslogFW6LogSummary Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName2')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "CiscoSyslogFW6LogSummary",
                "category": "Samples",
                "functionAlias": "CiscoSyslogFW6LogSummary",
                "query": "\nlet CiscoSyslogFW6LogSummary_view = view() {\r\n    Syslog\r\n    | where SyslogMessage has \"%FW-6-LOG_SUMMARY:\"\r\n    | extend FieldList = extract_all(@\"\\S{3}\\s+\\d{1,2}\\s[^\\s]+\\s%(?P<type>[^:\\s]+).*TS:\\d+\\s%(?P<sub_type>[^:\\s]+)[^\\d]+(?P<packets>\\d+)\\s(?P<protocol>\\w+).*\\s(?P<action>\\w+)\\sfrom\\s[^\\s]+\\s(?P<src_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<src_port>\\d{1,5})[^\\d]+(?P<dest_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<dest_port>\\d{1,5}).*\\(target:class\\)-\\((?P<target>[^\\s\\)\\(:]+)\\:(?P<class>[^\\s\\:\\)]+)\", dynamic(['type', 'sub_type', 'packets', 'protocol', 'action', 'src_ip', 'src_port', 'dest_ip', 'dest_port', 'target', 'class']), SyslogMessage)\r\n    | extend\r\n        SyslogType = tostring(FieldList[0][0]),\r\n        SyslogSubType = tostring(FieldList[0][1]),\r\n        Packets = tostring(FieldList[0][2]),\r\n        Protocol = tostring(FieldList[0][3]),\r\n        Action = tostring(FieldList[0][4]),\r\n        SourceIP = tostring(FieldList[0][5]),\r\n        SourcePort = tostring(FieldList[0][6]),\r\n        DestinationIP = tostring(FieldList[0][7]),\r\n        DestinationPort = tostring(FieldList[0][8]),\r\n        SyslogTarget = tostring(FieldList[0][9]),\r\n        SyslogClass = tostring(FieldList[0][10])\r\n    | extend \r\n        EventVendor=\"CiscoSD-WAN\",\r\n        EventProduct=\"Syslog_FW-6-LOG_SUMMARY\"\r\n    | project \r\n        EventVendor,\r\n        EventProduct,\r\n        Host = HostName,\r\n        TimeGenerated=EventTime,\r\n        SyslogType,\r\n        SyslogSubType,\r\n        Packets,\r\n        Protocol,\r\n        Action,\r\n        SourceIP,\r\n        SourcePort,\r\n        DestinationIP,\r\n        DestinationPort,\r\n        SyslogTarget,\r\n        SyslogClass,\r\n        SyslogMessage\r\n};\r\nCiscoSyslogFW6LogSummary_view",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "CiscoSyslogFW6LogSummary"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId2'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName2')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
                "contentId": "[variables('_parserContentId2')]",
                "kind": "Parser",
                "version": "[variables('parserVersion2')]",
                "source": {
                  "name": "Cisco SD-WAN",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName2')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "CiscoSyslogFW6LogSummary",
        "category": "Samples",
        "functionAlias": "CiscoSyslogFW6LogSummary",
        "query": "\nlet CiscoSyslogFW6LogSummary_view = view() {\r\n    Syslog\r\n    | where SyslogMessage has \"%FW-6-LOG_SUMMARY:\"\r\n    | extend FieldList = extract_all(@\"\\S{3}\\s+\\d{1,2}\\s[^\\s]+\\s%(?P<type>[^:\\s]+).*TS:\\d+\\s%(?P<sub_type>[^:\\s]+)[^\\d]+(?P<packets>\\d+)\\s(?P<protocol>\\w+).*\\s(?P<action>\\w+)\\sfrom\\s[^\\s]+\\s(?P<src_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<src_port>\\d{1,5})[^\\d]+(?P<dest_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<dest_port>\\d{1,5}).*\\(target:class\\)-\\((?P<target>[^\\s\\)\\(:]+)\\:(?P<class>[^\\s\\:\\)]+)\", dynamic(['type', 'sub_type', 'packets', 'protocol', 'action', 'src_ip', 'src_port', 'dest_ip', 'dest_port', 'target', 'class']), SyslogMessage)\r\n    | extend\r\n        SyslogType = tostring(FieldList[0][0]),\r\n        SyslogSubType = tostring(FieldList[0][1]),\r\n        Packets = tostring(FieldList[0][2]),\r\n        Protocol = tostring(FieldList[0][3]),\r\n        Action = tostring(FieldList[0][4]),\r\n        SourceIP = tostring(FieldList[0][5]),\r\n        SourcePort = tostring(FieldList[0][6]),\r\n        DestinationIP = tostring(FieldList[0][7]),\r\n        DestinationPort = tostring(FieldList[0][8]),\r\n        SyslogTarget = tostring(FieldList[0][9]),\r\n        SyslogClass = tostring(FieldList[0][10])\r\n    | extend \r\n        EventVendor=\"CiscoSD-WAN\",\r\n        EventProduct=\"Syslog_FW-6-LOG_SUMMARY\"\r\n    | project \r\n        EventVendor,\r\n        EventProduct,\r\n        Host = HostName,\r\n        TimeGenerated=EventTime,\r\n        SyslogType,\r\n        SyslogSubType,\r\n        Packets,\r\n        Protocol,\r\n        Action,\r\n        SourceIP,\r\n        SourcePort,\r\n        DestinationIP,\r\n        DestinationPort,\r\n        SyslogTarget,\r\n        SyslogClass,\r\n        SyslogMessage\r\n};\r\nCiscoSyslogFW6LogSummary_view",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId2'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId2')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
        "contentId": "[variables('_parserContentId2')]",
        "kind": "Parser",
        "version": "[variables('parserVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco SD-WAN",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Cisco Systems",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cisco Systems",
          "email": "support@cisco.com",
          "tier": "Partner",
          "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "CiscoSyslogUTD Data Parser with template",
        "displayName": "CiscoSyslogUTD Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName3'),'/',variables('parserVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "CiscoSyslogUTD Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName3')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "CiscoSyslogUTD",
                "category": "Samples",
                "functionAlias": "CiscoSyslogUTD",
                "query": "\nlet CiscoSyslogUTD_view = view() {\r\n    Syslog\r\n    | where SyslogMessage matches regex @\"\\[\\*\\*\\].*\\[\\*\\*\\].*\\[\\*\\*\\][^-]*.*->\"\r\n    | extend FieldList = extract_all(@\"]\\s(?P<action>[^\\s[]*)\\s\\[\\S*\\s[^{]*{(?P<protocol>[^\\s}]*)}\\s(?P<src_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<src_port>\\d{1,5})\\s->\\s(?P<dest_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<dest_port>\\d{1,5})\", dynamic(['action', 'protocol', 'src_ip', 'src_port', 'dest_ip', 'dest_port']), SyslogMessage)\r\n    | extend\r\n        Action = tostring(FieldList[0][0]),\r\n        Protocol = tostring(FieldList[0][1]),\r\n        SourceIP = tostring(FieldList[0][2]),\r\n        SourcePort = tostring(FieldList[0][3]),\r\n        DestinationIP = tostring(FieldList[0][4]),\r\n        DestinationPort = tostring(FieldList[0][5])\r\n    | extend UTDWebfilter = extract(@\"\\sUTD\\sWebFilter\\s(?P<utd_webfilter>[^\\s]*)\", 1, SyslogMessage)\r\n    | extend SignatureId = replace_string(extract(@\"\\[(?P<raw_signature_id>\\d+\\:\\d+)\\:\\d+\\]\",1,SyslogMessage),':','-')\r\n    | extend FileInspectionLogs = extract(@\"UTD\\sAMP\\sDISPOSITION\\s(?P<utd_amp_disposition>[^\\s]*)\\s\", 1, SyslogMessage)\r\n    | extend BracketData = SyslogMessage \r\n    | extend NonBracketData = SyslogMessage\r\n    | extend \r\n        EventVendor=\"CiscoSD-WAN\",\r\n        EventProduct=\"Syslog_UTD\"\r\n    | project\r\n        EventVendor,\r\n        EventProduct,\r\n        Host = HostName,\r\n        TimeGenerated = EventTime,\r\n        Action,\r\n        Protocol,\r\n        SourceIP,\r\n        SourcePort,\r\n        DestinationIP,\r\n        DestinationPort,\r\n        UTDWebfilter,\r\n        FileInspectionLogs,\r\n        BracketData,\r\n        NonBracketData,\r\n        SignatureId,\r\n        SyslogMessage\r\n    | parse-kv BracketData as (['Hostname'] : string, ['System_IP']: string, ['Instance_ID']: string, ['Classification']: string, ['Priority']: string, ['POLICY']: string, ['URL']: string, ['Category']: string, ['Reputation']: string) with (regex=@\"\\s\\[([^\\[\\]:]*):\\s([^\\]]*)\\]\")\r\n    | project-away BracketData\r\n    | parse-kv NonBracketData as (['SHA']: string, ['Malware']: string, ['Filename']: string, ['Filetype']: string) with (regex=@\"[\\s|\\{]([\\w.:\\/]+):\\s([\\w.]*)\")\r\n    | project-away NonBracketData\r\n};\r\nCiscoSyslogUTD_view",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "CiscoSyslogUTD"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId3'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName3')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
                "contentId": "[variables('_parserContentId3')]",
                "kind": "Parser",
                "version": "[variables('parserVersion3')]",
                "source": {
                  "name": "Cisco SD-WAN",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName3')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "CiscoSyslogUTD",
        "category": "Samples",
        "functionAlias": "CiscoSyslogUTD",
        "query": "\nlet CiscoSyslogUTD_view = view() {\r\n    Syslog\r\n    | where SyslogMessage matches regex @\"\\[\\*\\*\\].*\\[\\*\\*\\].*\\[\\*\\*\\][^-]*.*->\"\r\n    | extend FieldList = extract_all(@\"]\\s(?P<action>[^\\s[]*)\\s\\[\\S*\\s[^{]*{(?P<protocol>[^\\s}]*)}\\s(?P<src_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<src_port>\\d{1,5})\\s->\\s(?P<dest_ip>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}):(?P<dest_port>\\d{1,5})\", dynamic(['action', 'protocol', 'src_ip', 'src_port', 'dest_ip', 'dest_port']), SyslogMessage)\r\n    | extend\r\n        Action = tostring(FieldList[0][0]),\r\n        Protocol = tostring(FieldList[0][1]),\r\n        SourceIP = tostring(FieldList[0][2]),\r\n        SourcePort = tostring(FieldList[0][3]),\r\n        DestinationIP = tostring(FieldList[0][4]),\r\n        DestinationPort = tostring(FieldList[0][5])\r\n    | extend UTDWebfilter = extract(@\"\\sUTD\\sWebFilter\\s(?P<utd_webfilter>[^\\s]*)\", 1, SyslogMessage)\r\n    | extend SignatureId = replace_string(extract(@\"\\[(?P<raw_signature_id>\\d+\\:\\d+)\\:\\d+\\]\",1,SyslogMessage),':','-')\r\n    | extend FileInspectionLogs = extract(@\"UTD\\sAMP\\sDISPOSITION\\s(?P<utd_amp_disposition>[^\\s]*)\\s\", 1, SyslogMessage)\r\n    | extend BracketData = SyslogMessage \r\n    | extend NonBracketData = SyslogMessage\r\n    | extend \r\n        EventVendor=\"CiscoSD-WAN\",\r\n        EventProduct=\"Syslog_UTD\"\r\n    | project\r\n        EventVendor,\r\n        EventProduct,\r\n        Host = HostName,\r\n        TimeGenerated = EventTime,\r\n        Action,\r\n        Protocol,\r\n        SourceIP,\r\n        SourcePort,\r\n        DestinationIP,\r\n        DestinationPort,\r\n        UTDWebfilter,\r\n        FileInspectionLogs,\r\n        BracketData,\r\n        NonBracketData,\r\n        SignatureId,\r\n        SyslogMessage\r\n    | parse-kv BracketData as (['Hostname'] : string, ['System_IP']: string, ['Instance_ID']: string, ['Classification']: string, ['Priority']: string, ['POLICY']: string, ['URL']: string, ['Category']: string, ['Reputation']: string) with (regex=@\"\\s\\[([^\\[\\]:]*):\\s([^\\]]*)\\]\")\r\n    | project-away BracketData\r\n    | parse-kv NonBracketData as (['SHA']: string, ['Malware']: string, ['Filename']: string, ['Filetype']: string) with (regex=@\"[\\s|\\{]([\\w.:\\/]+):\\s([\\w.]*)\")\r\n    | project-away NonBracketData\r\n};\r\nCiscoSyslogUTD_view",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId3'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId3')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
        "contentId": "[variables('_parserContentId3')]",
        "kind": "Parser",
        "version": "[variables('parserVersion3')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco SD-WAN",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Cisco Systems",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cisco Systems",
          "email": "support@cisco.com",
          "tier": "Partner",
          "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2022-02-01",
      "name": "[variables('parserTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "MapNetflowUsername Data Parser with template",
        "displayName": "MapNetflowUsername Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2022-02-01",
      "name": "[concat(variables('parserTemplateSpecName4'),'/',variables('parserVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "MapNetflowUsername Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName4')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "MapNetflowUsername",
                "category": "Samples",
                "functionAlias": "MapNetflowUsername",
                "query": "\nCiscoSyslogUTD\r\n| join (\r\nCiscoSDWANNetflow\r\n| where isnotempty(NetflowUsername)\r\n| summarize arg_max(TimeStamp, NetflowUsername) by NetflowFwSrcAddrIpv4\r\n| distinct \r\n    [\"Username\"] = NetflowUsername,\r\n    [\"SourceIP\"] = NetflowFwSrcAddrIpv4) on SourceIP\r\n    | distinct SourceIP, Username",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "MapNetflowUsername"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId4'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName4')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
                "contentId": "[variables('_parserContentId4')]",
                "kind": "Parser",
                "version": "[variables('parserVersion4')]",
                "source": {
                  "name": "Cisco SD-WAN",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Cisco Systems",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Cisco Systems",
                  "email": "support@cisco.com",
                  "tier": "Partner",
                  "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName4')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "MapNetflowUsername",
        "category": "Samples",
        "functionAlias": "MapNetflowUsername",
        "query": "\nCiscoSyslogUTD\r\n| join (\r\nCiscoSDWANNetflow\r\n| where isnotempty(NetflowUsername)\r\n| summarize arg_max(TimeStamp, NetflowUsername) by NetflowFwSrcAddrIpv4\r\n| distinct \r\n    [\"Username\"] = NetflowUsername,\r\n    [\"SourceIP\"] = NetflowFwSrcAddrIpv4) on SourceIP\r\n    | distinct SourceIP, Username",
        "version": 1
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId4'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId4')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
        "contentId": "[variables('_parserContentId4')]",
        "kind": "Parser",
        "version": "[variables('parserVersion4')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco SD-WAN",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Cisco Systems",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cisco Systems",
          "email": "support@cisco.com",
          "tier": "Partner",
          "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco SD-WAN",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Cisco Systems",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Cisco Systems",
          "email": "support@cisco.com",
          "tier": "Partner",
          "link": "https://globalcontacts.cloudapps.cisco.com/contacts/contactDetails/en_US/c1o1-c2o2-c3o8"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CiscoSDWANIntrusionLogicAPP')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CiscoSDWANLogicAPP')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_CiscoSDWANReport')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId2')]",
              "version": "[variables('parserVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId3')]",
              "version": "[variables('parserVersion3')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId4')]",
              "version": "[variables('parserVersion4')]"
            }
          ]
        },
        "firstPublishDate": "2023-06-01",
        "lastPublishDate": "2024-06-01",
        "providers": [
          "Cisco"
        ],
        "categories": {
          "domains": [
            "Security - Network",
            "Security - Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
