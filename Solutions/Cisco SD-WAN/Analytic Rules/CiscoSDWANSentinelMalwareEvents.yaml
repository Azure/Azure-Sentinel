id: cb14defd-3415-4420-a2e4-2dd0f3e07a86
name: Cisco SDWAN - Maleware Events
description: |
  'This analytic rule will monitor Malware Events in Syslog and Netflow Data'
severity: High
status: Available
requiredDataConnectors:
  - connectorId: CiscoSDWAN
    dataTypes:
      - CiscoSyslogUTD
  - connectorId: CiscoSDWAN
    dataTypes:
      - CiscoSDWANNetflow
queryFrequency: 3h
queryPeriod: 3h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - Discovery
query: |
  CiscoSyslogUTD
  | where isnotempty(Malware) and Malware != "None"
  | distinct Malware, SourceIP
  | join kind=inner (CiscoSDWANNetflow
  | where isnotempty(NetflowUsername)
  | summarize arg_max(TimeStamp, NetflowUsername) by NetflowFwSrcAddrIpv4
  | distinct 
      ["Username"] = NetflowUsername,
      ["SourceIP"] = NetflowFwSrcAddrIpv4) on SourceIP
  | project Malware, SourceIP, Username
incidentConfiguration:
  createIncident: true
eventGroupingSettings:
    aggregationKind: AlertPerResult
customDetails:
  "mal_malware": "Malware"
  "mal_src_ip": "SourceIP"
  "mal_username": "Username"
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
  - entityType: Malware
    fieldMappings:
      - identifier: Name
        columnName: Malware
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: Username
version: 1.0.0
kind: Scheduled