{
  "name": "MorphisecDCR",
  "apiVersion": "2023-04-01-preview",
  "type": "Microsoft.Insights/dataCollectionRules",
  "location": "{{location}}",
  "properties": {
    "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "streamDeclarations": {
      "Custom-MorphisecAlerts_CL": {
        "columns": [
          {
            "name": "action",
            "type": "string"
          },
          {
            "name": "application",
            "type": "string"
          },
          {
            "name": "applicationPath",
            "type": "string"
          },
          {
            "name": "attackModule",
            "type": "string"
          },
          {
            "name": "attackSeverity",
            "type": "string"
          },
          {
            "name": "classification",
            "type": "string"
          },
          {
            "name": "defenderDescription",
            "type": "dynamic"
          },
          {
            "name": "defenderId",
            "type": "string"
          },
          {
            "name": "description",
            "type": "string"
          },
          {
            "name": "detectionDescription",
            "type": "string"
          },
          {
            "name": "detectionEngineVersion",
            "type": "dynamic"
          },
          {
            "name": "detectionName",
            "type": "string"
          },
          {
            "name": "detectionPath",
            "type": "dynamic"
          },
          {
            "name": "engine",
            "type": "string"
          },
          {
            "name": "filePath",
            "type": "string"
          },
          {
            "name": "hostname",
            "type": "string"
          },
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "kernel",
            "type": "string"
          },
          {
            "name": "mitreClassification",
            "type": "dynamic"
          },
          {
            "name": "name",
            "type": "string"
          },
          {
            "name": "numberOfAttacks",
            "type": "dynamic"
          },
          {
            "name": "operatingSystem",
            "type": "string"
          },
          {
            "name": "parentProcessCommandLine",
            "type": "string"
          },
          {
            "name": "parentProcessSignature",
            "type": "string"
          },
          {
            "name": "path",
            "type": "dynamic"
          },
          {
            "name": "processCommandLine",
            "type": "string"
          },
          {
            "name": "processCommandLineArgs",
            "type": "dynamic"
          },
          {
            "name": "processSignature",
            "type": "string"
          },
          {
            "name": "protectorId",
            "type": "string"
          },
          {
            "name": "reviewStatus",
            "type": "string"
          },
          {
            "name": "signature",
            "type": "string"
          },
          {
            "name": "subClassification",
            "type": "string"
          },
          {
            "name": "threatMessageArrivalTime",
            "type": "datetime"
          },
          {
            "name": "threatModule",
            "type": "string"
          },
          {
            "name": "threatSubType",
            "type": "string"
          },
          {
            "name": "threatTime",
            "type": "datetime"
          },
          {
            "name": "threatType",
            "type": "string"
          },
          {
            "name": "TimeGenerated",
            "type": "datetime"
          },
          {
            "name": "url",
            "type": "dynamic"
          },
          {
            "name": "user",
            "type": "string"
          },
          {
            "name": "metadataProtectorVersion",
            "type": "string"
          }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "{{workspaceResourceId}}]",
          "name": "clv2ws2"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-MorphisecAlerts_CL"
        ],
        "destinations": [
          "clv2ws2"
        ],
        "transformKql": "source | where threatSubType != \"DEFENDER\" | extend TimeGenerated = now()",
        "outputStream": "Custom-MorphisecAlerts_CL"
      }
    ]
  }
}
