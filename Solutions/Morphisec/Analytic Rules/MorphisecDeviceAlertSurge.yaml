id: 5c8e1f2e-9d6b-4f4a-8f3e-123456789abc
name: Device Alert Surge
description: |
  'Triggers an incident when a device generates 5 or more Medium or High severity alerts, indicating potential compromise.'
severity: High
status: Available
requiredDataConnectors:
  - connectorId: MorphisecCCF
    dataTypes:
      - Morphisec
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
suppressionDuration: 5h
suppressionEnabled: false
tactics:
  - Execution
  - DefenseEvasion
relevantTechniques:
  - T1059
  - T1204
query: |
  MorphisecAlerts_CL
  | where threatMessageArrivalTime >= ago(1h)
  | where attackSeverity in ("HIGH", "MEDIUM")
  | summarize arg_max(threatMessageArrivalTime, *) by id
  | summarize AlertCount = dcount(id) by hostname
  | where AlertCount >= 5
entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: hostname
eventGroupingSettings:
  aggregationKind: SingleAlert
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: false
    reopenClosedIncident: false
    lookbackDuration: 1h
    matchingMethod: AllEntities
    groupByEntities:
      - Host
    groupByAlertDetails:
      - DisplayName
alertDetailsOverride:
  alertDisplayNameFormat: "Device alert surge detected: {{hostname}}"
  alertDescriptionFormat: "Device {{hostname}} triggered {{AlertCount}} distinct High/Medium alerts within the last hour."
version: 1.0.0
kind: Scheduled

