{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "VMware by Broadcom",
    "comments": "Solution template for VMware SASE"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "VMware SD-WAN and SASE",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "VMware SASE",
    "_solutionVersion": "3.0.0",
    "solutionId": "velocloud.azure-sentinel-solution-vmwaresase",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "VMwareSDWAN",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "VMwareSDWAN",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "VMwareSDWAN",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "b26a7d97-6b6e-43ab-870e-eb18460ae602",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b26a7d97-6b6e-43ab-870e-eb18460ae602')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b26a7d97-6b6e-43ab-870e-eb18460ae602')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b26a7d97-6b6e-43ab-870e-eb18460ae602','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "3efebd49-c985-431b-9da8-d7d397092d18",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '3efebd49-c985-431b-9da8-d7d397092d18')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('3efebd49-c985-431b-9da8-d7d397092d18')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','3efebd49-c985-431b-9da8-d7d397092d18','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "b84a1f62-ad30-4ae1-8b21-3d304d8aa818",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b84a1f62-ad30-4ae1-8b21-3d304d8aa818')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b84a1f62-ad30-4ae1-8b21-3d304d8aa818')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b84a1f62-ad30-4ae1-8b21-3d304d8aa818','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "d811ef72-66b9-43a3-ba29-cd9e4bf75b74",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'd811ef72-66b9-43a3-ba29-cd9e4bf75b74')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('d811ef72-66b9-43a3-ba29-cd9e4bf75b74')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','d811ef72-66b9-43a3-ba29-cd9e4bf75b74','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "a88ead0a-f022-48d6-8f53-e5a164c4c72e",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'a88ead0a-f022-48d6-8f53-e5a164c4c72e')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('a88ead0a-f022-48d6-8f53-e5a164c4c72e')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','a88ead0a-f022-48d6-8f53-e5a164c4c72e','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "44f78dbf-9f29-4ec0-aaca-ab5bf0b559af",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '44f78dbf-9f29-4ec0-aaca-ab5bf0b559af')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('44f78dbf-9f29-4ec0-aaca-ab5bf0b559af')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','44f78dbf-9f29-4ec0-aaca-ab5bf0b559af','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.0",
      "_analyticRulecontentId7": "a8e2bfd2-5d9c-4acc-aa55-30029e50d574",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'a8e2bfd2-5d9c-4acc-aa55-30029e50d574')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('a8e2bfd2-5d9c-4acc-aa55-30029e50d574')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','a8e2bfd2-5d9c-4acc-aa55-30029e50d574','-', '1.0.0')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "6364be84-9f13-4fd8-8b4a-8ccb43a89376",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6364be84-9f13-4fd8-8b4a-8ccb43a89376')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6364be84-9f13-4fd8-8b4a-8ccb43a89376')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6364be84-9f13-4fd8-8b4a-8ccb43a89376','-', '1.0.0')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.0",
      "_analyticRulecontentId9": "27553108-4aaf-4a3e-8ecd-5439d820d474",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '27553108-4aaf-4a3e-8ecd-5439d820d474')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('27553108-4aaf-4a3e-8ecd-5439d820d474')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','27553108-4aaf-4a3e-8ecd-5439d820d474','-', '1.0.0')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.0",
      "_analyticRulecontentId10": "ce207901-ed7b-49ae-ada7-033e1fbb1240",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ce207901-ed7b-49ae-ada7-033e1fbb1240')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ce207901-ed7b-49ae-ada7-033e1fbb1240')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ce207901-ed7b-49ae-ada7-033e1fbb1240','-', '1.0.0')))]"
    },
    "analyticRuleObject11": {
      "analyticRuleVersion11": "1.0.0",
      "_analyticRulecontentId11": "69c0644f-4ad5-41b6-9e09-a94c072ab80e",
      "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '69c0644f-4ad5-41b6-9e09-a94c072ab80e')]",
      "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('69c0644f-4ad5-41b6-9e09-a94c072ab80e')))]",
      "_analyticRulecontentProductId11": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','69c0644f-4ad5-41b6-9e09-a94c072ab80e','-', '1.0.0')))]"
    },
    "analyticRuleObject12": {
      "analyticRuleVersion12": "1.0.0",
      "_analyticRulecontentId12": "8d05cc90-d337-41f5-b5fa-614cbfe1a879",
      "analyticRuleId12": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '8d05cc90-d337-41f5-b5fa-614cbfe1a879')]",
      "analyticRuleTemplateSpecName12": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('8d05cc90-d337-41f5-b5fa-614cbfe1a879')))]",
      "_analyticRulecontentProductId12": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','8d05cc90-d337-41f5-b5fa-614cbfe1a879','-', '1.0.0')))]"
    },
    "analyticRuleObject13": {
      "analyticRuleVersion13": "1.0.0",
      "_analyticRulecontentId13": "50c86f92-86b0-4ae3-bb94-698da076ca9e",
      "analyticRuleId13": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '50c86f92-86b0-4ae3-bb94-698da076ca9e')]",
      "analyticRuleTemplateSpecName13": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('50c86f92-86b0-4ae3-bb94-698da076ca9e')))]",
      "_analyticRulecontentProductId13": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','50c86f92-86b0-4ae3-bb94-698da076ca9e','-', '1.0.0')))]"
    },
    "analyticRuleObject14": {
      "analyticRuleVersion14": "1.0.0",
      "_analyticRulecontentId14": "840b050f-842b-4264-8973-d4f9b65facb5",
      "analyticRuleId14": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '840b050f-842b-4264-8973-d4f9b65facb5')]",
      "analyticRuleTemplateSpecName14": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('840b050f-842b-4264-8973-d4f9b65facb5')))]",
      "_analyticRulecontentProductId14": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','840b050f-842b-4264-8973-d4f9b65facb5','-', '1.0.0')))]"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "c514ecc9-fa74-4977-976b-847895ee7e71",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('c514ecc9-fa74-4977-976b-847895ee7e71')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VMware SASE data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "VMware SD-WAN and SASE Connector (using Azure Functions)",
                  "publisher": "VMware by Broadcom",
                  "descriptionMarkdown": "The [VMware SD-WAN & SASE](https://sase.vmware.com) data connector offers the capability to ingest VMware SD-WAN and CWS events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://developer.vmware.com/apis/vmware-sase-platform/) for more information. The connector provides ability to get events which helps to examine potential network security issues, identify misconfigured network devices and monitor SD-WAN and SASE usage. If you have your own custom connector, make sure that the connector is deployed under an isolated Log Analytics Workspace first. In case of issues, questions or feature requests, please contact us via email on sase-siem-integration@vmware.com.",
                  "graphQueries": [
                    {
                      "metricName": "Function App - VECO Event Logs ingested",
                      "legend": "VMware_VECO_EventLogs_CL",
                      "baseQuery": "let min_t = toscalar(VMware_VECO_EventLogs_CL | summarize min(TimeGenerated));\nlet max_t = toscalar(VMware_VECO_EventLogs_CL | summarize max(TimeGenerated));\nVMware_VECO_EventLogs_CL\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h\n| render areachart with(title=\"VECO Event Log ingestion\")"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "SD-WAN API Events - All captured events",
                      "query": "VMware_VECO_EventLogs_CL\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "VMware_VECO_EventLogs_CL",
                      "lastDataReceivedQuery": "VMware_VECO_EventLogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "VMware_CWS_Weblogs_CL",
                      "lastDataReceivedQuery": "VMware_CWS_Weblogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "VMware_CWS_Health_CL",
                      "lastDataReceivedQuery": "VMware_CWS_Health_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "VMware_CWS_DLPLogs_CL",
                      "lastDataReceivedQuery": "VMware_CWS_DLPLogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "VMware_VECO_EventLogs_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "REST API Credentials/permissions",
                        "description": "**api_veco_authorization**, **api_veco_fqdn** is required for REST API. [See the documentation to learn more about VMware SASE APIs](https://developer.vmware.com/apis/vmware-sase-platform/). Check all [requirements and follow  the instructions](https://docs.vmware.com/en/VMware-SD-WAN/5.3/VMware-SD-WAN-Administration-Guide/GUID-2FA3763F-835C-4D10-A32B-450FEB5397D8.html) for obtaining credentials. The Function App only supports token-based API authentication. Be advised that the API Token generated will inherit the access rights of the user account under which it was generated."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to the VMware Edge Cloud Orchestrator REST API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": "**STEP 1 - Configuration steps for the VECO API**\n\n [Follow the instructions](https://docs.vmware.com/en/VMware-SD-WAN/5.3/VMware-SD-WAN-Administration-Guide/GUID-2FA3763F-835C-4D10-A32B-450FEB5397D8.html) to create and obtain the credentials. \n"
                    },
                    {
                      "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function.**"
                    },
                    {
                      "description": "Use this method for automated deployment of the VMware SD-WAN and SASE Connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinelvmwaresdwan)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**.\n3. Enter or modify the Function App, Log Analytics and Azure Monitor settings, enter the VECO FQDN (without https://, for example vco123-usvi1.velocloud.net), enter the API token created (including \"Token \" at the beginning of the string), and adjust your desired Function App freaquency, then deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                      "title": "Option 1 - Azure Resource Manager (ARM) Template"
                    },
                    {
                      "description": "Use the following step-by-step instructions to deploy the VMware SD-WAN and SASE Connector manually with Azure Functions (Deployment via Visual Studio Code).",
                      "title": "Option 2 - Manual Deployment of Azure Functions"
                    },
                    {
                      "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-vmwaresdwan-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. vmwsase-siemXXXXXXXXXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.10.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
                    },
                    {
                      "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab .\n3. Check if the application has these settings defined correctly and adjust if needed: \n\t\tapi_veco_authorization\n\t\tapi_veco_fqdn\n\t\tapp_frequency_mins\n\t\tazsa_share_connectionstring\n\t\tazsa_share_name dce_endpoint\n\t\tdcr_cwsdlplog_immutableid\n\t\tdcr_cwshealth_immutableid\n\t\tdcr_cwsweblog_immutableid\n\t\tdcr_efsfwlog_immutableid\n\t\tdcr_efshealth_immutableid\n\t\tdcr_saseaudit_immutableid\n\t\tstream_cwsdlplog\n\t\tstream_cwshealth\n\t\tstream_cwsweblog\n\t\tstream_efsfwlog\n\t\tstream_efshealth\n\t\tstream_saseaudit\n3. In case you made changes to application settings have been entered, make sure that you click **Save**."
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "VMware SD-WAN and SASE Connector (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "VMware SASE",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "VMware by Broadcom"
        },
        "support": {
          "name": "VMware by Broadcom",
          "tier": "Partner",
          "email": "sase-siem-integration@vmware.com",
          "link": "https://developer.vmware.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "VMware SD-WAN and SASE Connector (using Azure Functions)",
          "publisher": "VMware by Broadcom",
          "descriptionMarkdown": "The [VMware SD-WAN & SASE](https://sase.vmware.com) data connector offers the capability to ingest VMware SD-WAN and CWS events into Microsoft Sentinel through the REST API. Refer to [API documentation](https://developer.vmware.com/apis/vmware-sase-platform/) for more information. The connector provides ability to get events which helps to examine potential network security issues, identify misconfigured network devices and monitor SD-WAN and SASE usage. If you have your own custom connector, make sure that the connector is deployed under an isolated Log Analytics Workspace first. In case of issues, questions or feature requests, please contact us via email on sase-siem-integration@vmware.com.",
          "graphQueries": [
            {
              "metricName": "Function App - VECO Event Logs ingested",
              "legend": "VMware_VECO_EventLogs_CL",
              "baseQuery": "let min_t = toscalar(VMware_VECO_EventLogs_CL | summarize min(TimeGenerated));\nlet max_t = toscalar(VMware_VECO_EventLogs_CL | summarize max(TimeGenerated));\nVMware_VECO_EventLogs_CL\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h\n| render areachart with(title=\"VECO Event Log ingestion\")"
            }
          ],
          "dataTypes": [
            {
              "name": "VMware_VECO_EventLogs_CL",
              "lastDataReceivedQuery": "VMware_VECO_EventLogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "VMware_CWS_Weblogs_CL",
              "lastDataReceivedQuery": "VMware_CWS_Weblogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "VMware_CWS_Health_CL",
              "lastDataReceivedQuery": "VMware_CWS_Health_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "VMware_CWS_DLPLogs_CL",
              "lastDataReceivedQuery": "VMware_CWS_DLPLogs_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "VMware_VECO_EventLogs_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "SD-WAN API Events - All captured events",
              "query": "VMware_VECO_EventLogs_CL\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "REST API Credentials/permissions",
                "description": "**api_veco_authorization**, **api_veco_fqdn** is required for REST API. [See the documentation to learn more about VMware SASE APIs](https://developer.vmware.com/apis/vmware-sase-platform/). Check all [requirements and follow  the instructions](https://docs.vmware.com/en/VMware-SD-WAN/5.3/VMware-SD-WAN-Administration-Guide/GUID-2FA3763F-835C-4D10-A32B-450FEB5397D8.html) for obtaining credentials. The Function App only supports token-based API authentication. Be advised that the API Token generated will inherit the access rights of the user account under which it was generated."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to the VMware Edge Cloud Orchestrator REST API to pull its logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": "**STEP 1 - Configuration steps for the VECO API**\n\n [Follow the instructions](https://docs.vmware.com/en/VMware-SD-WAN/5.3/VMware-SD-WAN-Administration-Guide/GUID-2FA3763F-835C-4D10-A32B-450FEB5397D8.html) to create and obtain the credentials. \n"
            },
            {
              "description": "**STEP 2 - Choose ONE from the following two deployment options to deploy the connector and the associated Azure Function.**"
            },
            {
              "description": "Use this method for automated deployment of the VMware SD-WAN and SASE Connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinelvmwaresdwan)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**.\n3. Enter or modify the Function App, Log Analytics and Azure Monitor settings, enter the VECO FQDN (without https://, for example vco123-usvi1.velocloud.net), enter the API token created (including \"Token \" at the beginning of the string), and adjust your desired Function App freaquency, then deploy. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
              "title": "Option 1 - Azure Resource Manager (ARM) Template"
            },
            {
              "description": "Use the following step-by-step instructions to deploy the VMware SD-WAN and SASE Connector manually with Azure Functions (Deployment via Visual Studio Code).",
              "title": "Option 2 - Manual Deployment of Azure Functions"
            },
            {
              "description": "**1. Deploy a Function App**\n\n> **NOTE:** You will need to [prepare VS code](https://docs.microsoft.com/azure/azure-functions/functions-create-first-function-python#prerequisites) for Azure function development.\n\n1. Download the [Azure Function App](https://aka.ms/sentinel-vmwaresdwan-functionapp) file. Extract archive to your local development computer.\n2. Start VS Code. Choose File in the main menu and select Open Folder.\n3. Select the top level folder from extracted files.\n4. Choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose the **Deploy to function app** button.\nIf you aren't already signed in, choose the Azure icon in the Activity bar, then in the **Azure: Functions** area, choose **Sign in to Azure**\nIf you're already signed in, go to the next step.\n5. Provide the following information at the prompts:\n\n\ta. **Select folder:** Choose a folder from your workspace or browse to one that contains your function app.\n\n\tb. **Select Subscription:** Choose the subscription to use.\n\n\tc. Select **Create new Function App in Azure** (Don't choose the Advanced option)\n\n\td. **Enter a globally unique name for the function app:** Type a name that is valid in a URL path. The name you type is validated to make sure that it's unique in Azure Functions. (e.g. vmwsase-siemXXXXXXXXXXXXX).\n\n\te. **Select a runtime:** Choose Python 3.10.\n\n\tf. Select a location for new resources. For better performance and lower costs choose the same [region](https://azure.microsoft.com/regions/) where Microsoft Sentinel is located.\n\n6. Deployment will begin. A notification is displayed after your function app is created and the deployment package is applied.\n7. Go to Azure Portal for the Function App configuration."
            },
            {
              "description": "**2. Configure the Function App**\n\n1. In the Function App, select the Function App Name and select **Configuration**.\n2. In the **Application settings** tab .\n3. Check if the application has these settings defined correctly and adjust if needed: \n\t\tapi_veco_authorization\n\t\tapi_veco_fqdn\n\t\tapp_frequency_mins\n\t\tazsa_share_connectionstring\n\t\tazsa_share_name dce_endpoint\n\t\tdcr_cwsdlplog_immutableid\n\t\tdcr_cwshealth_immutableid\n\t\tdcr_cwsweblog_immutableid\n\t\tdcr_efsfwlog_immutableid\n\t\tdcr_efshealth_immutableid\n\t\tdcr_saseaudit_immutableid\n\t\tstream_cwsdlplog\n\t\tstream_cwshealth\n\t\tstream_cwsweblog\n\t\tstream_efsfwlog\n\t\tstream_efshealth\n\t\tstream_saseaudit\n3. In case you made changes to application settings have been entered, make sure that you click **Save**."
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VMwareSASESOCDashboard Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This workbook is intended to provide an overview on security events on VMware SD-WAN and Cloud Web Security."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## VMware SD-WAN and SASE SOC Dashboard\\n---\\n\\nThis Dashboard provides valuable insights into the security operations center (SOC) by tracking key metrics and threat data from VMware SD-WAN and SASE solutions. This information can be used to monitor the SOC's efficiency and ensure that all security operations (detection, analysis, and response) are proceeding as planned. The workbook also provides insights into emerging threats and trends, which can be used to proactively improve the organization's security posture.\"},\"name\":\"text - 2\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# 1. Sentinel Connectivity Overview\\n\\nThis section shows connectivity from VMware SD-WAN and SASE services to Sentinel. The key deliverables are the following:\\n1. Syslog - AMA Agent connecitivity (heartbeat), volume of logs imported from AMA Agents\\n2. API calls - Function app activity, DCR/DCE activity\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(Heartbeat | summarize min(TimeGenerated));\\nlet max_t = toscalar(Heartbeat | summarize max(TimeGenerated));\\nHeartbeat\\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h by Computer\\n| render timechart with(title=\\\"Heartbeat response from AMA agents\\\")\",\"size\":1,\"aggregation\":1,\"title\":\"Heartbeat response from AMA agents\",\"color\":\"purpleDark\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"Heartbeat Activity\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(Syslog | summarize min(TimeGenerated));\\nlet max_t = toscalar(Syslog | summarize max(TimeGenerated));\\nSyslog\\n| where CollectorHostName != \\\"\\\"\\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h by CollectorHostName\\n| render areachart with(title=\\\"Syslog upload from AMA agents\\\")\",\"size\":1,\"title\":\"Syslog upload from AMA agents\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"Syslog Activity\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(Syslog | summarize min(TimeGenerated));\\nlet max_t = toscalar(Syslog | summarize max(TimeGenerated));\\nSyslog\\n| where CollectorHostName != \\\"\\\"\\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h by HostName\\n| render timechart with(title=\\\"Syslog message ingestion by Edge Appliance\\\")\",\"size\":1,\"title\":\"Syslog message ingestion by Edge Appliance\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"tileSettings\":{\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"Syslog ingestion by Edge\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(VMware_CWS_Weblogs_CL | summarize min(TimeGenerated));\\nlet max_t = toscalar(VMware_CWS_Weblogs_CL | summarize max(TimeGenerated));\\nVMware_CWS_Weblogs_CL\\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h\\n| render areachart with(title=\\\"Cloud Web Security Log ingestion\\\")\",\"size\":1,\"title\":\"Cloud Web Security Log ingestion\",\"color\":\"greenDark\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"CWS Event Ingestion by API\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"VMware SASE - Sentinel Connectivity\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# 2. VMware Cloud Web Security Overview\\n\\nVMware Cloud Web Security is a cloud-hosted service that protects users and infrastructure accessing SaaS and Internet applications from threats, offering visibility, control, and compliance. It is delivered through a global network of VMware SASE Points of Presence (PoPs) to ensure optimal access to applications.\"},\"name\":\"text - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Health_CL\\n| render timechart\",\"size\":0,\"aggregation\":3,\"title\":\"Cloud Web Security - Solution Health\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"healthtest_observed_value\"],\"seriesLabelSettings\":[{\"seriesName\":\"cwsManager_responseTime\",\"label\":\"CWS Manager Response Time\",\"color\":\"amethyst\"},{\"seriesName\":\"vni_responseTime\",\"label\":\"VNI Response Time\",\"color\":\"blueDark\"},{\"seriesName\":\"database_responseTime\",\"label\":\"CWS DB Response Time\",\"color\":\"green\"},{\"seriesName\":\"database_connection\",\"label\":\"CWS DB Query Time\",\"color\":\"magenta\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"name\":\"CWS Health metrics\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(VMware_CWS_Weblogs_CL | summarize min(TimeGenerated));\\nlet max_t = toscalar(VMware_CWS_Weblogs_CL | summarize max(TimeGenerated));\\nVMware_CWS_Weblogs_CL\\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h by action\\n| render areachart with(title=\\\"Cloud Web Security events by Action\\\")\",\"size\":0,\"title\":\"Cloud Web Security events by Action\",\"color\":\"blueDark\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"allow\",\"label\":\"Allow\",\"color\":\"grayBlue\"},{\"seriesName\":\"block\",\"label\":\"Block\",\"color\":\"orangeDark\"},{\"seriesName\":\"sslbump_bypass\",\"label\":\"SSL Inspection Bypass\",\"color\":\"magenta\"}]}},\"customWidth\":\"50\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(VMware_CWS_Weblogs_CL | summarize min(TimeGenerated));\\nlet max_t = toscalar(VMware_CWS_Weblogs_CL | summarize max(TimeGenerated));\\nVMware_CWS_Weblogs_CL\\n| make-series num=count() default=0 on TimeGenerated from min_t to max_t step 1h by userAgent\\n| render areachart with(title=\\\"Access activity by user agents\\\")\",\"size\":0,\"title\":\"Connectivity Events by Agents\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"Connectivity by Agent type\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL\\n| summarize hitcount = count() by region\\n| sort by hitcount\\n| render barchart with(title=\\\"Cloud Web Security SASE POP Utilization\\\")\",\"size\":0,\"title\":\"CWS -SASE POP Utilization\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"DE\",\"color\":\"grayBlue\"},{\"seriesName\":\"US\",\"color\":\"blue\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"name\":\"CWS -SASE POP Utilization\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL\\n| summarize siterisk = count() by webRiskScore\\n| sort by siterisk\\n| render piechart with(title=\\\"Cloud Web Security Website Risks\\\")\",\"size\":0,\"title\":\"URLF -  Website Risk scores\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"G\",\"label\":\"Green/Low Risk\",\"color\":\"green\"},{\"seriesName\":\"Y\",\"label\":\"Yellow/Medium Risk\",\"color\":\"yellow\"},{\"seriesName\":\"R\",\"label\":\"Red/High Risk\",\"color\":\"redBright\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"25\",\"name\":\"CWS Website Categories - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL \\n| where threatTypes != \\\"\\\"\\n| summarize hitcount = count() by tostring(threatTypes)\",\"size\":0,\"title\":\"URLF - Risk Categories\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"threatTypes\",\"label\":\"Threat Type\"},{\"columnId\":\"hitcount\",\"label\":\"Hit Count\"}]}},\"customWidth\":\"25\",\"name\":\"Risk Category Overview\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL \\n| where threatTypes != \\\"\\\"\\n| summarize hitcount = count() by sourceIp\",\"size\":0,\"title\":\"URLF - Risky website access request by Client IP\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"sourceIp\",\"label\":\"Source IP\",\"comment\":\"Internal Source IP of the CWS client\"},{\"columnId\":\"hitcount\",\"label\":\"Hit Count\"}]}},\"customWidth\":\"25\",\"name\":\"URLF - Risky website access request by Client IP\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL\\n| summarize hitcount = count() by categories\\n| sort by hitcount\\n| render piechart with(title=\\\"Cloud Web Security Website categories\\\")\",\"size\":0,\"title\":\"URLF - Website Categories\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"URLF - Website Categories\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL\\n| summarize destCountry = count() by dstCountry\\n| sort by destCountry\\n| render piechart with(title=\\\"Cloud Web Security Destination Countries\\\")\",\"size\":0,\"title\":\"URLF -  Destination Countries\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"DE\",\"color\":\"grayBlue\"},{\"seriesName\":\"US\",\"color\":\"blue\"}],\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"25\",\"name\":\"CWS Destination Countries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL\\n| where categories == \\\"Uncategorized\\\"\\n| summarize hitcount = count() by domain\\n| sort by hitcount\",\"size\":0,\"title\":\"URLF - Uncategorized Domains\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"domain\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"uncat_domain\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"25\",\"name\":\"URLF - Uncategorized Domains\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL \\n| where casbAppName != \\\"\\\"\\n| summarize hitcount = count() by tostring(casbAppName)\\n| sort by hitcount\\n| render areachart with(title=\\\"CASB - SaaS Application Overview\\\")\",\"size\":0,\"title\":\"CASB.- SaaS Application Overview\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"CASB.- SaaS Application Overview\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL \\n| where casbAppName != \\\"\\\"\\n| summarize riskScore = max(tolong(casbRiskScore)) by tostring(casbAppName)\\n| sort by riskScore\\n| render areachart with(title=\\\"CASB - SaaS Applications by Risk\\\")\",\"size\":0,\"title\":\"CASB - SaaS Applications by Risk\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"customThresholdLine\":\"3\",\"customThresholdLineStyle\":1}},\"customWidth\":\"50\",\"name\":\"CASB - SaaS Applications by Risk\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL\\n| where fileScanResult != \\\"\\\"\\n| summarize hitcount = count() by tostring(fileScanResult)\\n| render piechart with(title=\\\"Content Inspection - File disposition\\\")\",\"size\":0,\"title\":\"Content Inspection - File Disposition\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Clean\",\"color\":\"purple\"}]}},\"customWidth\":\"25\",\"name\":\"CI - File disposition\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL \\n| where action == \\\"block\\\"\\n| summarize hitcount = count() by userId\\n| sort by hitcount\\n| render piechart with(title=\\\"Users with CWS Policy Violations\\\")\",\"size\":0,\"title\":\"Policy Violation by User ID (E-Mail)\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"hitcount\",\"label\":\"Hit Count\"}]}},\"customWidth\":\"25\",\"name\":\"CWS - Policy Violation by User ID (E-Mail)\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_CWS_Weblogs_CL \\n| where action == \\\"block\\\"\\n| extend cRulePolicy = strcat(ruleMatched, \\\" / \\\", policyName)\\n| summarize hitcount = count() by cRulePolicy\\n| sort by hitcount\\n| render piechart with(title=\\\"Cloud Web Security Policy Health\\\")\",\"size\":0,\"title\":\"Connections blocked by Rule/Policy\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"Connections blocked by Rule/Policy\"}]},\"name\":\"VMware CWS Security\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# 3. VMware SD-WAN Security Dashboard\\n\\nThis section details key security KPI information for the VMware SD-WAN Platform. Information can be collected from the Edge appliances via Syslog or from the VMware Edge Cloud Orchestrator (VECO) platform via API.\\n\\nThis group is split into three sections:\\n\\t1. Edge Firewall Telemetry (Flood Protection & Enhanced Firewall Services)\\n\\t2. Edge Health (Congestion, Non-SDWAN Destination or Cloud Security Service Health)\\n\\t3. SD-WAN Audit\"},\"name\":\"text - 0\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## 3A. Edge Firewall Telemetry\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\n| where SyslogMessage contains \\\"VCF Alert\\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend IdpsSignatureName = extract(\\\"SIGNATURE=(.+) CATEGORY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertCategory = extract(\\\"CATEGORY=(.+) SEVERITY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertSeverity = extract(\\\"SEVERITY=(.+) SRC_IP=\\\", 1, SyslogMessage)\\n| extend IdpsSignatureId = extract(\\\"SIG_ID=([0-9]+) SIGNATURE=\\\", 1, SyslogMessage)\\n| extend OverlaySegmentName = extract(\\\"SEGMENT_NAME=(.+) SIG_ID=\\\", 1, SyslogMessage)\\n| extend IpProtocol = extract(\\\"PROTO=([A-Z]+) SRC=\\\", 1, SyslogMessage)\\n| extend SrcIpAddress = extract(\\\"SRC=(.+) DST=\\\", 1, SyslogMessage)\\n| extend SrcPort = extract(\\\"SPT=([0-9]+) DPT=\\\", 1, SyslogMessage)\\n| extend DstIpAddress = extract(\\\"DST=(.+) SPT=\\\", 1, SyslogMessage)\\n| extend DstPort = extract(\\\"DPT=(.+) DEST_DOMAIN=\\\", 1, SyslogMessage)\\n| extend VictimIp = extract(\\\"TARGET_IP=(.+) TARGET_PORT=\\\", 1, SyslogMessage)\\n| extend AttackerIp = extract(\\\"SRC_IP=(.+) SRC_PORT=\\\", 1, SyslogMessage)\\n| extend DomainName = extract(\\\"DEST_DOMAIN=(.+) FW_POLICY_NAME=\\\", 1, SyslogMessage)\\n| extend EdgeFwAction = extract(\\\"ATP_ACTION=(.+) SEGMENT=\\\", 1, SyslogMessage)\\n| extend SyslogTag = extract(\\\"$(.+): ACTION=\\\", 1, SyslogMessage)\\n| extend FwPolicyName = extract(\\\"FW_POLICY_NAME=(.+) SEGMENT_NAME=\\\", 1, SyslogMessage)\\n| summarize categorycount = count() by IdpsAlertCategory\\n| sort by categorycount\\n| render piechart\",\"size\":0,\"title\":\"Edge Firewall - IDS/IPS Alert Categories\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"40\",\"name\":\"Edge Firewall - IDS/IPS Alert Categories\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\n| where SyslogMessage contains \\\"VCF Alert\\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend IdpsSignatureName = extract(\\\"SIGNATURE=(.+) CATEGORY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertCategory = extract(\\\"CATEGORY=(.+) SEVERITY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertSeverity = extract(\\\"SEVERITY=(.+) SRC_IP=\\\", 1, SyslogMessage)\\n| extend IdpsSignatureId = extract(\\\"SIG_ID=([0-9]+) SIGNATURE=\\\", 1, SyslogMessage)\\n| extend OverlaySegmentName = extract(\\\"SEGMENT_NAME=(.+) SIG_ID=\\\", 1, SyslogMessage)\\n| extend IpProtocol = extract(\\\"PROTO=([A-Z]+) SRC=\\\", 1, SyslogMessage)\\n| extend SrcIpAddress = extract(\\\"SRC=(.+) DST=\\\", 1, SyslogMessage)\\n| extend SrcPort = extract(\\\"SPT=([0-9]+) DPT=\\\", 1, SyslogMessage)\\n| extend DstIpAddress = extract(\\\"DST=(.+) SPT=\\\", 1, SyslogMessage)\\n| extend DstPort = extract(\\\"DPT=(.+) DEST_DOMAIN=\\\", 1, SyslogMessage)\\n| extend VictimIp = extract(\\\"TARGET_IP=(.+) TARGET_PORT=\\\", 1, SyslogMessage)\\n| extend AttackerIp = extract(\\\"SRC_IP=(.+) SRC_PORT=\\\", 1, SyslogMessage)\\n| extend DomainName = extract(\\\"DEST_DOMAIN=(.+) FW_POLICY_NAME=\\\", 1, SyslogMessage)\\n| extend EdgeFwAction = extract(\\\"ATP_ACTION=(.+) SEGMENT=\\\", 1, SyslogMessage)\\n| extend SyslogTag = extract(\\\"$(.+): ACTION=\\\", 1, SyslogMessage)\\n| extend FwPolicyName = extract(\\\"FW_POLICY_NAME=(.+) SEGMENT_NAME=\\\", 1, SyslogMessage)\\n| make-series kind=nonempty countevent=count(TimeGenerated) default=0 on TimeGenerated step 1h by EdgeName\\n| render timechart\",\"size\":0,\"title\":\"Edge Firewall - IDS/IPS Events over time by Edge\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"xSettings\":{\"numberFormatSettings\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"60\",\"name\":\"Edge Firewall - IDS/IPS Events By Edge\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\n| where SyslogMessage contains \\\"VCF Alert\\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend IdpsSignatureName = extract(\\\"SIGNATURE=(.+) CATEGORY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertCategory = extract(\\\"CATEGORY=(.+) SEVERITY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertSeverity = extract(\\\"SEVERITY=(.+) SRC_IP=\\\", 1, SyslogMessage)\\n| extend IdpsSignatureId = extract(\\\"SIG_ID=([0-9]+) SIGNATURE=\\\", 1, SyslogMessage)\\n| extend OverlaySegmentName = extract(\\\"SEGMENT_NAME=(.+) SIG_ID=\\\", 1, SyslogMessage)\\n| extend IpProtocol = extract(\\\"PROTO=([A-Z]+) SRC=\\\", 1, SyslogMessage)\\n| extend SrcIpAddress = extract(\\\"SRC=(.+) DST=\\\", 1, SyslogMessage)\\n| extend SrcPort = extract(\\\"SPT=([0-9]+) DPT=\\\", 1, SyslogMessage)\\n| extend DstIpAddress = extract(\\\"DST=(.+) SPT=\\\", 1, SyslogMessage)\\n| extend DstPort = extract(\\\"DPT=(.+) DEST_DOMAIN=\\\", 1, SyslogMessage)\\n| extend VictimIp = extract(\\\"TARGET_IP=(.+) TARGET_PORT=\\\", 1, SyslogMessage)\\n| extend AttackerIp = extract(\\\"SRC_IP=(.+) SRC_PORT=\\\", 1, SyslogMessage)\\n| extend DomainName = extract(\\\"DEST_DOMAIN=(.+) FW_POLICY_NAME=\\\", 1, SyslogMessage)\\n| extend EdgeFwAction = extract(\\\"ATP_ACTION=(.+) SEGMENT=\\\", 1, SyslogMessage)\\n| extend SyslogTag = extract(\\\"$(.+): ACTION=\\\", 1, SyslogMessage)\\n| extend FwPolicyName = extract(\\\"FW_POLICY_NAME=(.+) SEGMENT_NAME=\\\", 1, SyslogMessage)\\n| summarize signaturecount = count() by IdpsSignatureName\\n| sort by signaturecount\\n| render piechart\",\"size\":0,\"title\":\"Edge Firewall - IDS/IPS Signature Match\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"Edge Firewall - IDS/IPS Signature Hits\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\n| where SyslogMessage contains \\\"VCF Alert\\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend IdpsSignatureName = extract(\\\"SIGNATURE=(.+) CATEGORY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertCategory = extract(\\\"CATEGORY=(.+) SEVERITY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertSeverity = extract(\\\"SEVERITY=(.+) SRC_IP=\\\", 1, SyslogMessage)\\n| extend IdpsSignatureId = extract(\\\"SIG_ID=([0-9]+) SIGNATURE=\\\", 1, SyslogMessage)\\n| extend OverlaySegmentName = extract(\\\"SEGMENT_NAME=(.+) SIG_ID=\\\", 1, SyslogMessage)\\n| extend IpProtocol = extract(\\\"PROTO=([A-Z]+) SRC=\\\", 1, SyslogMessage)\\n| extend SrcIpAddress = extract(\\\"SRC=(.+) DST=\\\", 1, SyslogMessage)\\n| extend SrcPort = extract(\\\"SPT=([0-9]+) DPT=\\\", 1, SyslogMessage)\\n| extend DstIpAddress = extract(\\\"DST=(.+) SPT=\\\", 1, SyslogMessage)\\n| extend DstPort = extract(\\\"DPT=(.+) DEST_DOMAIN=\\\", 1, SyslogMessage)\\n| extend VictimIp = extract(\\\"TARGET_IP=(.+) TARGET_PORT=\\\", 1, SyslogMessage)\\n| extend AttackerIp = extract(\\\"SRC_IP=(.+) SRC_PORT=\\\", 1, SyslogMessage)\\n| extend DomainName = extract(\\\"DEST_DOMAIN=(.+) FW_POLICY_NAME=\\\", 1, SyslogMessage)\\n| extend EdgeFwAction = extract(\\\"ATP_ACTION=(.+) SEGMENT=\\\", 1, SyslogMessage)\\n| extend SyslogTag = extract(\\\"$(.+): ACTION=\\\", 1, SyslogMessage)\\n| extend FwPolicyName = extract(\\\"FW_POLICY_NAME=(.+) SEGMENT_NAME=\\\", 1, SyslogMessage)\\n| summarize attackercount = count() by AttackerIp\\n| sort by attackercount\\n| render barchart\",\"size\":0,\"title\":\"Edge Firewall - IDS/IPS Attackers\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"35\",\"name\":\"Edge Firewall - Attackers\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\n| where SyslogMessage contains \\\"VCF Alert\\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend IdpsSignatureName = extract(\\\"SIGNATURE=(.+) CATEGORY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertCategory = extract(\\\"CATEGORY=(.+) SEVERITY=\\\", 1, SyslogMessage)\\n| extend IdpsAlertSeverity = extract(\\\"SEVERITY=(.+) SRC_IP=\\\", 1, SyslogMessage)\\n| extend IdpsSignatureId = extract(\\\"SIG_ID=([0-9]+) SIGNATURE=\\\", 1, SyslogMessage)\\n| extend OverlaySegmentName = extract(\\\"SEGMENT_NAME=(.+) SIG_ID=\\\", 1, SyslogMessage)\\n| extend IpProtocol = extract(\\\"PROTO=([A-Z]+) SRC=\\\", 1, SyslogMessage)\\n| extend SrcIpAddress = extract(\\\"SRC=(.+) DST=\\\", 1, SyslogMessage)\\n| extend SrcPort = extract(\\\"SPT=([0-9]+) DPT=\\\", 1, SyslogMessage)\\n| extend DstIpAddress = extract(\\\"DST=(.+) SPT=\\\", 1, SyslogMessage)\\n| extend DstPort = extract(\\\"DPT=(.+) DEST_DOMAIN=\\\", 1, SyslogMessage)\\n| extend VictimIp = extract(\\\"TARGET_IP=(.+) TARGET_PORT=\\\", 1, SyslogMessage)\\n| extend AttackerIp = extract(\\\"SRC_IP=(.+) SRC_PORT=\\\", 1, SyslogMessage)\\n| extend DomainName = extract(\\\"DEST_DOMAIN=(.+) FW_POLICY_NAME=\\\", 1, SyslogMessage)\\n| extend EdgeFwAction = extract(\\\"ATP_ACTION=(.+) SEGMENT=\\\", 1, SyslogMessage)\\n| extend SyslogTag = extract(\\\"$(.+): ACTION=\\\", 1, SyslogMessage)\\n| extend FwPolicyName = extract(\\\"FW_POLICY_NAME=(.+) SEGMENT_NAME=\\\", 1, SyslogMessage)\\n| summarize victimcount = count() by VictimIp\\n| sort by victimcount\\n| render barchart\",\"size\":0,\"title\":\"Edge Firewall - IDS/IPS Victims\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"30\",\"name\":\"Edge Firewall - Victims\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(Syslog | summarize min(TimeGenerated));\\nlet max_t = toscalar(Syslog | summarize max(TimeGenerated));\\nSyslog\\n| where CollectorHostName != \\\"\\\"\\n| where SyslogMessage contains \\\"ACTION=VCF \\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend EdgeFwAction = case(SyslogMessage contains \\\"VCF Open\\\", \\\"Session Open\\\", SyslogMessage contains \\\"VCF Close\\\", \\\"Session Close\\\", SyslogMessage contains \\\"VCF Drop\\\", \\\"Session Drop\\\", SyslogMessage contains \\\"VCF Alert\\\", \\\"IDS/IPS Signature Match\\\", SyslogMessage contains \\\"VCF Deny\\\", \\\"Session Denied\\\", SyslogMessage contains \\\"VCF Update\\\", \\\"Session Refresh\\\", \\\"Unmapped Message\\\")\\n| make-series FwEventCount=count(TimeGenerated) on TimeGenerated from min_t to max_t step 1h by EdgeFwAction\\n| render timechart\",\"size\":0,\"title\":\"Edge Firewall - Events over Time by Category\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Session Open\",\"color\":\"green\"},{\"seriesName\":\"Session Close\",\"color\":\"greenDark\"},{\"seriesName\":\"Session Drop\",\"color\":\"orange\"},{\"seriesName\":\"Session Refresh\",\"color\":\"greenDarkDark\"},{\"seriesName\":\"IDS/IPS Signature Match\",\"color\":\"redBright\"},{\"seriesName\":\"Session Denied\",\"color\":\"red\"}],\"xSettings\":{\"numberFormatSettings\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"65\",\"name\":\"Edge Firewall - Events over Time by Category\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Syslog\\n| where CollectorHostName != \\\"\\\"\\n| where SyslogMessage contains \\\"ACTION=VCF \\\"\\n| project-rename EdgeName=HostName\\n| project-away Computer, HostIP, SourceSystem, Type\\n| extend EdgeFwAction = case(SyslogMessage contains \\\"VCF Open\\\", \\\"Session Open\\\", SyslogMessage contains \\\"VCF Close\\\", \\\"Session Close\\\", SyslogMessage contains \\\"VCF Drop\\\", \\\"Session Drop\\\", SyslogMessage contains \\\"VCF Alert\\\", \\\"IDS/IPS Signature Match\\\", SyslogMessage contains \\\"VCF Deny\\\", \\\"Session Denied\\\", SyslogMessage contains \\\"VCF Update\\\", \\\"Session Refresh\\\", \\\"Unmapped Message\\\")\\n| where EdgeFwAction == \\\"Session Drop\\\"\\n| extend DropReason = extract(\\\"REASON=(.+) SEGMENT_NAME=\\\", 1, SyslogMessage)\\n| summarize eventcount=count() by DropReason\\n| render piechart\",\"size\":0,\"title\":\"Edge Firewall - Anomaly Detection\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Session Open\",\"color\":\"green\"},{\"seriesName\":\"Session Close\",\"color\":\"greenDark\"},{\"seriesName\":\"Session Drop\",\"color\":\"orange\"},{\"seriesName\":\"Session Refresh\",\"color\":\"greenDarkDark\"},{\"seriesName\":\"IDS/IPS Signature Match\",\"color\":\"redBright\"},{\"seriesName\":\"Session Denied\",\"color\":\"red\"}],\"xSettings\":{\"numberFormatSettings\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"35\",\"name\":\"Edge Firewall - Anomaly Detection\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}}]},\"name\":\"Edge Firewall\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# 3B Edge Health and Cloud Security Service\"},\"name\":\"text - 0\"}]},\"name\":\"Edge Health & CSS\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(VMware_VECO_EventLogs_CL | summarize min(TimeGenerated));\\nlet max_t = toscalar(VMware_VECO_EventLogs_CL | summarize max(TimeGenerated));\\nVMware_VECO_EventLogs_CL\\n| where event contains \\\"EDGE_NVS_TUNNEL_DOWN\\\"\\n| extend EdgeName = extract(\\\"edge \\\\\\\\[(.+)\\\\\\\\] for\\\", 1, message)\\n| extend nsdServiceName=todynamic(detail).nvsProviderName\\n| extend nsdServiceId=todynamic(detail).nvsTunnelSiteName\\n| extend nsdServicePath=todynamic(detail).nvsTunnelPathId\\n| extend nsdPeerIp=todynamic(detail).nvsDestinationPublicIp\\n| project-away detail\\n| make-series nsdDownstatistics = count(nsdServiceId) default=0 on TimeGenerated from min_t to max_t step 1h by EdgeName\\n| render timechart\",\"size\":0,\"title\":\"NSD/CSS Down Events by Edge over Time\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"60\",\"name\":\"NSD/CSS Down Events by Edge over Time\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_VECO_EventLogs_CL\\n| where event contains \\\"EDGE_NVS_TUNNEL_DOWN\\\"\\n| extend EdgeName = extract(\\\"edge \\\\\\\\[(.+)\\\\\\\\] for\\\", 1, message)\\n| extend nsdServiceName=todynamic(detail).nvsProviderName\\n| extend nsdServiceId=todynamic(detail).nvsTunnelSiteName\\n| extend nsdServicePath=todynamic(detail).nvsTunnelPathId\\n| extend nsdPeerIp=todynamic(detail).nvsDestinationPublicIp\\n| project-away detail\\n| summarize nsdEndpoint = count() by tostring(nsdPeerIp)\\n| render barchart\",\"size\":0,\"title\":\"NSD / CSS - Tunnel Down alerts per Remote IP\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"40\",\"name\":\"NSD / CSS - Tunnel Down alerts per Remote IP\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(VMware_VECO_EventLogs_CL | summarize min(TimeGenerated));\\nlet max_t = toscalar(VMware_VECO_EventLogs_CL | summarize max(TimeGenerated));\\nVMware_VECO_EventLogs_CL\\n| where event == \\\"VPN_DATACENTER_STATUS\\\"\\n| extend nsdServiceChange = todynamic(detail).ikeState\\n| extend nsdServiceName = extract(\\\"^Tunnel to \\\\\\\\[(.+)\\\\\\\\]\\\", 1, message)\\n| where nsdServiceChange == \\\"DOWN\\\"\\n| make-series nsdStatusChange = count(TimeGenerated) default=0 on TimeGenerated from min_t to max_t step 1h by nsdServiceName\\n| render timechart\\n\",\"size\":0,\"title\":\"NSD via Gateway service - IKE SA Down Events\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"60\",\"name\":\"NSD via Gateway service - IKE SA Down Events\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\"}}]},\"name\":\"Edge NSD/CSS\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# 3C SD-WAN and SASE Audit Logs & Events\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_VECO_EventLogs_CL\\n| where event == \\\"CWS_EVENT\\\"\\n| extend eventType = todynamic(detail).subEvent\\n| summarize count() by tostring(eventType)\\n| render piechart\",\"size\":0,\"title\":\"CWS Audit Event Summary by Type\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"group\":\"eventType\",\"seriesLabelSettings\":[{\"seriesName\":\"CWS_POLICY_PUBLISHED\",\"label\":\"Policy Publish\",\"color\":\"green\"},{\"seriesName\":\"CWS_SECURITY_RULE_DELETED\",\"label\":\"Security Rule Deleted\",\"color\":\"orange\"},{\"seriesName\":\"CWS_SECURITY_RULE_UPDATED\",\"label\":\"Security Rule Updated\",\"color\":\"blue\"},{\"seriesName\":\"CWS_POLICY_DELETED\",\"label\":\"Policy Deleted\",\"color\":\"redBright\"},{\"seriesName\":\"CWS_SECURITY_RULE_CREATED\",\"label\":\"Security Rule Created\",\"color\":\"magenta\"}],\"showDataPoints\":true}},\"customWidth\":\"30\",\"name\":\"CWS Audit Event Summary by Type\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let min_t = toscalar(VMware_VECO_EventLogs_CL | summarize min(TimeGenerated));\\nlet max_t = toscalar(VMware_VECO_EventLogs_CL | summarize max(TimeGenerated));\\nVMware_VECO_EventLogs_CL\\n| where event == \\\"CWS_EVENT\\\"\\n| extend eventType = todynamic(detail).subEvent\\n| where eventType contains \\\"CWS_POLICY\\\"\\n| extend policyName = todynamic(detail).name\\n| project-keep TimeGenerated, policyName, eventType\\n| summarize policyEvents = count(eventType) by tostring(policyName), tostring(eventType)\\n\",\"size\":0,\"title\":\"CWS Policy Changes by Policy and Change Type\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"policyName\",\"formatter\":2},\"leftContent\":{\"columnMatch\":\"eventType\",\"formatter\":1},\"rightContent\":{\"columnMatch\":\"policyEvents\",\"formatter\":20,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},\"showBorder\":true,\"sortCriteriaField\":\"policyEvents\",\"sortOrderField\":2,\"size\":\"auto\"}},\"customWidth\":\"35\",\"name\":\"CWS Policy Changes by Policy and Change Type\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"VMware_VECO_EventLogs_CL\\n| where event == \\\"CWS_EVENT\\\"\\n| extend eventType = todynamic(detail).subEvent\\n| where eventType contains \\\"CWS_SECURITY_RULE\\\"\\n| extend ruleName = todynamic(detail).name\\n| extend policyName = todynamic(detail).policyName\\n| project-keep TimeGenerated, policyName, eventType, ruleName\\n| summarize policyEvents = count(eventType) by tostring(ruleName), tostring(eventType), tostring(policyName)\\n\",\"size\":0,\"title\":\"CWS Rule Changes by Policy and Change Type\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ruleName\"},\"leftContent\":{\"columnMatch\":\"eventType\",\"formatter\":1},\"rightContent\":{\"columnMatch\":\"policyEvents\",\"formatter\":20,\"formatOptions\":{\"palette\":\"blue\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},\"secondaryContent\":{\"columnMatch\":\"policyName\",\"formatter\":1},\"showBorder\":true,\"sortCriteriaField\":\"policyEvents\",\"sortOrderField\":2,\"size\":\"auto\"}},\"customWidth\":\"35\",\"name\":\"CWS Rule Changes by Policy and Change Type\",\"styleSettings\":{\"margin\":\"5px\",\"padding\":\"5px\",\"showBorder\":true}}]},\"name\":\"Audit\"}]},\"name\":\"VMware SD-WAN Security\"}],\"fromTemplateId\":\"https://sentinelus.hosting.portal.azure.net/sentinelus/Content/1.0.02484.3403-231021-003920/Scenarios/Ecosystem/Content/Workbooks/CustomWorkbook.json\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=VMwareSDWAN; logoFileName=vmware_sase_logo.svg; description=This workbook is intended to provide an overview on security events on VMware SD-WAN and Cloud Web Security.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=VMware SD-WAN and SASE; templateRelativePath=VMwareSASESOCDashboard.json; subtitle=; provider=velocloud}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "VMware_CWS_Weblogs_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "VMware_VECO_EventLogs_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "VMwareSDWAN",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sase-cws-policy-publish_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This alert is capturing events when VMware CWS policies were published. During publish, the VMware Edge Cloud Orchestrator deploys the CWS policies in SASE POPs, making them effective. All new rules will be enforced. Depending on the contents of the policy, this might create an impact on the CWS Data Plane traffic.",
                "displayName": "VMware Cloud Web Security - Policy Publish Event",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event == \"CWS_EVENT\"\n| extend cwsPolicyAction = todynamic(detail).subEvent\n| where cwsPolicyAction == \"CWS_POLICY_PUBLISHED\"\n| extend cwsPolicyName = todynamic(detail).policyName\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "CWS"
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDescriptionFormat": "CWS Policy Published: {{cwsPolicyName}}\n\nDuring publish, the VMware Edge Cloud Orchestrator deploys the CWS policies in SASE POPs, making them effective. All new rules will be enforced. Depending on the contents of the policy, this might create an impact on the CWS Data Plane traffic."
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware Cloud Web Security - Policy Publish Event",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sase-cws-policychange_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This Analytics rule provides notifications when a VMware CWS policy has been modified. These alerts serve audit purposes. Policy changes might lower the level of security controls.",
                "displayName": "VMware Cloud Web Security - Policy Change Detected",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event == \"CWS_EVENT\"\n| extend cwsPolicyAction = todynamic(detail).subEvent\n| where cwsPolicyAction contains \"SECURITY_RULE\"\n| extend cwsRuleName = todynamic(detail).name\n| extend cwsRuleType = todynamic(detail).data.ruleType\n| extend cwsPolicyName = todynamic(detail).policyName\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "CWS"
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "cwsRuleType",
                      "alertProperty": "ProductComponentName"
                    }
                  ],
                  "alertDescriptionFormat": "CWS Policy Change Detected:\n\nCWS Policy Name: {{cwsPolicyName}}\n - Rule changed: {{cwsRuleName}}\n    - Audited Action: {{cwsPolicyAction}}\n\n"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware Cloud Web Security - Policy Change Detected",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sase-cws-policyviolation_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "VMware Cloud Web Security reported access events which were violating web access policy rules. Additional investigation might be required.",
                "displayName": "VMware Cloud Web Security - Web Access Policy Violation",
                "enabled": false,
                "query": "VMware_CWS_Weblogs_CL\n| where action == \"block\"\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "CWS"
                    ]
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sourceIp",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "virusList",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Malware"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "url",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "userId",
                        "identifier": "AadUserId"
                      }
                    ],
                    "entityType": "Account"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware Cloud Web Security - Web Access Policy Violation",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sase-cwsdlp-violation_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This Analytics rule receives VMware CWS DLP alerts and combines them with their respective Web Log events. Each Data Loss Prevention event is an alert of policy violations and should be investigated.",
                "displayName": "VMware Cloud Web Security - Data Loss Prevention Violation",
                "enabled": false,
                "query": "VMware_CWS_DLPLogs_CL\n| join kind=innerunique VMware_CWS_Weblogs_CL on TimeGenerated",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "CWS"
                    ]
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "userId",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sourceIp",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "casbAppName",
                        "identifier": "Name"
                      }
                    ],
                    "entityType": "CloudApplication"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "dstUrl",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "CWS_Policy_Name": "policyName",
                  "CWS_Rule_Name": "ruleMatched"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware Cloud Web Security - Data Loss Prevention Violation",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-device-congestion_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware Edge Cloud Orchestrator reported an edge congestion event, where the Edge is dropping a large number of packets on one of its interfaces. This could indicate an ongoing Denial of Service attack against an appliance. Please make sure that Network Flood Protection is turned on.",
                "displayName": "VMware SD-WAN Edge - Device Congestion Alert - Packet Drops",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event == \"EDGE_CONGESTED\"\n| where message contains \"high number of packet drops\"\n| extend edgeSerialNumber = extract(\"edgeSerialNumber: (.+)$\", 1, detail)",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1498"
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "edgeSerialNumber": "edgeSerialNumber"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - Device Congestion Alert - Packet Drops",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-idps-alert-api_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware SD-WAN Edge appliance captured a potentially malicious traffic flow. Please investigate the IOC information available.\n\nThis analytics rule analyses Search API streams. Search API queries report only IDS/IPS Alerts. In case you would also need Network Flood Protection, please enable Syslog collection using AMA.",
                "displayName": "VMware SD-WAN Edge - IDS/IPS Alert triggered (Search API)",
                "enabled": false,
                "query": "VMware_SDWAN_FirewallLogs_CL\n| project TimeGenerated, signature, severity, category, signatureId, actionTaken, edgeName, sourceIp, protocol, sourcePort, destinationIp, destinationPort, domainName, attackSource, attackTarget, firewallPolicyName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "tactics": [
                  "LateralMovement"
                ],
                "techniques": [
                  "T1210"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "domainName",
                        "identifier": "DomainName"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "sourceIp",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "IDPS_Signature": "signature",
                  "IDPS_Event_Category": "category"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": []
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - IDS/IPS Alert triggered (Search API)",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-idps-alert-syslog_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware SD-WAN Edge appliance captured a potentially malicious traffic flow. Please investigate the IOC information available.\n\nThis analytics rule analyzes Syslog streams.",
                "displayName": "VMware SD-WAN Edge - IDS/IPS Alert triggered (Syslog)",
                "enabled": false,
                "query": "Syslog\n| where SyslogMessage contains \"VCF Alert\"\n| project-rename EdgeName=HostName\n| project-away Computer, HostIP, SourceSystem, Type\n| extend IdpsSignatureName = extract(\"SIGNATURE=(.+) CATEGORY=\", 1, SyslogMessage)\n| extend IdpsAlertCategory = extract(\"CATEGORY=(.+) SEVERITY=\", 1, SyslogMessage)\n| extend IdpsAlertSeverity = extract(\"SEVERITY=(.+) SRC_IP=\", 1, SyslogMessage)\n| extend IdpsSignatureId = extract(\"SIG_ID=([0-9]+) SIGNATURE=\", 1, SyslogMessage)\n| extend OverlaySegmentName = extract(\"SEGMENT_NAME=(.+) SIG_ID=\", 1, SyslogMessage)\n| extend IpProtocol = extract(\"PROTO=([A-Z]+) SRC=\", 1, SyslogMessage)\n| extend SrcIpAddress = extract(\"SRC=(.+) DST=\", 1, SyslogMessage)\n| extend SrcPort = extract(\"SPT=([0-9]+) DPT=\", 1, SyslogMessage)\n| extend DstIpAddress = extract(\"DST=(.+) SPT=\", 1, SyslogMessage)\n| extend DstPort = extract(\"DPT=(.+) DEST_DOMAIN=\", 1, SyslogMessage)\n| extend VictimIp = extract(\"TARGET_IP=(.+) TARGET_PORT=\", 1, SyslogMessage)\n| extend AttackerIp = extract(\"SRC_IP=(.+) SRC_PORT=\", 1, SyslogMessage)\n| extend DomainName = extract(\"DEST_DOMAIN=(.+) FW_POLICY_NAME=\", 1, SyslogMessage)\n| extend EdgeFwAction = extract(\"ATP_ACTION=(.+) SEGMENT=\", 1, SyslogMessage)\n| extend SyslogTag = extract(\"$(.+): ACTION=\", 1, SyslogMessage)\n| extend FwPolicyName = extract(\"FW_POLICY_NAME=(.+) SEGMENT_NAME=\", 1, SyslogMessage)\n| project\n    TimeGenerated,\n    IdpsSignatureName,\n    IdpsAlertSeverity,\n    IdpsAlertCategory,\n    IdpsSignatureId,\n    EdgeFwAction,\n    EdgeName,\n    SrcIpAddress,\n    IpProtocol,\n    SrcPort,\n    DstIpAddress,\n    DstPort,\n    DomainName,\n    AttackerIp,\n    VictimIp,\n    FwPolicyName,\n    SyslogTag",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "tactics": [
                  "LateralMovement"
                ],
                "techniques": [
                  "T1210"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "DomainName",
                        "identifier": "DomainName"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "VictimIp",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "IDPS_Signature": "IdpsSignatureName",
                  "IDPS_Event_Category": "IdpsAlertCategory",
                  "Edge_Name": "EdgeName"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - IDS/IPS Alert triggered (Syslog)",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-idps-update-success_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware SD-WAN Edge Management Plane reported a successful IDS/IPS signature update. New signatures might impact Data Plane traffic, therefore an audit event is generated.",
                "displayName": "VMware SD-WAN Edge - IDS/IPS Signature Update Succeeded",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event == \"MGD_ATPUP_APPLY_IDPS_SIGNATURE_SUCCEEDED\"\n| extend idpsSignatureVersion = extract(\"\\\"version\\\":\\\"([0-9]+)\\\"\", 1, tostring(todynamic(detail).data))\n| extend todynamic(detail).edgeSerialNumber\n| extend todynamic(detail).data\n| project-rename idpsSignatureData = detail_data\n| project-rename edgeSerialNumber = detail_edgeSerialNumber\n| project-away detail\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "idpsSignatureVersion": "idpsSignatureVersion",
                  "edgeSerialNumber": "edgeSerialNumber"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDescriptionFormat": "{{message}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - IDS/IPS Signature Update Succeeded",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-idps-updatefailed_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware SD-WAN Edge Management Plane reported a failed IDS/IPS signature update. This can indicate a potential management plane issue, an Edge OS version mismatch (IDS/IPS has been introduced in release 5.2.0.0), or a software issue.\n\nIf the Edge was able to download signature files before, this error means that the IPS/IDS engine can still provide a level of protection, however, signatures might be missing or inaccurate. If the Edge has no valid signature file, this error could indicate that the Edge Firewall cannot protect from network threats.",
                "displayName": "VMware SD-WAN Edge - IDS/IPS Signature Update Failed",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event == \"MGD_ATPUP_APPLY_IDPS_SIGNATURE_FAILED\"\n| extend idpsSignatureVersion = extract(\"\\\"version\\\":\\\"([0-9]+)\\\"\", 1, tostring(todynamic(detail).data))\n| extend todynamic(detail).edgeSerialNumber\n| extend todynamic(detail).data\n| project-rename idpsSignatureData = detail_data\n| project-rename edgeSerialNumber = detail_edgeSerialNumber\n| project-away detail\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "idpsSignatureVersion": "idpsSignatureVersion",
                  "edgeSerialNumber": "edgeSerialNumber"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDescriptionFormat": "{{message}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - IDS/IPS Signature Update Failed",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-ipfrag-attempt_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware SD-WAN Edge appliance received packets potentially part of an IP Fragmentation attack or indicating an MTU mismatch.\n\nAn IP fragmentation attack is a cyberattack that exploits how IP packets are fragmented and reassembled. IP fragmentation is a process by which large IP packets are broken down into smaller packets to transmit them over networks with smaller Maximum Transmission Unit (MTU) sizes.\n\nAttackers can exploit IP fragmentation in various ways, for example, Denial-of-service attacks, address spoofing, or even information disclosure.\n\nThis analytics rule analyzes Syslog streams; these alerts are not reported by default if Search API is used.",
                "displayName": "VMware SD-WAN Edge - Network Anomaly Detection - Potential Fragmentation Attack",
                "enabled": false,
                "query": "Syslog\n| where SyslogMessage contains \"VCF Drop\"\n| where SyslogMessage contains \"packet too big\"\n| project-rename EdgeName=HostName\n| project-away Computer, HostIP, SourceSystem, Type\n| extend OverlaySegmentName = extract(\"SEGMENT_NAME=(.+) COUNT=\", 1, SyslogMessage)\n| extend IpProtocol = extract(\"PROTO=(.+) SRC=\", 1, SyslogMessage)\n| extend SrcIpAddress = extract(\"SRC=(.+) DST=\", 1, SyslogMessage)\n| extend DstIpAddress = extract(\"DST=(.+) REASON=\", 1, SyslogMessage)\n| extend EdgeFwAction = extract(\"ACTION=(.+) SEGMENT=\", 1, SyslogMessage)\n| extend SyslogTag = extract(\"^(.+): ACTION=\", 1, SyslogMessage)\n| extend pcktCount = extract(\"COUNT=([0-9]+)$\", 1, SyslogMessage)\n| project\n    TimeGenerated,\n    EdgeFwAction,\n    EdgeName,\n    SrcIpAddress,\n    IpProtocol,\n    DstIpAddress,\n    pcktCount,\n    SyslogTag\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "tactics": [
                  "Impact",
                  "DefenseEvasion"
                ],
                "techniques": [
                  "T1498",
                  "T1599"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "SrcIpAddress",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "Edge_Name": "EdgeName"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - Network Anomaly Detection - Potential Fragmentation Attack",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject11').analyticRuleTemplateSpecName11]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-lanside-devicedetect_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject11').analyticRuleVersion11]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule creates notifications of newly connected devices. These clients are connected to the LAN interface of the Edge.",
                "displayName": "VMware Edge Cloud Orchestrator - New LAN-Side Client Device Detected",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| extend details = todynamic(detail)\n| evaluate bag_unpack(details)\n| where event == \"EDGE_NEW_DEVICE\"\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "hostname",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "os_description",
                        "identifier": "OSFamily"
                      },
                      {
                        "columnName": "os_version",
                        "identifier": "OSVersion"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "client_ipv4addr",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Client_MAC_Address": "client_mac",
                  "DHCP_Parameter_List": "dhcp_param_list"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": []
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject11').analyticRuleId11,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 11",
                "parentId": "[variables('analyticRuleObject11').analyticRuleId11]",
                "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject11').analyticRuleVersion11]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware Edge Cloud Orchestrator - New LAN-Side Client Device Detected",
        "contentProductId": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "id": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject12').analyticRuleTemplateSpecName12]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-nsd-cssdown_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject12').analyticRuleVersion12]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule collects events where an SD-WAN Edge reports that all Cloud Security Service (CSS) tunnels are down. Losing connectivity to a Secure Service Edge (SSE) service can impact security capabilities.",
                "displayName": "VMware SD-WAN Edge - All Cloud Security Service Tunnels DOWN",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event contains \"ALL_CSS_DOWN\"\n| extend Edge_Serial_Number = extract(\"edgeSerialNumber:(.*)$\", 1, detail)\n| project TimeGenerated, Edge_Serial_Number, message, severity\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "Edge_Serial_Number": "Edge_Serial_Number"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [],
                  "alertDescriptionFormat": "{{message}}  "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject12').analyticRuleId12,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 12",
                "parentId": "[variables('analyticRuleObject12').analyticRuleId12]",
                "contentId": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject12').analyticRuleVersion12]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - All Cloud Security Service Tunnels DOWN",
        "contentProductId": "[variables('analyticRuleObject12')._analyticRulecontentProductId12]",
        "id": "[variables('analyticRuleObject12')._analyticRulecontentProductId12]",
        "version": "[variables('analyticRuleObject12').analyticRuleVersion12]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject13').analyticRuleTemplateSpecName13]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-orchestrator-config-change_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject13').analyticRuleVersion13]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule is searching for configuration changes. Configuration changes can override security measures and the overarching security design. Therefore audit events must be accurately tracked.",
                "displayName": "VMware SD-WAN - Orchestrator Audit Event",
                "enabled": false,
                "query": "VMware_VECO_EventLogs_CL\n| where event == \"EDIT_PROFILE\"\n| extend edgeProfile = extract(\"^profile \\\\[(.+)\\\\] [a-z]+ module\", 1, message)\n| extend configAction = extract(\"^profile \\\\[.+\\\\] (.+) module\", 1, message)\n| extend edgeModule = extract(\"^profile \\\\[.+\\\\] [a-z]+ module \\\\[(.+)\\\\]$\", 1, message)\n| extend configChange = todynamic(detail).diff\n| project TimeGenerated, severity, edgeProfile, configAction, edgeModule, configChange\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Informational",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "edgeModule": "edgeModule",
                  "edgeProfile": "edgeProfile",
                  "auditAction": "configAction"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": [
                    {
                      "value": "edgeProfile",
                      "alertProperty": "ProductComponentName"
                    }
                  ],
                  "alertDescriptionFormat": "There was a configuration change event on the VMware Edge Cloud Orchestrator.\nThe configuration changes are the following:\n{{{configChange}} "
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject13').analyticRuleId13,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 13",
                "parentId": "[variables('analyticRuleObject13').analyticRuleId13]",
                "contentId": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject13').analyticRuleVersion13]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN - Orchestrator Audit Event",
        "contentProductId": "[variables('analyticRuleObject13')._analyticRulecontentProductId13]",
        "id": "[variables('analyticRuleObject13')._analyticRulecontentProductId13]",
        "version": "[variables('analyticRuleObject13').analyticRuleVersion13]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject14').analyticRuleTemplateSpecName14]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "vmw-sdwan-rpfcheck_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject14').analyticRuleVersion14]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "The VMware SD-WAN Edge appliance received packets that failed a Reverse Path Forwarding (RPF) Check.\n\nReverse path forwarding (RPF) check is a network security mechanism that verifies whether the source IP address of a packet is reachable through the incoming interface on which the packet is received. The packet is dropped if the source IP address is not reachable through the incoming interface.\n\nRPF checks prevent spoofing attacks, in which an attacker uses a forged source IP address to make it appear that the packets are coming from a trusted source. This can allow the attacker to gain unauthorized network access or launch a denial-of-service attack against a target system.\n\nAn IP fragmentation attack is a cyberattack that exploits how IP packets are fragmented and reassembled. IP fragmentation is a process by which large IP packets are broken down into smaller packets to transmit them over networks with smaller Maximum Transmission Unit (MTU) sizes.\n\nThis analytics rule analyzes Syslog streams; these alerts are not reported by default if Search API is used.",
                "displayName": "VMware SD-WAN Edge - Network Anomaly Detection - RPF Check Failure",
                "enabled": false,
                "query": "Syslog\n| where SyslogMessage contains \"VCF Drop\"\n| where SyslogMessage contains \"Reverse path forwarding check fail\"\n| project-rename EdgeName=HostName\n| project-away Computer, HostIP, SourceSystem, Type\n| extend OverlaySegmentName = extract(\"SEGMENT_NAME=(.+) COUNT=\", 1, SyslogMessage)\n| extend IpProtocol = extract(\"PROTO=(.+) SRC=\", 1, SyslogMessage)\n| extend SrcIpAddress = extract(\"SRC=(.+) DST=\", 1, SyslogMessage)\n| extend DstIpAddress = extract(\"DST=(.+) REASON=\", 1, SyslogMessage)\n| extend EdgeFwAction = extract(\"ACTION=(.+) SEGMENT=\", 1, SyslogMessage)\n| extend SyslogTag = extract(\"^(.+): ACTION=\", 1, SyslogMessage)\n| extend pcktCount = extract(\"COUNT=([0-9]+)$\", 1, SyslogMessage)\n| project\n    TimeGenerated,\n    EdgeFwAction,\n    EdgeName,\n    SrcIpAddress,\n    IpProtocol,\n    DstIpAddress,\n    pcktCount,\n    SyslogTag\n\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "VMwareSDWAN",
                    "dataTypes": [
                      "SDWAN"
                    ]
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1498"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "SrcIpAddress",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "customDetails": {
                  "Edge_Name": "EdgeName"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "enabled": true,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject14').analyticRuleId14,'/'))))]",
              "properties": {
                "description": "VMware SASE Analytics Rule 14",
                "parentId": "[variables('analyticRuleObject14').analyticRuleId14]",
                "contentId": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject14').analyticRuleVersion14]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
        "contentKind": "AnalyticsRule",
        "displayName": "VMware SD-WAN Edge - Network Anomaly Detection - RPF Check Failure",
        "contentProductId": "[variables('analyticRuleObject14')._analyticRulecontentProductId14]",
        "id": "[variables('analyticRuleObject14')._analyticRulecontentProductId14]",
        "version": "[variables('analyticRuleObject14').analyticRuleVersion14]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "VECOfrequentFailedLogins_HuntingQueries Hunting Query with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "VMware_SASE_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "VMware Edge Cloud Orchestrator - High number of login failures from a source IP address",
                "category": "Hunting Queries",
                "query": "let failureThreshold = 5; VMware_VECO_EventLogs_CL | where event in (\"USER_LOGIN_FAILURE\", \"USER_LOGIN_FAILURE_SSO\") | extend loginRemoteIp = todynamic(detail).remoteIp | summarize loginAttempts = count() by tostring(loginRemoteIp) | where loginAttempts >= failureThreshold | project loginRemoteIp, loginAttempts | extend IP_0_Address = loginRemoteIp",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This query identifies repeating authentication attempts (5 or higher attempts) from a single source IP. These could be failed automation or service accounts, however, it is worth investigating these events."
                  },
                  {
                    "name": "tactics",
                    "value": "CredentialAccess,InitialAccess"
                  },
                  {
                    "name": "techniques",
                    "value": "T1078"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "VMware SASE Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "VMware SASE",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "VMware by Broadcom"
                },
                "support": {
                  "name": "VMware by Broadcom",
                  "tier": "Partner",
                  "email": "sase-siem-integration@vmware.com",
                  "link": "https://developer.vmware.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "VMware Edge Cloud Orchestrator - High number of login failures from a source IP address",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "VMware SASE",
        "publisherDisplayName": "VMware by Broadcom",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution [Release Notes](<a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/VMware\">https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/VMware</a> SASE/ReleaseNotes.md)</p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://sase.vmware.com/\">VMware SASE</a> solution provides the capability to ingest telemetry and event data from your VMware SD-WAN fabric and Cloud Web Security service into Microsoft Sentinel through Syslog and the Orchestrator REST API.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><p><a href=\"https://learn.microsoft.com/en-us/azure/azure-monitor/logs/logs-ingestion-api-overview\">Azure Monitor Log Ingestion API</a></p>\n</li>\n<li><p><a href=\"https://azure.microsoft.com/services/functions/#overview\">Azure Functions</a></p>\n</li>\n<li><p><a href=\"https://learn.microsoft.com/en-us/azure/azure-monitor/agents/agents-overview\">Azure Monitor Agent for Syslog collection</a></p>\n</li>\n</ol>\n<p><strong>Data Connectors:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 14, <strong>Hunting Queries:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/vmware_sase_logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "VMware SASE",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "VMware by Broadcom"
        },
        "support": {
          "name": "VMware by Broadcom",
          "email": "sase-siem-integration@vmware.com",
          "tier": "Partner",
          "link": "https://developer.vmware.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
              "version": "[variables('analyticRuleObject12').analyticRuleVersion12]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
              "version": "[variables('analyticRuleObject13').analyticRuleVersion13]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
              "version": "[variables('analyticRuleObject14').analyticRuleVersion14]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            }
          ]
        },
        "firstPublishDate": "2023-12-31",
        "providers": [
          "VMware"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
