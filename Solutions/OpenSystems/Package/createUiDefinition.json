{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "basics": {
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [],
    "steps": [
      {
        "name": "osag",
        "label": "OSAG Logs-API",
        "elements": [
          {
            "name": "eventhubEndpoint",
            "type": "Microsoft.Common.TextBox",
            "label": "Logs-API Endpoint",
            "placeholder": "",
            "multiLine": false,
            "visible": true,
            "constraints": {
              "required": true
            }
          },
          {
            "name": "eventhubConnectionString",
            "type": "Microsoft.Common.PasswordBox",
            "label": {
              "password": "Logs-API Connection String"
            },
            "constraints": {
              "required": true
            },
            "options": {
              "hideConfirmation": true
            },
            "visible": true
          },
          {
            "name": "auth",
            "type": "Microsoft.Common.CheckBox",
            "label": "Authentication"
          },
          {
            "name": "proxy",
            "type": "Microsoft.Common.CheckBox",
            "label": "Proxy"
          },
          {
            "name": "ztna",
            "type": "Microsoft.Common.CheckBox",
            "label": "ZTNA"
          },
          {
            "name": "firewall",
            "type": "Microsoft.Common.CheckBox",
            "label": "Firewall"
          },
          {
            "name": "mail",
            "type": "Microsoft.Common.CheckBox",
            "label": "Mail"
          },
          {
            "name": "zeek",
            "type": "Microsoft.Common.CheckBox",
            "label": "Zeek"
          }
        ]
      },
      {
        "name": "logsWorkspace",
        "label": "Log Analytics",
        "elements": [
          {
            "name": "logsWorkspaceSelector",
            "type": "Microsoft.Solutions.ResourceSelector",
            "label": "Select Log Analytics workspace",
            "resourceType": "Microsoft.OperationalInsights/workspaces"
          },
          {
            "name": "servicePrincipal",
            "type": "Microsoft.Common.ServicePrincipalSelector",
            "label": {
              "password": "Password",
              "sectionHeader": "Service Principal"
            },
            "toolTip": {
              "password": "Fow existing Service Principal please use pre-configured secret"
            },
            "defaultValue": {
              "principalId": "<default guid>",
              "name": "osag-logs-api-connector"
            },
            "constraints": {
              "required": true
            },
            "options": {
              "hideCertificate": true
            },
            "visible": true
          }
        ]
      }
    ],
    "outputs": {
      "principalId": "[steps('logsWorkspace').servicePrincipal.objectId]",
      "principalClientId": "[steps('logsWorkspace').servicePrincipal.appId]",
      "logAnalyticsWorkspaceName": "[steps('logsWorkspace').logsWorkspaceSelector.name]",
      "principalSecret": "[steps('logsWorkspace').servicePrincipal.password]",
      "eventhubEndpoint": "[steps('osag').eventhubEndpoint]",
      "eventhubConnectionString": "[steps('osag').eventhubConnectionString]",
      "proxy": "[steps('osag').proxy]",
      "ztna": "[steps('osag').ztna]",
      "firewall": "[steps('osag').firewall]",
      "mail": "[steps('osag').mail]",
      "zeek": "[steps('osag').zeek]",
      "auth": "[steps('osag').auth]"
    }
  }
}
