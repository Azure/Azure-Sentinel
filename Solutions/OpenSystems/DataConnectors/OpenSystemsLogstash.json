{
  "id": "OpenSystemsLogstash",
  "title": "OpenSystems Logstash Connector",
  "publisher": "OpenSystems",
  "descriptionMarkdown": "This data connector deploys a Logstash instance to collect logs from your OpenSystems environment via Event Hub and ingest them into Azure Sentinel.",
  "graphQueries": [
    {
      "metricName": "Total ZTNA logs received",
      "legend": "OSAGZtnaLogs_CL",
      "baseQuery": "OSAGZtnaLogs_CL"
    },
    {
      "metricName": "Total Firewall logs received",
      "legend": "OSAGFirewallLogs_CL",
      "baseQuery": "OSAGFirewallLogs_CL"
    },
    {
      "metricName": "Total Authentication logs received",
      "legend": "OSAGAuthenticationLogs_CL",
      "baseQuery": "OSAGAuthenticationLogs_CL"
    },
    {
      "metricName": "Total Proxy logs received",
      "legend": "OSAGProxyLogs_CL",
      "baseQuery": "OSAGProxyLogs_CL"
    }
  ],
  "sampleQueries": [
    {
      "description": "Raw ZTNA logs",
      "query": "OSAGZtnaLogs_CL | take 100"
    },
    {
      "description": "View normalized ZTNA events (ASIM Authentication)",
      "query": "OpenSystemsImZTNA | take 100"
    },
    {
      "description": "Raw Firewall logs",
      "query": "OSAGFirewallLogs_CL | take 100"
    },
    {
      "description": "View normalized Firewall network sessions (ASIM NetworkSession)",
      "query": "OpenSystemsImNetworkSessionFirewall | take 100"
    },
    {
      "description": "Raw Authentication logs",
      "query": "OSAGAuthenticationLogs_CL | take 100"
    },
    {
      "description": "View normalized Authentication events (ASIM Authentication)",
      "query": "OpenSystemsImAuthentication | take 100"
    },
    {
      "description": "Raw Proxy logs",
      "query": "OSAGProxyLogs_CL | take 100"
    },
    {
      "description": "View normalized Proxy network events (ASIM NetworkSession/HTTP)",
      "query": "OpenSystemsImNetworkSessionProxy | take 100"
    }
  ],
  "dataTypes": [
    {
      "name": "OSAGZtnaLogs_CL",
      "lastDataReceivedQuery": "OSAGZtnaLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived"
    },
    {
      "name": "OSAGFirewallLogs_CL",
      "lastDataReceivedQuery": "OSAGFirewallLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived"
    },
    {
      "name": "OSAGAuthenticationLogs_CL",
      "lastDataReceivedQuery": "OSAGAuthenticationLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived"
    },
    {
      "name": "OSAGProxyLogs_CL",
      "lastDataReceivedQuery": "OSAGProxyLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived"
    }
  ],
  "connectivityCriterias": [
    {
      "type": "IsConnectedQuery",
      "value": [
        "OSAGZtnaLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived",
        "OSAGFirewallLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived",
        "OSAGAuthenticationLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived",
        "OSAGProxyLogs_CL | summarize LastLogReceived = max(TimeGenerated) | project LastLogReceived"
      ]
    }
  ],
  "availability": {
    "status": 1,
    "isPreview": true
  },
  "permissions": {
    "resourceProvider": [
      {
        "provider": "Microsoft.OperationalInsights/workspaces",
        "permissionsDisplayText": "read and write permissions are required.",
        "providerDisplayName": "Workspace",
        "scope": "Workspace",
        "requiredPermissions": {
          "write": true,
          "read": true,
          "delete": true
        }
      },
      {
        "provider": "Microsoft.OperationalInsights/solutions",
        "permissionsDisplayText": "read permission is required.",
        "providerDisplayName": "Solution",
        "scope": "Workspace",
        "requiredPermissions": {
          "read": true
        }
      }
    ]
  },
  "deploymentSteps": [
    {
      "title": "Deploy Logstash and Data Collection Rule",
      "description": "Click the button below to deploy the ARM template, which will set up the Logstash container instance, data collection rule, and associated resources.",
      "templateUri": "https://raw.githubusercontent.com/open-ch/Azure-Sentinel/feature/sentinel-solution-package/Solutions/OpenSystems/Package/mainTemplate.json",
      "uiFormDefinitionUri": "https://raw.githubusercontent.com/open-ch/Azure-Sentinel/feature/sentinel-solution-package/Solutions/OpenSystems/Package/createUiDefinition.json"
    }
  ],
  "instructionSteps": [
    {
      "title": "Connect to OpenSystems Logstash",
      "description": "Click the 'Deploy to Azure' button below to deploy the Logstash container and associated resources. This will configure the ingestion pipeline from your Event Hub to Azure Sentinel.",
      "instructions": [
        {
          "type": "DeployToAzure",
          "parameters": {
            "templateUri": "https://raw.githubusercontent.com/open-ch/Azure-Sentinel/feature/sentinel-solution-package/Solutions/OpenSystems/Package/mainTemplate.json",
            "uiFormDefinitionUri": "https://raw.githubusercontent.com/open-ch/Azure-Sentinel/feature/sentinel-solution-package/Solutions/OpenSystems/Package/createUiDefinition.json"
          }
        }
      ]
    }
  ]
}
