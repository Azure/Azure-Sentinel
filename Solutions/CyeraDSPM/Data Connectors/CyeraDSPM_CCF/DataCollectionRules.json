{
    "name": "CyeraDSPMCollectionRules",
    "apiVersion": "2022-06-01",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "[parameters('workspace-location')]",
    "kind": "[variables('blanks')]",
    "properties": {
        "streamDeclarations": {
            "Custom-CyeraDSPMClassifications-Input": {
                "columns": [
                    {
                        "name": "dataClassName",
                        "type": "string"
                    },
                    {
                        "name": "classificationName",
                        "type": "string"
                    },
                    {
                        "name": "classificationGroup",
                        "type": "string"
                    },
                    {
                        "name": "dataCategory",
                        "type": "string"
                    },
                    {
                        "name": "collections",
                        "type": "dynamic"
                    },
                    {
                        "name": "customCollections",
                        "type": "dynamic"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "name": "sensitivity",
                        "type": "string"
                    },
                    {
                        "name": "sensitivityDisplayName",
                        "type": "string"
                    },
                    {
                        "name": "defaultSensitivity",
                        "type": "string"
                    },
                    {
                        "name": "defaultSensitivityDisplayName",
                        "type": "string"
                    },
                    {
                        "name": "context",
                        "type": "dynamic"
                    },
                    {
                        "name": "frameworks",
                        "type": "dynamic"
                    },
                    {
                        "name": "learned",
                        "type": "boolean"
                    },
                    {
                        "name": "classificationLevel",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyeraDSPMAssets-Input": {
                "columns": [
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "name": "provider",
                        "type": "string"
                    },
                    {
                        "name": "infrastructure",
                        "type": "string"
                    },
                    {
                        "name": "engine",
                        "type": "string"
                    },
                    {
                        "name": "regions",
                        "type": "dynamic"
                    },
                    {
                        "name": "account",
                        "type": "dynamic"
                    },
                    {
                        "name": "classificationGroups",
                        "type": "dynamic"
                    },
                    {
                        "name": "cloudProviderTags",
                        "type": "dynamic"
                    },
                    {
                        "name": "owner",
                        "type": "string"
                    },
                    {
                        "name": "type",
                        "type": "string"
                    },
                    {
                        "name": "dataType",
                        "type": "string"
                    },
                    {
                        "name": "discoveredDate",
                        "type": "string"
                    },
                    {
                        "name": "createdDate",
                        "type": "string"
                    },
                    {
                        "name": "cloudProviderUrl",
                        "type": "string"
                    },
                    {
                        "name": "scanningState",
                        "type": "string"
                    },
                    {
                        "name": "ghost",
                        "type": "boolean"
                    },
                    {
                        "name": "vpc",
                        "type": "string"
                    },
                    {
                        "name": "sensitivity",
                        "type": "string"
                    },
                    {
                        "name": "sensitivityDisplayName",
                        "type": "string"
                    },
                    {
                        "name": "recordCountBySensitivity",
                        "type": "dynamic"
                    },
                    {
                        "name": "issues",
                        "type": "dynamic"
                    },
                    {
                        "name": "userTags",
                        "type": "dynamic"
                    },
                    {
                        "name": "collections",
                        "type": "dynamic"
                    },
                    {
                        "name": "customCollections",
                        "type": "dynamic"
                    },
                    {
                        "name": "frameworks",
                        "type": "dynamic"
                    },
                    {
                        "name": "learned",
                        "type": "boolean"
                    },
                    {
                        "name": "classificationLevel",
                        "type": "string"
                    },
                    {
                        "name": "encrypted",
                        "type": "boolean"
                    },
                    {
                        "name": "sslEnforced",
                        "type": "string"
                    },
                    {
                        "name": "logging",
                        "type": "string"
                    },
                    {
                        "name": "publicAccessibilityState",
                        "type": "string"
                    },
                    {
                        "name": "lastDataRefresh",
                        "type": "string"
                    },
                    {
                        "name": "lastModifiedTime",
                        "type": "string"
                    },
                    {
                        "name": "driveId",
                        "type": "string"
                    },
                    {
                        "name": "arn",
                        "type": "string"
                    },
                    {
                        "name": "rdsEndpoint",
                        "type": "string"
                    },
                    {
                        "name": "azureId",
                        "type": "string"
                    },
                    {
                        "name": "datastoreSizeInGiB",
                        "type": "dynamic"
                    },
                    {
                        "name": "projectIds",
                        "type": "dynamic"
                    },
                    {
                        "name": "datastoreOwners",
                        "type": "dynamic"
                    },
                    {
                        "name": "autoScan",
                        "type": "boolean"
                    },
                    {
                        "name": "siteName",
                        "type": "string"
                    },
                    {
                        "name": "userId",
                        "type": "string"
                    },
                    {
                        "name": "siteId",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyeraDSPMIssues-Input": {
                "columns": [
                    {
                        "name": "provider",
                        "type": "string"
                    },
                    {
                        "name": "infrastructure",
                        "type": "string"
                    },
                    {
                        "name": "engine",
                        "type": "string"
                    },
                    {
                        "name": "regions",
                        "type": "dynamic"
                    },
                    {
                        "name": "account",
                        "type": "dynamic"
                    },
                    {
                        "name": "classificationGroups",
                        "type": "dynamic"
                    },
                    {
                        "name": "cloudProviderTags",
                        "type": "dynamic"
                    },
                    {
                        "name": "owner",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "createdDate",
                        "type": "string"
                    },
                    {
                        "name": "updatedDate",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "riskStatus",
                        "type": "string"
                    },
                    {
                        "name": "resolution",
                        "type": "string"
                    },
                    {
                        "name": "resolutionNote",
                        "type": "string"
                    },
                    {
                        "name": "datastoreName",
                        "type": "string"
                    },
                    {
                        "name": "datastoreUid",
                        "type": "string"
                    },
                    {
                        "name": "risk",
                        "type": "dynamic"
                    },
                    {
                        "name": "data",
                        "type": "dynamic"
                    },
                    {
                        "name": "datastoreCloudProviderTags",
                        "type": "dynamic"
                    },
                    {
                        "name": "datastoreUserTags",
                        "type": "dynamic"
                    },
                    {
                        "name": "datastoreOwners",
                        "type": "dynamic"
                    },
                    {
                        "name": "remediationAdvice",
                        "type": "string"
                    },
                    {
                        "name": "policyUid",
                        "type": "string"
                    },
                    {
                        "name": "itsmTickets",
                        "type": "dynamic"
                    }
                ]
            },
            "Custom-CyeraDSPMIdentities-Input": {
                "columns": [
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "displayName",
                        "type": "string"
                    },
                    {
                        "name": "displayId",
                        "type": "string"
                    },
                    {
                        "name": "scopeNamespace",
                        "type": "string"
                    },
                    {
                        "name": "scopeDisplayName",
                        "type": "string"
                    },
                    {
                        "name": "scopeId",
                        "type": "string"
                    },
                    {
                        "name": "trustLevel",
                        "type": "string"
                    },
                    {
                        "name": "isStale",
                        "type": "boolean"
                    },
                    {
                        "name": "isEnabled",
                        "type": "boolean"
                    },
                    {
                        "name": "multiFactorAuthenticationStatus",
                        "type": "string"
                    },
                    {
                        "name": "membersCount",
                        "type": "dynamic"
                    },
                    {
                        "name": "hasCopilot",
                        "type": "boolean"
                    },
                    {
                        "name": "lastActiveTime",
                        "type": "string"
                    },
                    {
                        "name": "creationTime",
                        "type": "string"
                    },
                    {
                        "name": "description",
                        "type": "string"
                    },
                    {
                        "name": "isAdmin",
                        "type": "boolean"
                    },
                    {
                        "name": "classificationGroupsNames",
                        "type": "dynamic"
                    },
                    {
                        "name": "sensitivity",
                        "type": "string"
                    },
                    {
                        "name": "sensitiveRecords",
                        "type": "dynamic"
                    },
                    {
                        "name": "sensitivityBreakdown",
                        "type": "dynamic"
                    },
                    {
                        "name": "lastPasswordUpdateTime",
                        "type": "string"
                    },
                    {
                        "name": "jobTitle",
                        "type": "string"
                    },
                    {
                        "name": "department",
                        "type": "string"
                    },
                    {
                        "name": "officeLocation",
                        "type": "string"
                    },
                    {
                        "name": "country",
                        "type": "string"
                    },
                    {
                        "name": "hasMultipleParents",
                        "type": "boolean"
                    },
                    {
                        "name": "domain",
                        "type": "string"
                    },
                    {
                        "name": "businessFunction",
                        "type": "string"
                    },
                    {
                        "name": "seniorityLevel",
                        "type": "string"
                    },
                    {
                        "name": "issueCountBySeverity",
                        "type": "dynamic"
                    },
                    {
                        "name": "reportsTo",
                        "type": "string"
                    },
                    {
                        "name": "managerId",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "[variables('workspaceResourceId')]",
                    "name": "cyeradspm"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-CyeraDSPMClassifications-Input"
                ],
                "destinations": [
                    "cyeradspm"
                ],
                "transformKql": "source | extend TimeGenerated = now()",
                "outputStream": "Custom-CyeraDSPMClassifications_CL"
            },
            {
                "streams": [
                    "Custom-CyeraDSPMAssets-Input"
                ],
                "destinations": [
                    "cyeradspm"
                ],
                "transformKql": "source\n| extend TimeGenerated = now() \n| project-rename infrastructureType = type",
                "outputStream": "Custom-CyeraDSPMAssets_CL"
            },
            {
                "streams": [
                    "Custom-CyeraDSPMIssues-Input"
                ],
                "destinations": [
                    "cyeradspm"
                ],
                "transformKql": "source\n| extend TimeGenerated = now()",
                "outputStream": "Custom-CyeraDSPMIssues_CL"
            },
            {
                "streams": [
                    "Custom-CyeraDSPMIdentities-Input"
                ],
                "destinations": [
                    "cyeradspm"
                ],
                "transformKql": "source\n| extend TimeGenerated = now()",
                "outputStream": "Custom-CyeraDSPMIdentities_CL"
            }
        ],
        "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/CyeraDSPMDataCollectionEndpoint')]"
    }
}