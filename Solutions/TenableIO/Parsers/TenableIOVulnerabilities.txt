// Usage Instruction : 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias as TenableIOVulnerabilities.
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. TenableIOVulnerabilities | take 10).
// Reference : Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
Tenable_IO_Vuln_CL
| extend 
    EventVendor="TenableIO",
    EventProduct="Vulnerabilities",
    EventType='VulnerabilityExport',
    AssetAgentUUID=column_ifexists('asset_agent_uuid_g', ''),
    AssetBIOSUUID=column_ifexists('asset_bios_uuid_g', ''),
    AssetDeviceType=column_ifexists('asset_device_type_s', ''),
    AssetFQDN=column_ifexists('asset_fqdn_s', ''),
    AssetHostname=column_ifexists('asset_hostname_s', ''),
    AssetIPV4=column_ifexists('asset_ipv4_s', ''),
    AssetIPV6=column_ifexists('asset_ipv6_s', ''),
    AssetLastAuthenticatedScanDate=column_ifexists('asset_last_authenticated_results_t', ''),
    AssetLastUnauthenticatedScanDate=column_ifexists('asset_last_unauthenticated_results_t', ''),
    AssetMACAddress=column_ifexists('asset_mac_address_s', ''),
    AssetNetBIOSName=column_ifexists('asset_netbios_name_s', ''),
    AssetNetworkID=column_ifexists('asset_network_id_g', ''),
    AssetOperatingSystem=column_ifexists('asset_operating_system_s', ''),
    AssetTracked=column_ifexists('asset_tracked_b', ''),
    AssetUUID=column_ifexists('asset_uuid_g', ''),
    Computer=column_ifexists('Computer', ''),
    FirstFoundDate=column_ifexists('first_found_t', ''),
    IndexedDate=column_ifexists('indexed_t', ''),
    LastFixedDate=column_ifexists('last_fixed_t', ''),
    LastFoundDate=column_ifexists('last_found_t', ''),
    Output=column_ifexists('output_s', ''),
    PluginBugtraqID=column_ifexists('plugin_bid_s', ''),
    PluginCanvasPackage=column_ifexists('plugin_canvas_package_s', ''),
    PluginChecksForDefaultAccount=column_ifexists('plugin_checks_for_default_account_b', ''),
    PluginChecksForMalware=column_ifexists('plugin_checks_for_malware_b', ''),
    PluginCPE=column_ifexists('plugin_cpe_s', ''),
    PluginCVE=column_ifexists('plugin_cve_s', ''),
    PluginCVSS3BaseScore=column_ifexists('plugin_cvss3_base_score_d', ''),
    PluginCVSS3TemporalScore=column_ifexists('plugin_cvss3_temporal_score_d', ''),
    PluginCVSS3TemporalVectorExploitability=column_ifexists('plugin_cvss3_temporal_vector_exploitability_s', ''),
    PluginCVSS3TemporalVectorRaw=column_ifexists('plugin_cvss3_temporal_vector_raw_s', ''),
    PluginCVSS3TemporalVectorRemediationLevel=column_ifexists('plugin_cvss3_temporal_vector_remediation_level_s', ''),
    PluginCVSS3TemporalVectorReportConfidence=column_ifexists('plugin_cvss3_temporal_vector_report_confidence_s', ''),
    PluginCVSS3VectorAccessComplexity=column_ifexists('plugin_cvss3_vector_access_complexity_s', ''),
    PluginCVSS3VectorAccessVector=column_ifexists('plugin_cvss3_vector_access_vector_s', ''),
    PluginCVSS3VectorAvailabilityImpact=column_ifexists('plugin_cvss3_vector_availability_impact_s', ''),
    PluginCVSS3VectorConfidentialityImpact=column_ifexists('plugin_cvss3_vector_confidentiality_impact_s', ''),
    PluginCVSS3VectorIntegrityImpact=column_ifexists('plugin_cvss3_vector_integrity_impact_s', ''),
    PluginCVSS3VectorRaw=column_ifexists('plugin_cvss3_vector_raw_s', ''),
    PluginCVSSBaseScore=column_ifexists('plugin_cvss_base_score_d', ''),
    PluginCVSSTemporalScore=column_ifexists('plugin_cvss_temporal_score_d', ''),
    PluginCVSSTemporalVectorRemediationLevel=column_ifexists('plugin_cvss_temporal_vector_remediation_level_s', ''),
    PluginCVSSTemporalVectorReportConfidence=column_ifexists('plugin_cvss_temporal_vector_report_confidence_s', ''),
    PluginCVSSVectorAccessComplexity=column_ifexists('plugin_cvss_vector_access_complexity_s', ''),
    PluginCVSSVectorAccessVector=column_ifexists('plugin_cvss_vector_access_vector_s', ''),
    PluginCVSSVectorAuthentication=column_ifexists('plugin_cvss_vector_authentication_s', ''),
    PluginCVSSVectorAvailabilityImpact=column_ifexists('plugin_cvss_vector_availability_impact_s', ''),
    PluginCVSSVectorConfidentialityImpact=column_ifexists('plugin_cvss_vector_confidentiality_impact_s', ''),
    PluginCVSSVectorIntegrityImpact=column_ifexists('plugin_cvss_vector_integrity_impact_s', ''),
    PluginCVSSVectorRaw=column_ifexists('plugin_cvss_vector_raw_s', ''),
    PluginDescription=column_ifexists('plugin_description_s', ''),
    PluginExploitabilityEase=column_ifexists('plugin_exploitability_ease_s', ''),
    PluginExploitedByMalware=column_ifexists('plugin_exploited_by_malware_b', ''),
    PluginExploitedByNessus=column_ifexists('plugin_exploited_by_nessus_b', ''),
    PluginExploitAvailable=column_ifexists('plugin_exploit_available_b', ''),
    PluginExploitFrameworkCanvas=column_ifexists('plugin_exploit_framework_canvas_b', ''),
    PluginExploitFrameworkMetasploit=column_ifexists('plugin_exploit_framework_metasploit_b', ''),
    PluginFamilyID=column_ifexists('plugin_family_id_d', ''),
    PluginFamily=column_ifexists('plugin_family_s', ''),
    PluginHasPatch=column_ifexists('plugin_has_patch_b', ''),
    PluginID=column_ifexists('plugin_id_d', ''),
    PluginInTheNews=column_ifexists('plugin_in_the_news_b', ''),
    PluginMetasploitName=column_ifexists('plugin_metasploit_name_s', ''),
    PluginMicrosoftBulletin=column_ifexists('plugin_ms_bulletin_s', ''),
    PluginName=column_ifexists('plugin_name_s', ''),
    PluginPatchPublicationDate=column_ifexists('plugin_patch_publication_date_t', ''),
    PluginPublicationDate=column_ifexists('plugin_publication_date_t', ''),
    PluginRiskFactor=column_ifexists('plugin_risk_factor_s', ''),
    PluginSeeAlso=column_ifexists('plugin_see_also_s', ''),
    PluginSolution=column_ifexists('plugin_solution_s', ''),
    PluginSTIGSeverity=column_ifexists('plugin_stig_severity_s', ''),
    PluginSynopsis=column_ifexists('plugin_synopsis_s', ''),
    PluginType=column_ifexists('plugin_type_s', ''),
    PluginUnsupportedByVendor=column_ifexists('plugin_unsupported_by_vendor_b', ''),
    PluginUbuntuSecurityNotice=column_ifexists('plugin_usn_s', ''),
    PluginVersion=column_ifexists('plugin_version_s', ''),
    PluginVPRDriversAgeOfVulnLowerBound=column_ifexists('plugin_vpr_drivers_age_of_vuln_lower_bound_d', ''),
    PluginVPRDriversAgeOfVulnUpperBound=column_ifexists('plugin_vpr_drivers_age_of_vuln_upper_bound_d', ''),
    PluginVPRDriversCVSS3ImpactScore=column_ifexists('plugin_vpr_drivers_cvss3_impact_score_d', ''),
    PluginVPRDriversCVSSImpactScorePredicted=column_ifexists('plugin_vpr_drivers_cvss_impact_score_predicted_b', ''),
    PluginVPRDriversExploitCodeMaturity=column_ifexists('plugin_vpr_drivers_exploit_code_maturity_s', ''),
    PluginVPRDriversProductCoverage=column_ifexists('plugin_vpr_drivers_product_coverage_s', ''),
    PluginVPRDriversThreatIntensityLast28=column_ifexists('plugin_vpr_drivers_threat_intensity_last28_s', ''),
    PluginVPRDriversThreatRecencyLowerBound=column_ifexists('plugin_vpr_drivers_threat_recency_lower_bound_d', ''),
    PluginVPRDriversThreatRecencyUpperBound=column_ifexists('plugin_vpr_drivers_threat_recency_upper_bound_d', ''),
    PluginVPRDriversThreatSourcesLast28=column_ifexists('plugin_vpr_drivers_threat_sources_last28_s', ''),
    PluginVPRScore=column_ifexists('plugin_vpr_score_d', ''),
    PluginVPRUpdatedDate=column_ifexists('plugin_vpr_updated_t', ''),
    PluginVPRPublicationDate=column_ifexists('plugin_vuln_publication_date_t', ''),
    PluginXRefs=column_ifexists('plugin_xrefs_s', ''),
    PortNumber=column_ifexists('port_port_d', ''),
    PortProtocol=column_ifexists('port_protocol_s', ''),
    PortService=column_ifexists('port_service_s', ''),
    ScanCompletedAtTime=column_ifexists('scan_completed_at_t', ''),
    ScanScheduleUUID=column_ifexists('scan_schedule_uuid_s', ''),
    ScanID=column_ifexists('scan_uuid_g', ''),
    SeverityDefaultID=column_ifexists('severity_default_id_d', ''),
    SeverityID=column_ifexists('severity_id_d', ''),
    SeverityModificationType=column_ifexists('severity_modification_type_s', ''),
    Severity=column_ifexists('severity_s', ''),
    State=column_ifexists('state_s', '')
| project
    AssetFQDN,
    AssetIPV4,
    AssetOperatingSystem,
    Severity,
    State,
    PluginID,
    PluginName,
    PluginCVE,
    PluginCPE,
    PluginVPRScore,
    PluginCVSS3BaseScore,
    PluginCVSSBaseScore,
    PluginFamily,
    PluginDescription,
    PluginSolution,
    FirstFoundDate,
    IndexedDate,
    LastFixedDate,
    LastFoundDate,
    AssetLastAuthenticatedScanDate,
    AssetLastUnauthenticatedScanDate,
    AssetAgentUUID,
    AssetBIOSUUID,
    AssetDeviceType,
    AssetHostname,
    AssetIPV6,
    AssetMACAddress,
    AssetNetBIOSName,
    AssetNetworkID,
    AssetTracked,
    AssetUUID,
    Computer,
    Output,
    PluginBugtraqID,
    PluginCanvasPackage,
    PluginChecksForDefaultAccount,
    PluginChecksForMalware,
    PluginCVSS3TemporalScore,
    PluginCVSS3TemporalVectorExploitability,
    PluginCVSS3TemporalVectorRaw,
    PluginCVSS3TemporalVectorRemediationLevel,
    PluginCVSS3TemporalVectorReportConfidence,
    PluginCVSS3VectorAccessComplexity,
    PluginCVSS3VectorAccessVector,
    PluginCVSS3VectorAvailabilityImpact,
    PluginCVSS3VectorConfidentialityImpact,
    PluginCVSS3VectorIntegrityImpact,
    PluginCVSS3VectorRaw,
    PluginCVSSTemporalScore,
    PluginCVSSTemporalVectorRemediationLevel,
    PluginCVSSTemporalVectorReportConfidence,
    PluginCVSSVectorAccessComplexity,
    PluginCVSSVectorAccessVector,
    PluginCVSSVectorAuthentication,
    PluginCVSSVectorAvailabilityImpact,
    PluginCVSSVectorConfidentialityImpact,
    PluginCVSSVectorIntegrityImpact,
    PluginCVSSVectorRaw,
    PluginExploitabilityEase,
    PluginExploitedByMalware,
    PluginExploitedByNessus,
    PluginExploitAvailable,
    PluginExploitFrameworkCanvas,
    PluginExploitFrameworkMetasploit,
    PluginFamilyID,
    PluginHasPatch,
    PluginInTheNews,
    PluginMetasploitName,
    PluginMicrosoftBulletin,
    PluginPatchPublicationDate,
    PluginPublicationDate,
    PluginRiskFactor,
    PluginSeeAlso,
    PluginSTIGSeverity,
    PluginSynopsis,
    PluginType,
    PluginUnsupportedByVendor,
    PluginUbuntuSecurityNotice,
    PluginVersion,
    PluginVPRDriversAgeOfVulnLowerBound,
    PluginVPRDriversAgeOfVulnUpperBound,
    PluginVPRDriversCVSS3ImpactScore,
    PluginVPRDriversCVSSImpactScorePredicted,
    PluginVPRDriversExploitCodeMaturity,
    PluginVPRDriversProductCoverage,
    PluginVPRDriversThreatIntensityLast28,
    PluginVPRDriversThreatRecencyLowerBound,
    PluginVPRDriversThreatRecencyUpperBound,
    PluginVPRDriversThreatSourcesLast28,
    PluginVPRUpdatedDate,
    PluginVPRPublicationDate,
    PluginXRefs,
    PortNumber,
    PortProtocol,
    PortService,
    ScanCompletedAtTime,
    ScanScheduleUUID,
    ScanID,
    SeverityDefaultID,
    SeverityID,
    SeverityModificationType,
    EventVendor,
    EventProduct,
    EventType
