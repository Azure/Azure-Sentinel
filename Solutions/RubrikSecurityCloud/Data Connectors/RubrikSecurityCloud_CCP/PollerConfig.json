{
  "properties": {
    "connectorDefinitionName": "RSCBackupStatusConnectorDefinition",
    "dataType": "Rubrik Security Cloud Protection Status",
    "dcrConfig": {
      "dataCollectionEndpoint": "[reference(resourceId('Microsoft.Insights/dataCollectionEndpoints', 'RSCBackupStatusDCE')).logsIngestion.endpoint]",
      "dataCollectionRuleImmutableId": "[reference(resourceId('Microsoft.Insights/dataCollectionRules', 'RSCBackupStatusDCR')).immutableId]",
      "streamName": "Custom-RubrikBackupStatus_API"
    },
    "auth": {
      "type": "OAuth2",
      "ClientId": "[parameters('ClientId')]",
      "ClientSecret": "[parameters('ClientSecret')]",
      "GrantType": "client_credentials",
      "TokenEndpoint": "[concat(parameters('RSCUrl'), '/api/client_token')]",
      "TokenEndpointHeaders": {
        "Content-Type": "application/x-www-form-urlencoded",
        "User-Agent": "Microsoft-Azure-DataConnector/1.0"
      },
      "TokenEndpointMethod": "POST"
    },
    "request": {
      "apiEndpoint": "[concat(parameters('RSCUrl'), '/api/graphql')]",
      "httpMethod": "POST",
      "rateLimitQPS": 5,
      "queryWindowInMin": 60,
      "retryCount": 3,
      "timeoutInSeconds": 120,
      "headers": {
        "Content-Type": "application/json",
        "User-Agent": "Scuba"
      },
      "queryParametersTemplate": "{\"variables\":{},\"query\":\"{\n  snappableConnection(\n    filter: {objectType: [AzureNativeVm], isLocal: true, objectState: [ACTIVE]}\n    first: 50\n  ) {\n    nodes {\n      id\n      name\n      objectType\n      objectState\n      protectionStatus\n      complianceStatus\n      archivalComplianceStatus\n      replicationComplianceStatus\n      lastSnapshot\n      latestArchivalSnapshot\n      latestReplicationSnapshot\n      protectedOn\n      pullTime\n      location\n      cluster {\n        name\n      }\n      slaDomain {\n        name\n      }\n      workloadOrg {\n        name\n      }\n      orgName\n      fid\n      orgId\n      awaitingFirstFull\n      archivalSnapshotLag\n      replicationSnapshotLag\n      missedSnapshots\n      totalSnapshots\n      localSnapshots\n      localSlaSnapshots\n      localOnDemandSnapshots\n      archiveSnapshots\n      replicaSnapshots\n      localStorage\n      archiveStorage\n      replicaStorage\n      localEffectiveStorage\n      logicalBytes\n      physicalBytes\n      usedBytes\n      provisionedBytes\n      transferredBytes\n      localProtectedData\n      localMeteredData\n      lastSnapshotLogicalBytes\n      dataReduction\n      logicalDataReduction\n      sourceProtocol\n      ncdPolicyName\n      ncdSnapshotType\n      ncdLatestArchiveSnapshot\n    }\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n  }\n}\"}",
      "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ"
    },
    "response": {
      "eventsJsonPaths": [
        "$.data.snappableConnection.nodes"
      ]
    }
  },
  "apiVersion": "2022-09-01-preview",
  "name": "RubrikSecurityCloudProtectionStatusPoller",
  "kind": "RestApiPoller",
  "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors"
}
