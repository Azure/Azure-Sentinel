{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "metadata": {
        "title":  "Rubrik Anomaly Analysis",
        "description":  "This playbook queries Rubrik Security Cloud to enrich the Anomaly event with additional information regarding the Ransomware analysis, results from sensitive data scans, (to aid in incident prioritization), and additional information about the Rubrik cluster. Also it retrieves suspiciousFiles information associated with anomalous snapshot and internally calls RubrikAnomalyGenerateDownloadableLink playbook to get downloadable links and enrich the anomaly incident.",
        "prerequisites":  [
            "1. The Rubrik Security Cloud data connector should be configured to send appropriate events to Microsoft Sentinel.",
            "2. The Rubrik Security Cloud solution should be configured to [connect to Rubrik Security Cloud API end points using a Service Account](https://docs.rubrik.com/en-us/saas/saas/polaris_api_access_with_service_accounts.html), the service account should be assigned a role that includes the relevant privileges necessary to perform the desired operations (see [Roles and Permissions](https://docs.rubrik.com/en-us/saas/saas/common/roles_and_permissions.html) in the Rubrik Security Cloud user guide).",
            "3. Rubrik custom connector needs to be deployed prior to the deployment of this playbook, in the same resource group and region. Relevant instructions can be found in the connector doc page.",
            "4. Store Service account credentials in Key Vault and obtain keyvault name and tenantId",
                "a. Create a Key Vault with unique name",
                "b. Go to KeyVault -> secrets -> Generate/import and create 'Rubrik-AS-Int-ClientId' & 'Rubrik-AS-Int-ClientSecret' for storing client_id and client_secret respectively",
            "5. Make sure that RubrikAnomalyGenerateDownloadableLink playbook is deployed before deploying RubrikAnomalyAnalysis playbook."
        ],
        "postDeployment":  [
            "**a. Authorize connections**",
            "Once deployment is complete, authorize each connection.",
            "1. Click the Custom Connector connection resource",
            "2. Click edit API connection",
            "3. Click Authorize",
            "4. Sign in",
            "5. Click Save",
            "6. Repeat steps for other connections"
        ],
        "prerequisitesDeployTemplateFile": "Azure-Sentinel/Solutions/RubrikSecurityCloud/Playbooks/RubrikCustomConnector/Rubrik_custom_conn.json",
        "lastUpdateTime":  "2024-02-21T00:00:00.000Z",
        "entities":  ["account","url"],
        "tags":  ["Anomaly","Enrichment","Rubrik"],
        "support":  {
            "tier":  "community",
            "armtemplate":  "Generated from https://github.com/Azure/Azure-Sentinel/tree/master/Tools/Playbook-ARM-Template-Generator"
        },
        "author":  {
            "name":  "Rubrik"
        }
    },
    "parameters":  {
        "PlaybookName":  {
            "defaultValue":  "RubrikAnomalyAnalysis",
            "type":  "string"
        },
        "Rubrik Connector name": {
            "defaultValue": "RubrikCustomConnector",
            "type": "String",
            "metadata": {
                "description": "Rubrik Custom Connector name"
            }
        },
        "keyvaultName": {
            "defaultValue": "RubrikSentinelKeyVault",
            "type": "string"
        },
        "tenantId": {
            "type": "string"
        },
        "DownloadableLinkGeneratePlaybookName": {
            "type": "string",
            "metadata": {
                "description": "Playbook name that you have given while deployment of playbook RubrikGenerateDownloadableLink(e.g.RubrikGenerateDownloadableLink)"
            }
        }
    },
    "variables": {
        "RubrikcustomconnectorConnectionName": "[concat('Rubrikcustomconnector-', parameters('PlaybookName'))]",
        "KeyvaultConnectionName": "[concat('Keyvault-', parameters('PlaybookName'))]"
    },
    "resources": [
        {
            "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                    "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                        "$connections": {
                            "defaultValue": {},
                            "type": "Object"
                        }
                    },
                    "triggers": {
                        "manual": {
                            "type": "Request",
                            "kind": "Http",
                            "inputs": {
                                "schema": {
                                    "properties": {
                                        "BaseUrl": {
                                            "type": "string"
                                        },
                                        "ClusterId": {
                                            "type": "string"
                                        },
                                        "IncidentARMId": {
                                            "type": "string"
                                        },
                                        "IncidentStartTime": {
                                            "type": "string"
                                        },
                                        "ObjectId": {
                                            "type": "string"
                                        },
                                        "ObjectName": {
                                            "type": "string"
                                        },
                                        "ObjectType": {
                                            "type": "string"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "actions": {
                        "Authentication": {
                            "runAfter": {
                                "Get_secret": [
                                    "Succeeded"
                                ]
                            },
                            "type": "ApiConnection",
                            "inputs": {
                                "body": {
                                    "client_id": "@body('Get_Client_Id_')?['value']",
                                    "client_secret": "@body('Get_secret')?['value']"
                                },
                                "headers": {
                                    "Content-Type": "application/json"
                                },
                                "host": {
                                    "connection": {
                                        "name": "@parameters('$connections')['RubrikCustomConnector']['connectionId']"
                                    }
                                },
                                "method": "post",
                                "path": "/api/client_token"
                            },
                            "runtimeConfiguration": {
                                "secureData": {
                                    "properties": [
                                        "inputs",
                                        "outputs"
                                    ]
                                }
                            }
                        },
                        "Determine_the_status_of_the_Rubrik_Radar_analysis_process": {
                            "runAfter": {
                                "Initialize_access_token": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Http",
                            "inputs": {
                                "body": {
                                    "query": "query EventSeriesListQuery($after: String, $filters: ActivitySeriesFilter, $first: Int, $sortBy: ActivitySeriesSortField, $sortOrder: SortOrder) {\r\n  activitySeriesConnection(\r\n    after: $after\r\n    first: $first\r\n    filters: $filters\r\n    sortBy: $sortBy\r\n    sortOrder: $sortOrder\r\n  ) {\r\n    edges {\r\n      cursor\r\n      node {\r\n        ...EventSeriesFragment\r\n        cluster {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        activityConnection(first: 1) {\r\n          nodes {\r\n            id\r\n            message\r\n            __typename\r\n          }\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      __typename\r\n    }\r\n    pageInfo {\r\n      endCursor\r\n      hasNextPage\r\n      hasPreviousPage\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n}\r\n\r\nfragment EventSeriesFragment on ActivitySeries {\r\n  id\r\n  fid\r\n  activitySeriesId\r\n  lastUpdated\r\n  lastActivityType\r\n  lastActivityStatus\r\n  objectId\r\n  objectName\r\n  objectType\r\n  severity\r\n  progress\r\n  isCancelable\r\n  isPolarisEventSeries\r\n  location\r\n  __typename\r\n}\r\n",
                                    "variables": {
                                        "filters": {
                                            "clusterId": "@variables('ClusterId')",
                                            "lastActivityStatus": [],
                                            "lastActivityType": [
                                                "ANOMALY"
                                            ],
                                            "lastUpdatedTimeGt": "@{variables('StartDate')}",
                                            "objectName": "@{variables('ObjectName')}",
                                            "objectType": [],
                                            "severity": []
                                        },
                                        "first": 40,
                                        "sortBy": "OBJECT_NAME",
                                        "sortOrder": "ASC"
                                    }
                                },
                                "headers": {
                                    "Authorization": "Bearer @{variables('access_token')}",
                                    "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                            }
                        },
                        "Does_Object_List_get_status_code_200": {
                            "actions": {
                                "Does_Object_List_API_response_contains_errors": {
                                    "actions": {
                                        "Set_API_response_error_as_status": {
                                            "runAfter": {},
                                            "type": "SetVariable",
                                            "inputs": {
                                                "name": "Status",
                                                "value": "Error:@{body('rubrik-sonar-sensitive-hits(Object_List)')?['errors'][0]?['message']}"
                                            }
                                        }
                                    },
                                    "runAfter": {},
                                    "else": {
                                        "actions": {
                                            "Does_Object_Id_found": {
                                                "actions": {
                                                    "Does_sonar_sensitive_hits(Object_Details)_get_status_code_200": {
                                                        "actions": {
                                                            "Does_Object_Details_API_response_contain_errors": {
                                                                "actions": {
                                                                    "Set_API_error_response_as_status_": {
                                                                        "runAfter": {},
                                                                        "type": "SetVariable",
                                                                        "inputs": {
                                                                            "name": "Status",
                                                                            "value": "Error:@{body('sonar_sensitive_hits(Object_Details)')?['errors'][0]?['message']}"
                                                                        }
                                                                    }
                                                                },
                                                                "runAfter": {},
                                                                "expression": {
                                                                    "and": [
                                                                        {
                                                                            "contains": [
                                                                                "@body('sonar_sensitive_hits(Object_Details)')",
                                                                                "errors"
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                "type": "If"
                                                            }
                                                        },
                                                        "runAfter": {
                                                            "sonar_sensitive_hits(Object_Details)": [
                                                                "Succeeded",
                                                                "Failed"
                                                            ]
                                                        },
                                                        "else": {
                                                            "actions": {
                                                                "Set_Error_message_with_status_code_for_Object_Details": {
                                                                    "runAfter": {},
                                                                    "type": "SetVariable",
                                                                    "inputs": {
                                                                        "name": "Status",
                                                                        "value": "StatusCode: @{outputs('sonar_sensitive_hits(Object_Details)')['statusCode']}Error:@{body('sonar_sensitive_hits(Object_Details)')?['message']}"
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "expression": {
                                                            "and": [
                                                                {
                                                                    "equals": [
                                                                        "@outputs('sonar_sensitive_hits(Object_Details)')['statusCode']",
                                                                        200
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        "type": "If"
                                                    },
                                                    "sonar_sensitive_hits(Object_Details)": {
                                                        "runAfter": {},
                                                        "type": "Http",
                                                        "inputs": {
                                                            "body": {
                                                                "query": "query ObjectDetailQuery($snappableFid: String!, $snapshotFid: String!) {\r\n                policyObj(snappableFid: $snappableFid, snapshotFid: $snapshotFid) {\r\n                    id\r\n                    rootFileResult {\r\n                        hits {\r\n                            totalHits\r\n                    }\r\n                    analyzerGroupResults {\r\n                        analyzerGroup {\r\n                            name\r\n                        }\r\n                        analyzerResults {\r\n                            hits {\r\n                                totalHits\r\n                            }\r\n                            analyzer {\r\n                                name\r\n                            }\r\n                        }\r\n                            hits {\r\n                            totalHits\r\n                        }\r\n                    }\r\n                    filesWithHits {\r\n                        totalHits\r\n                    }\r\n                    openAccessFiles {\r\n                        totalHits\r\n                    }\r\n                    openAccessFolders {\r\n                        totalHits\r\n                    }\r\n                    openAccessFilesWithHits {\r\n                        totalHits\r\n                    }\r\n                    staleFiles {\r\n                        totalHits\r\n                    }\r\n                    staleFilesWithHits {\r\n                        totalHits\r\n                    }\r\n                    openAccessStaleFiles {\r\n                        totalHits\r\n                    }\r\n                    }\r\n                }\r\n            }\r\n",
                                                                "variables": {
                                                                    "snappableFid": "@{variables('ObjectId')}",
                                                                    "snapshotFid": "@{variables('SnapshotId')}"
                                                                }
                                                            },
                                                            "headers": {
                                                                "Authorization": "Bearer @{variables('access_token')}",
                                                                "Content-Type": "application/json"
                                                            },
                                                            "method": "POST",
                                                            "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                                                        }
                                                    }
                                                },
                                                "runAfter": {
                                                    "For_each": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "expression": {
                                                    "and": [
                                                        {
                                                            "not": {
                                                                "equals": [
                                                                    "@empty(variables('ObjectId'))",
                                                                    true
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                },
                                                "type": "If"
                                            },
                                            "For_each": {
                                                "foreach": "@body('Parse_JSON_of_Object_List')?['data']?['policyObjs']?['edges']",
                                                "actions": {
                                                    "Does_snappable_name_equals_to_Object_name_fetched_from_incidnet_": {
                                                        "actions": {
                                                            "Set_Object_Id": {
                                                                "runAfter": {},
                                                                "type": "SetVariable",
                                                                "inputs": {
                                                                    "name": "ObjectId",
                                                                    "value": "@items('For_each')?['node']?['snappable']?['id']"
                                                                }
                                                            },
                                                            "Set_Snapshot_Id": {
                                                                "runAfter": {
                                                                    "Set_Object_Id": [
                                                                        "Succeeded"
                                                                    ]
                                                                },
                                                                "type": "SetVariable",
                                                                "inputs": {
                                                                    "name": "SnapshotId",
                                                                    "value": "@items('For_each')?['node']?['snapshotFid']"
                                                                }
                                                            }
                                                        },
                                                        "runAfter": {},
                                                        "expression": {
                                                            "and": [
                                                                {
                                                                    "equals": [
                                                                        "@items('For_each')?['node']?['snappable']?['name']",
                                                                        "@variables('ObjectName')"
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        "type": "If"
                                                    }
                                                },
                                                "runAfter": {
                                                    "Parse_JSON_of_Object_List": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "Foreach",
                                                "runtimeConfiguration": {
                                                    "concurrency": {
                                                        "repetitions": 1
                                                    }
                                                }
                                            },
                                            "Parse_JSON_of_Object_List": {
                                                "runAfter": {},
                                                "type": "ParseJson",
                                                "inputs": {
                                                    "content": "@body('rubrik-sonar-sensitive-hits(Object_List)')",
                                                    "schema": {
                                                        "properties": {
                                                            "data": {
                                                                "properties": {
                                                                    "policyObjs": {
                                                                        "properties": {
                                                                            "__typename": {
                                                                                "type": "string"
                                                                            },
                                                                            "edges": {
                                                                                "items": {
                                                                                    "properties": {
                                                                                        "__typename": {
                                                                                            "type": "string"
                                                                                        },
                                                                                        "cursor": {
                                                                                            "type": "string"
                                                                                        },
                                                                                        "node": {
                                                                                            "properties": {
                                                                                                "__typename": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "id": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "objectStatus": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "latestSnapshotResult": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "snapshotFid": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "snapshotTime": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "policyStatuses": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "__typename": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "status": {
                                                                                                                        "type": "string"
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "__typename",
                                                                                                                    "status"
                                                                                                                ],
                                                                                                                "type": [
                                                                                                                    "object",
                                                                                                                    "null"
                                                                                                                ]
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": [
                                                                                                        "object",
                                                                                                        "null"
                                                                                                    ]
                                                                                                },
                                                                                                "osType": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "rootFileResult": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "analyzerGroupResults": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "__typename": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "analyzerGroup": {
                                                                                                                        "properties": {
                                                                                                                            "__typename": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "groupType": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "id": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "name": {
                                                                                                                                "type": "string"
                                                                                                                            }
                                                                                                                        },
                                                                                                                        "type": [
                                                                                                                            "object",
                                                                                                                            "null"
                                                                                                                        ]
                                                                                                                    },
                                                                                                                    "analyzerResults": {
                                                                                                                        "type": "array"
                                                                                                                    },
                                                                                                                    "hits": {
                                                                                                                        "properties": {
                                                                                                                            "__typename": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "permittedHits": {
                                                                                                                                "type": "integer"
                                                                                                                            },
                                                                                                                            "totalHits": {
                                                                                                                                "type": "integer"
                                                                                                                            },
                                                                                                                            "totalHitsDelta": {
                                                                                                                                "type": "integer"
                                                                                                                            },
                                                                                                                            "violations": {
                                                                                                                                "type": "integer"
                                                                                                                            },
                                                                                                                            "violationsDelta": {
                                                                                                                                "type": "integer"
                                                                                                                            }
                                                                                                                        },
                                                                                                                        "type": [
                                                                                                                            "object",
                                                                                                                            "null"
                                                                                                                        ]
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "__typename",
                                                                                                                    "analyzerGroup",
                                                                                                                    "analyzerResults",
                                                                                                                    "hits"
                                                                                                                ],
                                                                                                                "type": [
                                                                                                                    "object",
                                                                                                                    "null"
                                                                                                                ]
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        },
                                                                                                        "filesWithHits": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "hits": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "numActivities": {
                                                                                                            "type": "integer"
                                                                                                        },
                                                                                                        "numActivitiesDelta": {
                                                                                                            "type": "integer"
                                                                                                        },
                                                                                                        "openAccessFiles": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "openAccessFilesWithHits": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "openAccessFolders": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "openAccessStaleFiles": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "staleFiles": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "staleFilesWithHits": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "permittedHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHits": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "totalHitsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violations": {
                                                                                                                    "type": "integer"
                                                                                                                },
                                                                                                                "violationsDelta": {
                                                                                                                    "type": "integer"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        }
                                                                                                    },
                                                                                                    "type": [
                                                                                                        "object",
                                                                                                        "null"
                                                                                                    ]
                                                                                                },
                                                                                                "shareType": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "snappable": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "cluster": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "id": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "name": {
                                                                                                                    "type": "string"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "effectiveSlaDomain": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "id": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "name": {
                                                                                                                    "type": "string"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": [
                                                                                                                "object",
                                                                                                                "null"
                                                                                                            ]
                                                                                                        },
                                                                                                        "id": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "logicalPath": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "__typename": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "name": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "objectType": {
                                                                                                                        "type": "string"
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "__typename",
                                                                                                                    "name",
                                                                                                                    "objectType"
                                                                                                                ],
                                                                                                                "type": [
                                                                                                                    "object",
                                                                                                                    "null"
                                                                                                                ]
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        },
                                                                                                        "name": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "objectType": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "physicalPath": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "__typename": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "name": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "objectType": {
                                                                                                                        "type": "string"
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "__typename",
                                                                                                                    "name",
                                                                                                                    "objectType"
                                                                                                                ],
                                                                                                                "type": [
                                                                                                                    "object",
                                                                                                                    "null"
                                                                                                                ]
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        },
                                                                                                        "slaAssignment": {
                                                                                                            "type": "string"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": [
                                                                                                        "object",
                                                                                                        "null"
                                                                                                    ]
                                                                                                },
                                                                                                "snapshotFid": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "snapshotTimestamp": {
                                                                                                    "type": "integer"
                                                                                                }
                                                                                            },
                                                                                            "type": [
                                                                                                "object",
                                                                                                "null"
                                                                                            ]
                                                                                        }
                                                                                    },
                                                                                    "required": [
                                                                                        "__typename",
                                                                                        "cursor",
                                                                                        "node"
                                                                                    ],
                                                                                    "type": [
                                                                                        "object",
                                                                                        "null"
                                                                                    ]
                                                                                },
                                                                                "type": "array"
                                                                            },
                                                                            "pageInfo": {
                                                                                "properties": {
                                                                                    "__typename": {
                                                                                        "type": "string"
                                                                                    },
                                                                                    "endCursor": {
                                                                                        "type": "string"
                                                                                    },
                                                                                    "hasNextPage": {
                                                                                        "type": "boolean"
                                                                                    },
                                                                                    "hasPreviousPage": {
                                                                                        "type": "boolean"
                                                                                    },
                                                                                    "startCursor": {
                                                                                        "type": "string"
                                                                                    }
                                                                                },
                                                                                "type": [
                                                                                    "object",
                                                                                    "null"
                                                                                ]
                                                                            }
                                                                        },
                                                                        "type": [
                                                                            "object",
                                                                            "null"
                                                                        ]
                                                                    }
                                                                },
                                                                "type": [
                                                                    "object",
                                                                    "null"
                                                                ]
                                                            }
                                                        },
                                                        "type": [
                                                            "object",
                                                            "null"
                                                        ]
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "expression": {
                                        "and": [
                                            {
                                                "contains": [
                                                    "@body('rubrik-sonar-sensitive-hits(Object_List)')",
                                                    "errors"
                                                ]
                                            }
                                        ]
                                    },
                                    "type": "If"
                                }
                            },
                            "runAfter": {
                                "rubrik-sonar-sensitive-hits(Object_List)": [
                                    "Succeeded",
                                    "TimedOut",
                                    "Skipped",
                                    "Failed"
                                ]
                            },
                            "else": {
                                "actions": {
                                    "Set_error_message_with_status_code_for_Object_List": {
                                        "runAfter": {},
                                        "type": "SetVariable",
                                        "inputs": {
                                            "name": "Status",
                                            "value": "StatusCode:@{outputs('rubrik-sonar-sensitive-hits(Object_List)')['statusCode']} Error:@{body('rubrik-sonar-sensitive-hits(Object_List)')?['message']}"
                                        }
                                    }
                                }
                            },
                            "expression": {
                                "and": [
                                    {
                                        "equals": [
                                            "@outputs('rubrik-sonar-sensitive-hits(Object_List)')['statusCode']",
                                            200
                                        ]
                                    }
                                ]
                            },
                            "type": "If"
                        },
                        "Does_cdm-cluster-connection_get_status_code_200": {
                            "actions": {
                                "Does_cdm-cluster-connection_API_response_contain_errors": {
                                    "actions": {
                                        "Set_error_response_as_cluster_connection_status": {
                                            "runAfter": {},
                                            "type": "SetVariable",
                                            "inputs": {
                                                "name": "ClusterConnectionStatus",
                                                "value": "Error:@{body('rubrik-cdm-cluster-connection-state')?['errors'][0]?['message']}"
                                            }
                                        }
                                    },
                                    "runAfter": {},
                                    "expression": {
                                        "and": [
                                            {
                                                "contains": [
                                                    "@body('rubrik-cdm-cluster-connection-state')",
                                                    "errors"
                                                ]
                                            }
                                        ]
                                    },
                                    "type": "If"
                                }
                            },
                            "runAfter": {
                                "rubrik-cdm-cluster-connection-state": [
                                    "Succeeded",
                                    "TimedOut",
                                    "Skipped",
                                    "Failed"
                                ]
                            },
                            "else": {
                                "actions": {
                                    "Set_error_message_with_status_code_for_cluster_connection": {
                                        "runAfter": {},
                                        "type": "SetVariable",
                                        "inputs": {
                                            "name": "ClusterConnectionStatus",
                                            "value": "StatusCode:@{outputs('rubrik-cdm-cluster-connection-state')['statusCode']} Error:@{body('rubrik-cdm-cluster-connection-state')?['message']}"
                                        }
                                    }
                                }
                            },
                            "expression": {
                                "and": [
                                    {
                                        "equals": [
                                            "@outputs('rubrik-cdm-cluster-connection-state')['statusCode']",
                                            200
                                        ]
                                    }
                                ]
                            },
                            "type": "If"
                        },
                        "Does_cdm-cluster-location_get_status_code_200": {
                            "actions": {
                                "Does_cdm-cluster-location_API_response_contains_error": {
                                    "actions": {
                                        "Set_error_response_as_cluster_location_status": {
                                            "runAfter": {},
                                            "type": "SetVariable",
                                            "inputs": {
                                                "name": "ClusterLocationStatus",
                                                "value": "Error:@{body('rubrik-cdm-cluster-location')?['errors'][0]?['message']}"
                                            }
                                        }
                                    },
                                    "runAfter": {},
                                    "expression": {
                                        "and": [
                                            {
                                                "contains": [
                                                    "@body('rubrik-cdm-cluster-location')",
                                                    "errors"
                                                ]
                                            }
                                        ]
                                    },
                                    "type": "If"
                                }
                            },
                            "runAfter": {
                                "rubrik-cdm-cluster-location": [
                                    "Succeeded",
                                    "TimedOut",
                                    "Skipped",
                                    "Failed"
                                ]
                            },
                            "else": {
                                "actions": {
                                    "Set_Error_message_with_status_code_for_Cluster_location": {
                                        "runAfter": {},
                                        "type": "SetVariable",
                                        "inputs": {
                                            "name": "ClusterLocationStatus",
                                            "value": "StatusCode: @{outputs('rubrik-cdm-cluster-location')['statusCode']}Error:@{body('rubrik-cdm-cluster-location')?['message']}"
                                        }
                                    }
                                }
                            },
                            "expression": {
                                "and": [
                                    {
                                        "equals": [
                                            "@outputs('rubrik-cdm-cluster-location')['statusCode']",
                                            200
                                        ]
                                    }
                                ]
                            },
                            "type": "If"
                        },
                        "Does_radar_analysis_get_status_code_200_": {
                            "actions": {
                                "Does_radar_analysis_response_contains_error": {
                                    "actions": {
                                        "Set_Event__List_API_error_response": {
                                            "runAfter": {},
                                            "type": "SetVariable",
                                            "inputs": {
                                                "name": "EventListAPIStatus",
                                                "value": "Error:@{body('Determine_the_status_of_the_Rubrik_Radar_analysis_process')?['errors'][0]?['message']}"
                                            }
                                        }
                                    },
                                    "runAfter": {},
                                    "else": {
                                        "actions": {
                                            "Does_get_cdmId_request_status_code_equal_to_200": {
                                                "actions": {
                                                    "Does_get_cdmId_response_contain_errors": {
                                                        "actions": {
                                                            "Set_error_message_with_status_code_200": {
                                                                "runAfter": {},
                                                                "type": "SetVariable",
                                                                "inputs": {
                                                                    "name": "anomalousFilesStatus",
                                                                    "value": "Error:@{body('Get_cdm_snapshotid_for_latest_snapshotfid')?['errors'][0]?['message']}"
                                                                }
                                                            }
                                                        },
                                                        "runAfter": {},
                                                        "else": {
                                                            "actions": {
                                                                "Parse_JSON": {
                                                                    "runAfter": {},
                                                                    "type": "ParseJson",
                                                                    "inputs": {
                                                                        "content": "@body('Get_cdm_snapshotid_for_latest_snapshotfid')",
                                                                        "schema": {
                                                                            "properties": {
                                                                                "data": {
                                                                                    "properties": {
                                                                                        "snapshot": {
                                                                                            "properties": {
                                                                                                "__typename": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "cdmId": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "cluster": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "id": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "name": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "status": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "version": {
                                                                                                            "type": "string"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                },
                                                                                                "date": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "snappableNew": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "authorizedOperations": {
                                                                                                            "items": {
                                                                                                                "type": "string"
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        },
                                                                                                        "cdmId": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "id": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "name": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "objectType": {
                                                                                                            "type": "string"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                }
                                                                                            },
                                                                                            "type": "object"
                                                                                        }
                                                                                    },
                                                                                    "type": "object"
                                                                                }
                                                                            },
                                                                            "type": "object"
                                                                        }
                                                                    }
                                                                },
                                                                "Set_cdmId": {
                                                                    "runAfter": {
                                                                        "Parse_JSON": [
                                                                            "Succeeded"
                                                                        ]
                                                                    },
                                                                    "type": "SetVariable",
                                                                    "inputs": {
                                                                        "name": "cdmId",
                                                                        "value": "@body('Parse_JSON')?['data']?['snapshot']?['cdmId']"
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "expression": {
                                                            "and": [
                                                                {
                                                                    "contains": [
                                                                        "@body('Get_cdm_snapshotid_for_latest_snapshotfid')",
                                                                        "errors"
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        "type": "If"
                                                    }
                                                },
                                                "runAfter": {
                                                    "Get_cdm_snapshotid_for_latest_snapshotfid": [
                                                        "Succeeded",
                                                        "Failed"
                                                    ]
                                                },
                                                "else": {
                                                    "actions": {
                                                        "Set_error_message_in_get_cdmId": {
                                                            "runAfter": {},
                                                            "type": "SetVariable",
                                                            "inputs": {
                                                                "name": "anomalousFilesStatus",
                                                                "value": "Error:@{body('Get_cdm_snapshotid_for_latest_snapshotfid')?['message']}"
                                                            }
                                                        }
                                                    }
                                                },
                                                "expression": {
                                                    "and": [
                                                        {
                                                            "equals": [
                                                                "@outputs('Get_cdm_snapshotid_for_latest_snapshotfid')['statusCode']",
                                                                200
                                                            ]
                                                        }
                                                    ]
                                                },
                                                "type": "If"
                                            },
                                            "Does_get_suspicious_files_status_code_equal_to_200": {
                                                "actions": {
                                                    "Does_get_suspicious_files_response_contain_errors": {
                                                        "actions": {
                                                            "Set_errormessage_with_status_code_200_from_get_suspicious_files": {
                                                                "runAfter": {},
                                                                "type": "SetVariable",
                                                                "inputs": {
                                                                    "name": "anomalousFilesStatus",
                                                                    "value": "Error:@{body('Get_Suspicious_files_for_a_latest_snpshot_of_given_object')?['errors'][0]?['message']}"
                                                                }
                                                            }
                                                        },
                                                        "runAfter": {},
                                                        "else": {
                                                            "actions": {
                                                                "Does_snapshot_contain_anomaly": {
                                                                    "actions": {
                                                                        "Compose": {
                                                                            "runAfter": {
                                                                                "For_each_anomaly_result": [
                                                                                    "Succeeded"
                                                                                ]
                                                                            },
                                                                            "type": "Compose",
                                                                            "inputs": "@variables('SuspiciousFiles')"
                                                                        },
                                                                        "For_each_anomaly_result": {
                                                                            "foreach": "@body('Parse_JSON_2')?['data']?['anomalyResultOpt']?['anomalyInfo']?['strainAnalysisInfo']",
                                                                            "actions": {
                                                                                "For_each_AfffectedFiles": {
                                                                                    "foreach": "@items('For_each_anomaly_result')['sampleAffectedFilesInfo']",
                                                                                    "actions": {
                                                                                        "Append_filePath_of_affected_files_to_array": {
                                                                                            "runAfter": {
                                                                                                "Append_to_SuspiciousFiles": [
                                                                                                    "Succeeded"
                                                                                                ]
                                                                                            },
                                                                                            "type": "AppendToArrayVariable",
                                                                                            "inputs": {
                                                                                                "name": "filePaths",
                                                                                                "value": {
                                                                                                    "title": "@items('For_each_AfffectedFiles')?['filePath']",
                                                                                                    "value": "@items('For_each_AfffectedFiles')?['filePath']"
                                                                                                }
                                                                                            }
                                                                                        },
                                                                                        "Append_to_SuspiciousFiles": {
                                                                                            "runAfter": {},
                                                                                            "type": "AppendToArrayVariable",
                                                                                            "inputs": {
                                                                                                "name": "SuspiciousFiles",
                                                                                                "value": {
                                                                                                    "filePath": "@items('For_each_AfffectedFiles')?['filePath']",
                                                                                                    "lastModified": "@items('For_each_AfffectedFiles')?['lastModified']",
                                                                                                    "suspiciousActivity": "Ransomware encryption"
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    "runAfter": {
                                                                                        "For_each_sampleRansomwareNotefiles": [
                                                                                            "Succeeded"
                                                                                        ]
                                                                                    },
                                                                                    "type": "Foreach"
                                                                                },
                                                                                "For_each_sampleRansomwareNotefiles": {
                                                                                    "foreach": "@items('For_each_anomaly_result')?['sampleRansomwareNoteFilesInfo']",
                                                                                    "actions": {
                                                                                        "Append_to_SuspiciousFiles_Array": {
                                                                                            "runAfter": {},
                                                                                            "type": "AppendToArrayVariable",
                                                                                            "inputs": {
                                                                                                "name": "SuspiciousFiles",
                                                                                                "value": {
                                                                                                    "filePath": "@items('For_each_sampleRansomwareNotefiles')?['filePath']",
                                                                                                    "lastModified": "@items('For_each_sampleRansomwareNotefiles')?['lastModified']",
                                                                                                    "suspiciousActivity": "Ransomware note"
                                                                                                }
                                                                                            }
                                                                                        },
                                                                                        "Append_to_filepath_array": {
                                                                                            "runAfter": {
                                                                                                "Append_to_SuspiciousFiles_Array": [
                                                                                                    "Succeeded"
                                                                                                ]
                                                                                            },
                                                                                            "type": "AppendToArrayVariable",
                                                                                            "inputs": {
                                                                                                "name": "filePaths",
                                                                                                "value": {
                                                                                                    "title": "@items('For_each_sampleRansomwareNotefiles')?['filePath']",
                                                                                                    "value": "@items('For_each_sampleRansomwareNotefiles')?['filePath']"
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    },
                                                                                    "runAfter": {},
                                                                                    "type": "Foreach"
                                                                                }
                                                                            },
                                                                            "runAfter": {},
                                                                            "type": "Foreach",
                                                                            "runtimeConfiguration": {
                                                                                "concurrency": {
                                                                                    "repetitions": 1
                                                                                }
                                                                            }
                                                                        },
                                                                        "RubrikGenerateDownloadableLink": {
                                                                            "runAfter": {
                                                                                "Compose": [
                                                                                    "Succeeded"
                                                                                ]
                                                                            },
                                                                            "type": "Workflow",
                                                                            "inputs": {
                                                                                "body": {
                                                                                    "AccessToken": "@variables('access_token')",
                                                                                    "ActivitySeriesId": "@variables('snapshotFid')",
                                                                                    "BaseUrl": "@triggerBody()?['BaseUrl']",
                                                                                    "ClusterId": "@variables('ClusterId')",
                                                                                    "FilePaths": "@variables('filePaths')",
                                                                                    "IncidentARMId": "@triggerBody()?['IncidentARMId']",
                                                                                    "IncidentStartTime": "@triggerBody()?['IncidentStartTime']",
                                                                                    "LastUpdatedTime": "@variables('lastUpdatedTime')",
                                                                                    "ObjectId": "@triggerBody()?['ObjectId']",
                                                                                    "ObjectName": "@variables('ObjectName')",
                                                                                    "ObjectType": "@triggerBody()?['ObjectType']",
                                                                                    "SuspiciousFiles": "@variables('SuspiciousFiles')"
                                                                                },
                                                                                "host": {
                                                                                    "triggerName": "manual",
                                                                                    "workflow": {
                                                                                        "id": "[concat('/subscriptions/',subscription().subscriptionId,'/resourceGroups/',resourceGroup().name,'/providers/Microsoft.Logic/workflows/',parameters('DownloadableLinkGeneratePlaybookName'))]"
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    },
                                                                    "runAfter": {
                                                                        "Parse_JSON_2": [
                                                                            "Succeeded"
                                                                        ]
                                                                    },
                                                                    "expression": {
                                                                        "and": [
                                                                            {
                                                                                "equals": [
                                                                                    "@body('Parse_JSON_2')?['data']?['anomalyResultOpt']?['isAnomaly']",
                                                                                    "@true"
                                                                                ]
                                                                            }
                                                                        ]
                                                                    },
                                                                    "type": "If"
                                                                },
                                                                "Parse_JSON_2": {
                                                                    "runAfter": {},
                                                                    "type": "ParseJson",
                                                                    "inputs": {
                                                                        "content": "@body('Get_Suspicious_files_for_a_latest_snpshot_of_given_object')",
                                                                        "schema": {
                                                                            "properties": {
                                                                                "data": {
                                                                                    "properties": {
                                                                                        "anomalyResultOpt": {
                                                                                            "properties": {
                                                                                                "__typename": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "anomalyInfo": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "strainAnalysisInfo": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "__typename": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "sampleAffectedFilesInfo": {
                                                                                                                        "items": {
                                                                                                                            "properties": {
                                                                                                                                "__typename": {
                                                                                                                                    "type": "string"
                                                                                                                                },
                                                                                                                                "filePath": {
                                                                                                                                    "type": "string"
                                                                                                                                },
                                                                                                                                "fileSizeBytes": {
                                                                                                                                    "type": "integer"
                                                                                                                                },
                                                                                                                                "lastModified": {
                                                                                                                                    "type": "string"
                                                                                                                                }
                                                                                                                            },
                                                                                                                            "required": [
                                                                                                                                "filePath",
                                                                                                                                "lastModified",
                                                                                                                                "fileSizeBytes",
                                                                                                                                "__typename"
                                                                                                                            ],
                                                                                                                            "type": [
                                                                                                                                "object",
                                                                                                                                "null"
                                                                                                                            ]
                                                                                                                        },
                                                                                                                        "type": "array"
                                                                                                                    },
                                                                                                                    "sampleRansomwareNoteFilesInfo": {
                                                                                                                        "items": {
                                                                                                                            "properties": {
                                                                                                                                "__typename": {
                                                                                                                                    "type": "string"
                                                                                                                                },
                                                                                                                                "filePath": {
                                                                                                                                    "type": "string"
                                                                                                                                },
                                                                                                                                "fileSizeBytes": {
                                                                                                                                    "type": "integer"
                                                                                                                                },
                                                                                                                                "lastModified": {
                                                                                                                                    "type": "string"
                                                                                                                                }
                                                                                                                            },
                                                                                                                            "required": [
                                                                                                                                "filePath",
                                                                                                                                "lastModified",
                                                                                                                                "fileSizeBytes",
                                                                                                                                "__typename"
                                                                                                                            ],
                                                                                                                            "type": [
                                                                                                                                "object",
                                                                                                                                "null"
                                                                                                                            ]
                                                                                                                        },
                                                                                                                        "type": "array"
                                                                                                                    },
                                                                                                                    "strainId": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "totalAffectedFiles": {
                                                                                                                        "type": "integer"
                                                                                                                    },
                                                                                                                    "totalRansomwareNotes": {
                                                                                                                        "type": "integer"
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "strainId",
                                                                                                                    "__typename"
                                                                                                                ],
                                                                                                                "type": [
                                                                                                                    "object",
                                                                                                                    "null"
                                                                                                                ]
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": [
                                                                                                        "object",
                                                                                                        "null"
                                                                                                    ]
                                                                                                },
                                                                                                "anomalyProbability": {
                                                                                                    "type": "number"
                                                                                                },
                                                                                                "detectionTime": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "encryption": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "id": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "isAnomaly": {
                                                                                                    "type": "boolean"
                                                                                                },
                                                                                                "location": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "managedId": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "objectType": {},
                                                                                                "severity": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "snapshotDate": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "snapshotFid": {
                                                                                                    "type": "string"
                                                                                                }
                                                                                            },
                                                                                            "type": "object"
                                                                                        }
                                                                                    },
                                                                                    "type": "object"
                                                                                }
                                                                            },
                                                                            "type": "object"
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "expression": {
                                                            "and": [
                                                                {
                                                                    "contains": [
                                                                        "@body('Get_Suspicious_files_for_a_latest_snpshot_of_given_object')",
                                                                        "errors"
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        "type": "If"
                                                    }
                                                },
                                                "runAfter": {
                                                    "Get_Suspicious_files_for_a_latest_snpshot_of_given_object": [
                                                        "Succeeded",
                                                        "Failed"
                                                    ]
                                                },
                                                "else": {
                                                    "actions": {
                                                        "Set_errormessage_from_get_suspicious_files": {
                                                            "runAfter": {},
                                                            "type": "SetVariable",
                                                            "inputs": {
                                                                "name": "anomalousFilesStatus",
                                                                "value": "Error:@{body('Get_Suspicious_files_for_a_latest_snpshot_of_given_object')?['message']}"
                                                            }
                                                        }
                                                    }
                                                },
                                                "expression": {
                                                    "and": [
                                                        {
                                                            "equals": [
                                                                "@outputs('Get_Suspicious_files_for_a_latest_snpshot_of_given_object')['statusCode']",
                                                                200
                                                            ]
                                                        }
                                                    ]
                                                },
                                                "type": "If"
                                            },
                                            "For_each_2": {
                                                "foreach": "@body('Parse_JSON_of_Radar_Analysis_Process')?['data']?['activitySeriesConnection']?['edges']",
                                                "actions": {
                                                    "Does_this_edge_object_name_equal_to_object_name_fetched_from_incident": {
                                                        "actions": {
                                                            "Set_ransomware_analysis_status": {
                                                                "runAfter": {},
                                                                "type": "SetVariable",
                                                                "inputs": {
                                                                    "name": "RansomwareAnalysisStatus",
                                                                    "value": "@items('For_each_2')?['node']?['lastActivityStatus']"
                                                                }
                                                            }
                                                        },
                                                        "runAfter": {},
                                                        "expression": {
                                                            "and": [
                                                                {
                                                                    "equals": [
                                                                        "@items('For_each_2')?['node']?['objectName']",
                                                                        "@variables('ObjectName')"
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        "type": "If"
                                                    }
                                                },
                                                "runAfter": {
                                                    "Parse_JSON_of_Radar_Analysis_Process": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "Foreach",
                                                "runtimeConfiguration": {
                                                    "concurrency": {
                                                        "repetitions": 1
                                                    }
                                                }
                                            },
                                            "Get_Suspicious_files_for_a_latest_snpshot_of_given_object": {
                                                "runAfter": {
                                                    "Does_get_cdmId_request_status_code_equal_to_200": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "Http",
                                                "inputs": {
                                                    "body": {
                                                        "query": "query AnomalyResultQuery($clusterUuid: UUID!, $snapshotId: String!) {\r\n  anomalyResultOpt(clusterUuid: $clusterUuid, snapshotId: $snapshotId) {\r\n    id\r\n    snapshotFid\r\n    managedId\r\n    anomalyProbability\r\n    location\r\n    isAnomaly\r\n    objectType\r\n    severity\r\n    detectionTime\r\n    snapshotDate\r\n    encryption\r\n    anomalyInfo {\r\n      strainAnalysisInfo {\r\n        strainId\r\n        totalAffectedFiles\r\n        totalRansomwareNotes\r\n        sampleAffectedFilesInfo {\r\n          filePath\r\n          lastModified\r\n          fileSizeBytes\r\n          __typename\r\n        }\r\n        sampleRansomwareNoteFilesInfo {\r\n          filePath\r\n          lastModified\r\n          fileSizeBytes\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n}\r\n",
                                                        "variables": {
                                                            "clusterUuid": "@{triggerBody()?['ClusterId']}",
                                                            "snapshotId": "@{variables('cdmId')}"
                                                        }
                                                    },
                                                    "headers": {
                                                        "Authorization": "Bearer @{variables('access_token')}"
                                                    },
                                                    "method": "POST",
                                                    "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                                                }
                                            },
                                            "Get_cdm_snapshotid_for_latest_snapshotfid": {
                                                "runAfter": {
                                                    "Is_ransomware_analysis_running": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "Http",
                                                "inputs": {
                                                    "body": {
                                                        "query": "query SnappableInvestigationsQuery($id: UUID!) {\r\n  snapshot(snapshotFid: $id) {\r\n    date\r\n    cluster {\r\n      id\r\n      name\r\n      version\r\n      status\r\n      __typename\r\n    }\r\n    cdmId\r\n    snappableNew {\r\n      name\r\n      id\r\n      cdmId\r\n      objectType\r\n      ... on VsphereVm {\r\n        authorizedOperations\r\n        __typename\r\n      }\r\n      ... on VolumeGroup {\r\n        logicalPath {\r\n          fid\r\n          name\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      ... on NutanixVm {\r\n        authorizedOperations\r\n        __typename\r\n      }\r\n      ... on HyperVVirtualMachine {\r\n        authorizedOperations\r\n        __typename\r\n      }\r\n      ... on LinuxFileset {\r\n        host {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        failoverClusterApp {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      ... on WindowsFileset {\r\n        host {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        failoverClusterApp {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      ... on ShareFileset {\r\n        host {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        share {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        shareType\r\n        __typename\r\n      }\r\n      ... on NasFileset {\r\n        nasShare {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n}",
                                                        "variables": {
                                                            "id": "@{variables('snapshotFid')}"
                                                        }
                                                    },
                                                    "headers": {
                                                        "Authorization": "Bearer @{variables('access_token')}"
                                                    },
                                                    "method": "POST",
                                                    "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                                                }
                                            },
                                            "Is_ransomware_analysis_running": {
                                                "actions": {
                                                    "Does_Radar_Analysis_status_get_status_code_200": {
                                                        "actions": {
                                                            "Does_Radar_analysis_status_response_contain_errors": {
                                                                "actions": {
                                                                    "Set_Radar_Analysis_status": {
                                                                        "runAfter": {},
                                                                        "type": "SetVariable",
                                                                        "inputs": {
                                                                            "name": "EventListAPIStatus",
                                                                            "value": "Error:@{body('Gather_the_final_Radar_Analysis_results')?['errors'][0]?['message']}"
                                                                        }
                                                                    }
                                                                },
                                                                "runAfter": {},
                                                                "else": {
                                                                    "actions": {
                                                                        "Parse_JSON_of_Gather_final_Radar_analysis_status": {
                                                                            "runAfter": {},
                                                                            "type": "ParseJson",
                                                                            "inputs": {
                                                                                "content": "@body('Gather_the_final_Radar_Analysis_results')",
                                                                                "schema": {
                                                                                    "properties": {
                                                                                        "data": {
                                                                                            "properties": {
                                                                                                "activitySeriesConnection": {
                                                                                                    "properties": {
                                                                                                        "edges": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "node": {
                                                                                                                        "properties": {
                                                                                                                            "activityConnection": {
                                                                                                                                "properties": {
                                                                                                                                    "nodes": {
                                                                                                                                        "items": {
                                                                                                                                            "properties": {
                                                                                                                                                "id": {
                                                                                                                                                    "type": "string"
                                                                                                                                                },
                                                                                                                                                "message": {
                                                                                                                                                    "type": "string"
                                                                                                                                                },
                                                                                                                                                "severity": {
                                                                                                                                                    "type": "string"
                                                                                                                                                },
                                                                                                                                                "time": {
                                                                                                                                                    "type": "string"
                                                                                                                                                }
                                                                                                                                            },
                                                                                                                                            "required": [
                                                                                                                                                "id",
                                                                                                                                                "message",
                                                                                                                                                "severity",
                                                                                                                                                "time"
                                                                                                                                            ],
                                                                                                                                            "type": "object"
                                                                                                                                        },
                                                                                                                                        "type": "array"
                                                                                                                                    }
                                                                                                                                },
                                                                                                                                "type": "object"
                                                                                                                            },
                                                                                                                            "activitySeriesId": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "cluster": {
                                                                                                                                "properties": {
                                                                                                                                    "id": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "name": {
                                                                                                                                        "type": "string"
                                                                                                                                    }
                                                                                                                                },
                                                                                                                                "type": "object"
                                                                                                                            },
                                                                                                                            "fid": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "id": {
                                                                                                                                "type": "integer"
                                                                                                                            },
                                                                                                                            "lastActivityStatus": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "lastActivityType": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "lastUpdated": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "objectId": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "objectName": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "objectType": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "progress": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "severity": {
                                                                                                                                "type": "string"
                                                                                                                            }
                                                                                                                        },
                                                                                                                        "type": "object"
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "node"
                                                                                                                ],
                                                                                                                "type": "object"
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        },
                                                                                                        "pageInfo": {
                                                                                                            "properties": {
                                                                                                                "endCursor": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "hasNextPage": {
                                                                                                                    "type": "boolean"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": "object"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                },
                                                                                                "featureFlag": {
                                                                                                    "properties": {
                                                                                                        "name": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "variant": {
                                                                                                            "type": "string"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                }
                                                                                            },
                                                                                            "type": "object"
                                                                                        }
                                                                                    },
                                                                                    "type": "object"
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                },
                                                                "expression": {
                                                                    "and": [
                                                                        {
                                                                            "contains": [
                                                                                "@body('Gather_the_final_Radar_Analysis_results')",
                                                                                "errors"
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                "type": "If"
                                                            }
                                                        },
                                                        "runAfter": {
                                                            "Gather_the_final_Radar_Analysis_results": [
                                                                "Succeeded",
                                                                "Failed"
                                                            ]
                                                        },
                                                        "else": {
                                                            "actions": {
                                                                "Set_Error_message_for_Radar_Analysis_status": {
                                                                    "runAfter": {},
                                                                    "type": "SetVariable",
                                                                    "inputs": {
                                                                        "name": "EventListAPIStatus",
                                                                        "value": "StatusCode:@{outputs('Gather_the_final_Radar_Analysis_results')['statusCode']} Error:@{body('Gather_the_final_Radar_Analysis_results')}"
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "expression": {
                                                            "and": [
                                                                {
                                                                    "equals": [
                                                                        "@outputs('Gather_the_final_Radar_Analysis_results')['statusCode']",
                                                                        200
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        "type": "If"
                                                    },
                                                    "Gather_the_final_Radar_Analysis_results": {
                                                        "runAfter": {
                                                            "Until": [
                                                                "Succeeded"
                                                            ]
                                                        },
                                                        "type": "Http",
                                                        "inputs": {
                                                            "body": {
                                                                "query": "query EventSeriesListQuery($after: String, $filters: ActivitySeriesFilterInput, $first: Int, $sortBy: ActivitySeriesSortByEnum, $sortOrder: SortOrderEnum) {\r\n  activitySeriesConnection(\r\n    after: $after\r\n    first: $first\r\n    filters: $filters\r\n    sortBy: $sortBy\r\n    sortOrder: $sortOrder\r\n  ) {\r\n    edges {\r\n      cursor\r\n      node {\r\n        ...EventSeriesFragment\r\n        cluster {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        activityConnection(first: 1) {\r\n          nodes {\r\n            id\r\n            message\r\n            __typename\r\n          }\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      __typename\r\n    }\r\n    pageInfo {\r\n      endCursor\r\n      hasNextPage\r\n      hasPreviousPage\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n}\r\n\r\nfragment EventSeriesFragment on ActivitySeries {\r\n  id\r\n  fid\r\n  activitySeriesId\r\n  lastUpdated\r\n  lastActivityType\r\n  lastActivityStatus\r\n  objectId\r\n  objectName\r\n  objectType\r\n  severity\r\n  progress\r\n  isCancelable\r\n  isPolarisEventSeries\r\n  location\r\n  __typename\r\n}\r\n",
                                                                "variables": {
                                                                    "filters": {
                                                                        "cluster": {
                                                                            "id": "@{variables('ClusterId')}"
                                                                        },
                                                                        "lastActivityStatus": [],
                                                                        "lastActivityType": [
                                                                            "Anomaly"
                                                                        ],
                                                                        "lastUpdatedGt": "@{variables('StartDate')}",
                                                                        "objectName": "@{variables('ObjectName')}",
                                                                        "objectType": [],
                                                                        "severity": []
                                                                    },
                                                                    "first": 40,
                                                                    "sortBy": "StartTime",
                                                                    "sortOrder": "Asc"
                                                                }
                                                            },
                                                            "headers": {
                                                                "Authorization": "Beare @{variables('access_token')}",
                                                                "Content-Type": "application/json"
                                                            },
                                                            "method": "POST",
                                                            "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                                                        }
                                                    },
                                                    "Until": {
                                                        "actions": {
                                                            "Delay": {
                                                                "runAfter": {
                                                                    "Does_Event_List_get_status_code_200_in_Generic_Polling": [
                                                                        "Succeeded"
                                                                    ]
                                                                },
                                                                "type": "Wait",
                                                                "inputs": {
                                                                    "interval": {
                                                                        "count": 1,
                                                                        "unit": "Minute"
                                                                    }
                                                                }
                                                            },
                                                            "Does_Event_List_get_status_code_200_in_Generic_Polling": {
                                                                "actions": {
                                                                    "Does_Event_List_response_contains_errors": {
                                                                        "actions": {
                                                                            "Set_Event_List_error_response_": {
                                                                                "runAfter": {},
                                                                                "type": "SetVariable",
                                                                                "inputs": {
                                                                                    "name": "EventListAPIStatus",
                                                                                    "value": "Error:@{body('GenericPolling')?['errors'][0]?['message']}"
                                                                                }
                                                                            }
                                                                        },
                                                                        "runAfter": {},
                                                                        "else": {
                                                                            "actions": {
                                                                                "For_each_edge_in_activitySeriesConnection": {
                                                                                    "foreach": "@body('Parse_JSON_of_Generic_Polling')?['data']?['activitySeriesConnection']?['edges']",
                                                                                    "actions": {
                                                                                        "Does_object_name_equal_to_object_name_fetched_from_incident": {
                                                                                            "actions": {
                                                                                                "Update_Ransomware_Analysis_status": {
                                                                                                    "runAfter": {},
                                                                                                    "type": "SetVariable",
                                                                                                    "inputs": {
                                                                                                        "name": "RansomwareAnalysisStatus",
                                                                                                        "value": "@items('For_each_edge_in_activitySeriesConnection')?['node']?['lastActivityStatus']"
                                                                                                    }
                                                                                                }
                                                                                            },
                                                                                            "runAfter": {},
                                                                                            "expression": {
                                                                                                "and": [
                                                                                                    {
                                                                                                        "equals": [
                                                                                                            "@items('For_each_edge_in_activitySeriesConnection')?['node']?['objectName']",
                                                                                                            "@variables('ObjectName')"
                                                                                                        ]
                                                                                                    }
                                                                                                ]
                                                                                            },
                                                                                            "type": "If"
                                                                                        }
                                                                                    },
                                                                                    "runAfter": {
                                                                                        "Parse_JSON_of_Generic_Polling": [
                                                                                            "Succeeded"
                                                                                        ]
                                                                                    },
                                                                                    "type": "Foreach"
                                                                                },
                                                                                "Parse_JSON_of_Generic_Polling": {
                                                                                    "runAfter": {},
                                                                                    "type": "ParseJson",
                                                                                    "inputs": {
                                                                                        "content": "@body('GenericPolling')",
                                                                                        "schema": {
                                                                                            "properties": {
                                                                                                "data": {
                                                                                                    "properties": {
                                                                                                        "activitySeriesConnection": {
                                                                                                            "properties": {
                                                                                                                "__typename": {
                                                                                                                    "type": "string"
                                                                                                                },
                                                                                                                "edges": {
                                                                                                                    "items": {
                                                                                                                        "properties": {
                                                                                                                            "__typename": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "cursor": {
                                                                                                                                "type": "string"
                                                                                                                            },
                                                                                                                            "node": {
                                                                                                                                "properties": {
                                                                                                                                    "__typename": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "activityConnection": {
                                                                                                                                        "properties": {
                                                                                                                                            "__typename": {
                                                                                                                                                "type": "string"
                                                                                                                                            },
                                                                                                                                            "nodes": {
                                                                                                                                                "items": {
                                                                                                                                                    "properties": {
                                                                                                                                                        "__typename": {
                                                                                                                                                            "type": "string"
                                                                                                                                                        },
                                                                                                                                                        "id": {
                                                                                                                                                            "type": "string"
                                                                                                                                                        },
                                                                                                                                                        "message": {
                                                                                                                                                            "type": "string"
                                                                                                                                                        }
                                                                                                                                                    },
                                                                                                                                                    "required": [
                                                                                                                                                        "id",
                                                                                                                                                        "message",
                                                                                                                                                        "__typename"
                                                                                                                                                    ],
                                                                                                                                                    "type": "object"
                                                                                                                                                },
                                                                                                                                                "type": "array"
                                                                                                                                            }
                                                                                                                                        },
                                                                                                                                        "type": "object"
                                                                                                                                    },
                                                                                                                                    "activitySeriesId": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "cluster": {
                                                                                                                                        "properties": {
                                                                                                                                            "__typename": {
                                                                                                                                                "type": "string"
                                                                                                                                            },
                                                                                                                                            "id": {
                                                                                                                                                "type": "string"
                                                                                                                                            },
                                                                                                                                            "name": {
                                                                                                                                                "type": "string"
                                                                                                                                            }
                                                                                                                                        },
                                                                                                                                        "type": "object"
                                                                                                                                    },
                                                                                                                                    "fid": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "id": {
                                                                                                                                        "type": "integer"
                                                                                                                                    },
                                                                                                                                    "isCancelable": {
                                                                                                                                        "type": "boolean"
                                                                                                                                    },
                                                                                                                                    "isPolarisEventSeries": {
                                                                                                                                        "type": "boolean"
                                                                                                                                    },
                                                                                                                                    "lastActivityStatus": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "lastActivityType": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "lastUpdated": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "location": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "objectId": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "objectName": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "objectType": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "progress": {
                                                                                                                                        "type": "string"
                                                                                                                                    },
                                                                                                                                    "severity": {
                                                                                                                                        "type": "string"
                                                                                                                                    }
                                                                                                                                },
                                                                                                                                "type": "object"
                                                                                                                            }
                                                                                                                        },
                                                                                                                        "required": [
                                                                                                                            "cursor",
                                                                                                                            "node",
                                                                                                                            "__typename"
                                                                                                                        ],
                                                                                                                        "type": "object"
                                                                                                                    },
                                                                                                                    "type": "array"
                                                                                                                },
                                                                                                                "pageInfo": {
                                                                                                                    "properties": {
                                                                                                                        "__typename": {
                                                                                                                            "type": "string"
                                                                                                                        },
                                                                                                                        "endCursor": {
                                                                                                                            "type": "string"
                                                                                                                        },
                                                                                                                        "hasNextPage": {
                                                                                                                            "type": "boolean"
                                                                                                                        },
                                                                                                                        "hasPreviousPage": {
                                                                                                                            "type": "boolean"
                                                                                                                        }
                                                                                                                    },
                                                                                                                    "type": "object"
                                                                                                                }
                                                                                                            },
                                                                                                            "type": "object"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                }
                                                                                            },
                                                                                            "type": "object"
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        },
                                                                        "expression": {
                                                                            "and": [
                                                                                {
                                                                                    "contains": [
                                                                                        "@body('GenericPolling')",
                                                                                        "errors"
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        },
                                                                        "type": "If"
                                                                    }
                                                                },
                                                                "runAfter": {
                                                                    "GenericPolling": [
                                                                        "Succeeded",
                                                                        "Failed"
                                                                    ]
                                                                },
                                                                "expression": {
                                                                    "and": [
                                                                        {
                                                                            "equals": [
                                                                                "@outputs('GenericPolling')['statusCode']",
                                                                                200
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                "type": "If"
                                                            },
                                                            "GenericPolling": {
                                                                "runAfter": {},
                                                                "type": "Http",
                                                                "inputs": {
                                                                    "body": {
                                                                        "query": "query EventSeriesListQuery($after: String, $filters: ActivitySeriesFilterInput, $first: Int, $sortBy: ActivitySeriesSortByEnum, $sortOrder: SortOrderEnum) {\r\n  activitySeriesConnection(\r\n    after: $after\r\n    first: $first\r\n    filters: $filters\r\n    sortBy: $sortBy\r\n    sortOrder: $sortOrder\r\n  ) {\r\n    edges {\r\n      cursor\r\n      node {\r\n        ...EventSeriesFragment\r\n        cluster {\r\n          id\r\n          name\r\n          __typename\r\n        }\r\n        activityConnection(first: 1) {\r\n          nodes {\r\n            id\r\n            message\r\n            __typename\r\n          }\r\n          __typename\r\n        }\r\n        __typename\r\n      }\r\n      __typename\r\n    }\r\n    pageInfo {\r\n      endCursor\r\n      hasNextPage\r\n      hasPreviousPage\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n}\r\n\r\nfragment EventSeriesFragment on ActivitySeries {\r\n  id\r\n  fid\r\n  activitySeriesId\r\n  lastUpdated\r\n  lastActivityType\r\n  lastActivityStatus\r\n  objectId\r\n  objectName\r\n  objectType\r\n  severity\r\n  progress\r\n  isCancelable\r\n  isPolarisEventSeries\r\n  location\r\n  __typename\r\n}\r\n",
                                                                        "variables": {
                                                                            "filters": {
                                                                                "cluster": {
                                                                                    "id": "@{variables('ClusterId')}"
                                                                                },
                                                                                "lastActivityStatus": [],
                                                                                "lastActivityType": [
                                                                                    "Anomaly"
                                                                                ],
                                                                                "lastUpdatedGt": "@{variables('StartDate')}",
                                                                                "objectName": "@{variables('ObjectName')}",
                                                                                "objectType": [],
                                                                                "severity": []
                                                                            },
                                                                            "first": 40,
                                                                            "sortBy": "StartTime",
                                                                            "sortOrder": "Asc"
                                                                        }
                                                                    },
                                                                    "headers": {
                                                                        "Authorization": "Bearer @{variables('access_token')}",
                                                                        "Content-Type": "application/json"
                                                                    },
                                                                    "method": "POST",
                                                                    "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                                                                }
                                                            }
                                                        },
                                                        "runAfter": {},
                                                        "expression": "@not(equals(variables('RansomwareAnalysisStatus'), 'Running'))",
                                                        "limit": {
                                                            "timeout": "PT1440M"
                                                        },
                                                        "type": "Until"
                                                    }
                                                },
                                                "runAfter": {
                                                    "Set_last_updated_time_for_snapshot": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "expression": {
                                                    "and": [
                                                        {
                                                            "equals": [
                                                                "@variables('RansomwareAnalysisStatus')",
                                                                "Running\n"
                                                            ]
                                                        }
                                                    ]
                                                },
                                                "type": "If"
                                            },
                                            "Parse_JSON_of_Radar_Analysis_Process": {
                                                "runAfter": {},
                                                "type": "ParseJson",
                                                "inputs": {
                                                    "content": "@body('Determine_the_status_of_the_Rubrik_Radar_analysis_process')",
                                                    "schema": {
                                                        "properties": {
                                                            "data": {
                                                                "properties": {
                                                                    "activitySeriesConnection": {
                                                                        "properties": {
                                                                            "__typename": {
                                                                                "type": "string"
                                                                            },
                                                                            "edges": {
                                                                                "items": {
                                                                                    "properties": {
                                                                                        "__typename": {
                                                                                            "type": "string"
                                                                                        },
                                                                                        "cursor": {
                                                                                            "type": "string"
                                                                                        },
                                                                                        "node": {
                                                                                            "properties": {
                                                                                                "__typename": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "activityConnection": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "nodes": {
                                                                                                            "items": {
                                                                                                                "properties": {
                                                                                                                    "__typename": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "id": {
                                                                                                                        "type": "string"
                                                                                                                    },
                                                                                                                    "message": {
                                                                                                                        "type": "string"
                                                                                                                    }
                                                                                                                },
                                                                                                                "required": [
                                                                                                                    "id",
                                                                                                                    "message",
                                                                                                                    "__typename"
                                                                                                                ],
                                                                                                                "type": "object"
                                                                                                            },
                                                                                                            "type": "array"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                },
                                                                                                "activitySeriesId": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "cluster": {
                                                                                                    "properties": {
                                                                                                        "__typename": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "id": {
                                                                                                            "type": "string"
                                                                                                        },
                                                                                                        "name": {
                                                                                                            "type": "string"
                                                                                                        }
                                                                                                    },
                                                                                                    "type": "object"
                                                                                                },
                                                                                                "fid": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "id": {
                                                                                                    "type": "integer"
                                                                                                },
                                                                                                "isCancelable": {
                                                                                                    "type": "boolean"
                                                                                                },
                                                                                                "isPolarisEventSeries": {
                                                                                                    "type": "boolean"
                                                                                                },
                                                                                                "lastActivityStatus": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "lastActivityType": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "lastUpdated": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "location": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "objectId": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "objectName": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "objectType": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "progress": {
                                                                                                    "type": "string"
                                                                                                },
                                                                                                "severity": {
                                                                                                    "type": "string"
                                                                                                }
                                                                                            },
                                                                                            "type": "object"
                                                                                        }
                                                                                    },
                                                                                    "required": [
                                                                                        "cursor",
                                                                                        "node",
                                                                                        "__typename"
                                                                                    ],
                                                                                    "type": "object"
                                                                                },
                                                                                "type": "array"
                                                                            },
                                                                            "pageInfo": {
                                                                                "properties": {
                                                                                    "__typename": {
                                                                                        "type": "string"
                                                                                    },
                                                                                    "endCursor": {
                                                                                        "type": "string"
                                                                                    },
                                                                                    "hasNextPage": {
                                                                                        "type": "boolean"
                                                                                    },
                                                                                    "hasPreviousPage": {
                                                                                        "type": "boolean"
                                                                                    }
                                                                                },
                                                                                "type": "object"
                                                                            }
                                                                        },
                                                                        "type": "object"
                                                                    }
                                                                },
                                                                "type": "object"
                                                            }
                                                        },
                                                        "type": "object"
                                                    }
                                                }
                                            },
                                            "Set_cdmId_same_as_snapshotfid": {
                                                "runAfter": {
                                                    "Set_snapshotfid": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "SetVariable",
                                                "inputs": {
                                                    "name": "cdmId",
                                                    "value": "@variables('snapshotFid')"
                                                }
                                            },
                                            "Set_last_updated_time_for_snapshot": {
                                                "runAfter": {
                                                    "Set_cdmId_same_as_snapshotfid": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "SetVariable",
                                                "inputs": {
                                                    "name": "lastUpdatedTime",
                                                    "value": "@{body('Parse_JSON_of_Radar_Analysis_Process')?['data']?['activitySeriesConnection']?['edges'][0]?['node']?['lastUpdated']}"
                                                }
                                            },
                                            "Set_snapshotfid": {
                                                "runAfter": {
                                                    "For_each_2": [
                                                        "Succeeded"
                                                    ]
                                                },
                                                "type": "SetVariable",
                                                "inputs": {
                                                    "name": "snapshotFid",
                                                    "value": "@{body('Parse_JSON_of_Radar_Analysis_Process')?['data']?['activitySeriesConnection']?['edges'][0]?['node']?['activitySeriesId']}"
                                                }
                                            }
                                        }
                                    },
                                    "expression": {
                                        "and": [
                                            {
                                                "contains": [
                                                    "@body('Determine_the_status_of_the_Rubrik_Radar_analysis_process')",
                                                    "errors"
                                                ]
                                            }
                                        ]
                                    },
                                    "type": "If"
                                }
                            },
                            "runAfter": {
                                "Determine_the_status_of_the_Rubrik_Radar_analysis_process": [
                                    "Succeeded",
                                    "Failed"
                                ]
                            },
                            "else": {
                                "actions": {
                                    "Set_Error_message_with_status_code_for_radar_analysis": {
                                        "runAfter": {},
                                        "type": "SetVariable",
                                        "inputs": {
                                            "name": "EventListAPIStatus",
                                            "value": "Status Code:@{outputs('Determine_the_status_of_the_Rubrik_Radar_analysis_process')['statusCode']}Error:@{body('Determine_the_status_of_the_Rubrik_Radar_analysis_process')?['message']}"
                                        }
                                    }
                                }
                            },
                            "expression": {
                                "and": [
                                    {
                                        "equals": [
                                            "@outputs('Determine_the_status_of_the_Rubrik_Radar_analysis_process')['statusCode']",
                                            200
                                        ]
                                    }
                                ]
                            },
                            "type": "If"
                        },
                        "Get_Client_Id_": {
                            "runAfter": {
                                "Initialize_Start_Date": [
                                    "Succeeded"
                                ]
                            },
                            "type": "ApiConnection",
                            "inputs": {
                                "host": {
                                    "connection": {
                                        "name": "@parameters('$connections')['keyvault_1']['connectionId']"
                                    }
                                },
                                "method": "get",
                                "path": "/secrets/@{encodeURIComponent('Rubrik-AS-Int-ClientId')}/value"
                            },
                            "runtimeConfiguration": {
                                "secureData": {
                                    "properties": [
                                        "inputs",
                                        "outputs"
                                    ]
                                }
                            }
                        },
                        "Get_secret": {
                            "runAfter": {
                                "Get_Client_Id_": [
                                    "Succeeded"
                                ]
                            },
                            "type": "ApiConnection",
                            "inputs": {
                                "host": {
                                    "connection": {
                                        "name": "@parameters('$connections')['keyvault_1']['connectionId']"
                                    }
                                },
                                "method": "get",
                                "path": "/secrets/@{encodeURIComponent('Rubrik-AS-Int-ClientSecret')}/value"
                            },
                            "runtimeConfiguration": {
                                "secureData": {
                                    "properties": [
                                        "inputs",
                                        "outputs"
                                    ]
                                }
                            }
                        },
                        "Initialize_AnomolousFileStatus": {
                            "runAfter": {
                                "Initialize_filepaths": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "anomalousFilesStatus",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_Cluster_Id": {
                            "runAfter": {
                                "Initialize_Snapshot_Id": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "ClusterId",
                                        "type": "string",
                                        "value": "@triggerBody()?['ClusterId']"
                                    }
                                ]
                            },
                            "description": "from playbook input"
                        },
                        "Initialize_Event_List_API_status": {
                            "runAfter": {
                                "Initialize_cluster_connection_status": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "EventListAPIStatus",
                                        "type": "string",
                                        "value": "@{null}"
                                    }
                                ]
                            }
                        },
                        "Initialize_Object_Id": {
                            "runAfter": {
                                "Initialize_Object_Name": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "ObjectId",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_Object_Name": {
                            "runAfter": {},
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "ObjectName",
                                        "type": "string",
                                        "value": "@triggerBody()?['ObjectName']"
                                    }
                                ]
                            },
                            "description": "from playbook input"
                        },
                        "Initialize_Snapshot_Id": {
                            "runAfter": {
                                "Initialize_Object_Id": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "SnapshotId",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_Start_Date": {
                            "runAfter": {
                                "Subtract_from_time": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "StartDate",
                                        "type": "string",
                                        "value": "@body('Subtract_from_time')"
                                    }
                                ]
                            },
                            "description": "start time of incident"
                        },
                        "Initialize_access_token": {
                            "runAfter": {
                                "Is_Authentication_failed": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "access_token",
                                        "type": "string",
                                        "value": "@{body('Authentication')?['access_token']}"
                                    }
                                ]
                            }
                        },
                        "Initialize_cdmId": {
                            "runAfter": {
                                "Initialize_snapshotFid": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "cdmId",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_cluster_connection_status": {
                            "runAfter": {
                                "Initialize_cluster_location_status": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "ClusterConnectionStatus",
                                        "type": "string",
                                        "value": "@{null}"
                                    }
                                ]
                            }
                        },
                        "Initialize_cluster_location_status": {
                            "runAfter": {
                                "Initialize_sonar_sensitive_hits_status": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "ClusterLocationStatus",
                                        "type": "string",
                                        "value": "@{null}"
                                    }
                                ]
                            }
                        },
                        "Initialize_clusterlocation": {
                            "runAfter": {
                                "Initialize_filpaths_to_download": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "clusterLocation",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_filepaths": {
                            "runAfter": {
                                "Initialize_suspicious_files": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "filePaths",
                                        "type": "array"
                                    }
                                ]
                            }
                        },
                        "Initialize_filpaths_to_download": {
                            "runAfter": {
                                "Initialize_cdmId": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "downloadPaths",
                                        "type": "array"
                                    }
                                ]
                            }
                        },
                        "Initialize_lastUpdatedTime": {
                            "runAfter": {
                                "Initialize_AnomolousFileStatus": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "lastUpdatedTime",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_ransomware_analysis_status": {
                            "runAfter": {
                                "Initialize_Cluster_Id": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "RansomwareAnalysisStatus",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_snapshotFid": {
                            "runAfter": {
                                "Initialize_lastUpdatedTime": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "snapshotFid",
                                        "type": "string"
                                    }
                                ]
                            }
                        },
                        "Initialize_sonar_sensitive_hits_status": {
                            "runAfter": {
                                "Initialize_ransomware_analysis_status": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "Status",
                                        "type": "string",
                                        "value": "@{null}"
                                    }
                                ]
                            }
                        },
                        "Initialize_suspicious_files": {
                            "runAfter": {
                                "Initialize_Event_List_API_status": [
                                    "Succeeded"
                                ]
                            },
                            "type": "InitializeVariable",
                            "inputs": {
                                "variables": [
                                    {
                                        "name": "SuspiciousFiles",
                                        "type": "array"
                                    }
                                ]
                            }
                        },
                        "Is_Authentication_failed": {
                            "actions": {
                                "Failed_Response_": {
                                    "runAfter": {},
                                    "type": "Response",
                                    "kind": "Http",
                                    "inputs": {
                                        "body": "Error:@{body('Authentication')?['message']}",
                                        "statusCode": "@outputs('Authentication')['statusCode']"
                                    }
                                },
                                "Terminate": {
                                    "runAfter": {
                                        "Failed_Response_": [
                                            "Succeeded"
                                        ]
                                    },
                                    "type": "Terminate",
                                    "inputs": {
                                        "runError": {
                                            "code": "@{outputs('Authentication')['statusCode']}",
                                            "message": "Error:@{body('Authentication')?['message']}"
                                        },
                                        "runStatus": "Failed"
                                    }
                                }
                            },
                            "runAfter": {
                                "Authentication": [
                                    "Succeeded",
                                    "Failed"
                                ]
                            },
                            "expression": {
                                "and": [
                                    {
                                        "not": {
                                            "equals": [
                                                "@outputs('Authentication')['statusCode']",
                                                200
                                            ]
                                        }
                                    }
                                ]
                            },
                            "type": "If"
                        },
                        "Response": {
                            "runAfter": {
                                "Does_cdm-cluster-connection_get_status_code_200": [
                                    "Succeeded",
                                    "TimedOut",
                                    "Skipped",
                                    "Failed"
                                ],
                                "Does_radar_analysis_get_status_code_200_": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Response",
                            "kind": "Http",
                            "inputs": {
                                "statusCode": "@if(or(contains(variables('EventListAPIStatus'),'Error'),or(contains(variables('ClusterConnectionStatus'),'Error'),or(contains(variables('ClusterLocationStatus'),'Error'),contains(variables('Status'),'Error')))),400,200)"
                            }
                        },
                        "Subtract_from_time": {
                            "runAfter": {
                                "Initialize_clusterlocation": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Expression",
                            "kind": "SubtractFromTime",
                            "inputs": {
                                "baseTime": "@triggerBody()?['IncidentStartTime']",
                                "interval": 1,
                                "timeUnit": "Day"
                            }
                        },
                        "rubrik-cdm-cluster-connection-state": {
                            "runAfter": {
                                "Does_cdm-cluster-location_get_status_code_200": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Http",
                            "inputs": {
                                "body": {
                                    "query": "query ClusterDetailQuery($id: UUID!) {\r\n  clusterConnection(filter: {id: [$id]}) {\r\n    nodes {\r\n      status\r\n      }\r\n    }\r\n}",
                                    "variables": {
                                        "id": "@{variables('ClusterId')}"
                                    }
                                },
                                "headers": {
                                    "Authorization": "Bearer @{variables('access_token')}",
                                    "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                            }
                        },
                        "rubrik-cdm-cluster-location": {
                            "runAfter": {
                                "Does_Object_List_get_status_code_200": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Http",
                            "inputs": {
                                "body": {
                                    "query": "query ClusterDetailQuery($id: UUID!) {\r\n  clusterConnection(filter: {id: [$id]}) {\r\n    nodes {\r\n      geoLocation {\r\n        address\r\n      }\r\n    }\r\n  }\r\n}",
                                    "variables": {
                                        "id": "@{variables('ClusterId')}"
                                    }
                                },
                                "headers": {
                                    "Authorization": "Bearer @{variables('access_token')}",
                                    "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                            }
                        },
                        "rubrik-sonar-sensitive-hits(Object_List)": {
                            "runAfter": {
                                "Initialize_access_token": [
                                    "Succeeded"
                                ]
                            },
                            "type": "Http",
                            "inputs": {
                                "body": {
                                    "query": "query ObjectsListQuery($day: String!, $timezone: String!) {\r\n  policyObjs(day: $day, timezone: $timezone,workloadTypes:[]) {\r\n    edges {\r\n      cursor\r\n      node {\r\n        ...PolicyObjFragment\r\n        __typename\r\n      }\r\n      __typename\r\n    }\r\n    pageInfo {\r\n      startCursor\r\n      endCursor\r\n      hasNextPage\r\n      hasPreviousPage\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n}\r\nfragment PolicyObjFragment on PolicyObj {\r\n  id\r\n  snapshotFid\r\n  snapshotTimestamp\r\n  osType\r\n  shareType\r\n  objectStatus {\r\n    policyStatuses {\r\n      status\r\n      __typename\r\n    }\r\n    latestSnapshotResult {\r\n      snapshotTime\r\n      snapshotFid\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  rootFileResult {\r\n    hits {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    analyzerGroupResults {\r\n      ...AnalyzerGroupResultFragment\r\n      __typename\r\n    }\r\n    filesWithHits {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    openAccessFiles {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    openAccessFolders {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    openAccessFilesWithHits {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    staleFiles {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    staleFilesWithHits {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    openAccessStaleFiles {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      violationsDelta\r\n      totalHitsDelta\r\n      __typename\r\n    }\r\n    numActivities\r\n    numActivitiesDelta\r\n    __typename\r\n  }\r\n  snappable {\r\n    ...SnappableFragment\r\n    __typename\r\n  }\r\n  __typename\r\n}\r\nfragment AnalyzerGroupResultFragment on AnalyzerGroupResult {\r\n  analyzerGroup {\r\n    groupType\r\n    id\r\n    name\r\n    __typename\r\n  }\r\n  analyzerResults {\r\n    hits {\r\n      totalHits\r\n      violations\r\n      permittedHits\r\n      __typename\r\n    }\r\n    analyzer {\r\n      id\r\n      name\r\n      analyzerType\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  hits {\r\n    totalHits\r\n    violations\r\n    permittedHits\r\n    violationsDelta\r\n    totalHitsDelta\r\n    __typename\r\n  }\r\n  __typename\r\n}\r\nfragment SnappableFragment on HierarchyObject {\r\n  id\r\n  name\r\n  objectType\r\n  slaAssignment\r\n  logicalPath {\r\n    name\r\n    objectType\r\n    __typename\r\n  }\r\n  physicalPath {\r\n    name\r\n    objectType\r\n    __typename\r\n  }\r\n  effectiveSlaDomain {\r\n    id\r\n    name\r\n    __typename\r\n  }\r\n  ... on VsphereVm {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  ... on LinuxFileset {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  ... on ShareFileset {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  ... on WindowsFileset {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  ... on NutanixVm {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  ... on HyperVVirtualMachine {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  ... on VolumeGroup {\r\n    cluster {\r\n      id\r\n      name\r\n      __typename\r\n    }\r\n    __typename\r\n  }\r\n  __typename\r\n}",
                                    "variables": {
                                        "day": "@{formatDateTime(utcNow(),'yyyy-MM-dd')}",
                                        "timezone": "Asia/Calcutta"
                                    }
                                },
                                "headers": {
                                    "Authorization": "Bearer @{variables('access_token')}",
                                    "Content-Type": "application/json"
                                },
                                "method": "POST",
                                "uri": "@{triggerBody()?['BaseUrl']}/api/graphql"
                            }
                        }
                    },
                    "outputs": {}
                },
                "parameters": {
                    "$connections": {
                        "value": {
                            "RubrikCustomConnector": {
                                "connectionId": "[resourceId('Microsoft.Web/connections', variables('RubrikcustomconnectorConnectionName'))]",
                                "connectionName": "[variables('RubrikcustomconnectorConnectionName')]",
                                "id":  "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Rubrik Connector name'))]"
                            },
                            "keyvault_1": {
                                "connectionId": "[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                                "connectionName": "[variables('KeyvaultConnectionName')]",
                                "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', resourceGroup().location, '/managedApis/Keyvault')]"
                            }
                        }
                    }
                }
            },
            "name": "[parameters('PlaybookName')]",
            "type": "Microsoft.Logic/workflows",
            "location": "[resourceGroup().location]",
            "tags": {
                "hidden-SentinelTemplateName": "RubrikAnomalyAnalysis",
                "hidden-SentinelTemplateVersion": "1.0"
            },
            "identity": {
                "type": "SystemAssigned"
            },
            "apiVersion": "2017-07-01",
            "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('RubrikcustomconnectorConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
            ]
        },
        {
            "type":  "Microsoft.Web/connections",
            "apiVersion":  "2016-06-01",
            "name":  "[variables('RubrikcustomconnectorConnectionName')]",
            "location":  "[resourceGroup().location]",
            "kind":  "V1",
            "properties":  {
                "displayName":  "[variables('RubrikcustomconnectorConnectionName')]",
                "customParameterValues":  {
                },
                "api":  {
                    "id":  "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('Rubrik Connector name'))]"
                }
            }
        },
        {
            "type": "Microsoft.Web/connections",
            "apiVersion": "2016-06-01",
            "name": "[variables('KeyvaultConnectionName')]",
            "location": "[resourceGroup().location]",
            "kind": "V1",
            "properties": {
                "displayName": "[variables('KeyvaultConnectionName')]",
                "customParameterValues": {},
                "api": {
                    "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', resourceGroup().location, '/managedApis/Keyvault')]"
                },
                "parameterValues": {
                    "token:TenantId": "[parameters('tenantId')]",
                    "token:grantType": "code",
                    "vaultName": "[parameters('keyvaultName')]"
                }
            }
        }
    ]
}
