[
	{
		"name": "JumpCloudDCR",
		"apiVersion": "2021-09-01-preview",
		"type": "Microsoft.Insights/dataCollectionRules",
		"location": "{{location}}",
		"properties": {
			"dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
			"streamDeclarations": {
				"Custom-JumpCloud_API": {
					"columns": [
						{
							"name": "ts",
							"type": "datetime",
							"description": "The time at which the data was generated"
						},
						{
							"name": "initiatedById",
							"type": "string",
							"description": "ID of the initiator"
						},
						{
							"name": "initiatedByType",
							"type": "string",
							"description": "Type of the initiator"
						},
						{
							"name": "initiatedByEmail",
							"type": "string",
							"description": "Email of the initiator"
						},
						{
							"name": "geoipCountryCode",
							"type": "string",
							"description": "Country code of the geo IP"
						},
						{
							"name": "geoipTimezone",
							"type": "string",
							"description": "Timezone of the geo IP"
						},
						{
							"name": "geoipLatitude",
							"type": "real",
							"description": "Latitude of the geo IP"
						},
						{
							"name": "geoipContinentCode",
							"type": "string",
							"description": "Continent code of the geo IP"
						},
						{
							"name": "geoipRegionName",
							"type": "string",
							"description": "Region name of the geo IP"
						},
						{
							"name": "geoipRegionCode",
							"type": "string",
							"description": "Region code of the geo IP"
						},
						{
							"name": "geoipLongitude",
							"type": "real",
							"description": "Longitude of the geo IP"
						},
						{
							"name": "userAgentPatch",
							"type": "string",
							"description": "Patch version of the user agent"
						},
						{
							"name": "userAgentOsFull",
							"type": "string",
							"description": "Full OS version of the user agent"
						},
						{
							"name": "userAgentMajor",
							"type": "string",
							"description": "Major version of the user agent"
						},
						{
							"name": "userAgentMinor",
							"type": "string",
							"description": "Minor version of the user agent"
						},
						{
							"name": "userAgentOs",
							"type": "string",
							"description": "OS of the user agent"
						},
						{
							"name": "userAgentOsVersion",
							"type": "string",
							"description": "OS version of the user agent"
						},
						{
							"name": "userAgentOsMajor",
							"type": "string",
							"description": "OS major version of the user agent"
						},
						{
							"name": "userAgentName",
							"type": "string",
							"description": "Name of the user agent"
						},
						{
							"name": "userAgentOsName",
							"type": "string",
							"description": "OS name of the user agent"
						},
						{
							"name": "userAgentVersion",
							"type": "string",
							"description": "Version of the user agent"
						},
						{
							"name": "userAgentDevice",
							"type": "string",
							"description": "Device type of the user agent"
						},
						{
							"name": "mfa",
							"type": "boolean",
							"description": "MFA status"
						},
						{
							"name": "eventType",
							"type": "string",
							"description": "Type of the event"
						},
						{
							"name": "provider",
							"type": "string",
							"description": "Provider of the event"
						},
						{
							"name": "success",
							"type": "boolean",
							"description": "Success status of the event"
						},
						{
							"name": "service",
							"type": "string",
							"description": "Service related to the event"
						},
						{
							"name": "organization",
							"type": "string",
							"description": "Organization ID"
						},
						{
							"name": "version",
							"type": "string",
							"description": "Version of the event"
						},
						{
							"name": "clientIp",
							"type": "string",
							"description": "Client IP address"
						},
						{
							"name": "id",
							"type": "string",
							"description": "Event ID"
						}
					]
				}
			},
			"destinations": {
				"logAnalytics": [
					{
						"workspaceResourceId": "{{workspaceResourceId}}",
						"name": "clv2ws1"
					}
				]
			},
			"dataFlows": [
				{
					"streams": [
						"Custom-JumpCloud_API"
					],
					"destinations": [
						"clv2ws1"
					],
					"transformKql": "source\r\n| extend \r\n            TimeGenerated = ts,\r\n            EventStartTime = ts,\r\n            EventEndTime = ts,\r\n            EventCount = toint(1),\r\n            EventResult = iif(success, \"Success\", \"Failure\"),\r\n            EventResultDetails = tostring(id),\r\n            EventProduct = \"JumpCloud\", \r\n            EventVendor = \"JumpCloud\",\r\n            Dvc = \"JumpCloud\",\r\n            EventType = eventType,\r\n            EventSchemaVersion = \"0.1\",  \r\n            EventOriginalType = eventType,         \r\n            SrcIpAddr = clientIp,\r\n            SrcUserId = initiatedById,\r\n            SrcUserIdType = \"UID\",\r\n            OrganizationId = organization,\r\n            GeoLocation = geo_location(clientIp),\r\n            UserAgent = userAgentName,\r\n            UserAgentVersion = userAgentVersion,\r\n            UserAgentOs = userAgentOs,\r\n            UserAgentOsVersion = userAgentOsVersion,\r\n            UserAgentDevice = userAgentDevice,\r\n            UserAgentOsFull = userAgentOsFull,\r\n            UserAgentPatch = userAgentPatch,\r\n            UserAgentMajor = userAgentMajor,\r\n            UserAgentMinor = userAgentMinor,\r\n            UserAgentOsMajor = userAgentOsMajor,\r\n            UserAgentOsName = userAgentOsName,\r\n            GeoCountry = geoipCountryCode,\r\n            GeoTimezone = geoipTimezone,\r\n            GeoLatitude = geoipLatitude,\r\n            GeoContinentCode = geoipContinentCode,\r\n            GeoRegionName = geoipRegionName,\r\n            GeoRegionCode = geoipRegionCode,\r\n            GeoLongitude = geoipLongitude\r\n| project-away ts\r\n| extend Type=\"JumpCloud_CL\"",
					"outputStream": "Custom-JumpCloud_CL"
				}
			]
		}
	}
]
