{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Rao Peraka - rao.peraka@forescout.com",
    "comments": "Solution template for Forescout eyeInspect for OT Security"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Forescout eyeInspect for OT Security Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "rao.peraka@forescout.com",
    "_email": "[variables('email')]",
    "_solutionName": "Forescout eyeInspect for OT Security",
    "_solutionVersion": "3.0.0",
    "solutionId": "forescout.eyeinspectotsecurity",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "Forescout_eyeInspect_for_OT_Security",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "Forescout_eyeInspect_for_OT_Security",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workbookVersion1": "1.0",
    "workbookContentId1": "eyeInspectOTSecurityWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Forescout eyeInspect for OT Security data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Forescout eyeInspect for OT Security",
                  "publisher": "Forescout",
                  "descriptionMarkdown": "Forescout eyeInspect for OT Security connector allows you to connect Asset/Alert information from Forescout eyeInspect OT platform with Microsoft Sentinel, to view and analyze data using Log Analytics Tables and Workbooks. This gives you more insight into OT organization network and improves security operation capabilities.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "ForescoutOtAsset_CL",
                      "baseQuery": "ForescoutOtAsset_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get 5 latest OT Assets",
                      "query": "ForescoutOtAsset_CL\n | sort by TimeGenerated | take 5"
                    },
                    {
                      "description": "Get 5 latest OT Alerts",
                      "query": "ForescoutOtAlert_CL\n | sort by TimeGenerated | take 5"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "ForescoutOtAsset_CL",
                      "lastDataReceivedQuery": "ForescoutOtAsset_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "ForescoutOtAlert_CL",
                      "lastDataReceivedQuery": "ForescoutOtAlert_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "ForescoutOtAsset_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "ForescoutOtAlert_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Instructions on how to configure Forescout eyeInspect Microsoft Sentinel Integration are provided at Forescout eyeInspect Documentation Portal",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "Forescout eyeInspect OT Microsoft Sentinel Integration"
                    }
                  ],
                  "metadata": {
                    "id": "6ff68bad-2b36-4439-a6d3-0dee736b0dd1",
                    "version": "1.0.0",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "author": {
                      "name": "Forescout Technologies"
                    },
                    "support": {
                      "tier": "developer",
                      "name": "Forescout Technologies",
                      "link": "https://www.forescout.com/support"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Forescout eyeInspect for OT Security",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Rao Peraka",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Forescout Technologies",
                  "email": "support@forescout.com",
                  "tier": "Partner",
                  "link": "https://www.forescout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "Forescout eyeInspect for OT Security",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Forescout eyeInspect for OT Security",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Rao Peraka",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Forescout Technologies",
          "email": "support@forescout.com",
          "tier": "Partner",
          "link": "https://www.forescout.com/support"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "Forescout eyeInspect for OT Security",
          "publisher": "Forescout",
          "descriptionMarkdown": "Forescout eyeInspect for OT Security connector allows you to connect Asset/Alert information from Forescout eyeInspect OT platform with Microsoft Sentinel, to view and analyze data using Log Analytics Tables and Workbooks. This gives you more insight into OT organization network and improves security operation capabilities.",
          "graphQueries": {
            "metricName": "Total data received",
            "legend": "ForescoutOtAsset_CL",
            "baseQuery": "ForescoutOtAsset_CL"
          },
          "dataTypes": [
            {
              "name": "ForescoutOtAsset_CL",
              "lastDataReceivedQuery": "ForescoutOtAsset_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "ForescoutOtAlert_CL",
              "lastDataReceivedQuery": "ForescoutOtAlert_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "ForescoutOtAsset_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "ForescoutOtAlert_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Get 5 latest OT Assets",
              "query": "ForescoutOtAsset_CL\n | sort by TimeGenerated | take 5"
            },
            {
              "description": "Get 5 latest OT Alerts",
              "query": "ForescoutOtAlert_CL\n | sort by TimeGenerated | take 5"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Instructions on how to configure Forescout eyeInspect Microsoft Sentinel Integration are provided at Forescout eyeInspect Documentation Portal",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ],
              "title": "Forescout eyeInspect OT Microsoft Sentinel Integration"
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "eyeInspectOTSecurityWorkbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into Assets and Alerts in Forescout eyeInspect OT platform"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Filter Parameters\",\"expandable\":true,\"expanded\":true,\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6fae20b1-4c99-4444-8eec-118d49bc4819\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"description\":\"Time Range for Data\",\"isGlobal\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":2592000000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"parameters - 6\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"45b60e04-fd60-4b68-b7cd-0ac60bc96671\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LogAnalyticsWorkspace\",\"label\":\"Log Analytics Workspace\",\"type\":5,\"description\":\"Source Log Analytics Workspace\",\"isGlobal\":true,\"query\":\"resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains 'SecurityInsights' | project id = tostring(properties.workspaceResourceId)\",\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true,\"microsoft.desktopvirtualization/workspaces\":true,\"microsoft.apicenter/services/workspaces\":true,\"microsoft.apimanagement/service/workspaces\":true},\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"customWidth\":\"15\",\"name\":\"parameters - 5\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f6a66069-738a-4664-92db-3b25da9ba906\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectedTab\",\"type\":1,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000},\"value\":\"alert_severity\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"20\",\"conditionalVisibility\":{\"parameterName\":\"PurdueLevel\",\"comparison\":\"isEqualTo\",\"value\":\"abcd\"},\"name\":\"parameters - 19\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"4f25575d-17c9-4896-8bec-7a85d96e39eb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AssetIpAddress\",\"label\":\"Asset Ip Address\",\"type\":1,\"description\":\"IP Address of Asset to view\",\"isRequired\":true,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"parameters - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"f200aaf5-8fc4-4e21-b8d9-0308e8302d85\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"PurdueLevel\",\"label\":\"Purdue Level\",\"type\":1,\"description\":\"Value of Purdue Level to view Assets\",\"isRequired\":true,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"parameters - 8\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"2958962e-027c-4c66-8341-d3e9dd019c97\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AssetSeverity\",\"label\":\"Asset Severity\",\"type\":1,\"description\":\"Value of Severity to view Assets\",\"isRequired\":true,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"20\",\"name\":\"parameters - 5\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"8834a3bc-8099-41ed-8d02-6c6e1a640b9d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AlertSeverity\",\"label\":\"Alert Severity\",\"type\":1,\"description\":\"Value of Severity to view Alerts\",\"isRequired\":true,\"isGlobal\":true,\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"20\",\"name\":\"parameters - 7\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"2aaad873-997a-496b-a824-21cb3e62f0f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"CCIP\",\"label\":\"Command Center IP\",\"type\":2,\"description\":\"IP Address of Command Center\",\"isGlobal\":true,\"query\":\"datatable(CommandCenterIpAddr:string) [\\\"Any\\\"]\\r\\n| union (\\r\\n    union ForescoutOtAsset_CL, ForescoutOtAlert_CL\\r\\n    | where isnotempty(CommandCenterIpAddr)\\r\\n    | distinct CommandCenterIpAddr\\r\\n)\",\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Any\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 7\"}],\"exportParameters\":true},\"name\":\"Filter Parameters\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Number of Assets/Alerts/Sensors\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAsset_CL\\r\\n| sort by TimeGenerated\\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| summarize distinctAssets =  count() by IpAddr\\r\\n| summarize Number_Of_Distinct_Assets = count()\\r\\n| project Number_Of_Distinct_Assets\",\"size\":4,\"title\":\"        Number of Assets\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"rowLimit\":100},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Number_Of_Distinct_Assets\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"compositeBarSettings\":{\"labelText\":\"\"}}},\"showBorder\":false,\"size\":\"auto\"},\"statSettings\":{\"valueAggregation\":\"None\",\"colorSettings\":{\"type\":\"static\",\"mode\":\"foreground\",\"staticColor\":\"blue\",\"heatmapPalette\":\"greenRed\"},\"tagText\":\"\",\"valueFontStyle\":\"medium\"}},\"customWidth\":\"20\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| sort by TimeGenerated\\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n//| summarize distinctAssets =  count() by IpAddr\\r\\n|  summarize Number_Of_New_Alerts = count()\\r\\n| project Number_Of_New_Alerts\",\"size\":4,\"title\":\"Number of Alerts\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Number_Of_New_Alerts\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false},\"statSettings\":{\"valueAggregation\":\"None\",\"colorSettings\":{\"type\":\"static\",\"mode\":\"foreground\",\"staticColor\":\"blue\",\"heatmapPalette\":\"greenRed\"},\"tagText\":\"\",\"valueFontStyle\":\"medium\"}},\"customWidth\":\"20\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where isnotempty(SensorName)\\r\\n| distinct tostring(SensorName)\\r\\n|summarize Number_of_Sensors = count()\",\"size\":4,\"title\":\"Number of Sensors\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Number_of_Sensors\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false},\"statSettings\":{\"valueAggregation\":\"None\",\"colorSettings\":{\"type\":\"static\",\"mode\":\"foreground\",\"staticColor\":\"blue\",\"heatmapPalette\":\"greenRed\"},\"tagText\":\"\",\"valueFontStyle\":\"medium\"}},\"customWidth\":\"20\",\"name\":\"query - 10\"}]},\"name\":\"Summary Counts\",\"styleSettings\":{\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Assets Information\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAsset_CL\\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where isnotempty(PurdueLevel)\\r\\n| where isnotempty(IpAddr)\\r\\n| distinct IpAddr, tostring(PurdueLevel)\\r\\n| summarize Count = count() by tostring(PurdueLevel)\\r\\n| sort by tostring(PurdueLevel) asc\\r\\n| project PurdueLevel, Count \\r\\n| render barchart\",\"size\":0,\"title\":\"Assets Per Purdue\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"x\",\"exportParameterName\":\"PurdueLevel\",\"exportDefaultValue\":\"\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"],\"visualization\":\"categoricalbar\"},\"customWidth\":\"65\",\"name\":\"query - 11\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n//| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where isnotempty(SrcIpAddr)\\r\\n| where isnotempty(Severity)\\r\\n| distinct SrcIpAddr, tostring(Severity)\\r\\n| summarize Count = count() by SrcIpAddr, tostring(Severity)\\r\\n| sort by tostring(Severity) asc\\r\\n| project Severity, Count \\r\\n| render piechart\",\"size\":0,\"title\":\"Assets Per Severity\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"AssetSeverity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"purple\"},{\"seriesName\":\"Low\",\"color\":\"turquoise\"}]}},\"customWidth\":\"35\",\"name\":\"query - 12\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"Assets Information\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Alerts Information\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL \\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| sort by TimeGenerated\\r\\n//| take 10000\\r\\n| summarize count() by bin(TimeGenerated, 6h), tostring(Severity)\\r\\n| render areachart\",\"size\":0,\"title\":\"Alerts Over Time\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"customWidth\":\"65\",\"name\":\"query - 13\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where isnotempty(Severity)\\r\\n| summarize Count = count() by tostring(Severity)\\r\\n| project Severity, Count\\r\\n| render piechart\",\"size\":0,\"title\":\"Alerts Per Severity\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"series\",\"exportParameterName\":\"AlertSeverity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"],\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Low\",\"color\":\"turquoise\"},{\"seriesName\":\"High\",\"color\":\"redBright\"},{\"seriesName\":\"Medium\",\"color\":\"purple\"},{\"seriesName\":\"Informational\",\"color\":\"magenta\"}]}},\"customWidth\":\"35\",\"name\":\"query - 14\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n|summarize NumberOfAlerts = count() by tostring(SrcIpAddr)//, tostring(DstIpAddr)\\r\\n|sort by NumberOfAlerts\\r\\n| take 10\\r\\n|render barchart\",\"size\":0,\"title\":\"Top 10 Assets with most Alerts\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"x\",\"exportParameterName\":\"AssetIpAddress\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"customWidth\":\"65\",\"name\":\"query - 15\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where SensorName <> \\\"\\\"\\r\\n| summarize Count = count() by tostring(SensorName)\\r\\n| project SensorName, Count\\r\\n| render piechart\",\"size\":0,\"title\":\"Alerts per Sensor\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"customWidth\":\"35\",\"name\":\"query - 13\",\"styleSettings\":{\"showBorder\":true}}]},\"name\":\"Alerts Information\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Details\",\"expandable\":true,\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"2dfe478b-1a64-4f53-86de-51854f57501c\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Assets\",\"subTarget\":\"assets\",\"style\":\"link\"},{\"id\":\"da0873be-6caa-4529-8cdf-0ae30d2f8c24\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Alerts\",\"subTarget\":\"alerts\",\"style\":\"link\"},{\"id\":\"f2648211-33f3-459c-9e03-8c6ba845d546\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Selected Asset Details\",\"subTarget\":\"asset_single\",\"style\":\"link\"},{\"id\":\"3dd7e7d4-4017-4881-84b8-c63714d25c3b\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Assets by Purdue\",\"subTarget\":\"asset_purdue\",\"style\":\"link\"},{\"id\":\"043cb8ea-841b-46a3-8448-e71e9f5244b3\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Assets by Severity\",\"subTarget\":\"asset_severity\",\"style\":\"link\"},{\"id\":\"c87b5aa1-1bad-4d93-9a77-0adeb969badf\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Alerts by Severity\",\"subTarget\":\"alert_severity\",\"style\":\"link\"}]},\"name\":\"links - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAsset_CL\\r\\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n|sort by TimeGenerated  \\r\\n| extend first_seen_epoch = todatetime(tostring(FirstSeen))\\r\\n| extend Duration = now() - first_seen_epoch\\r\\n| extend SrcIpAddr = IpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"Critical\\\" | summarize CriticalCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"High\\\" | summarize HighCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"Medium\\\" | summarize MediumCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n|summarize by IpAddr, CommandCenterIpAddr, tostring(MacAddrs), CriticalCount, HighCount, MediumCount, tostring(FirstSeen), tostring(MainVendorModel), tostring(FirmwareVersion), tostring(HardwareVersion), tostring(SerialNumber), tostring(Labels), tostring(OsVersion), tostring(MainRole), Duration\\r\\n| distinct Duration, IpAddr, CommandCenterIpAddr, MacAddrs, CriticalCount, HighCount, MediumCount, MainRole, MainVendorModel, FirmwareVersion, HardwareVersion, SerialNumber, Labels, OsVersion, FirstSeen\\r\\n| project-rename ['Ip Address']=IpAddr, ['CommandCenter Ip Address']=CommandCenterIpAddr, ['MAC']=MacAddrs, ['Critical #']=CriticalCount, ['High #']=HighCount, ['Medium #']=MediumCount, ['Main Role']=MainRole, ['Main Vendor Model']=MainVendorModel, ['Firmware Version']=FirmwareVersion, ['Hardware Version']=HardwareVersion, ['Serial Number']=SerialNumber, ['OS Version']=OsVersion, ['First Seen'] = FirstSeen\\r\\n|render table\",\"size\":0,\"title\":\"Assets\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"assets\"},\"name\":\"query - 16\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where isnotempty(Severity)\\r\\n| project TimeGenerated, AlertId, Severity, AlertCategory, Status, SrcIpAddr, SrcMacAddr, DstIpAddr, DstMacAddr, CommandCenterIpAddr, SensorName, CaseId, AlertData, Desc, SrcHostName, DstHostName, SrcPort, DstPort, L2Proto, L3Proto, L4Proto, L7Proto, Labels, MitreTactics, Name, ProfId, ProfModName, EngineName, TypeId\\r\\n| project-rename ['Time Generated']=TimeGenerated, ['Alert Id']=AlertId, Severity, Status, ['Src IpAddress']=SrcIpAddr, ['Src MAC']=SrcMacAddr, ['Dst IpAddress']=DstIpAddr, ['Dst MAC']=DstMacAddr, ['Command Center IpAddr']=CommandCenterIpAddr, ['Sensor Name']=SensorName, ['Alert Category']=AlertCategory, ['Case Id']=CaseId, ['Alert Data']=AlertData, Desc, ['Src HostName']=SrcHostName, ['Dst HostName']=DstHostName, ['Src Port']=SrcPort, ['Dst Port']=DstPort, ['L2 Protocol']=L2Proto, ['L3 Protocol']=L3Proto, ['L4 Protocol']=L4Proto, ['L7 Protocol']=L7Proto, Labels, ['Mitre Tactics']=MitreTactics, Name, ['Prof Id']=ProfId, ['Prof Module']=ProfModName, ['Engine Name']=EngineName, ['Type Id']=TypeId\\r\\n| render table\",\"size\":0,\"title\":\"Alerts\",\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"alerts\"},\"name\":\"query - 3\",\"styleSettings\":{\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAsset_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n|sort by TimeGenerated\\r\\n| where isnotempty(IpAddr)\\r\\n| where IpAddr == '{AssetIpAddress}'\\r\\n| extend SrcIpAddr = IpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"Critical\\\" | summarize CriticalCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"High\\\" | summarize HighCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"Medium\\\" | summarize MediumCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| summarize arg_max (TimeGenerated,CommandCenterIpAddr, tostring(MacAddrs),CriticalCount, HighCount, MediumCount, MainRole, MainVendorModel, FirmwareVersion, HardwareVersion, SerialNumber, Labels, OsVersion, FirstSeen, LastSeen, AssetData) by IpAddr\\r\\n| project-rename ['Ip Address']=IpAddr, ['CommandCenter Ip Address']=CommandCenterIpAddr, ['MAC']=MacAddrs, ['Critical #']=CriticalCount, ['High #']=HighCount, ['Medium #']=MediumCount, ['Main Role']=MainRole, ['Main Vendor Model']=MainVendorModel, ['Firmware Version']=FirmwareVersion, ['Hardware Version']=HardwareVersion, ['Serial Number']=SerialNumber, ['OS Version']=OsVersion, ['First Seen'] = FirstSeen\",\"size\":0,\"title\":\"Asset details of IP {AssetIpAddress}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"asset_single\"},\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAsset_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| sort by TimeGenerated\\r\\n| where isnotempty(PurdueLevel)\\r\\n//| extend selectedPurdueLevel = iff(isnotempty({PurdueLevel}), '{PurdueLevel}', 'notset')\\r\\n| where PurdueLevel == '{PurdueLevel}'\\r\\n//| distinct IpAddr, tostring(PurdueLevel)\\r\\n//| project IpAddr, PurdueLevel\\r\\n//| distinct IpAddr, tostring(PurdueLevel)\\r\\n| extend SrcIpAddr = IpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"Critical\\\" | summarize CriticalCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"High\\\" | summarize HighCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| lookup kind=leftouter (ForescoutOtAlert_CL | where Severity == \\\"Medium\\\" | summarize MediumCount = count() by SrcIpAddr) on SrcIpAddr\\r\\n| summarize arg_max (TimeGenerated, CommandCenterIpAddr, tostring(MacAddrs),CriticalCount, HighCount, MediumCount, MainRole, MainVendorModel, FirmwareVersion, HardwareVersion, SerialNumber, Labels, OsVersion, FirstSeen, LastSeen, AssetData) by IpAddr\\r\\n| project-rename ['Ip Address']=IpAddr, ['Time Generated']=TimeGenerated, ['Command Center Ip Address']=CommandCenterIpAddr, ['MAC']=MacAddrs, ['Critical #']=CriticalCount, ['High #']=HighCount, ['Medium #']=MediumCount, ['Main Role']=MainRole, ['Main Vendor Model']=MainVendorModel, ['Firmware Version']=FirmwareVersion, ['Hardware Version']=HardwareVersion, ['Serial Number']=SerialNumber, ['OS Version']=OsVersion, ['First Seen']=FirstSeen, ['Last Seen']=LastSeen, ['Asset Data']=AssetData \\r\\n| render table\",\"size\":0,\"title\":\"Assets matching PurdueLevel {PurdueLevel}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"asset_purdue\"},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where Severity == '{AssetSeverity}'\\r\\n| where isnotempty(SrcIpAddr)\\r\\n| extend IpAddr = SrcIpAddr\\r\\n| distinct SrcIpAddr,  SrcMacAddr, IpAddr\\r\\n| lookup ForescoutOtAsset_CL on IpAddr | summarize arg_max (TimeGenerated, CommandCenterIpAddr, tostring(MacAddrs), MainRole, MainVendorModel, FirmwareVersion, HardwareVersion, SerialNumber, Labels, OsVersion, FirstSeen, LastSeen, AssetData) by IpAddr | project-rename ['Ip Address']=IpAddr, ['Time Generated']=TimeGenerated, ['Command Center Ip Address']=CommandCenterIpAddr, ['MAC']=MacAddrs, ['Main Role']=MainRole, ['Main Vendor Model']=MainVendorModel, ['Firmware Version']=FirmwareVersion, ['Hardware Version']=HardwareVersion, ['Serial Number']=SerialNumber, ['OS Version']=OsVersion, ['First Seen']=FirstSeen, ['Last Seen']=LastSeen, ['Asset Data']=AssetData \\r\\n| render table\",\"size\":0,\"title\":\"Assets with Severity - {AssetSeverity}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"asset_severity\"},\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ForescoutOtAlert_CL\\r\\n| where iff((isnull('{CCIP}') or isempty('{CCIP}') or ('{CCIP}' == \\\"Any\\\")), true, CommandCenterIpAddr == '{CCIP}')\\r\\n| where isnotempty(Severity)\\r\\n| where Severity == '{AlertSeverity}'\\r\\n| project TimeGenerated, AlertId, Severity, Status, SrcIpAddr, SrcMacAddr, DstIpAddr, DstMacAddr, CommandCenterIpAddr, SensorName, AlertCategory, CaseId, AlertData, Desc, SrcHostName, DstHostName, SrcPort, DstPort, L2Proto, L3Proto, L4Proto, L7Proto, Labels, MitreTactics, Name, ProfId, ProfModName, EngineName, TypeId\\r\\n| project-rename ['Time Generated']=TimeGenerated, ['Alert Id']=AlertId, Severity, Status, ['Src IpAddress']=SrcIpAddr, ['Src MAC']=SrcMacAddr, ['Dst IpAddress']=DstIpAddr, ['Dst MAC']=DstMacAddr, ['Command Center IpAddr']=CommandCenterIpAddr, ['Sensor Name']=SensorName, ['Alert Category']=AlertCategory, ['Case Id']=CaseId, ['Alert Data']=AlertData, Desc, ['Src HostName']=SrcHostName, ['Dst HostName']=DstHostName, ['Src Port']=SrcPort, ['Dst Port']=DstPort, ['L2 Protocol']=L2Proto, ['L3 Protocol']=L3Proto, ['L4 Protocol']=L4Proto, ['L7 Protocol']=L7Proto, Labels, ['Mitre Tactics']=MitreTactics, Name, ['Prof Id']=ProfId, ['Prof Module']=ProfModName, ['Engine Name']=EngineName, ['Type Id']=TypeId\\r\\n| render table\",\"size\":0,\"title\":\"Alerts by Severity - {AlertSeverity}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{LogAnalyticsWorkspace}\"]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"alert_severity\"},\"name\":\"query - 14\"}],\"exportParameters\":true},\"name\":\"Details\",\"styleSettings\":{\"showBorder\":true}}],\"styleSettings\":{\"spacingStyle\":\"none\"},\"fromTemplateId\":\"sentinel-eyeInspectOTSecurityWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=eyeInspectOTSecurityWorkbook; logoFileName=forescout-logo.svg; description=Gain insights into Assets and Alerts in Forescout eyeInspect OT platform; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Forescout eyeInspect for OT Security Workbook; templateRelativePath=eyeInspectOTSecurityWorkbook.json; subtitle=; provider=Forescout}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Forescout eyeInspect for OT Security",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Rao Peraka",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Forescout Technologies",
                  "email": "support@forescout.com",
                  "tier": "Partner",
                  "link": "https://www.forescout.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ForescoutOtAsset_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ForescoutOtAlert_CL",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Forescout eyeInspect for OT Security",
        "publisherDisplayName": "Forescout Technologies",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Forescout%20eyeInspect%20for%20OT%20Security/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>Forescout eyeInspect isa cybersecurity platform designed for Operational Technology (OT) and Industrial Control Systems (ICS) environments.It provides visibility into network devices, threat detection, and risk management for critical infrastructure like power grids and manufacturing plants.eyeInspect usesdeep packet inspectionof OT/ICS protocols to establish a baseline of network behavior and identify potential threats and vulnerabilities.  Forescout eyeInspect helps OT/ICS industry customers to achieve end-to-end cyber resiliency of OT/ICS network with a comprehensive asset risk framework and threat detection through deep packet inspection of all industrial network protocols. Forescout eyeInspect defends customers most critical infrastructure, with thousands of OT-specific threat indicators and powerful anomaly detection through a platform that enables organizations across the globe to act on identified risks and detect cyber threats before they lead to operational downtime.  This solution integrates Forescout eyeInspect with Microsoft Sentinel. This integration facilitates comprehensive view of OT Asset data and Alerts, and helps with enhanced security analysis with Microsoft Sentinel tools.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Workbooks:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/forescout-logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Forescout eyeInspect for OT Security",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Rao Peraka",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Forescout Technologies",
          "email": "support@forescout.com",
          "tier": "Partner",
          "link": "https://www.forescout.com/support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2025-07-10",
        "providers": [
          "Forescout"
        ],
        "categories": {
          "domains": [
            "Security - Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
