{
    "name": "CyfirmaAttackSurfaceAlertsDCR",
    "type": "Microsoft.Insights/dataCollectionRules",
    "apiVersion": "2022-06-01",
    "location": "{{location}}",
    "properties": {
        "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
        "streamDeclarations": {
            "Custom-CyfirmaASCertificatesAlerts_CL": {
                "columns": [
                    {
                        "name": "alert_created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "alert_object_uid",
                        "type": "string"
                    },
                    {
                        "name": "alert_uid",
                        "type": "datetime"
                    },
                    {
                        "name": "asset_comments",
                        "type": "string"
                    },
                    {
                        "name": "attacks",
                        "type": "dynamic"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "cert_data",
                        "type": "string"
                    },
                    {
                        "name": "cert_hash",
                        "type": "string"
                    },
                    {
                        "name": "cert_type",
                        "type": "string"
                    },
                    {
                        "name": "description",
                        "type": "string"
                    },
                    {
                        "name": "first_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "is_third_party",
                        "type": "boolean"
                    },
                    {
                        "name": "is_vulnerable",
                        "type": "boolean"
                    },
                    {
                        "name": "issued_by",
                        "type": "string"
                    },
                    {
                        "name": "issued_to",
                        "type": "string"
                    },
                    {
                        "name": "issuer_public_hash",
                        "type": "string"
                    },
                    {
                        "name": "last_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "notes",
                        "type": "dynamic"
                    },
                    {
                        "name": "protocols",
                        "type": "dynamic"
                    },
                    {
                        "name": "risk_score",
                        "type": "int"
                    },
                    {
                        "name": "safe_flag_comments",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_by",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_date",
                        "type": "string"
                    },
                    {
                        "name": "self_signed",
                        "type": "boolean"
                    },
                    {
                        "name": "serial",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "source",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "sub_category",
                        "type": "string"
                    },
                    {
                        "name": "sub_domain",
                        "type": "string"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "top_domain",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "use_cases",
                        "type": "string"
                    },
                    {
                        "name": "valid_from",
                        "type": "datetime"
                    },
                    {
                        "name": "valid_to",
                        "type": "datetime"
                    },
                    {
                        "name": "version",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyfirmaASConfigurationAlerts_CL": {
                "columns": [
                    {
                        "name": "alert_created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "alert_object_uid",
                        "type": "string"
                    },
                    {
                        "name": "alert_uid",
                        "type": "datetime"
                    },
                    {
                        "name": "asset_comment",
                        "type": "string"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "click_jacking_defence",
                        "type": "boolean"
                    },
                    {
                        "name": "content_security_policy",
                        "type": "boolean"
                    },
                    {
                        "name": "cookie_xss_protection",
                        "type": "boolean"
                    },
                    {
                        "name": "data_injection_defence",
                        "type": "boolean"
                    },
                    {
                        "name": "description",
                        "type": "string"
                    },
                    {
                        "name": "dmarc",
                        "type": "string"
                    },
                    {
                        "name": "dns_sec",
                        "type": "string"
                    },
                    {
                        "name": "domain_expiry",
                        "type": "dynamic"
                    },
                    {
                        "name": "domain_status",
                        "type": "string"
                    },
                    {
                        "name": "first_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "ip",
                        "type": "string"
                    },
                    {
                        "name": "is_third_party",
                        "type": "boolean"
                    },
                    {
                        "name": "last_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "missing_epp_codes",
                        "type": "dynamic"
                    },
                    {
                        "name": "notes",
                        "type": "dynamic"
                    },
                    {
                        "name": "open_relay",
                        "type": "string"
                    },
                    {
                        "name": "risk_score",
                        "type": "int"
                    },
                    {
                        "name": "safe_flag_comments",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_by",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_date",
                        "type": "string"
                    },
                    {
                        "name": "secure_cookie",
                        "type": "boolean"
                    },
                    {
                        "name": "server",
                        "type": "string"
                    },
                    {
                        "name": "server_version",
                        "type": "string"
                    },
                    {
                        "name": "set_cookie_https_only",
                        "type": "boolean"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "software",
                        "type": "string"
                    },
                    {
                        "name": "spf",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "strict_transport_Security",
                        "type": "boolean"
                    },
                    {
                        "name": "sub_category",
                        "type": "string"
                    },
                    {
                        "name": "sub_domain",
                        "type": "string"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "top_domain",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "use_cases",
                        "type": "string"
                    },
                    {
                        "name": "web_app_firewall",
                        "type": "string"
                    },
                    {
                        "name": "x_frame_options",
                        "type": "boolean"
                    },
                    {
                        "name": "x_xss_protection",
                        "type": "boolean"
                    },
                    {
                        "name": "zone_transfer",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyfirmaASDomainIPReputationAlerts_CL": {
                "columns": [
                    {
                        "name": "alert_created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "alert_object_uid",
                        "type": "string"
                    },
                    {
                        "name": "alert_uid",
                        "type": "datetime"
                    },
                    {
                        "name": "asset_comments",
                        "type": "string"
                    },
                    {
                        "name": "categories",
                        "type": "dynamic"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "country",
                        "type": "string"
                    },
                    {
                        "name": "country_code",
                        "type": "string"
                    },
                    {
                        "name": "first_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "ip",
                        "type": "string"
                    },
                    {
                        "name": "ip_version",
                        "type": "int"
                    },
                    {
                        "name": "is_third_party",
                        "type": "boolean"
                    },
                    {
                        "name": "isp",
                        "type": "string"
                    },
                    {
                        "name": "last_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "last_users_reported",
                        "type": "datetime"
                    },
                    {
                        "name": "notes",
                        "type": "dynamic"
                    },
                    {
                        "name": "reports",
                        "type": "dynamic"
                    },
                    {
                        "name": "risk_score",
                        "type": "int"
                    },
                    {
                        "name": "safe_flag_comments",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_by",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_date",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "sub_category",
                        "type": "string"
                    },
                    {
                        "name": "sub_domain",
                        "type": "string"
                    },
                    {
                        "name": "threat_actors",
                        "type": "dynamic"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "top_domain",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "usage_type",
                        "type": "string"
                    },
                    {
                        "name": "use_cases",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyfirmaASDomainIPVulnerabilityAlerts_CL": {
                "columns": [
                    {
                        "name": "alert_created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "alert_object_uid",
                        "type": "string"
                    },
                    {
                        "name": "alert_uid",
                        "type": "datetime"
                    },
                    {
                        "name": "asset_comments",
                        "type": "string"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "country",
                        "type": "string"
                    },
                    {
                        "name": "description",
                        "type": "string"
                    },
                    {
                        "name": "first_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "host_provider",
                        "type": "string"
                    },
                    {
                        "name": "ip",
                        "type": "string"
                    },
                    {
                        "name": "is_third_party",
                        "type": "boolean"
                    },
                    {
                        "name": "last_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "notes",
                        "type": "dynamic"
                    },
                    {
                        "name": "open_ports",
                        "type": "dynamic"
                    },
                    {
                        "name": "possible_vulnerabilities",
                        "type": "dynamic"
                    },
                    {
                        "name": "risk_score",
                        "type": "int"
                    },
                    {
                        "name": "safe_flag_comments",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_by",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_date",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "softwares",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "sub_category",
                        "type": "string"
                    },
                    {
                        "name": "sub_domain",
                        "type": "string"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "top_domain",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "use_cases",
                        "type": "string"
                    },
                    {
                        "name": "web_server",
                        "type": "string"
                    },
                    {
                        "name": "web_server_version",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyfirmaASOpenPortsAlerts_CL": {
                "columns": [
                    {
                        "name": "alert_created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "alert_object_uid",
                        "type": "string"
                    },
                    {
                        "name": "alert_uid",
                        "type": "datetime"
                    },
                    {
                        "name": "asset_comments",
                        "type": "string"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "description",
                        "type": "string"
                    },
                    {
                        "name": "first_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "ip",
                        "type": "string"
                    },
                    {
                        "name": "is_third_party",
                        "type": "boolean"
                    },
                    {
                        "name": "last_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "notes",
                        "type": "dynamic"
                    },
                    {
                        "name": "open_ports",
                        "type": "dynamic"
                    },
                    {
                        "name": "risk_score",
                        "type": "int"
                    },
                    {
                        "name": "safe_flag_comments",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_by",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_date",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "software",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "sub_category",
                        "type": "string"
                    },
                    {
                        "name": "sub_domain",
                        "type": "string"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "top_domain",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "use_cases",
                        "type": "string"
                    },
                    {
                        "name": "web_app_firewall",
                        "type": "string"
                    },
                    {
                        "name": "web_server",
                        "type": "string"
                    },
                    {
                        "name": "web_server_version",
                        "type": "string"
                    }
                ]
            },
            "Custom-CyfirmaASCloudWeaknessAlerts_CL": {
                "columns": [
                    {
                        "name": "alert_created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "alert_object_uid",
                        "type": "string"
                    },
                    {
                        "name": "alert_uid",
                        "type": "string"
                    },
                    {
                        "name": "asset_category",
                        "type": "string"
                    },
                    {
                        "name": "asset_comments",
                        "type": "string"
                    },
                    {
                        "name": "asset_name",
                        "type": "string"
                    },
                    {
                        "name": "asset_type",
                        "type": "string"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "created_date",
                        "type": "datetime"
                    },
                    {
                        "name": "description",
                        "type": "string"
                    },
                    {
                        "name": "first_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "impact",
                        "type": "string"
                    },
                    {
                        "name": "is_third_party",
                        "type": "boolean"
                    },
                    {
                        "name": "last_seen",
                        "type": "datetime"
                    },
                    {
                        "name": "notes",
                        "type": "dynamic"
                    },
                    {
                        "name": "recommendations",
                        "type": "string"
                    },
                    {
                        "name": "risk_score",
                        "type": "int"
                    },
                    {
                        "name": "safe_flag_comments",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_by",
                        "type": "string"
                    },
                    {
                        "name": "safe_flag_marked_date",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "source",
                        "type": "string"
                    },
                    {
                        "name": "source_type",
                        "type": "dynamic"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "sub_category",
                        "type": "string"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "uid",
                        "type": "string"
                    },
                    {
                        "name": "use_cases",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "{{workspaceResourceId}}",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-CyfirmaASCertificatesAlerts_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend TimeGenerated=alert_created_date\n| extend alert_title=['title']\n| project-away alert_created_date, ['title']\n",
                "outputStream": "Custom-CyfirmaASCertificatesAlerts_CL"
            },
            {
                "streams": [
                    "Custom-CyfirmaASConfigurationAlerts_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend TimeGenerated=alert_created_date\n| extend alert_title=['title']\n| project-away alert_created_date, ['title']\n",
                "outputStream": "Custom-CyfirmaASConfigurationAlerts_CL"
            },
            {
                "streams": [
                    "Custom-CyfirmaASDomainIPReputationAlerts_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend TimeGenerated=alert_created_date\n| extend Alert_title=['title']\n| project-away alert_created_date, ['title']\n",
                "outputStream": "Custom-CyfirmaASDomainIPReputationAlerts_CL"
            },
            {
                "streams": [
                    "Custom-CyfirmaASDomainIPVulnerabilityAlerts_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend TimeGenerated=alert_created_date\n| extend alert_title=['title']\n| project-away alert_created_date, ['title']\n",
                "outputStream": "Custom-CyfirmaASDomainIPVulnerabilityAlerts_CL"
            },
            {
                "streams": [
                    "Custom-CyfirmaASOpenPortsAlerts_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend TimeGenerated=alert_created_date\n| extend alert_title=['title']\n| project-away alert_created_date, ['title']\n",
                "outputStream": "Custom-CyfirmaASOpenPortsAlerts_CL"
            },
            {
                "streams": [
                    "Custom-CyfirmaASCloudWeaknessAlerts_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend TimeGenerated=alert_created_date\n| extend alert_title=['title']\n| project-away alert_created_date, ['title']\n",
                "outputStream": "Custom-CyfirmaASCloudWeaknessAlerts_CL"
            }
        ]
    }
}
