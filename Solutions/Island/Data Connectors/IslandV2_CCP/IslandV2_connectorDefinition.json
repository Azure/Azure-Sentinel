{
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "apiVersion": "2022-09-01-preview",
    "name": "IslandV2",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "IslandV2",
            "title": "Island Enterprise Browser V2 Event Collector (Using CCF)",
            "publisher": "Island",
            "descriptionMarkdown": "The [Island Enterprise Browser](https://www.island.io) data connector allows you to ingest all Island event types — including user events, admin events, and system events — into Microsoft Sentinel.",
            "graphQueriesTableName": "Island_UserEvents_V2_CL",
            "graphQueries": [
                {
                    "metricName": "Total Browser Audit events",
                    "legend": "Browser Audit Events",
                    "baseQuery": "Island_UserEvents_V2_CL"
                },
                {
                    "metricName": "Total Admin Action events",
                    "legend": "Admin Action Events",
                    "baseQuery": "Island_AdminEvents_V2_CL"
                },
                {
                    "metricName": "Total System events",
                    "legend": "System Events",
                    "baseQuery": "Island_SystemEvents_V2_CL"
                }
            ],
            "sampleQueries": [
                {
                    "description": "Get 10 Browser Audit log entries",
                    "query": "Island_UserEvents_V2_CL\n | sort by TimeGenerated desc\n | take 10"
                },
                {
                    "description": "Get 10 Admin Action log entries",
                    "query": "Island_AdminEvents_V2_CL\n | sort by TimeGenerated desc\n | take 10"
                },
                {
                    "description": "Get 10 System Event log entries",
                    "query": "Island_SystemEvents_V2_CL\n | sort by TimeGenerated desc\n | take 10"
                },
                {
                    "description": "Total events across all tables",
                    "query": "union Island_UserEvents_V2_CL, Island_AdminEvents_V2_CL, Island_SystemEvents_V2_CL\n | summarize count()"
                }
            ],
            "dataTypes": [
                {
                    "name": "Island_UserEvents_V2_CL",
                    "lastDataReceivedQuery": "Island_UserEvents_V2_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                },
                {
                    "name": "Island_AdminEvents_V2_CL",
                    "lastDataReceivedQuery": "Island_AdminEvents_V2_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                },
                {
                    "name": "Island_SystemEvents_V2_CL",
                    "lastDataReceivedQuery": "Island_SystemEvents_V2_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors"
                }
            ],
            "availability": {
                "isPreview": false
            },
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "write": true,
                            "read": true,
                            "delete": true
                        }
                    },
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "action": true
                        }
                    }
                ],
                "customs": [
                    {
                        "name": "Island API Key",
                        "description": "An Island API key is required. Generate the API Key and connector ID in the Island Management Console under SIEM > SENTINEL."
                    }
                ]
            },
            "instructionSteps": [
                {
                    "description": "To enable the Island connector for Microsoft Sentinel, provide the required information below and click on Connect. For full setup instructions, refer to the [official Island documentation](https://documentation.island.io/docs/configure-the-microsoft-sentinel-integration) (requires login to the Island Management Console).\n>",
                    "instructions": [
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "API URL",
                                "placeholder": "https://management.island.io/api/v3/Audits/{connectorId}",
                                "type": "text",
                                "name": "apiEndpoint"
                            }
                        },
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "API Key",
                                "placeholder": "Enter your Island API Key",
                                "type": "password",
                                "name": "apiKey"
                            }
                        },
                        {
                            "parameters": {
                                "label": "toggle",
                                "name": "toggle"
                            },
                            "type": "ConnectionToggleButton"
                        }
                    ],
                    "title": "Connect Island Enterprise Browser to Microsoft Sentinel"
                }
            ]
        }
    }
}
