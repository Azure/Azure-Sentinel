{
    "name": "Onapsis-DCR",
    "apiVersion": "2023-03-11",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
        "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
        "streamDeclarations": {
            "Custom-Onapsis_CL": {
                "columns": [
                    {
                        "name": "incident_type",
                        "type": "string"
                    },
                    {
                        "name": "anomaly_score",
                        "type": "real"
                    },
                    {
                        "name": "asset_name",
                        "type": "string"
                    },
                    {
                        "name": "confidence",
                        "type": "real"
                    },
                    {
                        "name": "created_at",
                        "type": "datetime"
                    },
                    {
                        "name": "incident_detail",
                        "type": "string"
                    },
                    {
                        "name": "incident_name",
                        "type": "string"
                    },
                    {
                        "name": "job_name",
                        "type": "string"
                    },
                    {
                        "name": "matching_rule",
                        "type": "string"
                    },
                    {
                        "name": "module_category",
                        "type": "string"
                    },
                    {
                        "name": "module_description",
                        "type": "string"
                    },
                    {
                        "name": "module_name",
                        "type": "string"
                    },
                    {
                        "name": "severity",
                        "type": "string"
                    },
                    {
                        "name": "sid",
                        "type": "string"
                    },
                    {
                        "name": "system_type",
                        "type": "string"
                    },
                    {
                        "name": "username",
                        "type": "string"
                    },
                    {
                        "name": "alarm_name",
                        "type": "string"
                    },
                    {
                        "name": "job_type",
                        "type": "string"
                    },
                    {
                        "name": "task_id",
                        "type": "real"
                    },
                    {
                        "name": "alarm_profile_id",
                        "type": "real"
                    },
                    {
                        "name": "TimeGenerated",
                        "type": "datetime"
                    },
                    {
                        "name": "action",
                        "type": "string"
                    },
                    {
                        "name": "alarm_profile_matches",
                        "type": "string"
                    },
                    {
                        "name": "client",
                        "type": "string"
                    },
                    {
                        "name": "column_bname",
                        "type": "string"
                    },
                    {
                        "name": "column_profile",
                        "type": "string"
                    },
                    {
                        "name": "detected_compliance",
                        "type": "string"
                    },
                    {
                        "name": "destination_port",
                        "type": "string"
                    },
                    {
                        "name": "downloaded_table",
                        "type": "string"
                    },
                    {
                        "name": "dst",
                        "type": "string"
                    },
                    {
                        "name": "erp_event_source",
                        "type": "string"
                    },
                    {
                        "name": "erp_host",
                        "type": "string"
                    },
                    {
                        "name": "erp_time",
                        "type": "datetime"
                    },
                    {
                        "name": "event_id",
                        "type": "real"
                    },
                    {
                        "name": "event_type",
                        "type": "string"
                    },
                    {
                        "name": "events",
                        "type": "string"
                    },
                    {
                        "name": "failed_ctls",
                        "type": "string"
                    },
                    {
                        "name": "fqdn",
                        "type": "string"
                    },
                    {
                        "name": "job_id",
                        "type": "real"
                    },
                    {
                        "name": "logline",
                        "type": "string"
                    },
                    {
                        "name": "modified",
                        "type": "datetime"
                    },
                    {
                        "name": "module_id",
                        "type": "real"
                    },
                    {
                        "name": "modules",
                        "type": "string"
                    },
                    {
                        "name": "osp_link",
                        "type": "string"
                    },
                    {
                        "name": "patch_applied",
                        "type": "string"
                    },
                    {
                        "name": "policy",
                        "type": "string"
                    },
                    {
                        "name": "policy_name",
                        "type": "string"
                    },
                    {
                        "name": "program_name",
                        "type": "string"
                    },
                    {
                        "name": "protocol",
                        "type": "string"
                    },
                    {
                        "name": "reason",
                        "type": "string"
                    },
                    {
                        "name": "result",
                        "type": "string"
                    },
                    {
                        "name": "sap_sec_notes",
                        "type": "string"
                    },
                    {
                        "name": "source_port",
                        "type": "string"
                    },
                    {
                        "name": "src",
                        "type": "string"
                    },
                    {
                        "name": "success",
                        "type": "string"
                    },
                    {
                        "name": "terminal_source",
                        "type": "string"
                    },
                    {
                        "name": "user_type",
                        "type": "string"
                    },
                    {
                        "name": "vulnerability_cvss",
                        "type": "string"
                    },
                    {
                        "name": "warning_ctls",
                        "type": "string"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "org_id",
                        "type": "real"
                    },
                    {
                        "name": "rolecollection_name",
                        "type": "string"
                    },
                    {
                        "name": "space_id",
                        "type": "real"
                    },
                    {
                        "name": "tenant",
                        "type": "string"
                    },
                    {
                        "name": "user",
                        "type": "string"
                    },
                    {
                        "name": "user_id",
                        "type": "real"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "{{workspaceResourceId}}",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-Onapsis_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "outputStream": "Custom-Onapsis_CL"
            },
            {
                "streams": [
                    "Microsoft-ABAPAuditLog"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source",
                "outputStream": "Microsoft-ABAPAuditLog"
            }
        ]
    }
}