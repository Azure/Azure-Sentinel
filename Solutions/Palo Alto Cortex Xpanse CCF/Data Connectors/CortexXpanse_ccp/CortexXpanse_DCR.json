  {
    "name": "PaloAltoXpanseDCR",
    "apiVersion": "2022-06-01",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
      "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
      "streamDeclarations": {
        "Custom-CortexXpanseStreamAlerts": {
          "columns": [
            {
              "name": "category",
              "type": "string"
            },
            {
              "name": "project",
              "type": "string"
            },
            {
              "name": "cloud_provider",
              "type": "string"
            },
            {
              "name": "resource_sub_type",
              "type": "string"
            },
            {
              "name": "resource_type",
              "type": "string"
            },
            {
              "name": "action_country",
              "type": "dynamic"
            },
            {
              "name": "event_type",
              "type": "string"
            },
            {
              "name": "is_whitelisted",
              "type": "boolean"
            },
            {
              "name": "image_name",
              "type": "string"
            },
            {
              "name": "action_local_ip",
              "type": "string"
            },
            {
              "name": "action_local_port",
              "type": "string"
            },
            {
              "name": "mitre_tactic_id_and_name",
              "type": "dynamic"
            },
            {
              "name": "mitre_technique_id_and_name",
              "type": "dynamic"
            },
            {
              "name": "action_external_hostname",
              "type": "string"
            },
            {
              "name": "action_remote_ip",
              "type": "dynamic"
            },
            {
              "name": "action_remote_port",
              "type": "dynamic"
            },
            {
              "name": "matching_service_rule_id",
              "type": "string"
            },
            {
              "name": "starred",
              "type": "boolean"
            },
            {
              "name": "external_id",
              "type": "string"
            },
            {
              "name": "severity",
              "type": "string"
            },
            {
              "name": "matching_status",
              "type": "string"
            },
            {
              "name": "end_match_attempt_ts",
              "type": "long"
            },
            {
              "name": "local_insert_ts",
              "type": "long"
            },
            {
              "name": "last_modified_ts",
              "type": "long"
            },
            {
              "name": "case_id",
              "type": "int"
            },
            {
              "name": "deduplicate_tokens",
              "type": "string"
            },
            {
              "name": "filter_rule_id",
              "type": "string"
            },
            {
              "name": "event_id",
              "type": "string"
            },
            {
              "name": "event_timestamp",
              "type": "dynamic"
            },
            {
              "name": "action_local_ip_v6",
              "type": "string"
            },
            {
              "name": "action_remote_ip_v6",
              "type": "dynamic"
            },
            {
              "name": "alert_type",
              "type": "string"
            },
            {
              "name": "resolution_status",
              "type": "string"
            },
            {
              "name": "resolution_comment",
              "type": "string"
            },
            {
              "name": "dynamic_fields",
              "type": "dynamic"
            },
            {
              "name": "tags",
              "type": "dynamic"
            },
            {
              "name": "xpanse_first_observed",
              "type": "long"
            },
            {
              "name": "malicious_urls",
              "type": "dynamic"
            },
            {
              "name": "asm_alert_categories",
              "type": "dynamic"
            },
            {
              "name": "last_observed",
              "type": "long"
            },
            {
              "name": "country_codes",
              "type": "dynamic"
            },
            {
              "name": "cloud_providers",
              "type": "dynamic"
            },
            {
              "name": "ipv4_addresses",
              "type": "dynamic"
            },
            {
              "name": "ipv6_addresses",
              "type": "dynamic"
            },
            {
              "name": "domain_names",
              "type": "dynamic"
            },
            {
              "name": "service_ids",
              "type": "dynamic"
            },
            {
              "name": "website_ids",
              "type": "dynamic"
            },
            {
              "name": "asset_ids",
              "type": "dynamic"
            },
            {
              "name": "certificate",
              "type": "dynamic"
            },
            {
              "name": "port_protocol",
              "type": "string"
            },
            {
              "name": "port_number",
              "type": "int"
            },
            {
              "name": "cloud_management_status",
              "type": "string"
            },
            {
              "name": "business_unit_hierarchies",
              "type": "dynamic"
            },
            {
              "name": "attack_surface_rule_name",
              "type": "string"
            },
            {
              "name": "remediation_guidance",
              "type": "string"
            },
            {
              "name": "attack_surface_rule_id",
              "type": "string"
            },
            {
              "name": "asset_identifiers",
              "type": "dynamic"
            },
            {
              "name": "integration_source",
              "type": "string"
            },
            {
              "name": "certificate_subject_organization",
              "type": "string"
            },
            {
              "name": "externally_detected_version",
              "type": "string"
            },
            {
              "name": "alert_id",
              "type": "string"
            },
            {
              "name": "detection_timestamp",
              "type": "long"
            },
            {
              "name": "name",
              "type": "string"
            },
            {
              "name": "endpoint_id",
              "type": "string"
            },
            {
              "name": "description",
              "type": "string"
            },
            {
              "name": "host_ip",
              "type": "string"
            },
            {
              "name": "host_name",
              "type": "string"
            },
            {
              "name": "action",
              "type": "string"
            },
            {
              "name": "source",
              "type": "string"
            },
            {
              "name": "user_name",
              "type": "string"
            },
            {
              "name": "mac_addresses",
              "type": "dynamic"
            },
            {
              "name": "action_pretty",
              "type": "string"
            },
            {
              "name": "events",
              "type": "string"
            },
            {
              "name": "aws_cloud_tags",
              "type": "dynamic"
            },
            {
              "name": "azure_cloud_tags",
              "type": "dynamic"
            },
            {
              "name": "gcp_cloud_tags",
              "type": "dynamic"
            }
          ]
        }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "{{workspaceResourceId}}",
          "name": "clv2ws1"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-CortexXpanseStreamAlerts"
        ],
        "destinations": [
          "clv2ws1"
        ],
        "transformKql": "source | project TimeGenerated = datetime(1970-01-01) + (detection_timestamp * 1ms), Category = category, ProjectName = ['project'], CloudProvider = cloud_provider, ResourceSubType = resource_sub_type, ResourceType = resource_type, ActionCountry = action_country, EventType = event_type, IsWhitelisted = is_whitelisted, ImageName = image_name, ActionLocalIp = action_local_ip, ActionLocalPort = action_local_port, MitreTacticIdAndName = mitre_tactic_id_and_name, MitreTechniqueIdAndName = mitre_technique_id_and_name, ActionExternalHostname = action_external_hostname, ActionRemoteIp = action_remote_ip, ActionRemotePort = action_remote_port, MatchingServiceRuleId = matching_service_rule_id, Starred = starred, ExternalId = external_id, Severity = severity, MatchingStatus = matching_status, EndMatchAttemptTs = datetime(1970-01-01) + (end_match_attempt_ts * 1ms), LocalInsertTs = datetime(1970-01-01) + (local_insert_ts * 1ms), LastModifiedTs = datetime(1970-01-01) + (last_modified_ts * 1ms), CaseId = case_id, DeduplicateTokens = deduplicate_tokens, FilterRuleId = filter_rule_id, EventId = event_id, EventTimestamp = event_timestamp, ActionLocalIpV6 = action_local_ip_v6, ActionRemoteIpV6 = action_remote_ip_v6, AlertType = alert_type, ResolutionStatus = resolution_status, ResolutionComment = resolution_comment, DynamicFields = dynamic_fields, Tags = tags, XpanseFirstObserved = datetime(1970-01-01) + (xpanse_first_observed * 1ms), MaliciousUrls = malicious_urls, AsmAlertCategories = asm_alert_categories, LastObserved = datetime(1970-01-01) + (last_observed * 1ms), CountryCodes = country_codes, CloudProviders = cloud_providers, Ipv4Addresses = ipv4_addresses, Ipv6Addresses = ipv6_addresses, DomainNames = domain_names, ServiceIds = service_ids, WebsiteIds = website_ids, AssetIds = asset_ids, Certificate = certificate, PortProtocol = port_protocol, PortNumber = port_number, CloudManagementStatus = cloud_management_status, BusinessUnitHierarchies = business_unit_hierarchies, AttackSurfaceRuleName = attack_surface_rule_name, RemediationGuidance = remediation_guidance, AttackSurfaceRuleId = attack_surface_rule_id, AssetIdentifiers = asset_identifiers, IntegrationSource = integration_source, CertificateSubjectOrganization = certificate_subject_organization, ExternallyDetectedVersion = externally_detected_version, AlertId = alert_id, Name = name, EndpointId = endpoint_id, Description = description, HostIp = host_ip, HostName = host_name, Action = action, Source = source, UserName = user_name, MacAddresses = mac_addresses, ActionPretty = action_pretty, Events = events, AwsCloudTags = aws_cloud_tags, AzureCloudTags = azure_cloud_tags, GcpCloudTags = gcp_cloud_tags",
        "outputStream": "Custom-CortexXpanseAlerts_CL"
      }
    ]
  }
}

