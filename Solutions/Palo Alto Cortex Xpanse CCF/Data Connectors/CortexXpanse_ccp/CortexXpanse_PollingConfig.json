[
  {
    "type": "Microsoft.SecurityInsights/dataConnectors",
    "apiVersion": "2023-02-01",
    "name": "PaloAltoXpanseAlertsPolling",
    "location": "{{location}}",
    "kind": "RestApiPoller",
    "properties": {
      "connectorDefinitionName": "PaloAltoExpanseCCPDefinition",
      "dataType": "CortexXpanseAlerts_CL",
      "addOnAttributes": {
        "DomainName": "{{domainName}}"
      },
      "auth": {
        "type": "APIKey",
        "ApiKey": "{{apiKey}}",
        "ApiKeyName": "Authorization"
      },
      "request": {
        "apiEndpoint": "https://api-{{domainName}}/public_api/v2/alerts/get_alerts_multi_events",
        "headers": {
          "Accept": "application/json",
          "Content-Type": "application/json",
          "Authorization": "{{apiKey}}",
          "x-xdr-auth-id": "{{xpanseAuthId}}"
        },
        "httpMethod": "Post",
        "queryParametersTemplate": "{ 'request_data': { 'use_page_token': true, 'filters': [ { 'field': 'creation_time', 'operator': 'gte', 'value': {_QueryWindowStartTime} }, { 'field': 'creation_time', 'operator': 'lte', 'value': {_QueryWindowEndTime} } ], 'sort': { 'field': 'creation_time', 'keyword': 'desc' } } }",
        "queryTimeFormat": "UnixTimestampInMills",
        "queryWindowInMin": 10
      },
      "response": {
        "eventsJsonPaths": [
          "$.reply.alerts"
        ]
      },
      "dcrConfig": {
        "streamName": "Custom-CortexXpanseStreamAlerts",
        "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
        "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}"
      },    
      "paging": {
        "pagingType": "NextPageToken",
        "NextPageTokenJsonPath": "$.reply.next_page_token",
        "NextPageParaName": "$.request_data.next_page_token"
      }
    }
  }
]