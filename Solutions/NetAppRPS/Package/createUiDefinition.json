{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<svg width=\"112\" height=\"20\" viewBox=\"0 0 112 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" id=\"logo\" style=\"margin-bottom: 60px;\"><g clip-path=\"url(#clip0_574_17087)\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M108.136 11.0524V11.0132C108.136 9.14993 106.718 7.91269 105.042 7.91269C103.365 7.91269 101.972 9.14869 101.972 11.0132V11.0542C101.972 12.9175 103.368 14.1597 105.042 14.1597C106.715 14.1597 108.136 12.9387 108.136 11.0524ZM98.4301 5.41586H102.021V7.03073C102.459 6.45657 103.049 5.98961 103.737 5.67176C104.425 5.35391 105.19 5.19512 105.963 5.20965C108.916 5.20965 111.724 7.26302 111.724 11.0132V11.0542C111.724 14.8057 108.962 16.859 105.963 16.859C105.207 16.8741 104.457 16.7304 103.773 16.4394C103.089 16.1484 102.489 15.7179 102.021 15.1821V20.0006H98.4301V5.41586Z\" fill=\"black\"></path><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M27.1606 1.87695H30.517L38.2617 11.0121V1.87695H41.8475V16.6499H38.7548L30.7526 7.32278V16.6499H27.1606V1.87695Z\" fill=\"black\"></path><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M52.5221 10.1524C52.3107 8.72385 51.3656 7.76238 49.8558 7.76238C48.366 7.76238 47.3969 8.70956 47.1145 10.1524H52.5221ZM43.5962 11.0958V11.053C43.5644 10.2945 43.703 9.53815 44.0035 8.82921C44.3041 8.12027 44.7604 7.47342 45.3451 6.92748C45.9298 6.38155 46.6308 5.9478 47.4061 5.65228C48.1814 5.35677 49.0149 5.20557 49.8565 5.20779C54.0822 5.20779 56.0177 8.12013 56.0177 11.3058C56.0177 11.5542 55.9964 11.8511 55.9702 12.1436H47.1613C47.281 12.7921 47.6646 13.3769 48.237 13.784C48.8094 14.191 49.5295 14.391 50.2567 14.3448C50.8287 14.3523 51.3963 14.2538 51.9244 14.0554C52.4525 13.857 52.9297 13.5629 53.3266 13.1914L55.3792 14.8063C54.7561 15.4916 53.9654 16.0374 53.0691 16.401C52.1728 16.7646 51.1954 16.936 50.2133 16.9019C46.4064 16.8994 43.5962 14.5324 43.5962 11.0958V11.0958Z\" fill=\"black\"></path><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M58.2596 8.14001H56.7484V5.41648H58.2596V2.54761H61.8468V5.41648H64.8251V8.14001H61.8468V12.9393C61.8468 13.6728 62.2028 14.0299 63.0046 14.0299C63.6233 14.0328 64.2329 13.8951 64.7769 13.6293V16.187C63.9162 16.6371 62.9336 16.8622 61.939 16.8373C59.7453 16.8373 58.2589 16.0609 58.2589 13.4622L58.2596 8.14001Z\" fill=\"black\"></path><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M93.3768 11.0524V11.0133C93.3768 9.14997 91.9593 7.91273 90.2848 7.91273C88.6104 7.91273 87.2163 9.14873 87.2163 11.0133V11.0543C87.2163 12.9176 88.609 14.1598 90.2848 14.1598C91.9607 14.1598 93.3768 12.9387 93.3768 11.0524ZM83.6739 5.4159H87.2631V7.03077C87.7016 6.45636 88.2915 5.98922 88.9798 5.67135C89.6682 5.35348 90.4333 5.19484 91.2064 5.2097C94.1592 5.2097 96.9674 7.26306 96.9674 11.0133V11.0543C96.9674 14.8057 94.2054 16.8591 91.2064 16.8591C90.45 16.874 89.7001 16.7303 89.0158 16.4392C88.3315 16.1482 87.7315 15.7179 87.2631 15.1821V20.0006H83.6739V5.4159Z\" fill=\"black\"></path><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M76.387 10.5108L74.1912 5.75254L71.9939 10.5133L76.387 10.5108ZM72.6028 1.875H75.8704L82.7775 16.6492H78.9892L77.467 13.3573H70.9133L69.4014 16.6492H65.6957L72.6028 1.875Z\" fill=\"black\"></path><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M0 16.877H7.5095V7.87695H11.8008V16.877H19.3103V1.87695H0V16.877Z\" fill=\"black\"></path></g><defs><clipPath id=\"clip0_574_17087\"><rect width=\"111.724\" height=\"20\" fill=\"white\"></rect></clipPath></defs></svg>\n\n**Note:** Please refer to the following before installing the solution: \n\n• Review the solution [Release Notes](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/NetAppRPS/ReleaseNotes.md)\n\n • There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing.\n\nNetApp RPS (Ransomware Protection Service) - Comprehensive security solution for detecting and responding to ransomware threats across NetApp storage environments.\n\n**Data Connectors:** 1, **Analytic Rules:** 2, **Playbooks:** 6\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "bladeTitle": "Data Connectors",
        "elements": [
          {
            "name": "dataconnectors1-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Solution installs the data connector for NetAppRPS. You can get NetAppRPS custom log data in your Microsoft Sentinel workspace. After installing the solution, configure and enable this data connector by following guidance in Manage solution view."
            }
          },
          {
            "name": "dataconnectors-link1",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about connecting data sources",
                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
              }
            }
          }
        ]
      },
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following analytic rule templates. After installing the solution, create and enable analytic rules in Manage solution view."
            }
          },
          {
            "name": "analytics-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "NetApp RPS High Severity Alert",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects high severity NetApp RPS alerts that require immediate attention. This rule monitors the rps_alerts_CL table for alerts with HIGH severity level."
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "NetApp RPS Medium Severity Alert",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects medium severity NetApp RPS alerts that may require investigation. This rule monitors the rps_alerts_CL table for alerts with MEDIUM severity level."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "playbooks",
        "label": "Playbooks",
        "subLabel": {
          "preValidation": "Configure the playbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Playbooks",
        "elements": [
          {
            "name": "playbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the Playbook templates to help implement your Security Orchestration, Automation and Response (SOAR) operations. After installing the solution, these will be deployed under Playbook Templates in the Automation blade in Microsoft Sentinel. They can be configured and managed from the Manage solution view in Content Hub."
            }
          },
          {
            "name": "playbooks-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]"
    }
  }
}
