{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft",
    "comments": "Solution template for Cyfirma Cyber Intelligence"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "_solutionName": "Cyfirma Cyber Intelligence",
    "_solutionVersion": "3.0.1",
    "solutionId": "cyfirmaholdingspteltd1742879329545.azure-sentinel-solution-cyfirma-cyber-intelligence",
    "_solutionId": "[variables('solutionId')]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "6b61b716-afd9-4f6c-ad00-965d5987cafd",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6b61b716-afd9-4f6c-ad00-965d5987cafd')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6b61b716-afd9-4f6c-ad00-965d5987cafd')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6b61b716-afd9-4f6c-ad00-965d5987cafd','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "b278be0f-0662-47b4-9ab5-71a0f1435c3f",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b278be0f-0662-47b4-9ab5-71a0f1435c3f')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b278be0f-0662-47b4-9ab5-71a0f1435c3f')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b278be0f-0662-47b4-9ab5-71a0f1435c3f','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "6d8fb3fe-2501-4103-8137-34261fa3a596",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6d8fb3fe-2501-4103-8137-34261fa3a596')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6d8fb3fe-2501-4103-8137-34261fa3a596')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6d8fb3fe-2501-4103-8137-34261fa3a596','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "75931755-27cd-4e4b-a51c-efcca452e2ff",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '75931755-27cd-4e4b-a51c-efcca452e2ff')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('75931755-27cd-4e4b-a51c-efcca452e2ff')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','75931755-27cd-4e4b-a51c-efcca452e2ff','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "990fc0dc-e7a5-4f6d-bc24-8569652cd773",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '990fc0dc-e7a5-4f6d-bc24-8569652cd773')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('990fc0dc-e7a5-4f6d-bc24-8569652cd773')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','990fc0dc-e7a5-4f6d-bc24-8569652cd773','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "24dcff02-123c-4e10-a531-2a22a609120a",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '24dcff02-123c-4e10-a531-2a22a609120a')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('24dcff02-123c-4e10-a531-2a22a609120a')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','24dcff02-123c-4e10-a531-2a22a609120a','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.0",
      "_analyticRulecontentId7": "c919c911-8b01-44f8-9c3b-60b1edfc417f",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c919c911-8b01-44f8-9c3b-60b1edfc417f')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c919c911-8b01-44f8-9c3b-60b1edfc417f')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c919c911-8b01-44f8-9c3b-60b1edfc417f','-', '1.0.0')))]"
    },
    "analyticRuleObject8": {
      "analyticRuleVersion8": "1.0.0",
      "_analyticRulecontentId8": "ca16daff-28dd-499d-93fe-0bb232d76d4f",
      "analyticRuleId8": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ca16daff-28dd-499d-93fe-0bb232d76d4f')]",
      "analyticRuleTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ca16daff-28dd-499d-93fe-0bb232d76d4f')))]",
      "_analyticRulecontentProductId8": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ca16daff-28dd-499d-93fe-0bb232d76d4f','-', '1.0.0')))]"
    },
    "analyticRuleObject9": {
      "analyticRuleVersion9": "1.0.0",
      "_analyticRulecontentId9": "c7b0b6da-e9dc-405d-ad71-37661f56d40a",
      "analyticRuleId9": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c7b0b6da-e9dc-405d-ad71-37661f56d40a')]",
      "analyticRuleTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c7b0b6da-e9dc-405d-ad71-37661f56d40a')))]",
      "_analyticRulecontentProductId9": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c7b0b6da-e9dc-405d-ad71-37661f56d40a','-', '1.0.0')))]"
    },
    "analyticRuleObject10": {
      "analyticRuleVersion10": "1.0.0",
      "_analyticRulecontentId10": "ee2325cc-f5ba-49ac-b4d9-58ef0766e168",
      "analyticRuleId10": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ee2325cc-f5ba-49ac-b4d9-58ef0766e168')]",
      "analyticRuleTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ee2325cc-f5ba-49ac-b4d9-58ef0766e168')))]",
      "_analyticRulecontentProductId10": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ee2325cc-f5ba-49ac-b4d9-58ef0766e168','-', '1.0.0')))]"
    },
    "analyticRuleObject11": {
      "analyticRuleVersion11": "1.0.0",
      "_analyticRulecontentId11": "c7c02bbf-b775-4e85-a3c7-7f8a9318fd2f",
      "analyticRuleId11": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c7c02bbf-b775-4e85-a3c7-7f8a9318fd2f')]",
      "analyticRuleTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c7c02bbf-b775-4e85-a3c7-7f8a9318fd2f')))]",
      "_analyticRulecontentProductId11": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c7c02bbf-b775-4e85-a3c7-7f8a9318fd2f','-', '1.0.0')))]"
    },
    "analyticRuleObject12": {
      "analyticRuleVersion12": "1.0.0",
      "_analyticRulecontentId12": "77226d6e-1263-42b1-a40d-8a756407ad4c",
      "analyticRuleId12": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '77226d6e-1263-42b1-a40d-8a756407ad4c')]",
      "analyticRuleTemplateSpecName12": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('77226d6e-1263-42b1-a40d-8a756407ad4c')))]",
      "_analyticRulecontentProductId12": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','77226d6e-1263-42b1-a40d-8a756407ad4c','-', '1.0.0')))]"
    },
    "analyticRuleObject13": {
      "analyticRuleVersion13": "1.0.0",
      "_analyticRulecontentId13": "58ae2c87-fc07-434b-aacf-f66d25b25e7e",
      "analyticRuleId13": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '58ae2c87-fc07-434b-aacf-f66d25b25e7e')]",
      "analyticRuleTemplateSpecName13": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('58ae2c87-fc07-434b-aacf-f66d25b25e7e')))]",
      "_analyticRulecontentProductId13": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','58ae2c87-fc07-434b-aacf-f66d25b25e7e','-', '1.0.0')))]"
    },
    "analyticRuleObject14": {
      "analyticRuleVersion14": "1.0.0",
      "_analyticRulecontentId14": "4e7d1851-5aab-478d-b348-4b83dc2b03d9",
      "analyticRuleId14": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4e7d1851-5aab-478d-b348-4b83dc2b03d9')]",
      "analyticRuleTemplateSpecName14": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4e7d1851-5aab-478d-b348-4b83dc2b03d9')))]",
      "_analyticRulecontentProductId14": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4e7d1851-5aab-478d-b348-4b83dc2b03d9','-', '1.0.0')))]"
    },
    "analyticRuleObject15": {
      "analyticRuleVersion15": "1.0.0",
      "_analyticRulecontentId15": "8317de44-09e4-4a04-8fae-c38c1b72064b",
      "analyticRuleId15": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '8317de44-09e4-4a04-8fae-c38c1b72064b')]",
      "analyticRuleTemplateSpecName15": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('8317de44-09e4-4a04-8fae-c38c1b72064b')))]",
      "_analyticRulecontentProductId15": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','8317de44-09e4-4a04-8fae-c38c1b72064b','-', '1.0.0')))]"
    },
    "analyticRuleObject16": {
      "analyticRuleVersion16": "1.0.0",
      "_analyticRulecontentId16": "52c2f8d4-1dc8-4141-9152-614c036390a0",
      "analyticRuleId16": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '52c2f8d4-1dc8-4141-9152-614c036390a0')]",
      "analyticRuleTemplateSpecName16": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('52c2f8d4-1dc8-4141-9152-614c036390a0')))]",
      "_analyticRulecontentProductId16": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','52c2f8d4-1dc8-4141-9152-614c036390a0','-', '1.0.0')))]"
    },
    "analyticRuleObject17": {
      "analyticRuleVersion17": "1.0.0",
      "_analyticRulecontentId17": "6f053867-dbd8-4755-924d-577e3db7f5a6",
      "analyticRuleId17": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6f053867-dbd8-4755-924d-577e3db7f5a6')]",
      "analyticRuleTemplateSpecName17": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6f053867-dbd8-4755-924d-577e3db7f5a6')))]",
      "_analyticRulecontentProductId17": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6f053867-dbd8-4755-924d-577e3db7f5a6','-', '1.0.0')))]"
    },
    "analyticRuleObject18": {
      "analyticRuleVersion18": "1.0.0",
      "_analyticRulecontentId18": "5468e012-6681-44fb-be2d-b1cd58b62ac7",
      "analyticRuleId18": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5468e012-6681-44fb-be2d-b1cd58b62ac7')]",
      "analyticRuleTemplateSpecName18": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5468e012-6681-44fb-be2d-b1cd58b62ac7')))]",
      "_analyticRulecontentProductId18": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','5468e012-6681-44fb-be2d-b1cd58b62ac7','-', '1.0.0')))]"
    },
    "analyticRuleObject19": {
      "analyticRuleVersion19": "1.0.0",
      "_analyticRulecontentId19": "359e2afb-b6d4-45db-90aa-c89ce7234d72",
      "analyticRuleId19": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '359e2afb-b6d4-45db-90aa-c89ce7234d72')]",
      "analyticRuleTemplateSpecName19": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('359e2afb-b6d4-45db-90aa-c89ce7234d72')))]",
      "_analyticRulecontentProductId19": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','359e2afb-b6d4-45db-90aa-c89ce7234d72','-', '1.0.0')))]"
    },
    "analyticRuleObject20": {
      "analyticRuleVersion20": "1.0.0",
      "_analyticRulecontentId20": "1b9603dd-4787-403e-8a35-387c554bd15b",
      "analyticRuleId20": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '1b9603dd-4787-403e-8a35-387c554bd15b')]",
      "analyticRuleTemplateSpecName20": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('1b9603dd-4787-403e-8a35-387c554bd15b')))]",
      "_analyticRulecontentProductId20": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','1b9603dd-4787-403e-8a35-387c554bd15b','-', '1.0.0')))]"
    },
    "analyticRuleObject21": {
      "analyticRuleVersion21": "1.0.0",
      "_analyticRulecontentId21": "fa53ac37-a646-4106-91b6-ce478a1b5323",
      "analyticRuleId21": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'fa53ac37-a646-4106-91b6-ce478a1b5323')]",
      "analyticRuleTemplateSpecName21": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('fa53ac37-a646-4106-91b6-ce478a1b5323')))]",
      "_analyticRulecontentProductId21": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','fa53ac37-a646-4106-91b6-ce478a1b5323','-', '1.0.0')))]"
    },
    "analyticRuleObject22": {
      "analyticRuleVersion22": "1.0.0",
      "_analyticRulecontentId22": "aba36dc3-af43-4ab6-9349-3d1e37f1d4f3",
      "analyticRuleId22": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'aba36dc3-af43-4ab6-9349-3d1e37f1d4f3')]",
      "analyticRuleTemplateSpecName22": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('aba36dc3-af43-4ab6-9349-3d1e37f1d4f3')))]",
      "_analyticRulecontentProductId22": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','aba36dc3-af43-4ab6-9349-3d1e37f1d4f3','-', '1.0.0')))]"
    },
    "analyticRuleObject23": {
      "analyticRuleVersion23": "1.0.0",
      "_analyticRulecontentId23": "6f107cf8-02f9-4440-b5d8-1235293e5ad7",
      "analyticRuleId23": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6f107cf8-02f9-4440-b5d8-1235293e5ad7')]",
      "analyticRuleTemplateSpecName23": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6f107cf8-02f9-4440-b5d8-1235293e5ad7')))]",
      "_analyticRulecontentProductId23": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6f107cf8-02f9-4440-b5d8-1235293e5ad7','-', '1.0.0')))]"
    },
    "analyticRuleObject24": {
      "analyticRuleVersion24": "1.0.0",
      "_analyticRulecontentId24": "e41b7640-9ba6-42d6-a4c9-1ab6932a0b14",
      "analyticRuleId24": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'e41b7640-9ba6-42d6-a4c9-1ab6932a0b14')]",
      "analyticRuleTemplateSpecName24": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('e41b7640-9ba6-42d6-a4c9-1ab6932a0b14')))]",
      "_analyticRulecontentProductId24": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','e41b7640-9ba6-42d6-a4c9-1ab6932a0b14','-', '1.0.0')))]"
    },
    "analyticRuleObject25": {
      "analyticRuleVersion25": "1.0.0",
      "_analyticRulecontentId25": "7cb829b2-915a-42c2-adb9-725e9ce9bf43",
      "analyticRuleId25": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7cb829b2-915a-42c2-adb9-725e9ce9bf43')]",
      "analyticRuleTemplateSpecName25": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7cb829b2-915a-42c2-adb9-725e9ce9bf43')))]",
      "_analyticRulecontentProductId25": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7cb829b2-915a-42c2-adb9-725e9ce9bf43','-', '1.0.0')))]"
    },
    "analyticRuleObject26": {
      "analyticRuleVersion26": "1.0.0",
      "_analyticRulecontentId26": "cd06dae8-7b79-436b-b1a6-9d256830f9dd",
      "analyticRuleId26": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'cd06dae8-7b79-436b-b1a6-9d256830f9dd')]",
      "analyticRuleTemplateSpecName26": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('cd06dae8-7b79-436b-b1a6-9d256830f9dd')))]",
      "_analyticRulecontentProductId26": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','cd06dae8-7b79-436b-b1a6-9d256830f9dd','-', '1.0.0')))]"
    },
    "analyticRuleObject27": {
      "analyticRuleVersion27": "1.0.0",
      "_analyticRulecontentId27": "952b7d77-a848-4888-a638-62fe877eb55d",
      "analyticRuleId27": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '952b7d77-a848-4888-a638-62fe877eb55d')]",
      "analyticRuleTemplateSpecName27": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('952b7d77-a848-4888-a638-62fe877eb55d')))]",
      "_analyticRulecontentProductId27": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','952b7d77-a848-4888-a638-62fe877eb55d','-', '1.0.0')))]"
    },
    "analyticRuleObject28": {
      "analyticRuleVersion28": "1.0.0",
      "_analyticRulecontentId28": "5347c581-eb36-4bf5-a7e5-be1fb2d617f5",
      "analyticRuleId28": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '5347c581-eb36-4bf5-a7e5-be1fb2d617f5')]",
      "analyticRuleTemplateSpecName28": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('5347c581-eb36-4bf5-a7e5-be1fb2d617f5')))]",
      "_analyticRulecontentProductId28": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','5347c581-eb36-4bf5-a7e5-be1fb2d617f5','-', '1.0.0')))]"
    },
    "analyticRuleObject29": {
      "analyticRuleVersion29": "1.0.0",
      "_analyticRulecontentId29": "441204ca-274f-43d2-aeda-53409b94f447",
      "analyticRuleId29": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '441204ca-274f-43d2-aeda-53409b94f447')]",
      "analyticRuleTemplateSpecName29": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('441204ca-274f-43d2-aeda-53409b94f447')))]",
      "_analyticRulecontentProductId29": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','441204ca-274f-43d2-aeda-53409b94f447','-', '1.0.0')))]"
    },
    "analyticRuleObject30": {
      "analyticRuleVersion30": "1.0.0",
      "_analyticRulecontentId30": "baa63d52-285d-43bf-a34e-8ed2fa260f9e",
      "analyticRuleId30": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'baa63d52-285d-43bf-a34e-8ed2fa260f9e')]",
      "analyticRuleTemplateSpecName30": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('baa63d52-285d-43bf-a34e-8ed2fa260f9e')))]",
      "_analyticRulecontentProductId30": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','baa63d52-285d-43bf-a34e-8ed2fa260f9e','-', '1.0.0')))]"
    },
    "analyticRuleObject31": {
      "analyticRuleVersion31": "1.0.0",
      "_analyticRulecontentId31": "649f525a-1f92-412d-bfc2-ce642e7a7f1f",
      "analyticRuleId31": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '649f525a-1f92-412d-bfc2-ce642e7a7f1f')]",
      "analyticRuleTemplateSpecName31": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('649f525a-1f92-412d-bfc2-ce642e7a7f1f')))]",
      "_analyticRulecontentProductId31": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','649f525a-1f92-412d-bfc2-ce642e7a7f1f','-', '1.0.0')))]"
    },
    "analyticRuleObject32": {
      "analyticRuleVersion32": "1.0.0",
      "_analyticRulecontentId32": "25686f44-5f5f-4388-95e2-eea244481438",
      "analyticRuleId32": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '25686f44-5f5f-4388-95e2-eea244481438')]",
      "analyticRuleTemplateSpecName32": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('25686f44-5f5f-4388-95e2-eea244481438')))]",
      "_analyticRulecontentProductId32": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','25686f44-5f5f-4388-95e2-eea244481438','-', '1.0.0')))]"
    },
    "analyticRuleObject33": {
      "analyticRuleVersion33": "1.0.0",
      "_analyticRulecontentId33": "4afd8960-8bee-4cac-bb5e-a4f200b1f9f3",
      "analyticRuleId33": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4afd8960-8bee-4cac-bb5e-a4f200b1f9f3')]",
      "analyticRuleTemplateSpecName33": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4afd8960-8bee-4cac-bb5e-a4f200b1f9f3')))]",
      "_analyticRulecontentProductId33": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4afd8960-8bee-4cac-bb5e-a4f200b1f9f3','-', '1.0.0')))]"
    },
    "analyticRuleObject34": {
      "analyticRuleVersion34": "1.0.0",
      "_analyticRulecontentId34": "b89c893e-650f-4569-afc3-c487efee2472",
      "analyticRuleId34": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'b89c893e-650f-4569-afc3-c487efee2472')]",
      "analyticRuleTemplateSpecName34": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('b89c893e-650f-4569-afc3-c487efee2472')))]",
      "_analyticRulecontentProductId34": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','b89c893e-650f-4569-afc3-c487efee2472','-', '1.0.0')))]"
    },
    "analyticRuleObject35": {
      "analyticRuleVersion35": "1.0.0",
      "_analyticRulecontentId35": "89fd02b8-3c21-492c-a8de-b3e728d39119",
      "analyticRuleId35": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '89fd02b8-3c21-492c-a8de-b3e728d39119')]",
      "analyticRuleTemplateSpecName35": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('89fd02b8-3c21-492c-a8de-b3e728d39119')))]",
      "_analyticRulecontentProductId35": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','89fd02b8-3c21-492c-a8de-b3e728d39119','-', '1.0.0')))]"
    },
    "analyticRuleObject36": {
      "analyticRuleVersion36": "1.0.0",
      "_analyticRulecontentId36": "104f4574-fc95-4f38-8aa2-02f0b78eba9b",
      "analyticRuleId36": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '104f4574-fc95-4f38-8aa2-02f0b78eba9b')]",
      "analyticRuleTemplateSpecName36": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('104f4574-fc95-4f38-8aa2-02f0b78eba9b')))]",
      "_analyticRulecontentProductId36": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','104f4574-fc95-4f38-8aa2-02f0b78eba9b','-', '1.0.0')))]"
    },
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "CyfirmaCyberIntelligenceDC",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "CyfirmaCyberIntelligenceDCConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "C2NetworkIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - High severity Command & Control Network Indicators with Block Recommendation Rule",
                "enabled": false,
                "query": "// Network Indicators query with Block Recommended Action and C2 Roles\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and (Roles contains 'c2' or Roles contains 'Command & Control')\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "InitialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1071.001",
                  "T1573.001",
                  "T1568.002",
                  "T1566.002"
                ],
                "techniques": [
                  "T1071",
                  "T1090",
                  "T1573",
                  "T1105",
                  "T1568",
                  "T1566",
                  "T1041",
                  "T1071",
                  "T1573",
                  "T1568",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Command & Control Network Indicators with Block Recommendation Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Command & Control Network Indicators with Block Recommendation Rule",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "C2NetworkIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - Medium severity Command & Control Network Indicators with Block Recommendation Rule",
                "enabled": false,
                "query": "// Network Indicators query with Block Recommended Action and C2 Roles\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and (Roles contains 'c2' or Roles contains 'Command & Control')\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "InitialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1071.001",
                  "T1573.001",
                  "T1568.002",
                  "T1566.002"
                ],
                "techniques": [
                  "T1071",
                  "T1090",
                  "T1573",
                  "T1105",
                  "T1568",
                  "T1566",
                  "T1041",
                  "T1071",
                  "T1573",
                  "T1568",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Command & Control Network Indicators with Block Recommendation Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Command & Control Network Indicators with Block Recommendation Rule",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "C2NetworkIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - High severity Command & Control Network Indicators with Monitor Recommendation Rule",
                "enabled": false,
                "query": "// Network Indicators query with Monitor Recommended Action And C2 Roles\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and (Roles contains 'c2' or Roles contains 'Command & Control')\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "InitialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1071.001",
                  "T1573.001",
                  "T1568.002",
                  "T1566.002"
                ],
                "techniques": [
                  "T1071",
                  "T1090",
                  "T1573",
                  "T1105",
                  "T1568",
                  "T1566",
                  "T1041",
                  "T1071",
                  "T1573",
                  "T1568",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Command & Control Network Indicators with Monitor Recommendation Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Command & Control Network Indicators with Monitor Recommendation Rule",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "C2NetworkIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - Medium severity Command & Control Network Indicators with Monitor Recommendation Rule",
                "enabled": false,
                "query": "// Network Indicators query with Monitor Recommended Action And C2 Roles\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and (Roles contains 'c2' or Roles contains 'Command & Control')\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "InitialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1071.001",
                  "T1573.001",
                  "T1568.002",
                  "T1566.002"
                ],
                "techniques": [
                  "T1071",
                  "T1090",
                  "T1573",
                  "T1105",
                  "T1568",
                  "T1566",
                  "T1041",
                  "T1071",
                  "T1573",
                  "T1568",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Command & Control Network Indicators with Monitor Recommendation Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Command & Control Network Indicators with Monitor Recommendation Rule",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareFileHashIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query retrieves file hash indicators (MD5, SHA1, SHA256) from the CyfirmaIndicators_CL table within the last 5 minutes. \nIt filters records with a confidence score of 80 or higher, containing file hash patterns, a recommended action of 'Block', and roles marked as 'Malware'. \nExtracted hashes and key threat intelligence details are projected for Blocking and investigation.",
                "displayName": "CYFIRMA - High severity File Hash Indicators with Block Action and Malware",
                "enabled": false,
                "query": "// File Hash Indicators with Block Action and Malware\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Block' and (Roles contains \"Malware\")\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='md5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "PrivilegeEscalation",
                  "DefenseEvasion",
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1059.001",
                  "T1059.003",
                  "T1547.001",
                  "T1053.005",
                  "T1562.001",
                  "T1003.001",
                  "T1555.003",
                  "T1021.002"
                ],
                "techniques": [
                  "T1566",
                  "T1203",
                  "T1059",
                  "T1204",
                  "T1547",
                  "T1053",
                  "T1055",
                  "T1027",
                  "T1562",
                  "T1036",
                  "T1003",
                  "T1555",
                  "T1082",
                  "T1057",
                  "T1021",
                  "T1113",
                  "T1486",
                  "T1566",
                  "T1059",
                  "T1059",
                  "T1547",
                  "T1053",
                  "T1562",
                  "T1003",
                  "T1555",
                  "T1021"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "valid_from": "valid_from",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Block Action and Malware - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity File Hash Indicators with Block Action and Malware",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareFileHashIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query retrieves file hash indicators (MD5, SHA1, SHA256) from the CyfirmaIndicators_CL table within the last 5 minutes. \nIt filters records with a confidence score of 80 or higher, containing file hash patterns, a recommended action of 'Block', and roles marked as 'Malware'. \nExtracted hashes and key threat intelligence details are projected for Blocking and investigation.",
                "displayName": "CYFIRMA - Medium severity File Hash Indicators with Block Action and Malware",
                "enabled": false,
                "query": "// File Hash Indicators with Block Action and Malware\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Block' and (Roles contains \"Malware\")\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='md5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "PrivilegeEscalation",
                  "DefenseEvasion",
                  "CredentialAccess",
                  "Discovery",
                  "LateralMovement",
                  "Collection",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1059.001",
                  "T1059.003",
                  "T1547.001",
                  "T1053.005",
                  "T1562.001",
                  "T1003.001",
                  "T1555.003",
                  "T1021.002"
                ],
                "techniques": [
                  "T1566",
                  "T1203",
                  "T1059",
                  "T1204",
                  "T1547",
                  "T1053",
                  "T1055",
                  "T1027",
                  "T1562",
                  "T1036",
                  "T1003",
                  "T1555",
                  "T1082",
                  "T1057",
                  "T1021",
                  "T1113",
                  "T1486",
                  "T1566",
                  "T1059",
                  "T1059",
                  "T1547",
                  "T1053",
                  "T1562",
                  "T1003",
                  "T1555",
                  "T1021"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "valid_from": "valid_from",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Block Action and Malware - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity File Hash Indicators with Block Action and Malware",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareFileHashIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query retrieves file hash indicators (MD5, SHA1, SHA256) from the CyfirmaIndicators_CL table within the last 5 minutes. \nIt filters records with a confidence score of 80 or higher, containing file hash patterns, a recommended action of 'Monitor', and roles marked as 'Malware'. \nExtracted hashes and key threat intelligence details are projected for monitoring and investigation.",
                "displayName": "CYFIRMA - High severity File Hash Indicators with Monitor Action and Malware",
                "enabled": false,
                "query": "// File Hash Indicators with Monitor Action and Malware\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Monitor' and (Roles contains 'Malware')\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='md5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "InitialAccess",
                  "Impact",
                  "Execution"
                ],
                "subTechniques": [
                  "T1566.001"
                ],
                "techniques": [
                  "T1027",
                  "T1486",
                  "T1204",
                  "T1485",
                  "T1218",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "valid_from": "valid_from",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Monitor Action and Malware - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity File Hash Indicators with Monitor Action and Malware",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject8').analyticRuleTemplateSpecName8]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareFileHashIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject8').analyticRuleVersion8]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query retrieves file hash indicators (MD5, SHA1, SHA256) from the CyfirmaIndicators_CL table within the last 5 minutes. \nIt filters records with a confidence score of 80 or higher, containing file hash patterns, a recommended action of 'Monitor', and roles marked as 'Malware'. \nExtracted hashes and key threat intelligence details are projected for monitoring and investigation.",
                "displayName": "CYFIRMA - Medium severity File Hash Indicators with Monitor Action and Malware",
                "enabled": false,
                "query": "// File Hash Indicators with Monitor Action and Malware\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Monitor' and (Roles contains 'Malware')\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='md5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "InitialAccess",
                  "Impact",
                  "Execution"
                ],
                "subTechniques": [
                  "T1566.001"
                ],
                "techniques": [
                  "T1027",
                  "T1486",
                  "T1204",
                  "T1485",
                  "T1218",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "valid_from": "valid_from",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Monitor Action and Malware - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    },
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject8').analyticRuleId8,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 8",
                "parentId": "[variables('analyticRuleObject8').analyticRuleId8]",
                "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject8').analyticRuleVersion8]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity File Hash Indicators with Monitor Action and Malware",
        "contentProductId": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "id": "[variables('analyticRuleObject8')._analyticRulecontentProductId8]",
        "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject9').analyticRuleTemplateSpecName9]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareNetworkIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject9').analyticRuleVersion9]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - High severity Malicious Network Indicators Associated with Malware - Monitor Recommended Rule",
                "enabled": false,
                "query": "//Network Indicators Associated with Malware - Monitor Recommended Rule\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'Malware'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CommandAndControl"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1071.001",
                  "T1568.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1071",
                  "T1090",
                  "T1059",
                  "T1568",
                  "T1566",
                  "T1204",
                  "T1071",
                  "T1568"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators Associated with Malware - Monitor Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject9').analyticRuleId9,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 9",
                "parentId": "[variables('analyticRuleObject9').analyticRuleId9]",
                "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject9').analyticRuleVersion9]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Malicious Network Indicators Associated with Malware - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "id": "[variables('analyticRuleObject9')._analyticRulecontentProductId9]",
        "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject10').analyticRuleTemplateSpecName10]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareNetworkIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject10').analyticRuleVersion10]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - Medium severity Malicious Network Indicators Associated with Malware - Monitor Recommended Rule",
                "enabled": false,
                "query": "//Network Indicators Associated with Malware - Monitor Recommended Rule\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'Malware'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CommandAndControl"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1071.001",
                  "T1568.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1071",
                  "T1090",
                  "T1059",
                  "T1568",
                  "T1566",
                  "T1204",
                  "T1071",
                  "T1568"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators Associated with Malware - Monitor Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject10').analyticRuleId10,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 10",
                "parentId": "[variables('analyticRuleObject10').analyticRuleId10]",
                "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject10').analyticRuleVersion10]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Malicious Network Indicators Associated with Malware - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "id": "[variables('analyticRuleObject10')._analyticRulecontentProductId10]",
        "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject11').analyticRuleTemplateSpecName11]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareNetworkIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject11').analyticRuleVersion11]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - High severity Malicious Network Indicators Associated with Malware - Block Recommended Rule",
                "enabled": false,
                "query": "//Network Indicators Associated with Malware - Block Recommended Rule\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'Malware'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CommandAndControl"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1071.001",
                  "T1568.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1071",
                  "T1090",
                  "T1059",
                  "T1568",
                  "T1566",
                  "T1204",
                  "T1071",
                  "T1568"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators Associated with Malware - Block Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject11').analyticRuleId11,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 11",
                "parentId": "[variables('analyticRuleObject11').analyticRuleId11]",
                "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject11').analyticRuleVersion11]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Malicious Network Indicators Associated with Malware - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "id": "[variables('analyticRuleObject11')._analyticRulecontentProductId11]",
        "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject12').analyticRuleTemplateSpecName12]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "MalwareNetworkIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject12').analyticRuleVersion12]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators identified by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure.\nThese may represent attacker-controlled endpoints used to maintain persistence, exfiltrate data, or receive commands from malware-infected hosts.",
                "displayName": "CYFIRMA - Medium severity Malicious Network Indicators Associated with Malware - Block Recommended Rule",
                "enabled": false,
                "query": "//Network Indicators Associated with Malware - Block Recommended Rule\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'Malware'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CommandAndControl"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1071.001",
                  "T1568.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1071",
                  "T1090",
                  "T1059",
                  "T1568",
                  "T1566",
                  "T1204",
                  "T1071",
                  "T1568"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators Associated with Malware - Block Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject12').analyticRuleId12,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 12",
                "parentId": "[variables('analyticRuleObject12').analyticRuleId12]",
                "contentId": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject12').analyticRuleVersion12]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Malicious Network Indicators Associated with Malware - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject12')._analyticRulecontentProductId12]",
        "id": "[variables('analyticRuleObject12')._analyticRulecontentProductId12]",
        "version": "[variables('analyticRuleObject12').analyticRuleVersion12]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject13').analyticRuleTemplateSpecName13]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "NetworkIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject13').analyticRuleVersion13]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule detects network-based indicators such as IP addresses, domains, and URLs reported by CYFIRMA threat intelligence with a recommended action of 'Block' and no specified role. \nThese indicators may be associated with infrastructure used in phishing campaigns, malware, or initial access via watering hole or drive-by compromise techniques.",
                "displayName": "CYFIRMA - High severity Malicious Network Indicators with Block Action Rule",
                "enabled": false,
                "query": "// Network Indicators with Block Action Rule\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and (isempty(Roles) or not(Roles has_any ('Command & Control', 'Malware', 'TOR', 'Trojan', 'Phishing')))\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Reconnaissance",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1595.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1595",
                  "T1498",
                  "T1566",
                  "T1204",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators with Block Action Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject13').analyticRuleId13,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 13",
                "parentId": "[variables('analyticRuleObject13').analyticRuleId13]",
                "contentId": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject13').analyticRuleVersion13]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Malicious Network Indicators with Block Action Rule",
        "contentProductId": "[variables('analyticRuleObject13')._analyticRulecontentProductId13]",
        "id": "[variables('analyticRuleObject13')._analyticRulecontentProductId13]",
        "version": "[variables('analyticRuleObject13').analyticRuleVersion13]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject14').analyticRuleTemplateSpecName14]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "NetworkIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject14').analyticRuleVersion14]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule detects network-based indicators such as IP addresses, domains, and URLs reported by CYFIRMA threat intelligence with a recommended action of 'Block' and no specified role. \nThese indicators may be associated with infrastructure used in phishing campaigns, malware, or initial access via watering hole or drive-by compromise techniques.",
                "displayName": "CYFIRMA - Medium severity Malicious Network Indicators with Block Action Rule",
                "enabled": false,
                "query": "// Network Indicators with Block Action Rule\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and (isempty(Roles) or not(Roles has_any ('Command & Control', 'Malware', 'TOR', 'Trojan', 'Phishing')))\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Reconnaissance",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1595.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1595",
                  "T1498",
                  "T1566",
                  "T1204",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators with Block Action Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject14').analyticRuleId14,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 14",
                "parentId": "[variables('analyticRuleObject14').analyticRuleId14]",
                "contentId": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject14').analyticRuleVersion14]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Malicious Network Indicators with Block Action Rule",
        "contentProductId": "[variables('analyticRuleObject14')._analyticRulecontentProductId14]",
        "id": "[variables('analyticRuleObject14')._analyticRulecontentProductId14]",
        "version": "[variables('analyticRuleObject14').analyticRuleVersion14]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject15').analyticRuleTemplateSpecName15]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "NetworkIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject15').analyticRuleVersion15]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject15')._analyticRulecontentId15]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule detects high-confidence network-based indicators such as IP addresses, domains, and URLs reported by CYFIRMA threat intelligence with a recommended action of 'Monitor' and no specified role. \nThese indicators may be associated with infrastructure used in phishing campaigns, malware, or initial access via watering hole or drive-by compromise techniques.",
                "displayName": "CYFIRMA - High severity Malicious Network Indicators with Monitor Action Rule",
                "enabled": false,
                "query": "//Network Indicators with Monitor Action \nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and (isempty(Roles) or not(Roles has_any ('Command & Control', 'Malware', 'TOR', 'Trojan', 'Phishing')))\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Reconnaissance",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1595.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1595",
                  "T1498",
                  "T1566",
                  "T1204",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators with Monitor Action Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject15').analyticRuleId15,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 15",
                "parentId": "[variables('analyticRuleObject15').analyticRuleId15]",
                "contentId": "[variables('analyticRuleObject15')._analyticRulecontentId15]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject15').analyticRuleVersion15]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject15')._analyticRulecontentId15]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Malicious Network Indicators with Monitor Action Rule",
        "contentProductId": "[variables('analyticRuleObject15')._analyticRulecontentProductId15]",
        "id": "[variables('analyticRuleObject15')._analyticRulecontentProductId15]",
        "version": "[variables('analyticRuleObject15').analyticRuleVersion15]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject16').analyticRuleTemplateSpecName16]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "NetworkIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject16').analyticRuleVersion16]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject16')._analyticRulecontentId16]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This rule detects Network indicators such as IP addresses, domains, and URLs reported by CYFIRMA threat intelligence with a recommended action of 'Monitor' and no specified role. \nThese indicators may be associated with infrastructure used in phishing campaigns, malware, or initial access via watering hole or drive-by compromise techniques.",
                "displayName": "CYFIRMA - Medium severity Malicious Network Indicators with Monitor Action Rule",
                "enabled": false,
                "query": "//Network Indicators with Monitor Action \nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and (isempty(Roles) or not(Roles has_any ('Command & Control', 'Malware', 'TOR', 'Trojan', 'Phishing')))\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Reconnaissance",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.002",
                  "T1204.001",
                  "T1595.002"
                ],
                "techniques": [
                  "T1566",
                  "T1189",
                  "T1204",
                  "T1595",
                  "T1498",
                  "T1566",
                  "T1204",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Network Indicators with Monitor Action Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject16').analyticRuleId16,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 16",
                "parentId": "[variables('analyticRuleObject16').analyticRuleId16]",
                "contentId": "[variables('analyticRuleObject16')._analyticRulecontentId16]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject16').analyticRuleVersion16]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject16')._analyticRulecontentId16]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Malicious Network Indicators with Monitor Action Rule",
        "contentProductId": "[variables('analyticRuleObject16')._analyticRulecontentProductId16]",
        "id": "[variables('analyticRuleObject16')._analyticRulecontentProductId16]",
        "version": "[variables('analyticRuleObject16').analyticRuleVersion16]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject17').analyticRuleTemplateSpecName17]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PhishingNetworkIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject17').analyticRuleVersion17]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject17')._analyticRulecontentId17]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule identifies network-based indicators such as URLs, IP addresses, and domains related to phishing campaigns, as reported by CYFIRMA threat intelligence. \nThese indicators are flagged with a recommended action to block and are categorized under the 'Phishing' role.\nSuch infrastructure is often used to deliver phishing emails, host fake login portals, or redirect victims to credential-harvesting pages. \nBlocking these indicators proactively helps prevent user compromise and data theft.",
                "displayName": "CYFIRMA - High severity Malicious Phishing Network Indicators - Block Recommended Rule",
                "enabled": false,
                "query": "//Malicious Phishing Network Indicators - Block Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'Phishing'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CredentialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1566.002",
                  "T1204.001",
                  "T1556.002",
                  "T1110.003"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110",
                  "T1041",
                  "T1566",
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Phishing Network Indicators - Block Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject17').analyticRuleId17,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 17",
                "parentId": "[variables('analyticRuleObject17').analyticRuleId17]",
                "contentId": "[variables('analyticRuleObject17')._analyticRulecontentId17]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject17').analyticRuleVersion17]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject17')._analyticRulecontentId17]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Malicious Phishing Network Indicators - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject17')._analyticRulecontentProductId17]",
        "id": "[variables('analyticRuleObject17')._analyticRulecontentProductId17]",
        "version": "[variables('analyticRuleObject17').analyticRuleVersion17]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject18').analyticRuleTemplateSpecName18]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PhishingNetworkIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject18').analyticRuleVersion18]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject18')._analyticRulecontentId18]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule identifies network indicators such as URLs, IP addresses, and domains related to phishing campaigns, as reported by CYFIRMA threat intelligence. \nThese indicators are flagged with a recommended action to block and are categorized under the 'Phishing' role.\nSuch infrastructure is often used to deliver phishing emails, host fake login portals, or redirect victims to credential-harvesting pages. \nBlocking these indicators proactively helps prevent user compromise and data theft.",
                "displayName": "CYFIRMA - Medium severity Malicious Phishing Network Indicators - Block Recommended Rule",
                "enabled": false,
                "query": "//Malicious Phishing Network Indicators - Block Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'Phishing'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CredentialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1566.002",
                  "T1204.001",
                  "T1556.002",
                  "T1110.003"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110",
                  "T1041",
                  "T1566",
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Phishing Network Indicators - Block Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject18').analyticRuleId18,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 18",
                "parentId": "[variables('analyticRuleObject18').analyticRuleId18]",
                "contentId": "[variables('analyticRuleObject18')._analyticRulecontentId18]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject18').analyticRuleVersion18]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject18')._analyticRulecontentId18]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Malicious Phishing Network Indicators - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject18')._analyticRulecontentProductId18]",
        "id": "[variables('analyticRuleObject18')._analyticRulecontentProductId18]",
        "version": "[variables('analyticRuleObject18').analyticRuleVersion18]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject19').analyticRuleTemplateSpecName19]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PhishingNetworkIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject19').analyticRuleVersion19]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject19')._analyticRulecontentId19]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule identifies network-based indicators such as URLs, IP addresses, and domains related to phishing campaigns, as reported by CYFIRMA threat intelligence. \nThese indicators are flagged with a recommended action to block and are categorized under the 'Phishing' role.\nSuch infrastructure is often used to deliver phishing emails, host fake login portals, or redirect victims to credential-harvesting pages. \nmonitoring these indicators proactively helps prevent user compromise and data theft.",
                "displayName": "CYFIRMA - High severity Malicious Phishing Network Indicators - Monitor Recommended Rule",
                "enabled": false,
                "query": "//Phishing Network Indicators - Monitor Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'Phishing'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CredentialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1566.002",
                  "T1204.001",
                  "T1556.002",
                  "T1110.003"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110",
                  "T1041",
                  "T1566",
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Phishing Network Indicators - Monitor Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject19').analyticRuleId19,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 19",
                "parentId": "[variables('analyticRuleObject19').analyticRuleId19]",
                "contentId": "[variables('analyticRuleObject19')._analyticRulecontentId19]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject19').analyticRuleVersion19]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject19')._analyticRulecontentId19]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Malicious Phishing Network Indicators - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject19')._analyticRulecontentProductId19]",
        "id": "[variables('analyticRuleObject19')._analyticRulecontentProductId19]",
        "version": "[variables('analyticRuleObject19').analyticRuleVersion19]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject20').analyticRuleTemplateSpecName20]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "PhishingNetworkIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject20').analyticRuleVersion20]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject20')._analyticRulecontentId20]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule identifies network-based indicators such as URLs, IP addresses, and domains related to phishing campaigns, as reported by CYFIRMA threat intelligence. \nThese indicators are flagged with a recommended action to block and are categorized under the 'Phishing' role.\nSuch infrastructure is often used to deliver phishing emails, host fake login portals, or redirect victims to credential-harvesting pages. \nmonitoring these indicators proactively helps prevent user compromise and data theft.",
                "displayName": "CYFIRMA - Medium severity Malicious Phishing Network Indicators - Monitor Recommended Rule",
                "enabled": false,
                "query": "//Phishing Network Indicators - Monitor Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'Phishing'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "CredentialAccess",
                  "Exfiltration"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1566.002",
                  "T1204.001",
                  "T1556.002",
                  "T1110.003"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110",
                  "T1041",
                  "T1566",
                  "T1566",
                  "T1204",
                  "T1556",
                  "T1110"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Malicious Phishing Network Indicators - Monitor Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject20').analyticRuleId20,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 20",
                "parentId": "[variables('analyticRuleObject20').analyticRuleId20]",
                "contentId": "[variables('analyticRuleObject20')._analyticRulecontentId20]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject20').analyticRuleVersion20]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject20')._analyticRulecontentId20]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Malicious Phishing Network Indicators - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject20')._analyticRulecontentProductId20]",
        "id": "[variables('analyticRuleObject20')._analyticRulecontentProductId20]",
        "version": "[variables('analyticRuleObject20').analyticRuleVersion20]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject21').analyticRuleTemplateSpecName21]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TORNodeNetworkIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject21').analyticRuleVersion21]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject21')._analyticRulecontentId21]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query identifies network-based indicators from CYFIRMA intelligence that are associated with the role 'TOR'. \nThese indicators may include IP addresses, domains, and URLs related to Tor network activity. \nThreat actors often use Tor for anonymous communication, command and control, data exfiltration, and evasion of network defenses.",
                "displayName": "CYFIRMA - High severity TOR Node Network Indicators - Block Recommended Rule",
                "enabled": false,
                "query": "//TOR Node Network Indicators - Block Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'TOR'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "Exfiltration",
                  "InitialAccess",
                  "Persistence",
                  "Reconnaissance"
                ],
                "subTechniques": [
                  "T1090.003",
                  "T1048.002",
                  "T1071.001",
                  "T1505.003",
                  "T1595.002"
                ],
                "techniques": [
                  "T1090",
                  "T1572",
                  "T1048",
                  "T1071",
                  "T1189",
                  "T1505",
                  "T1595",
                  "T1090",
                  "T1048",
                  "T1071",
                  "T1505",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence TOR Node Network Indicators - Block Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject21').analyticRuleId21,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 21",
                "parentId": "[variables('analyticRuleObject21').analyticRuleId21]",
                "contentId": "[variables('analyticRuleObject21')._analyticRulecontentId21]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject21').analyticRuleVersion21]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject21')._analyticRulecontentId21]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity TOR Node Network Indicators - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject21')._analyticRulecontentProductId21]",
        "id": "[variables('analyticRuleObject21')._analyticRulecontentProductId21]",
        "version": "[variables('analyticRuleObject21').analyticRuleVersion21]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject22').analyticRuleTemplateSpecName22]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TORNodeNetworkIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject22').analyticRuleVersion22]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject22')._analyticRulecontentId22]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query identifies network-based indicators from CYFIRMA intelligence that are associated with the role 'TOR'. \nThese indicators may include IP addresses, domains, and URLs related to Tor network activity. \nThreat actors often use Tor for anonymous communication, command and control, data exfiltration, and evasion of network defenses.",
                "displayName": "CYFIRMA - Medium severity TOR Node Network Indicators - Block Recommended Rule",
                "enabled": false,
                "query": "//TOR Node Network Indicators - Block Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'TOR'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "Exfiltration",
                  "InitialAccess",
                  "Persistence",
                  "Reconnaissance"
                ],
                "subTechniques": [
                  "T1090.003",
                  "T1048.002",
                  "T1071.001",
                  "T1505.003",
                  "T1595.002"
                ],
                "techniques": [
                  "T1090",
                  "T1572",
                  "T1048",
                  "T1071",
                  "T1189",
                  "T1505",
                  "T1595",
                  "T1090",
                  "T1048",
                  "T1071",
                  "T1505",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence TOR Node Network Indicators - Block Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject22').analyticRuleId22,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 22",
                "parentId": "[variables('analyticRuleObject22').analyticRuleId22]",
                "contentId": "[variables('analyticRuleObject22')._analyticRulecontentId22]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject22').analyticRuleVersion22]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject22')._analyticRulecontentId22]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity TOR Node Network Indicators - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject22')._analyticRulecontentProductId22]",
        "id": "[variables('analyticRuleObject22')._analyticRulecontentProductId22]",
        "version": "[variables('analyticRuleObject22').analyticRuleVersion22]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject23').analyticRuleTemplateSpecName23]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TORNodeNetworkIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject23').analyticRuleVersion23]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject23')._analyticRulecontentId23]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query identifies network-based indicators from CYFIRMA intelligence that are associated with the role 'TOR'. \nThese indicators may include IP addresses, domains, and URLs related to Tor network activity. \nThreat actors often use Tor for anonymous communication, command and control, data exfiltration, and evasion of network defenses.",
                "displayName": "CYFIRMA - High severity TOR Node Network Indicators - Monitor Recommended Rule",
                "enabled": false,
                "query": "//TOR Node Network Indicators - Monitor Recommended \nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'TOR'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "Exfiltration",
                  "InitialAccess",
                  "Persistence",
                  "Reconnaissance"
                ],
                "subTechniques": [
                  "T1090.003",
                  "T1048.002",
                  "T1071.001",
                  "T1505.003",
                  "T1595.002"
                ],
                "techniques": [
                  "T1090",
                  "T1572",
                  "T1048",
                  "T1071",
                  "T1189",
                  "T1505",
                  "T1595",
                  "T1090",
                  "T1048",
                  "T1071",
                  "T1505",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence TOR Node Network Indicators - Monitor Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject23').analyticRuleId23,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 23",
                "parentId": "[variables('analyticRuleObject23').analyticRuleId23]",
                "contentId": "[variables('analyticRuleObject23')._analyticRulecontentId23]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject23').analyticRuleVersion23]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject23')._analyticRulecontentId23]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity TOR Node Network Indicators - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject23')._analyticRulecontentProductId23]",
        "id": "[variables('analyticRuleObject23')._analyticRulecontentProductId23]",
        "version": "[variables('analyticRuleObject23').analyticRuleVersion23]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject24').analyticRuleTemplateSpecName24]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TORNodeNetworkIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject24').analyticRuleVersion24]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject24')._analyticRulecontentId24]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query identifies network-based indicators from CYFIRMA intelligence that are associated with the role 'TOR'. \nThese indicators may include IP addresses, domains, and URLs related to Tor network activity. \nThreat actors often use Tor for anonymous communication, command and control, data exfiltration, and evasion of network defenses.",
                "displayName": "CYFIRMA - Medium severity TOR Node Network Indicators - Monitor Recommended Rule",
                "enabled": false,
                "query": "//TOR Node Network Indicators - Monitor Recommended \nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'TOR'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "CommandAndControl",
                  "Exfiltration",
                  "InitialAccess",
                  "Persistence",
                  "Reconnaissance"
                ],
                "subTechniques": [
                  "T1090.003",
                  "T1048.002",
                  "T1071.001",
                  "T1505.003",
                  "T1595.002"
                ],
                "techniques": [
                  "T1090",
                  "T1572",
                  "T1048",
                  "T1071",
                  "T1189",
                  "T1505",
                  "T1595",
                  "T1090",
                  "T1048",
                  "T1071",
                  "T1505",
                  "T1595"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence TOR Node Network Indicators - Monitor Recommended - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject24').analyticRuleId24,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 24",
                "parentId": "[variables('analyticRuleObject24').analyticRuleId24]",
                "contentId": "[variables('analyticRuleObject24')._analyticRulecontentId24]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject24').analyticRuleVersion24]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject24')._analyticRulecontentId24]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity TOR Node Network Indicators - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject24')._analyticRulecontentProductId24]",
        "id": "[variables('analyticRuleObject24')._analyticRulecontentProductId24]",
        "version": "[variables('analyticRuleObject24').analyticRuleVersion24]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject25').analyticRuleTemplateSpecName25]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "FileHashIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject25').analyticRuleVersion25]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject25')._analyticRulecontentId25]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query retrieves file hash indicators marked for blocking, with no assigned role, from the CyfirmaIndicators_CL table. \nIt extracts MD5, SHA1, and SHA256 hashes and includes threat metadata for use in preventive security controls such as EDRs, threat intel platforms, or automated blocklists.",
                "displayName": "CYFIRMA - High severity File Hash Indicators with Block Action Rule",
                "enabled": false,
                "query": "// File Hash Indicators with Block Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Block' and (isempty(Roles) or not(Roles has_any ('Malware', 'Trojan')))\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='MD5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    SHA1,\n    SHA256,\n    Algo_MD5,\n    Algo_SHA1,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Execution",
                  "InitialAccess",
                  "DefenseEvasion",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.001"
                ],
                "techniques": [
                  "T1204",
                  "T1566",
                  "T1027",
                  "T1486",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Block Action - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject25').analyticRuleId25,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 25",
                "parentId": "[variables('analyticRuleObject25').analyticRuleId25]",
                "contentId": "[variables('analyticRuleObject25')._analyticRulecontentId25]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject25').analyticRuleVersion25]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject25')._analyticRulecontentId25]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity File Hash Indicators with Block Action Rule",
        "contentProductId": "[variables('analyticRuleObject25')._analyticRulecontentProductId25]",
        "id": "[variables('analyticRuleObject25')._analyticRulecontentProductId25]",
        "version": "[variables('analyticRuleObject25').analyticRuleVersion25]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject26').analyticRuleTemplateSpecName26]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "FileHashIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject26').analyticRuleVersion26]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject26')._analyticRulecontentId26]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query retrieves file hash indicators marked for blocking, with no assigned role, from the CyfirmaIndicators_CL table. \nIt extracts MD5, SHA1, and SHA256 hashes and includes threat metadata for use in preventive security controls such as EDRs, threat intel platforms, or automated blocklists.",
                "displayName": "CYFIRMA - Medium severity File Hash Indicators with Block Action Rule",
                "enabled": false,
                "query": "// File Hash Indicators with Block Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Block' and (isempty(Roles) or not(Roles has_any ('Malware', 'Trojan')))\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='MD5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    SHA1,\n    SHA256,\n    Algo_MD5,\n    Algo_SHA1,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Execution",
                  "InitialAccess",
                  "DefenseEvasion",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.001"
                ],
                "techniques": [
                  "T1204",
                  "T1566",
                  "T1027",
                  "T1486",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Block Action - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject26').analyticRuleId26,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 26",
                "parentId": "[variables('analyticRuleObject26').analyticRuleId26]",
                "contentId": "[variables('analyticRuleObject26')._analyticRulecontentId26]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject26').analyticRuleVersion26]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject26')._analyticRulecontentId26]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity File Hash Indicators with Block Action Rule",
        "contentProductId": "[variables('analyticRuleObject26')._analyticRulecontentProductId26]",
        "id": "[variables('analyticRuleObject26')._analyticRulecontentProductId26]",
        "version": "[variables('analyticRuleObject26').analyticRuleVersion26]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject27').analyticRuleTemplateSpecName27]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "FileHashIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject27').analyticRuleVersion27]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject27')._analyticRulecontentId27]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query retrieves file hash indicators marked for Monitoring, with no assigned role, from the CyfirmaIndicators_CL table. \nIt extracts MD5, SHA1, and SHA256 hashes and includes threat metadata for use in preventive security controls such as EDRs, threat intel platforms.",
                "displayName": "CYFIRMA - High severity File Hash Indicators with Monitor Action Rule",
                "enabled": false,
                "query": "// File Hash Indicators with Monitor Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Monitor' and (isempty(Roles) or not(Roles has_any ('Malware', 'Trojan')))\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='MD5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    SHA1,\n    SHA256,\n    Algo_MD5,\n    Algo_SHA1,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Execution",
                  "InitialAccess",
                  "DefenseEvasion",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.001"
                ],
                "techniques": [
                  "T1204",
                  "T1566",
                  "T1027",
                  "T1486",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Monitor Action - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject27').analyticRuleId27,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 27",
                "parentId": "[variables('analyticRuleObject27').analyticRuleId27]",
                "contentId": "[variables('analyticRuleObject27')._analyticRulecontentId27]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject27').analyticRuleVersion27]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject27')._analyticRulecontentId27]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity File Hash Indicators with Monitor Action Rule",
        "contentProductId": "[variables('analyticRuleObject27')._analyticRulecontentProductId27]",
        "id": "[variables('analyticRuleObject27')._analyticRulecontentProductId27]",
        "version": "[variables('analyticRuleObject27').analyticRuleVersion27]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject28').analyticRuleTemplateSpecName28]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "FileHashIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject28').analyticRuleVersion28]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject28')._analyticRulecontentId28]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This query retrieves file hash indicators marked for Monitoring, with no assigned role, from the CyfirmaIndicators_CL table. \nIt extracts MD5, SHA1, and SHA256 hashes and includes threat metadata for use in preventive security controls such as EDRs, threat intel platforms.",
                "displayName": "CYFIRMA - Medium severity File Hash Indicators with Monitor Action Rule",
                "enabled": false,
                "query": "// File Hash Indicators with Monitor Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where  (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Monitor' and (isempty(Roles) or not(Roles has_any ('Malware', 'Trojan')))\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='MD5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    SHA1,\n    SHA256,\n    Algo_MD5,\n    Algo_SHA1,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Execution",
                  "InitialAccess",
                  "DefenseEvasion",
                  "Impact"
                ],
                "subTechniques": [
                  "T1566.001"
                ],
                "techniques": [
                  "T1204",
                  "T1566",
                  "T1027",
                  "T1486",
                  "T1566"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence File Hash Indicators with Monitor Action - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject28').analyticRuleId28,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 28",
                "parentId": "[variables('analyticRuleObject28').analyticRuleId28]",
                "contentId": "[variables('analyticRuleObject28')._analyticRulecontentId28]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject28').analyticRuleVersion28]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject28')._analyticRulecontentId28]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity File Hash Indicators with Monitor Action Rule",
        "contentProductId": "[variables('analyticRuleObject28')._analyticRulecontentProductId28]",
        "id": "[variables('analyticRuleObject28')._analyticRulecontentProductId28]",
        "version": "[variables('analyticRuleObject28').analyticRuleVersion28]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject29').analyticRuleTemplateSpecName29]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanNetworkIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject29').analyticRuleVersion29]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject29')._analyticRulecontentId29]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators flagged by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure. \nThese indicators may represent attacker-controlled endpoints used for persistence, data exfiltration, or command delivery to compromised systems.",
                "displayName": "CYFIRMA - High severity Trojan Network Indicators - Block Recommended Rule",
                "enabled": false,
                "query": "//Trojan Network Indicators - Block Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'Trojan'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Impact",
                  "Persistence",
                  "DefenseEvasion",
                  "CredentialAccess",
                  "CommandAndControl",
                  "Execution",
                  "InitialAccess"
                ],
                "subTechniques": [
                  "T1053.005",
                  "T1555.003",
                  "T1071.001",
                  "T1204.001"
                ],
                "techniques": [
                  "T1496",
                  "T1053",
                  "T1555",
                  "T1090",
                  "T1071",
                  "T1204",
                  "T1189",
                  "T1053",
                  "T1555",
                  "T1071",
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan Network Indicators - Block Recommended Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject29').analyticRuleId29,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 29",
                "parentId": "[variables('analyticRuleObject29').analyticRuleId29]",
                "contentId": "[variables('analyticRuleObject29')._analyticRulecontentId29]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject29').analyticRuleVersion29]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject29')._analyticRulecontentId29]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Trojan Network Indicators - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject29')._analyticRulecontentProductId29]",
        "id": "[variables('analyticRuleObject29')._analyticRulecontentProductId29]",
        "version": "[variables('analyticRuleObject29').analyticRuleVersion29]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject30').analyticRuleTemplateSpecName30]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanNetworkIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject30').analyticRuleVersion30]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject30')._analyticRulecontentId30]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators flagged by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure. \nThese indicators may represent attacker-controlled endpoints used for persistence, data exfiltration, or command delivery to compromised systems.",
                "displayName": "CYFIRMA - Medium severity Trojan Network Indicators - Block Recommended Rule",
                "enabled": false,
                "query": "//Trojan Network Indicators - Block Recommended\nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Block' and Roles has 'Trojan'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Impact",
                  "Persistence",
                  "DefenseEvasion",
                  "CredentialAccess",
                  "CommandAndControl",
                  "Execution",
                  "InitialAccess"
                ],
                "subTechniques": [
                  "T1053.005",
                  "T1555.003",
                  "T1071.001",
                  "T1204.001"
                ],
                "techniques": [
                  "T1496",
                  "T1053",
                  "T1555",
                  "T1090",
                  "T1071",
                  "T1204",
                  "T1189",
                  "T1053",
                  "T1555",
                  "T1071",
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan Network Indicators - Block Recommended Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject30').analyticRuleId30,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 30",
                "parentId": "[variables('analyticRuleObject30').analyticRuleId30]",
                "contentId": "[variables('analyticRuleObject30')._analyticRulecontentId30]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject30').analyticRuleVersion30]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject30')._analyticRulecontentId30]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Trojan Network Indicators - Block Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject30')._analyticRulecontentProductId30]",
        "id": "[variables('analyticRuleObject30')._analyticRulecontentProductId30]",
        "version": "[variables('analyticRuleObject30').analyticRuleVersion30]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject31').analyticRuleTemplateSpecName31]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanFileHashIndicatorsBlockHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject31').analyticRuleVersion31]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject31')._analyticRulecontentId31]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query extracts file hash indicators associated with Trojan activity from the CyfirmaIndicators_CL table. \nIt specifically targets indicators containing file hashes linked to Trojan behavior and retrieves MD5, SHA1, and SHA256 values. \nThe query also includes contextual threat intelligence such as threat actors, tags, sources, and geolocation information.",
                "displayName": "CYFIRMA - High severity Trojan File Hash Indicators with Block Action Rule",
                "enabled": false,
                "query": "//Trojan File Hash Indicators with Block Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Block' and (Roles has 'Trojan')\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='MD5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "DefenseEvasion",
                  "CommandAndControl",
                  "CredentialAccess"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1547.001"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1547",
                  "T1027",
                  "T1071",
                  "T1003",
                  "T1566",
                  "T1547"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      },
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      },
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      },
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan File Hash Indicators with Block Action Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject31').analyticRuleId31,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 31",
                "parentId": "[variables('analyticRuleObject31').analyticRuleId31]",
                "contentId": "[variables('analyticRuleObject31')._analyticRulecontentId31]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject31').analyticRuleVersion31]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject31')._analyticRulecontentId31]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Trojan File Hash Indicators with Block Action Rule",
        "contentProductId": "[variables('analyticRuleObject31')._analyticRulecontentProductId31]",
        "id": "[variables('analyticRuleObject31')._analyticRulecontentProductId31]",
        "version": "[variables('analyticRuleObject31').analyticRuleVersion31]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject32').analyticRuleTemplateSpecName32]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanFileHashIndicatorsBlockMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject32').analyticRuleVersion32]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject32')._analyticRulecontentId32]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query extracts file hash indicators associated with Trojan activity from the CyfirmaIndicators_CL table. \nIt specifically targets indicators containing file hashes linked to Trojan behavior and retrieves MD5, SHA1, and SHA256 values. \nThe query also includes contextual threat intelligence such as threat actors, tags, sources, and geolocation information.",
                "displayName": "CYFIRMA - Medium severity Trojan File Hash Indicators with Block Action Rule",
                "enabled": false,
                "query": "//Trojan File Hash Indicators with Block Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Block' and (Roles has 'Trojan')\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='MD5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "DefenseEvasion",
                  "CommandAndControl",
                  "CredentialAccess"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1547.001"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1547",
                  "T1027",
                  "T1071",
                  "T1003",
                  "T1566",
                  "T1547"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      },
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      },
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      },
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan File Hash Indicators with Block Action Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject32').analyticRuleId32,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 32",
                "parentId": "[variables('analyticRuleObject32').analyticRuleId32]",
                "contentId": "[variables('analyticRuleObject32')._analyticRulecontentId32]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject32').analyticRuleVersion32]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject32')._analyticRulecontentId32]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Trojan File Hash Indicators with Block Action Rule",
        "contentProductId": "[variables('analyticRuleObject32')._analyticRulecontentProductId32]",
        "id": "[variables('analyticRuleObject32')._analyticRulecontentProductId32]",
        "version": "[variables('analyticRuleObject32').analyticRuleVersion32]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject33').analyticRuleTemplateSpecName33]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanFileHashIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject33').analyticRuleVersion33]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject33')._analyticRulecontentId33]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query extracts file hash indicators associated with Trojan activity from the CyfirmaIndicators_CL table. \nIt specifically targets indicators containing file hashes linked to Trojan behavior and retrieves MD5, SHA1, and SHA256 values. \nThe query also includes contextual threat intelligence such as threat actors, tags, sources, and geolocation information.",
                "displayName": "CYFIRMA - High severity Trojan File Hash Indicators with Monitor Action Rule",
                "enabled": false,
                "query": "//Trojan File Hash Indicators with Monitor Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Monitor' and (Roles contains 'Trojan')\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='md5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "DefenseEvasion",
                  "CommandAndControl",
                  "CredentialAccess"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1547.001"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1547",
                  "T1027",
                  "T1071",
                  "T1003",
                  "T1566",
                  "T1547"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan File Hash Indicators with Monitor Action - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject33').analyticRuleId33,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 33",
                "parentId": "[variables('analyticRuleObject33').analyticRuleId33]",
                "contentId": "[variables('analyticRuleObject33')._analyticRulecontentId33]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject33').analyticRuleVersion33]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject33')._analyticRulecontentId33]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Trojan File Hash Indicators with Monitor Action Rule",
        "contentProductId": "[variables('analyticRuleObject33')._analyticRulecontentProductId33]",
        "id": "[variables('analyticRuleObject33')._analyticRulecontentProductId33]",
        "version": "[variables('analyticRuleObject33').analyticRuleVersion33]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject34').analyticRuleTemplateSpecName34]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanFileHashIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject34').analyticRuleVersion34]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject34')._analyticRulecontentId34]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This KQL query extracts file hash indicators associated with Trojan activity from the CyfirmaIndicators_CL table. \nIt specifically targets indicators containing file hashes linked to Trojan behavior and retrieves MD5, SHA1, and SHA256 values. \nThe query also includes contextual threat intelligence such as threat actors, tags, sources, and geolocation information.",
                "displayName": "CYFIRMA - Medium severity Trojan File Hash Indicators with Monitor Action Rule",
                "enabled": false,
                "query": "//Trojan File Hash Indicators with Monitor Action\nlet timeFrame = 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern contains 'file:hashes' and RecommendedActions has 'Monitor' and (Roles contains 'Trojan')\n| extend MD5 = extract(@\"file:hashes\\.md5\\s*=\\s*'([a-fA-F0-9]{32})'\", 1, pattern)\n| extend SHA1 = extract(@\"file:hashes\\.'SHA-1'\\s*=\\s*'([a-fA-F0-9]{40})'\", 1, pattern)\n| extend SHA256 = extract(@\"file:hashes\\.'SHA-256'\\s*=\\s*'([a-fA-F0-9]{64})'\", 1, pattern)\n| extend\n    Algo_MD5='md5',\n    Algo_SHA1= 'SHA1',\n    Algo_SHA256='SHA256',\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project  \n    MD5,\n    Algo_MD5,\n    SHA1,\n    Algo_SHA1,\n    SHA256,\n    Algo_SHA256,\n    ThreatActors,\n    Sources,\n    RecommendedActions,\n    Roles,\n    Country,\n    name,\n    Description,\n    ConfidenceScore,\n    SecurityVendors,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "Persistence",
                  "DefenseEvasion",
                  "CommandAndControl",
                  "CredentialAccess"
                ],
                "subTechniques": [
                  "T1566.001",
                  "T1547.001"
                ],
                "techniques": [
                  "T1566",
                  "T1204",
                  "T1547",
                  "T1027",
                  "T1071",
                  "T1003",
                  "T1566",
                  "T1547"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_MD5"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "MD5"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA1"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA1"
                      }
                    ],
                    "entityType": "FileHash"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Algorithm",
                        "columnName": "Algo_SHA256"
                      },
                      {
                        "identifier": "Value",
                        "columnName": "SHA256"
                      }
                    ],
                    "entityType": "FileHash"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "Roles": "Roles",
                  "modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan File Hash Indicators with Monitor Action - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject34').analyticRuleId34,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 34",
                "parentId": "[variables('analyticRuleObject34').analyticRuleId34]",
                "contentId": "[variables('analyticRuleObject34')._analyticRulecontentId34]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject34').analyticRuleVersion34]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject34')._analyticRulecontentId34]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Trojan File Hash Indicators with Monitor Action Rule",
        "contentProductId": "[variables('analyticRuleObject34')._analyticRulecontentProductId34]",
        "id": "[variables('analyticRuleObject34')._analyticRulecontentProductId34]",
        "version": "[variables('analyticRuleObject34').analyticRuleVersion34]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject35').analyticRuleTemplateSpecName35]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanNetworkIndicatorsMonitorHighSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject35').analyticRuleVersion35]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject35')._analyticRulecontentId35]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators flagged by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure. \nThese indicators may represent attacker-controlled endpoints used for persistence, data exfiltration, or command delivery to compromised systems.",
                "displayName": "CYFIRMA - High severity Trojan Network Indicators - Monitor Recommended Rule",
                "enabled": false,
                "query": "//Trojan Network Indicators - Monitor Recommended \nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where ConfidenceScore >= 80\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'Trojan'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Impact",
                  "Persistence",
                  "DefenseEvasion",
                  "CredentialAccess",
                  "CommandAndControl",
                  "Execution",
                  "InitialAccess"
                ],
                "subTechniques": [
                  "T1053.005",
                  "T1555.003",
                  "T1071.001",
                  "T1204.001"
                ],
                "techniques": [
                  "T1496",
                  "T1053",
                  "T1555",
                  "T1090",
                  "T1071",
                  "T1204",
                  "T1189",
                  "T1053",
                  "T1555",
                  "T1071",
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan Network Indicators - Monitor Recommended Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject35').analyticRuleId35,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 35",
                "parentId": "[variables('analyticRuleObject35').analyticRuleId35]",
                "contentId": "[variables('analyticRuleObject35')._analyticRulecontentId35]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject35').analyticRuleVersion35]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject35')._analyticRulecontentId35]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - High severity Trojan Network Indicators - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject35')._analyticRulecontentProductId35]",
        "id": "[variables('analyticRuleObject35')._analyticRulecontentProductId35]",
        "version": "[variables('analyticRuleObject35').analyticRuleVersion35]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject36').analyticRuleTemplateSpecName36]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "TrojanNetworkIndicatorsMonitorMediumSeverityRule_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject36').analyticRuleVersion36]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject36')._analyticRulecontentId36]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This analytics rule detects network-based indicators flagged by CYFIRMA threat intelligence as associated with Command & Control (C2) infrastructure. \nThese indicators may represent attacker-controlled endpoints used for persistence, data exfiltration, or command delivery to compromised systems.",
                "displayName": "CYFIRMA - Medium severity Trojan Network Indicators - Monitor Recommended Rule",
                "enabled": false,
                "query": "//Trojan Network Indicators - Monitor Recommended \nlet timeFrame= 5m;\nCyfirmaIndicators_CL \n| where (ConfidenceScore < 80 and ConfidenceScore >= 50)\n    and TimeGenerated between (ago(timeFrame) .. now())\n    and pattern !contains 'file:hashes' and RecommendedActions has 'Monitor' and Roles has 'Trojan'\n| extend IPv4 = extract(@\"ipv4-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend IPv6 = extract(@\"ipv6-addr:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend URL = extract(@\"url:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend Domain = extract(@\"domain-name:value\\s*=\\s*'([^']+)'\", 1, pattern)\n| extend parsed = parse_json(extensions)\n| extend extensionKeys = bag_keys(parsed)\n| mv-expand extensionKeys\n| extend extensionKeyStr = tostring(extensionKeys)\n| extend ext = parsed[extensionKeyStr]\n| extend props = ext.properties\n| extend \n    extension_id = extensionKeyStr,\n    ASN_Owner = props.asn_owner,\n    ASN = props.asn,\n    ProviderName = 'CYFIRMA',\n    ProductName = 'DeCYFIR/DeTCT'\n| project\n    IPv4,\n    IPv6,\n    URL,\n    Domain,\n    ThreatActors,\n    RecommendedActions,\n    Sources,\n    Roles,\n    Country,\n    IPAbuse,\n    name,\n    Description,\n    ConfidenceScore,\n    IndicatorID,\n    created,\n    modified,\n    valid_from,\n    Tags,\n    ThreatType,\n    TimeGenerated,\n    SecurityVendors,\n    ProductName,\n    ProviderName\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CyfirmaIndicators_CL"
                    ],
                    "connectorId": "CyfirmaCyberIntelligenceDC"
                  }
                ],
                "tactics": [
                  "Impact",
                  "Persistence",
                  "DefenseEvasion",
                  "CredentialAccess",
                  "CommandAndControl",
                  "Execution",
                  "InitialAccess"
                ],
                "subTechniques": [
                  "T1053.005",
                  "T1555.003",
                  "T1071.001",
                  "T1204.001"
                ],
                "techniques": [
                  "T1496",
                  "T1053",
                  "T1555",
                  "T1090",
                  "T1071",
                  "T1204",
                  "T1189",
                  "T1053",
                  "T1555",
                  "T1071",
                  "T1204"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv4"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPv6"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "DomainName",
                        "columnName": "Domain"
                      }
                    ],
                    "entityType": "DNS"
                  },
                  {
                    "fieldMappings": [
                      {
                        "identifier": "Url",
                        "columnName": "URL"
                      }
                    ],
                    "entityType": "URL"
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "SecurityVendors": "SecurityVendors",
                  "ThreatType": "ThreatType",
                  "IPAbuse": "IPAbuse",
                  "Roles": "Roles",
                  "Modified": "modified",
                  "Country": "Country",
                  "IndicatorID": "IndicatorID",
                  "ConfidenceScore": "ConfidenceScore",
                  "Created": "created",
                  "RecommendedActions": "RecommendedActions",
                  "ThreatActors": "ThreatActors",
                  "Sources": "Sources",
                  "Description": "Description",
                  "TimeGenerated": "TimeGenerated",
                  "Tags": "Tags",
                  "ValidFrom": "valid_from"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "High-Confidence Trojan Network Indicators - Monitor Recommended Rule - {{name}} ",
                  "alertDescriptionFormat": "{{Description}} - {{name}} ",
                  "alertDynamicProperties": [
                    {
                      "alertProperty": "ProductName",
                      "value": "ProductName"
                    },
                    {
                      "alertProperty": "ProviderName",
                      "value": "ProviderName"
                    }
                  ]
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "lookbackDuration": "5M",
                    "enabled": false,
                    "reopenClosedIncident": false,
                    "matchingMethod": "AllEntities"
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject36').analyticRuleId36,'/'))))]",
              "properties": {
                "description": "Cyfirma Cyber Intelligence Analytics Rule 36",
                "parentId": "[variables('analyticRuleObject36').analyticRuleId36]",
                "contentId": "[variables('analyticRuleObject36')._analyticRulecontentId36]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject36').analyticRuleVersion36]",
                "source": {
                  "kind": "Solution",
                  "name": "Cyfirma Cyber Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject36')._analyticRulecontentId36]",
        "contentKind": "AnalyticsRule",
        "displayName": "CYFIRMA - Medium severity Trojan Network Indicators - Monitor Recommended Rule",
        "contentProductId": "[variables('analyticRuleObject36')._analyticRulecontentProductId36]",
        "id": "[variables('analyticRuleObject36')._analyticRulecontentProductId36]",
        "version": "[variables('analyticRuleObject36').analyticRuleVersion36]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "CYFIRMA Cyber Intelligence",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "CyfirmaCyberIntelligenceDC",
                  "title": "CYFIRMA Cyber Intelligence",
                  "publisher": "Microsoft",
                  "isConnectivityCriteriasMatchSome": false,
                  "descriptionMarkdown": "The CYFIRMA Cyber Intelligence data connector enables seamless log ingestion from the DeCYFIR API into Microsoft Sentinel. Built on the Microsoft Sentinel Codeless Connector Platform, it leverages the DeCYFIR Alerts API to retrieve logs. Additionally, it supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview), which parse security data into a custom table during ingestion. This eliminates the need for query-time parsing, enhancing performance and efficiency.",
                  "graphQueries": [
                    {
                      "metricName": "Total Indicators logs received",
                      "legend": "Indicators Logs",
                      "baseQuery": "CyfirmaIndicators_CL"
                    },
                    {
                      "metricName": "Total Threat Actors logs received",
                      "legend": "Threat Actors Logs",
                      "baseQuery": "CyfirmaThreatActors_CL"
                    },
                    {
                      "metricName": "Total Campaigns logs received",
                      "legend": "Campaigns Logs",
                      "baseQuery": "CyfirmaCampaigns_CL"
                    },
                    {
                      "metricName": "Total Malware logs received",
                      "legend": "Malware Logs",
                      "baseQuery": "CyfirmaMalware_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get Sample of Indicators logs",
                      "query": "CyfirmaIndicators_CL | take 10"
                    },
                    {
                      "description": "Get Sample of Threat Actors logs",
                      "query": "CyfirmaThreatActors_CL | take 10"
                    },
                    {
                      "description": "Get Sample of Campaigns logs",
                      "query": "CyfirmaCampaigns_CL | take 10"
                    },
                    {
                      "description": "Get Sample of Malware logs",
                      "query": "CyfirmaMalware_CL | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "CyfirmaIndicators_CL",
                      "lastDataReceivedQuery": "CyfirmaIndicators_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
                    },
                    {
                      "name": "CyfirmaThreatActors_CL",
                      "lastDataReceivedQuery": "CyfirmaThreatActors_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
                    },
                    {
                      "name": "CyfirmaCampaigns_CL",
                      "lastDataReceivedQuery": "CyfirmaCampaigns_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
                    },
                    {
                      "name": "CyfirmaMalware_CL",
                      "lastDataReceivedQuery": "CyfirmaMalware_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "read": true,
                          "write": true,
                          "delete": true,
                          "action": false
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "CYFIRMA Cyber Intelligence",
                      "description": "This connector provides the Indicators, Threat actors, Malware and Campaigns logs from CYFIRMA Cyber Intelligence. The connector uses the DeCYFIR API to retrieve logs and supports DCR-based ingestion time transformations, parsing security data into a custom table during ingestion. This eliminates the need for query-time parsing, enhancing performance and efficiency.",
                      "descriptionMarkdown": "This connector provides the Indicators, Threat actors, Malware and Campaigns logs from CYFIRMA Cyber Intelligence. The connector uses the DeCYFIR API to retrieve logs and supports DCR-based ingestion time transformations, parsing security data into a custom table during ingestion. This eliminates the need for query-time parsing, enhancing performance and efficiency.",
                      "estimatedTime": "5 minutes",
                      "icon": "https://www.microsoft.com/favicon.ico",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "CYFIRMA API URL",
                            "placeholder": "https://decyfir.cyfirma.com",
                            "type": "text",
                            "name": "cyfirmaAPIURL"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "CYFIRMA API Key",
                            "placeholder": "CYFIRMA API Key",
                            "type": "password",
                            "name": "cyfirmaAPIKey"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Pull all IoC's Or Tailored IoC's",
                            "placeholder": "All IoC's or Tailored IoC's",
                            "type": "text",
                            "name": "apiAll",
                            "defaultValue": "false",
                            "description": "Set to true to pull all IoC's, set to false to pull tailoried IoC's"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API Delta",
                            "placeholder": "API Delta",
                            "type": "text",
                            "name": "apiDelta",
                            "defaultValue": "false",
                            "description": "Setting it to true returns only data added since the last API call, while false returns data from the last 24 hours."
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Recommended Actions",
                            "placeholder": "Recommended Action can be any one of:All/Monitor/Block",
                            "type": "text",
                            "name": "recommendedActions",
                            "defaultValue": "All",
                            "description": "Recommended Action can be any one of:All/Monitor/Block"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Threat Actor Associated",
                            "placeholder": "Is any Threat Actor Associated with the IoC's",
                            "type": "text",
                            "name": "isThreatActorExists",
                            "defaultValue": "false",
                            "description": "Is any Threat Actor Associated with the IoC's"
                          }
                        },
                        {
                          "type": "ConnectionToggleButton",
                          "parameters": {
                            "connectLabel": "Connect",
                            "name": "toggle"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "CyfirmaCyberIntelDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-CyfirmaIndicators_CL": {
                    "columns": [
                      {
                        "name": "type",
                        "type": "string"
                      },
                      {
                        "name": "name",
                        "type": "string"
                      },
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "created",
                        "type": "datetime"
                      },
                      {
                        "name": "modified",
                        "type": "datetime"
                      },
                      {
                        "name": "indicator_types",
                        "type": "dynamic"
                      },
                      {
                        "name": "pattern",
                        "type": "string"
                      },
                      {
                        "name": "pattern_type",
                        "type": "string"
                      },
                      {
                        "name": "valid_from",
                        "type": "datetime"
                      },
                      {
                        "name": "confidence",
                        "type": "int"
                      },
                      {
                        "name": "spec_version",
                        "type": "string"
                      },
                      {
                        "name": "labels",
                        "type": "dynamic"
                      },
                      {
                        "name": "extensions",
                        "type": "dynamic"
                      },
                      {
                        "name": "description",
                        "type": "string"
                      }
                    ]
                  },
                  "Custom-CyfirmaThreatActors_CL": {
                    "columns": [
                      {
                        "name": "type",
                        "type": "string"
                      },
                      {
                        "name": "name",
                        "type": "string"
                      },
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "spec_version",
                        "type": "string"
                      },
                      {
                        "name": "created",
                        "type": "datetime"
                      },
                      {
                        "name": "modified",
                        "type": "datetime"
                      },
                      {
                        "name": "description",
                        "type": "string"
                      },
                      {
                        "name": "threat_actor_types",
                        "type": "dynamic"
                      },
                      {
                        "name": "primary_motivation",
                        "type": "string"
                      },
                      {
                        "name": "aliases",
                        "type": "dynamic"
                      },
                      {
                        "name": "extensions",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-CyfirmaCampaigns_CL": {
                    "columns": [
                      {
                        "name": "type",
                        "type": "string"
                      },
                      {
                        "name": "name",
                        "type": "string"
                      },
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "description",
                        "type": "string"
                      },
                      {
                        "name": "created",
                        "type": "datetime"
                      },
                      {
                        "name": "modified",
                        "type": "datetime"
                      },
                      {
                        "name": "spec_version",
                        "type": "string"
                      },
                      {
                        "name": "aliases",
                        "type": "string"
                      },
                      {
                        "name": "first_seen",
                        "type": "datetime"
                      },
                      {
                        "name": "last_seen",
                        "type": "datetime"
                      },
                      {
                        "name": "extensions",
                        "type": "dynamic"
                      }
                    ]
                  },
                  "Custom-CyfirmaMalware_CL": {
                    "columns": [
                      {
                        "name": "type",
                        "type": "string"
                      },
                      {
                        "name": "name",
                        "type": "string"
                      },
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "spec_version",
                        "type": "string"
                      },
                      {
                        "name": "created",
                        "type": "datetime"
                      },
                      {
                        "name": "modified",
                        "type": "datetime"
                      },
                      {
                        "name": "description",
                        "type": "string"
                      },
                      {
                        "name": "aliases",
                        "type": "dynamic"
                      },
                      {
                        "name": "is_family",
                        "type": "boolean"
                      },
                      {
                        "name": "malware_types",
                        "type": "dynamic"
                      },
                      {
                        "name": "first_seen",
                        "type": "datetime"
                      },
                      {
                        "name": "last_seen",
                        "type": "datetime"
                      },
                      {
                        "name": "extensions",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-CyfirmaIndicators_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source \n| extend\n    TimeGenerated=created,\n    ThreatType=indicator_types[0],\n    Tags=labels,\n    ConfidenceScore = confidence,\n    Description=description,\n    IndicatorID = id\n| extend ParsedJson = parse_json(extensions)\n| extend ExtensionID = extract(@\"(extension-definition--[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\", 1, tostring(extensions))\n| extend ext = ParsedJson[ExtensionID]\n| extend props = ext.properties\n| extend \n    ThreatActors = props.threat_actors,\n    Country = props.country,\n    RecommendedActions = tostring(props.recommended_actions),\n    SecurityVendors=  tostring(props.security_vendors),\n    Sources = tostring(props.sources),\n    Roles = tostring(props.roles),\n    IPAbuse= tostring(props.ip_abuse_categories)\n| project-away\n    ['type'],\n    ParsedJson,\n    ExtensionID,\n    ext,\n    props,\n    confidence,\n    labels,\n    indicator_types,\n    id,\n    description,\n    pattern_type,\n    spec_version\n",
                    "outputStream": "Custom-CyfirmaIndicators_CL"
                  },
                  {
                    "streams": [
                      "Custom-CyfirmaThreatActors_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n| extend\n    TimeGenerated=created,\n    Aliases=aliases,\n    ThreatType=threat_actor_types[0],\n    PrimaryMotivation=primary_motivation,\n    Description=description\n| extend ParsedJson = parse_json(extensions)\n| extend ExtensionID = extract(@\"(extension-definition--[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\", 1, tostring(extensions))\n| extend ext = ParsedJson[ExtensionID]\n| extend props = ext.properties\n| extend \n    Country = props[\"origin-of-country\"],\n    TargetCountries = props[\"target-countries\"],\n    TargetIndustries = props[\"target-industries\"],\n    TargetTechnologies = props[\"target-technologies\"]\n| project-away ['type'],\n  ParsedJson, ExtensionID, ext, props, threat_actor_types, spec_version, primary_motivation,aliases,description\n",
                    "outputStream": "Custom-CyfirmaThreatActors_CL"
                  },
                  {
                    "streams": [
                      "Custom-CyfirmaCampaigns_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n| extend\n    TimeGenerated = last_seen,\n    Name=name,\n    CampaignID=id,\n    Description=description,\n    Aliases=aliases,\n    Modified=modified,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    Created=created\n| extend ParsedJson = parse_json(extensions)\n| extend ExtensionID = extract(@\"(extension-definition--[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\", 1, tostring(extensions))\n| extend ext = ParsedJson[ExtensionID]\n| extend props = ext.properties\n| extend \n    Country = props[\"geographies\"],\n    Technologies = props[\"technologies\"],\n    Industries = props[\"industries\"]\n| project-away\n    ParsedJson,\n    created,\n    name,\n    id,\n    description,\n    aliases,\n    ExtensionID,\n    ext,\n    props,\n    spec_version,\n    ['type'],\n    first_seen,\n    modified,\n    last_seen\n",
                    "outputStream": "Custom-CyfirmaCampaigns_CL"
                  },
                  {
                    "streams": [
                      "Custom-CyfirmaMalware_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n| extend\n    TimeGenerated=last_seen,\n    Name=name,\n    MalwareID=id,\n    Description=description,\n    Aliases=aliases,\n    Modified=modified,\n    FirstSeen=first_seen,\n    LastSeen=last_seen,\n    Created=created,\n    ThreatType=malware_types[0],\n    IsFamily=is_family\n| extend ParsedJson = parse_json(extensions)\n| extend ExtensionID = extract(@\"(extension-definition--[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\", 1, tostring(extensions))\n| extend ext = ParsedJson[ExtensionID]\n| extend props = ext.properties\n| extend \n    Countries = props[\"geographies\"],\n    Technologies = props[\"technologies\"]\n| project-away\n    ParsedJson,\n    created,\n    name,\n    id,\n    description,\n    aliases,\n    ExtensionID,\n    ext,\n    props,\n    spec_version,\n    ['type'],\n    first_seen,\n    modified,\n    last_seen,\n    malware_types,\n    is_family\n",
                    "outputStream": "Custom-CyfirmaMalware_CL"
                  }
                ]
              }
            },
            {
              "name": "CyfirmaIndicators_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CyfirmaIndicators_CL",
                  "columns": [
                    {
                      "name": "created",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "extensions",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "modified",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "name",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "pattern",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "valid_from",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ThreatType",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Tags",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ConfidenceScore",
                      "type": "int",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Description",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "IndicatorID",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ThreatActors",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Country",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "RecommendedActions",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "SecurityVendors",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Sources",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Roles",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "IPAbuse",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    }
                  ]
                }
              }
            },
            {
              "name": "CyfirmaCampaigns_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CyfirmaCampaigns_CL",
                  "columns": [
                    {
                      "name": "extensions",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Name",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "CampaignID",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Description",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Aliases",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Modified",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "FirstSeen",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "LastSeen",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Created",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Country",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Technologies",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Industries",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    }
                  ]
                }
              }
            },
            {
              "name": "CyfirmaThreatActors_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CyfirmaThreatActors_CL",
                  "columns": [
                    {
                      "name": "created",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "extensions",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "id",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "modified",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "name",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Aliases",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ThreatType",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "PrimaryMotivation",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Description",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Country",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TargetCountries",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TargetIndustries",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TargetTechnologies",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    }
                  ]
                }
              }
            },
            {
              "name": "CyfirmaMalware_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "CyfirmaMalware_CL",
                  "columns": [
                    {
                      "name": "extensions",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Name",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "MalwareID",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Description",
                      "type": "string",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Aliases",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Modified",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "FirstSeen",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "LastSeen",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Created",
                      "type": "datetime",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "ThreatType",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "IsFamily",
                      "type": "boolean",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Countries",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    },
                    {
                      "name": "Technologies",
                      "type": "dynamic",
                      "isDefaultDisplay": false,
                      "isHidden": false
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "CyfirmaCyberIntelligenceDC",
          "title": "CYFIRMA Cyber Intelligence",
          "publisher": "Microsoft",
          "isConnectivityCriteriasMatchSome": false,
          "descriptionMarkdown": "The CYFIRMA Cyber Intelligence data connector enables seamless log ingestion from the DeCYFIR API into Microsoft Sentinel. Built on the Microsoft Sentinel Codeless Connector Platform, it leverages the DeCYFIR Alerts API to retrieve logs. Additionally, it supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview), which parse security data into a custom table during ingestion. This eliminates the need for query-time parsing, enhancing performance and efficiency.",
          "graphQueries": [
            {
              "metricName": "Total Indicators logs received",
              "legend": "Indicators Logs",
              "baseQuery": "CyfirmaIndicators_CL"
            },
            {
              "metricName": "Total Threat Actors logs received",
              "legend": "Threat Actors Logs",
              "baseQuery": "CyfirmaThreatActors_CL"
            },
            {
              "metricName": "Total Campaigns logs received",
              "legend": "Campaigns Logs",
              "baseQuery": "CyfirmaCampaigns_CL"
            },
            {
              "metricName": "Total Malware logs received",
              "legend": "Malware Logs",
              "baseQuery": "CyfirmaMalware_CL"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get Sample of Indicators logs",
              "query": "CyfirmaIndicators_CL | take 10"
            },
            {
              "description": "Get Sample of Threat Actors logs",
              "query": "CyfirmaThreatActors_CL | take 10"
            },
            {
              "description": "Get Sample of Campaigns logs",
              "query": "CyfirmaCampaigns_CL | take 10"
            },
            {
              "description": "Get Sample of Malware logs",
              "query": "CyfirmaMalware_CL | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "CyfirmaIndicators_CL",
              "lastDataReceivedQuery": "CyfirmaIndicators_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
            },
            {
              "name": "CyfirmaThreatActors_CL",
              "lastDataReceivedQuery": "CyfirmaThreatActors_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
            },
            {
              "name": "CyfirmaCampaigns_CL",
              "lastDataReceivedQuery": "CyfirmaCampaigns_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
            },
            {
              "name": "CyfirmaMalware_CL",
              "lastDataReceivedQuery": "CyfirmaMalware_CL\n | where TimeGenerated > ago(5m) | summarize Time = max(TimeGenerated)\n  | where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "read": true,
                  "write": true,
                  "delete": true,
                  "action": false
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "CYFIRMA Cyber Intelligence",
              "description": "This connector provides the Indicators, Threat actors, Malware and Campaigns logs from CYFIRMA Cyber Intelligence. The connector uses the DeCYFIR API to retrieve logs and supports DCR-based ingestion time transformations, parsing security data into a custom table during ingestion. This eliminates the need for query-time parsing, enhancing performance and efficiency.",
              "descriptionMarkdown": "This connector provides the Indicators, Threat actors, Malware and Campaigns logs from CYFIRMA Cyber Intelligence. The connector uses the DeCYFIR API to retrieve logs and supports DCR-based ingestion time transformations, parsing security data into a custom table during ingestion. This eliminates the need for query-time parsing, enhancing performance and efficiency.",
              "estimatedTime": "5 minutes",
              "icon": "https://www.microsoft.com/favicon.ico",
              "instructions": [
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "CYFIRMA API URL",
                    "placeholder": "https://decyfir.cyfirma.com",
                    "type": "text",
                    "name": "cyfirmaAPIURL"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "CYFIRMA API Key",
                    "placeholder": "CYFIRMA API Key",
                    "type": "password",
                    "name": "cyfirmaAPIKey"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Pull all IoC's Or Tailored IoC's",
                    "placeholder": "All IoC's or Tailored IoC's",
                    "type": "text",
                    "name": "apiAll",
                    "defaultValue": "false",
                    "description": "Set to true to pull all IoC's, set to false to pull tailoried IoC's"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API Delta",
                    "placeholder": "API Delta",
                    "type": "text",
                    "name": "apiDelta",
                    "defaultValue": "false",
                    "description": "Setting it to true returns only data added since the last API call, while false returns data from the last 24 hours."
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Recommended Actions",
                    "placeholder": "Recommended Action can be any one of:All/Monitor/Block",
                    "type": "text",
                    "name": "recommendedActions",
                    "defaultValue": "All",
                    "description": "Recommended Action can be any one of:All/Monitor/Block"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Threat Actor Associated",
                    "placeholder": "Is any Threat Actor Associated with the IoC's",
                    "type": "text",
                    "name": "isThreatActorExists",
                    "defaultValue": "false",
                    "description": "Is any Threat Actor Associated with the IoC's"
                  }
                },
                {
                  "type": "ConnectionToggleButton",
                  "parameters": {
                    "connectLabel": "Connect",
                    "name": "toggle"
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Microsoft"
        },
        "support": {
          "name": "CYFIRMA",
          "email": "support@cyfirma.com",
          "tier": "Partner",
          "link": "https://www.cyfirma.com/contact-us/"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "CYFIRMA Cyber Intelligence",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "CYFIRMA Cyber Intelligence",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "cyfirmaAPIURL": {
              "defaultValue": "cyfirmaAPIURL",
              "type": "securestring",
              "minLength": 1
            },
            "cyfirmaAPIKey": {
              "defaultValue": "cyfirmaAPIKey",
              "type": "securestring",
              "minLength": 1
            },
            "apiAll": {
              "defaultValue": "apiAll",
              "type": "securestring",
              "minLength": 1
            },
            "apiDelta": {
              "defaultValue": "apiDelta",
              "type": "securestring",
              "minLength": 1
            },
            "recommendedActions": {
              "defaultValue": "recommendedActions",
              "type": "securestring",
              "minLength": 1
            },
            "isThreatActorExists": {
              "defaultValue": "isThreatActorExists",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Microsoft"
                },
                "support": {
                  "name": "CYFIRMA",
                  "email": "support@cyfirma.com",
                  "tier": "Partner",
                  "link": "https://www.cyfirma.com/contact-us/"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'CyfirmaIoCPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "displayName": "",
                "connectorDefinitionName": "CyfirmaCyberIntelligenceDC",
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('cyfirmaAPIKey')]",
                  "ApiKeyName": "key"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('cyfirmaAPIURL'),'/core/api-ua/stix-v2.1/v2/ioc')]",
                  "httpMethod": "GET",
                  "headers": {
                    "Accept": "application/json"
                  },
                  "queryTimeFormat": "UnixTimestampInMills",
                  "queryWindowInMin": 5,
                  "logResponseContent": true,
                  "queryParameters": {
                    "product-name": "MS_AZURE_DC",
                    "delta": "[[parameters('apiDelta')]",
                    "all": "[[parameters('apiAll')]",
                    "key": "[[parameters('cyfirmaAPIKey')]",
                    "recommended-actions": "[[parameters('recommendedActions')]",
                    "is-threat-actor-exists": "[[parameters('isThreatActorExists')]"
                  }
                },
                "response": {
                  "EventsJsonPaths": [
                    "$"
                  ],
                  "format": "json",
                  "SuccessStatusValue": "success"
                },
                "dcrConfig": {
                  "streamName": "Custom-CyfirmaIndicators_CL",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'CyfirmaThreatActorPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "displayName": "",
                "connectorDefinitionName": "CyfirmaCyberIntelligenceDC",
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('cyfirmaAPIKey')]",
                  "ApiKeyName": "key"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('cyfirmaAPIURL'),'/core/api-ua/threatactor/ctc/stix/v2.1')]",
                  "httpMethod": "GET",
                  "headers": {
                    "Accept": "application/json"
                  },
                  "queryTimeFormat": "UnixTimestampInMills",
                  "queryWindowInMin": 1440,
                  "logResponseContent": true,
                  "queryParameters": {
                    "product-name": "MS_AZURE_DC",
                    "key": "[[parameters('cyfirmaAPIKey')]"
                  }
                },
                "response": {
                  "EventsJsonPaths": [
                    "$"
                  ],
                  "format": "json",
                  "SuccessStatusValue": "success"
                },
                "dcrConfig": {
                  "streamName": "Custom-CyfirmaThreatActors_CL",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'CyfirmaCampaignsPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "displayName": "",
                "connectorDefinitionName": "CyfirmaCyberIntelligenceDC",
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('cyfirmaAPIKey')]",
                  "ApiKeyName": "key"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('cyfirmaAPIURL'),'/core/api-ua/campaigns/stix/v2.1')]",
                  "httpMethod": "GET",
                  "headers": {
                    "Accept": "application/json"
                  },
                  "queryTimeFormat": "UnixTimestampInMills",
                  "queryWindowInMin": 1440,
                  "logResponseContent": true,
                  "queryParameters": {
                    "product-name": "MS_AZURE_DC",
                    "key": "[[parameters('cyfirmaAPIKey')]"
                  }
                },
                "response": {
                  "EventsJsonPaths": [
                    "$"
                  ],
                  "format": "json",
                  "SuccessStatusValue": "success"
                },
                "dcrConfig": {
                  "streamName": "Custom-CyfirmaCampaigns_CL",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'CyfirmaMalwaresPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "displayName": "",
                "connectorDefinitionName": "CyfirmaCyberIntelligenceDC",
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('cyfirmaAPIKey')]",
                  "ApiKeyName": "key"
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('cyfirmaAPIURL'),'/core/api-ua/malwares/ctc/stix/v2.1')]",
                  "httpMethod": "GET",
                  "headers": {
                    "Accept": "application/json"
                  },
                  "queryTimeFormat": "UnixTimestampInMills",
                  "queryWindowInMin": 1440,
                  "logResponseContent": true,
                  "queryParameters": {
                    "product-name": "MS_AZURE_DC",
                    "key": "[[parameters('cyfirmaAPIKey')]"
                  }
                },
                "response": {
                  "EventsJsonPaths": [
                    "$"
                  ],
                  "format": "json",
                  "SuccessStatusValue": "success"
                },
                "dcrConfig": {
                  "streamName": "Custom-CyfirmaMalware_CL",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.1",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Cyfirma Cyber Intelligence",
        "publisherDisplayName": "CYFIRMA",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Cyfirma%20Cyber%20Intelligence/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The CYFIRMA Cyber Intelligence solution integrates with Microsoft Sentinel to provide actionable intelligence on IOCs, threat actors, malicious campaigns, and malware. This integration enables security teams to detect, analyze, and respond to emerging threats by correlating external threat data with internal telemetry. By ingesting enriched threat intelligence into Sentinel, organizations gain visibility into malicious activity, track threat actor tactics, and automate defense mechanisms to mitigate risks proactively.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Analytic Rules:</strong> 36</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Cyfirma_logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Cyfirma Cyber Intelligence",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft"
        },
        "support": {
          "name": "CYFIRMA",
          "email": "support@cyfirma.com",
          "tier": "Partner",
          "link": "https://www.cyfirma.com/contact-us/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject8')._analyticRulecontentId8]",
              "version": "[variables('analyticRuleObject8').analyticRuleVersion8]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject9')._analyticRulecontentId9]",
              "version": "[variables('analyticRuleObject9').analyticRuleVersion9]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject10')._analyticRulecontentId10]",
              "version": "[variables('analyticRuleObject10').analyticRuleVersion10]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject11')._analyticRulecontentId11]",
              "version": "[variables('analyticRuleObject11').analyticRuleVersion11]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject12')._analyticRulecontentId12]",
              "version": "[variables('analyticRuleObject12').analyticRuleVersion12]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject13')._analyticRulecontentId13]",
              "version": "[variables('analyticRuleObject13').analyticRuleVersion13]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject14')._analyticRulecontentId14]",
              "version": "[variables('analyticRuleObject14').analyticRuleVersion14]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject15')._analyticRulecontentId15]",
              "version": "[variables('analyticRuleObject15').analyticRuleVersion15]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject16')._analyticRulecontentId16]",
              "version": "[variables('analyticRuleObject16').analyticRuleVersion16]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject17')._analyticRulecontentId17]",
              "version": "[variables('analyticRuleObject17').analyticRuleVersion17]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject18')._analyticRulecontentId18]",
              "version": "[variables('analyticRuleObject18').analyticRuleVersion18]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject19')._analyticRulecontentId19]",
              "version": "[variables('analyticRuleObject19').analyticRuleVersion19]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject20')._analyticRulecontentId20]",
              "version": "[variables('analyticRuleObject20').analyticRuleVersion20]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject21')._analyticRulecontentId21]",
              "version": "[variables('analyticRuleObject21').analyticRuleVersion21]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject22')._analyticRulecontentId22]",
              "version": "[variables('analyticRuleObject22').analyticRuleVersion22]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject23')._analyticRulecontentId23]",
              "version": "[variables('analyticRuleObject23').analyticRuleVersion23]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject24')._analyticRulecontentId24]",
              "version": "[variables('analyticRuleObject24').analyticRuleVersion24]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject25')._analyticRulecontentId25]",
              "version": "[variables('analyticRuleObject25').analyticRuleVersion25]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject26')._analyticRulecontentId26]",
              "version": "[variables('analyticRuleObject26').analyticRuleVersion26]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject27')._analyticRulecontentId27]",
              "version": "[variables('analyticRuleObject27').analyticRuleVersion27]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject28')._analyticRulecontentId28]",
              "version": "[variables('analyticRuleObject28').analyticRuleVersion28]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject29')._analyticRulecontentId29]",
              "version": "[variables('analyticRuleObject29').analyticRuleVersion29]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject30')._analyticRulecontentId30]",
              "version": "[variables('analyticRuleObject30').analyticRuleVersion30]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject31')._analyticRulecontentId31]",
              "version": "[variables('analyticRuleObject31').analyticRuleVersion31]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject32')._analyticRulecontentId32]",
              "version": "[variables('analyticRuleObject32').analyticRuleVersion32]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject33')._analyticRulecontentId33]",
              "version": "[variables('analyticRuleObject33').analyticRuleVersion33]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject34')._analyticRulecontentId34]",
              "version": "[variables('analyticRuleObject34').analyticRuleVersion34]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject35')._analyticRulecontentId35]",
              "version": "[variables('analyticRuleObject35').analyticRuleVersion35]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject36')._analyticRulecontentId36]",
              "version": "[variables('analyticRuleObject36').analyticRuleVersion36]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            }
          ]
        },
        "firstPublishDate": "2025-05-15",
        "providers": [
          "CYFIRMA"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection",
            "Application",
            "Security - Automation (SOAR)",
            "Threat Intelligence"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
