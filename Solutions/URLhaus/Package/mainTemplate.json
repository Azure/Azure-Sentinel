{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for URLhaus"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-urlhaus",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "URLhausAPIConnector": "URLhausAPIConnector",
    "_URLhausAPIConnector": "[variables('URLhausAPIConnector')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "URLhausAPIConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "URLhaus-CheckHashAndEnrichIncident": "URLhaus-CheckHashAndEnrichIncident",
    "_URLhaus-CheckHashAndEnrichIncident": "[variables('URLhaus-CheckHashAndEnrichIncident')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "URLhaus-CheckHashAndEnrichIncident",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "URLhaus-CheckHostAndEnrichIncident": "URLhaus-CheckHostAndEnrichIncident",
    "_URLhaus-CheckHostAndEnrichIncident": "[variables('URLhaus-CheckHostAndEnrichIncident')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "URLhaus-CheckHostAndEnrichIncident",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
    "URLhaus-CheckURLAndEnrichIncident": "URLhaus-CheckURLAndEnrichIncident",
    "_URLhaus-CheckURLAndEnrichIncident": "[variables('URLhaus-CheckURLAndEnrichIncident')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "URLhaus-CheckURLAndEnrichIncident",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "properties": {
        "description": "URLhausAPIConnector",
        "displayName": "URLhausAPIConnector"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "URLhausAPIConnector Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "customApis_URLhaus": {
              "defaultValue": "URLhausAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the URLhaus Connector"
              }
            }
          },
          "variables": {
            "operationId-query_recent_urls": "query_recent_urls",
            "_operationId-query_recent_urls": "[[variables('operationId-query_recent_urls')]",
            "operationId-query_recent_payloads": "query_recent_payloads",
            "_operationId-query_recent_payloads": "[[variables('operationId-query_recent_payloads')]",
            "operationId-query_url_information": "query_url_information",
            "_operationId-query_url_information": "[[variables('operationId-query_url_information')]",
            "operationId-query_host_information": "query_host_information",
            "_operationId-query_host_information": "[[variables('operationId-query_host_information')]",
            "operationId-query_payload_information": "query_payload_information",
            "_operationId-query_payload_information": "[[variables('operationId-query_payload_information')]",
            "operationId-query_tag_information": "query_tag_information",
            "_operationId-query_tag_information": "[[variables('operationId-query_tag_information')]",
            "operationId-query_signature_information": "query_signature_information",
            "_operationId-query_signature_information": "[[variables('operationId-query_signature_information')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId": "URLhausAPIConnector",
            "playbookId": "[[resourceId('Microsoft.Web/customApis', parameters('customApis_URLhaus'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('customApis_URLhaus')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "brandColor": "#FFFFFF",
                "description": "Connector for URLhaus API",
                "displayName": "[[parameters('customApis_URLhaus')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkgAAAH2CAYAAACLNnM3AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAACSKADAAQAAAABAAAB9gAAAADxTki8AAA6UUlEQVR4Ae3dCdx053g/cBEJIoSEWCKLiDVI7YIg1FKiUVVEia1KqVpKqf4jlKKiYk0bWxqk9thqjSUEtQZFSskiEkIkCBFLEv/fFc+kk5MzZ7YzzzPP837vz+d6Z859n3Of+3xn3plr7nNmnktcQiFAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBA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gAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIECBAgAABAgQIbJoC/x/kUAZ7ICKcpAAAAABJRU5ErkJggg==",
                "backendService": {
                  "serviceUrl": "https://urlhaus-api.abuse.ch/v1/"
                },
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Default title",
                    "version": "1.0"
                  },
                  "host": "urlhaus-api.abuse.ch",
                  "basePath": "/v1/",
                  "schemes": [
                    "https"
                  ],
                  "paths": {
                    "/urls/recent/limit/{limit}": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_status": {
                                  "type": "string",
                                  "description": "query_status"
                                },
                                "urls": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string",
                                        "description": "id"
                                      },
                                      "urlhaus_reference": {
                                        "type": "string",
                                        "description": "urlhaus_reference"
                                      },
                                      "url": {
                                        "type": "string",
                                        "description": "url"
                                      },
                                      "url_status": {
                                        "type": "string",
                                        "description": "url_status"
                                      },
                                      "host": {
                                        "type": "string",
                                        "description": "host"
                                      },
                                      "date_added": {
                                        "type": "string",
                                        "description": "date_added"
                                      },
                                      "threat": {
                                        "type": "string",
                                        "description": "threat"
                                      },
                                      "blacklists": {
                                        "type": "object",
                                        "properties": {
                                          "spamhaus_dbl": {
                                            "type": "string",
                                            "description": "spamhaus_dbl"
                                          },
                                          "surbl": {
                                            "type": "string",
                                            "description": "surbl"
                                          }
                                        },
                                        "description": "blacklists"
                                      },
                                      "reporter": {
                                        "type": "string",
                                        "description": "reporter"
                                      },
                                      "larted": {
                                        "type": "string",
                                        "description": "larted"
                                      },
                                      "tags": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        },
                                        "description": "tags"
                                      }
                                    }
                                  },
                                  "description": "urls"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query recent URLs",
                        "description": "To retrieve a list of recent URLs (recent additions made to URLhaus), you must send a HTTP GET request to URLhaus. Please note that the API will return a list of recent additions made in the past 3 days, but will return maximal 1000 entries.",
                        "operationId": "[[variables('_operationId-query_recent_urls')]",
                        "parameters": [
                          {
                            "in": "path",
                            "name": "limit",
                            "type": "integer",
                            "maximum": 1000,
                            "default": 1000,
                            "required": true,
                            "description": "There is an additional (optional) parameter limit that you can use to limit the amount of results to a custom value (max 1000)"
                          }
                        ]
                      }
                    },
                    "/payloads/recent/limit/{limit}": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_status": {
                                  "type": "string",
                                  "description": "query_status"
                                },
                                "payloads": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "md5_hash": {
                                        "type": "string",
                                        "description": "md5_hash"
                                      },
                                      "sha256_hash": {
                                        "type": "string",
                                        "description": "sha256_hash"
                                      },
                                      "file_type": {
                                        "type": "string",
                                        "description": "file_type"
                                      },
                                      "file_size": {
                                        "type": "string",
                                        "description": "file_size"
                                      },
                                      "signature": {
                                        "type": "string",
                                        "description": "signature"
                                      },
                                      "firstseen": {
                                        "type": "string",
                                        "description": "firstseen"
                                      },
                                      "urlhaus_download": {
                                        "type": "string",
                                        "description": "urlhaus_download"
                                      },
                                      "virustotal": {
                                        "type": "string",
                                        "description": "virustotal"
                                      },
                                      "imphash": {
                                        "type": "string",
                                        "description": "imphash"
                                      },
                                      "ssdeep": {
                                        "type": "string",
                                        "description": "ssdeep"
                                      },
                                      "tlsh": {
                                        "type": "string",
                                        "description": "tlsh"
                                      }
                                    }
                                  },
                                  "description": "payloads"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query recent payloads",
                        "description": "To retrieve a list of recent payloads (recent payloads seen by URLhaus), you must send a HTTP GET request to URLhaus. Please note that the API will return a list of recent payloads from the past 3 days, but will return maximal 1000 entries.",
                        "operationId": "[[variables('_operationId-query_recent_payloads')]",
                        "parameters": [
                          {
                            "in": "path",
                            "name": "limit",
                            "type": "integer",
                            "maximum": 1000,
                            "default": 1000,
                            "required": true,
                            "description": "There is an additional (optional) parameter limit that you can use to limit the amount of results to a custom value (max 1000)"
                          }
                        ]
                      }
                    },
                    "/url/": {
                      "post": {
                        "consumes": [
                          "application/x-www-form-urlencoded"
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_status": {
                                  "type": "string",
                                  "description": "query_status"
                                },
                                "id": {
                                  "type": "string",
                                  "description": "id"
                                },
                                "urlhaus_reference": {
                                  "type": "string",
                                  "description": "urlhaus_reference"
                                },
                                "url": {
                                  "type": "string",
                                  "description": "url"
                                },
                                "url_status": {
                                  "type": "string",
                                  "description": "url_status"
                                },
                                "host": {
                                  "type": "string",
                                  "description": "host"
                                },
                                "date_added": {
                                  "type": "string",
                                  "description": "date_added"
                                },
                                "last_online": {
                                  "type": "string",
                                  "description": "last_online"
                                },
                                "threat": {
                                  "type": "string",
                                  "description": "threat"
                                },
                                "blacklists": {
                                  "type": "object",
                                  "properties": {
                                    "spamhaus_dbl": {
                                      "type": "string",
                                      "description": "spamhaus_dbl"
                                    },
                                    "surbl": {
                                      "type": "string",
                                      "description": "surbl"
                                    }
                                  },
                                  "description": "blacklists"
                                },
                                "reporter": {
                                  "type": "string",
                                  "description": "reporter"
                                },
                                "larted": {
                                  "type": "string",
                                  "description": "larted"
                                },
                                "takedown_time_seconds": {
                                  "type": "string",
                                  "description": "takedown_time_seconds"
                                },
                                "tags": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  },
                                  "description": "tags"
                                },
                                "payloads": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "firstseen": {
                                        "type": "string",
                                        "description": "firstseen"
                                      },
                                      "filename": {
                                        "type": "string",
                                        "description": "filename"
                                      },
                                      "file_type": {
                                        "type": "string",
                                        "description": "file_type"
                                      },
                                      "response_size": {
                                        "type": "string",
                                        "description": "response_size"
                                      },
                                      "response_md5": {
                                        "type": "string",
                                        "description": "response_md5"
                                      },
                                      "response_sha256": {
                                        "type": "string",
                                        "description": "response_sha256"
                                      },
                                      "urlhaus_download": {
                                        "type": "string",
                                        "description": "urlhaus_download"
                                      },
                                      "signature": {
                                        "type": "string",
                                        "description": "signature"
                                      },
                                      "virustotal": {
                                        "type": "string",
                                        "description": "virustotal"
                                      },
                                      "imphash": {
                                        "type": "string",
                                        "description": "imphash"
                                      },
                                      "ssdeep": {
                                        "type": "string",
                                        "description": "ssdeep"
                                      },
                                      "tlsh": {
                                        "type": "string",
                                        "description": "tlsh"
                                      }
                                    }
                                  },
                                  "description": "payloads"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query URL information",
                        "operationId": "[[variables('_operationId-query_url_information')]",
                        "description": "To retrieve information about an URL, you must send a HTTP POST request to URLhaus.",
                        "parameters": [
                          {
                            "in": "formData",
                            "name": "url",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "/host/": {
                      "post": {
                        "consumes": [
                          "application/x-www-form-urlencoded"
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_staus": {
                                  "type": "string",
                                  "description": "query_staus"
                                },
                                "urlhaus_reference": {
                                  "type": "string",
                                  "description": "urlhaus_reference"
                                },
                                "host": {
                                  "type": "string",
                                  "description": "host"
                                },
                                "firstseen": {
                                  "type": "string",
                                  "description": "firstseen"
                                },
                                "url_count": {
                                  "type": "string",
                                  "description": "url_count"
                                },
                                "blacklists": {
                                  "type": "object",
                                  "properties": {
                                    "spamhaus_dbl": {
                                      "type": "string",
                                      "description": "spamhaus_dbl"
                                    },
                                    "surbl": {
                                      "type": "string",
                                      "description": "surbl"
                                    }
                                  },
                                  "description": "blacklists"
                                },
                                "urls": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string",
                                        "description": "id"
                                      },
                                      "urlhaus_reference": {
                                        "type": "string",
                                        "description": "urlhaus_reference"
                                      },
                                      "url": {
                                        "type": "string",
                                        "description": "url"
                                      },
                                      "url_status": {
                                        "type": "string",
                                        "description": "url_status"
                                      },
                                      "date_added": {
                                        "type": "string",
                                        "description": "date_added"
                                      },
                                      "threat": {
                                        "type": "string",
                                        "description": "threat"
                                      },
                                      "reporter": {
                                        "type": "string",
                                        "description": "reporter"
                                      },
                                      "larted": {
                                        "type": "string",
                                        "description": "larted"
                                      },
                                      "takedown_time_seconds": {
                                        "type": "string",
                                        "description": "takedown_time_seconds"
                                      },
                                      "tags": {
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        },
                                        "description": "tags"
                                      }
                                    }
                                  },
                                  "description": "urls"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query host information",
                        "description": "To retrieve information about a host, you must send a HTTP POST request to URLhaus",
                        "operationId": "[[variables('_operationId-query_host_information')]",
                        "parameters": [
                          {
                            "in": "formData",
                            "name": "host",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "/payload/": {
                      "post": {
                        "consumes": [
                          "application/x-www-form-urlencoded"
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_status": {
                                  "type": "string",
                                  "description": "query_status"
                                },
                                "md5_hash": {
                                  "type": "string",
                                  "description": "md5_hash"
                                },
                                "sha256_hash": {
                                  "type": "string",
                                  "description": "sha256_hash"
                                },
                                "file_type": {
                                  "type": "string",
                                  "description": "file_type"
                                },
                                "file_size": {
                                  "type": "string",
                                  "description": "file_size"
                                },
                                "signature": {
                                  "type": "string",
                                  "description": "signature"
                                },
                                "firstseen": {
                                  "type": "string",
                                  "description": "firstseen"
                                },
                                "lastseen": {
                                  "type": "string",
                                  "description": "lastseen"
                                },
                                "urlhaus_download": {
                                  "type": "string",
                                  "description": "urlhaus_download"
                                },
                                "virustotal": {
                                  "type": "object",
                                  "properties": {
                                    "result": {
                                      "type": "string",
                                      "description": "result"
                                    },
                                    "percent": {
                                      "type": "string",
                                      "description": "percent"
                                    },
                                    "link": {
                                      "type": "string",
                                      "description": "link"
                                    }
                                  },
                                  "description": "virustotal"
                                },
                                "imphash": {
                                  "type": "string",
                                  "description": "imphash"
                                },
                                "ssdeep": {
                                  "type": "string",
                                  "description": "ssdeep"
                                },
                                "tlsh": {
                                  "type": "string",
                                  "description": "tlsh"
                                },
                                "urls": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "url_id": {
                                        "type": "string",
                                        "description": "url_id"
                                      },
                                      "url": {
                                        "type": "string",
                                        "description": "url"
                                      },
                                      "url_status": {
                                        "type": "string",
                                        "description": "url_status"
                                      },
                                      "urlhaus_reference": {
                                        "type": "string",
                                        "description": "urlhaus_reference"
                                      },
                                      "filename": {
                                        "type": "string",
                                        "description": "filename"
                                      },
                                      "firstseen": {
                                        "type": "string",
                                        "description": "firstseen"
                                      },
                                      "lastseen": {
                                        "type": "string",
                                        "description": "lastseen"
                                      }
                                    }
                                  },
                                  "description": "urls"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query payload information",
                        "description": "To retrieve information about a payload (malware sample) that URLhaus has retrieved, you must send a HTTP POST request to URLhaus",
                        "operationId": "[[variables('_operationId-query_payload_information')]",
                        "parameters": [
                          {
                            "in": "formData",
                            "name": "sha256_hash",
                            "type": "string"
                          },
                          {
                            "in": "formData",
                            "name": "md5_hash",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "/tag/": {
                      "post": {
                        "consumes": [
                          "application/x-www-form-urlencoded"
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_status": {
                                  "type": "string",
                                  "description": "query_status"
                                },
                                "firstseen": {
                                  "type": "string",
                                  "description": "firstseen"
                                },
                                "lastseen": {
                                  "type": "string",
                                  "description": "lastseen"
                                },
                                "url_count": {
                                  "type": "string",
                                  "description": "url_count"
                                },
                                "urls": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "url_id": {
                                        "type": "string",
                                        "description": "url_id"
                                      },
                                      "url": {
                                        "type": "string",
                                        "description": "url"
                                      },
                                      "url_status": {
                                        "type": "string",
                                        "description": "url_status"
                                      },
                                      "dateadded": {
                                        "type": "string",
                                        "description": "dateadded"
                                      },
                                      "reporter": {
                                        "type": "string",
                                        "description": "reporter"
                                      },
                                      "threat": {
                                        "type": "string",
                                        "description": "threat"
                                      },
                                      "urlhaus_reference": {
                                        "type": "string",
                                        "description": "urlhaus_reference"
                                      }
                                    }
                                  },
                                  "description": "urls"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query tag information",
                        "description": "To retrieve information about a tag, you must send a HTTP POST request to URLhaus",
                        "operationId": "[[variables('_operationId-query_tag_information')]",
                        "parameters": [
                          {
                            "in": "formData",
                            "name": "tag",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "/signature/": {
                      "post": {
                        "consumes": [
                          "application/x-www-form-urlencoded"
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "query_status": {
                                  "type": "string",
                                  "description": "query_status"
                                },
                                "firstseen": {
                                  "type": "string",
                                  "description": "firstseen"
                                },
                                "lastseen": {
                                  "type": "string",
                                  "description": "lastseen"
                                },
                                "url_count": {
                                  "type": "string",
                                  "description": "url_count"
                                },
                                "payload_count": {
                                  "type": "string",
                                  "description": "payload_count"
                                },
                                "urls": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "url_id": {
                                        "type": "string",
                                        "description": "url_id"
                                      },
                                      "url": {
                                        "type": "string",
                                        "description": "url"
                                      },
                                      "url_status": {
                                        "type": "string",
                                        "description": "url_status"
                                      },
                                      "firstseen": {
                                        "type": "string",
                                        "description": "firstseen"
                                      },
                                      "lastseen": {
                                        "type": "string",
                                        "description": "lastseen"
                                      },
                                      "filename": {
                                        "type": "string",
                                        "description": "filename"
                                      },
                                      "file_type": {
                                        "type": "string",
                                        "description": "file_type"
                                      },
                                      "file_size": {
                                        "type": "string",
                                        "description": "file_size"
                                      },
                                      "md5_hash": {
                                        "type": "string",
                                        "description": "md5_hash"
                                      },
                                      "sha256_hash": {
                                        "type": "string",
                                        "description": "sha256_hash"
                                      },
                                      "virustotal": {
                                        "type": "object",
                                        "properties": {
                                          "result": {
                                            "type": "string",
                                            "description": "result"
                                          },
                                          "percent": {
                                            "type": "string",
                                            "description": "percent"
                                          },
                                          "link": {
                                            "type": "string",
                                            "description": "link"
                                          }
                                        },
                                        "description": "virustotal"
                                      },
                                      "imphash": {
                                        "type": "string",
                                        "description": "imphash"
                                      },
                                      "ssdeep": {
                                        "type": "string",
                                        "description": "ssdeep"
                                      },
                                      "tlsh": {
                                        "type": "string",
                                        "description": "tlsh"
                                      },
                                      "urlhaus_reference": {
                                        "type": "string",
                                        "description": "urlhaus_reference"
                                      },
                                      "urlhaus_download": {
                                        "type": "string",
                                        "description": "urlhaus_download"
                                      }
                                    }
                                  },
                                  "description": "urls"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query signature information",
                        "description": "URLhaus tries to identify the malware family of a payload (malware sample) served by malware URLs. Unlink tags, the signature is something that the reporter of the malware URL can not influence. To retrieve information about a signature, you must send a HTTP POST request to URLhaus",
                        "operationId": "[[variables('_operationId-query_signature_information')]",
                        "parameters": [
                          {
                            "in": "formData",
                            "name": "signature",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "URLhaus",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "URLhaus-CheckHashAndEnrichIncident playbook",
        "displayName": "URLhaus-CheckHashAndEnrichIncident playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "URLhaus-CheckHashAndEnrichIncident Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "URLhaus-CheckHashAndEnrichIncident",
              "type": "String"
            },
            "customApis_URLhaus": {
              "defaultValue": "URLhausAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the URLhaus Connector"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "URLhausAPIConnectionName": "[[concat('urlhaus-connection-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_URLhaus'))]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('URLhausAPIConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('URLhausAPIConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('URLhausAPIConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Check_Results_Length": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Compose": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><span style=\"font-size: 14px\"><strong>URLhaus Hash Checking Results:<br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{outputs('Compose')}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Compose": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@body('Create_HTML_table')"
                        },
                        "Create_HTML_table": {
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('Result List')"
                          }
                        }
                      },
                      "runAfter": {
                        "Check_each_md5_hash_in_URLhaus": [
                          "Succeeded"
                        ],
                        "Check_each_sha256_hash_in_URLhaus": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('Result List'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Check_each_md5_hash_in_URLhaus": {
                      "foreach": "@body('Entities_-_Get_FileHashes')?['Filehashes']",
                      "actions": {
                        "Check_Query_Status(md5_hash)": {
                          "actions": {
                            "Append_to_array_variable(md5_hash)": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "Result List",
                                "value": {
                                  "file_size": "@body('Query_payload_information(md5_hash)')?['file_size']",
                                  "file_type": "@body('Query_payload_information(md5_hash)')?['file_type']",
                                  "firstseen": "@body('Query_payload_information(md5_hash)')?['firstseen']",
                                  "imphash": "@body('Query_payload_information(md5_hash)')?['imphash']",
                                  "lastseen": "@body('Query_payload_information(md5_hash)')?['lastseen']",
                                  "md5_hash": "@body('Query_payload_information(md5_hash)')?['md5_hash']",
                                  "sha256_hash": "@body('Query_payload_information(md5_hash)')?['sha256_hash']",
                                  "signature": "@body('Query_payload_information(md5_hash)')?['signature']",
                                  "ssdeep": "@body('Query_payload_information(md5_hash)')?['ssdeep']",
                                  "tlsh": "@body('Query_payload_information(md5_hash)')?['tlsh']",
                                  "url_count": "@body('Query_payload_information(md5_hash)')?['url_count']",
                                  "urlhaus_download": "@body('Query_payload_information(md5_hash)')?['urlhaus_download']",
                                  "virustotal": "@body('Query_payload_information(md5_hash)')?['virustotal']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Query_payload_information(md5_hash)": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@body('Query_payload_information(md5_hash)')?['query_status']",
                                  "ok"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Query_payload_information(md5_hash)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "$content-type": "multipart/form-data",
                              "$multipart": [
                                {
                                  "body": "@items('Check_each_md5_hash_in_URLhaus')?['Value']",
                                  "headers": {
                                    "Content-Disposition": "form-data; name=\"md5_hash\""
                                  }
                                }
                              ]
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['URLhausAPI']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/payload/"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_Results_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Check_each_sha256_hash_in_URLhaus": {
                      "foreach": "@body('Entities_-_Get_FileHashes')?['Filehashes']",
                      "actions": {
                        "Check_Query_Status(sha256_hash)": {
                          "actions": {
                            "Append_to_array_variable(sha256_hash)": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "Result List",
                                "value": {
                                  "file_size": "@body('Query_payload_information(sha256_hash)')?['file_size']",
                                  "file_type": "@body('Query_payload_information(sha256_hash)')?['file_type']",
                                  "firstseen": "@body('Query_payload_information(sha256_hash)')?['firstseen']",
                                  "imphash": "@body('Query_payload_information(sha256_hash)')?['imphash']",
                                  "lastseen": "@body('Query_payload_information(sha256_hash)')?['lastseen']",
                                  "md5_hash": "@body('Query_payload_information(sha256_hash)')?['md5_hash']",
                                  "sha256_hash": "@body('Query_payload_information(sha256_hash)')?['sha256_hash']",
                                  "signature": "@body('Query_payload_information(sha256_hash)')?['signature']",
                                  "ssdeep": "@body('Query_payload_information(sha256_hash)')?['ssdeep']",
                                  "tlsh": "@body('Query_payload_information(sha256_hash)')?['tlsh']",
                                  "url_count": "@body('Query_payload_information(sha256_hash)')?['url_count']",
                                  "urlhaus_download": "@body('Query_payload_information(sha256_hash)')?['urlhaus_download']",
                                  "virustotal": "@body('Query_payload_information(sha256_hash)')?['virustotal']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Query_payload_information(sha256_hash)": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@body('Query_payload_information(sha256_hash)')?['query_status']",
                                  "ok"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Query_payload_information(sha256_hash)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "$content-type": "multipart/form-data",
                              "$multipart": [
                                {
                                  "body": "@items('Check_each_sha256_hash_in_URLhaus')?['Value']",
                                  "headers": {
                                    "Content-Disposition": "form-data; name=\"sha256_hash\""
                                  }
                                }
                              ]
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['URLhausAPI']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/payload/"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_Results_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Entities_-_Get_FileHashes": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/filehash"
                      }
                    },
                    "Initialize_Results_List": {
                      "runAfter": {
                        "Entities_-_Get_FileHashes": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Result List",
                            "type": "array"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      },
                      "URLhausAPI": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('URLhausAPIConnectionName'))]",
                        "connectionName": "[[variables('URLhausAPIConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_URLhaus'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "URLhaus",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_URLhausAPIConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "URLhaus-CheckHashAndEnrichIncident",
            "description": "Once a new Microsoft Sentinel incident is created, this playbook gets triggered and performs the following actions:\n 1. [Gets Information](https://urlhaus-api.abuse.ch/#payloadinfo) from URLhaus by hashes, provided in the alert custom entities. \n 2. Enriches the incident with the obtained info.",
            "prerequisites": [
              "1. URLhausAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection..",
              "1.  Open playbook which has been deployed",
              "2.  Click API connection on left side blade",
              "3.  Click the Microsoft Sentinel connection resource",
              "4.  Click edit API connection",
              "5.  Click Authorize",
              "6.  Sign in",
              "7.  Click Save",
              "8.  Repeat steps for URLhausAPI connector API Connection",
              "**b. Configurations in Sentinel**",
              "1.  In Microsoft Sentinel, analytical rules should be configured to trigger an incident.",
              "2.  Configure the automation rules to trigger the playbook."
            ],
            "lastUpdateTime": "2022-08-11T12:00:00Z",
            "tags": [
              "Incident management"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "URLhaus-CheckHashAndEnrichIncident",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "URLhaus-CheckHostAndEnrichIncident playbook",
        "displayName": "URLhaus-CheckHostAndEnrichIncident playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "URLhaus-CheckHostAndEnrichIncident Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "URLhaus-CheckHostAndEnrichIncident",
              "type": "String"
            },
            "customApis_URLhaus": {
              "defaultValue": "URLhausAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the URLhaus Connector"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "URLhausAPIConnectionName": "[[concat('urlhaus-connection-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_URLhaus'))]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('URLhausAPIConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('URLhausAPIConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('URLhausAPIConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Check_Results_Length": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Compose": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><span style=\"font-size: 14px\"><strong>URLhaus URL Checking Results:</strong></span><br>\n@{outputs('Compose')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Compose": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@body('Create_HTML_table')"
                        },
                        "Create_HTML_table": {
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('Result List')"
                          }
                        }
                      },
                      "runAfter": {
                        "Check_each_Host_in_URLhaus": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('Result List'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Check_each_Host_in_URLhaus": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Condition": {
                          "actions": {
                            "Append_to_array_variable": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "Result List",
                                "value": {
                                  "blacklists": "@replace(replace(replace(string(body('Query_host_information')?['blacklists']),'{',''),'}',''),'\"','')",
                                  "firstseen": "@body('Query_host_information')?['firstseen']",
                                  "host": "@body('Query_host_information')?['host']",
                                  "url_count": "@body('Query_host_information')?['url_count']",
                                  "urlhaus_reference": "@body('Query_host_information')?['urlhaus_reference']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Query_host_information": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@body('Query_host_information')?['query_status']",
                                  "ok"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Query_host_information": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "$content-type": "multipart/form-data",
                              "$multipart": [
                                {
                                  "body": "@items('Check_each_Host_in_URLhaus')?['HostName']",
                                  "headers": {
                                    "Content-Disposition": "form-data; name=\"host\""
                                  }
                                }
                              ]
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['URLhausAPI']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/host/"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_Results_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Entities_-_Get_Hosts": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "Initialize_Results_List": {
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Result List",
                            "type": "array"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      },
                      "URLhausAPI": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('URLhausAPIConnectionName'))]",
                        "connectionName": "[[variables('URLhausAPIConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_URLhaus'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "URLhaus",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_URLhausAPIConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "URLhaus-CheckHostAndEnrichIncident",
            "description": "Once a new Microsoft Sentinel incident is created, this playbook gets triggered and performs the following actions:\n 1. [Gets Information](https://urlhaus-api.abuse.ch/#payloadinfo) from URLhaus by hashes, provided in the alert custom entities. \n 2. Enriches the incident with the obtained info.",
            "prerequisites": [
              "1. URLhausAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection..",
              "1.  Open playbook which has been deployed",
              "2.  Click API connection on left side blade",
              "3.  Click the Microsoft Sentinel connection resource",
              "4.  Click edit API connection",
              "5.  Click Authorize",
              "6.  Sign in",
              "7.  Click Save",
              "8.  Repeat steps for URLhausAPI connector API Connection",
              "**b. Configurations in Sentinel**",
              "1.  In Microsoft Sentinel, analytical rules should be configured to trigger an incident.",
              "2.  Configure the automation rules to trigger the playbook."
            ],
            "lastUpdateTime": "2022-08-11T12:00:00Z",
            "tags": [
              "Incident management"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "URLhaus-CheckHostAndEnrichIncident",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "URLhaus-CheckURLAndEnrichIncident playbook",
        "displayName": "URLhaus-CheckURLAndEnrichIncident playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName4'),'/',variables('playbookVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "URLhaus-CheckURLAndEnrichIncident Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "URLhaus-CheckURLAndEnrichIncident",
              "type": "String"
            },
            "customApis_URLhaus": {
              "defaultValue": "URLhausAPI",
              "type": "string",
              "metadata": {
                "description": "Name of the URLhaus Connector"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "URLhausAPIConnectionName": "[[concat('urlhaus-connection-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_URLhaus'))]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('URLhausAPIConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('URLhausAPIConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('URLhausAPIConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Check_Results_Length": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Compose": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><span style=\"font-size: 14px\"><strong>URLhaus URL Checking Results:<br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{outputs('Compose')}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Compose": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@body('Create_HTML_table')"
                        },
                        "Create_HTML_table": {
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('Result List')"
                          }
                        }
                      },
                      "runAfter": {
                        "Check_each_URL_in_URLhaus": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('Result List'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Check_each_URL_in_URLhaus": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Check_Query_Status": {
                          "actions": {
                            "Append_to_array_variable": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "Result List",
                                "value": {
                                  "blacklists": "@replace(replace(replace(string(body('Query_URL_information')?['blacklists']),'{',''),'}',''),'\"','')",
                                  "date_added": "@body('Query_URL_information')?['date_added']",
                                  "host": "@body('Query_URL_information')?['host']",
                                  "id": "@body('Query_URL_information')?['id']",
                                  "last_online": "@body('Query_URL_information')?['last_online']",
                                  "reporter": "@body('Query_URL_information')?['reporter']",
                                  "tags": "@replace(replace(string(body('Query_URL_information')?['tags']),'[',''),']','')",
                                  "threat": "@body('Query_URL_information')?['threat']",
                                  "url": "@body('Query_URL_information')?['url']",
                                  "url_status": "@body('Query_URL_information')?['url_status']",
                                  "urlhaus_reference": "@body('Query_URL_information')?['urlhaus_reference']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Query_URL_information": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@body('Query_URL_information')?['query_status']",
                                  "ok"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Query_URL_information": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "$content-type": "multipart/form-data",
                              "$multipart": [
                                {
                                  "body": "@items('Check_each_URL_in_URLhaus')?['Url']",
                                  "headers": {
                                    "Content-Disposition": "form-data; name=\"url\""
                                  }
                                }
                              ]
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['URLhausAPI']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/url/"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_Results_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "Initialize_Results_List": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Result List",
                            "type": "array"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      },
                      "URLhausAPI": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('URLhausAPIConnectionName'))]",
                        "connectionName": "[[variables('URLhausAPIConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_URLhaus'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "URLhaus",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_URLhausAPIConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "URLhaus-CheckURLAndEnrichIncident",
            "description": "Once a new Microsoft Sentinel incident is created, this playbook gets triggered and performs the following actions:\n 1. [Gets Information](https://urlhaus-api.abuse.ch/#payloadinfo) from URLhaus by hashes, provided in the alert custom entities. \n 2. Enriches the incident with the obtained info.",
            "prerequisites": [
              "1. URLhausAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection..",
              "1.  Open playbook which has been deployed",
              "2.  Click API connection on left side blade",
              "3.  Click the Microsoft Sentinel connection resource",
              "4.  Click edit API connection",
              "5.  Click Authorize",
              "6.  Sign in",
              "7.  Click Save",
              "8.  Repeat steps for URLhausAPI connector API Connection",
              "**b. Configurations in Sentinel**",
              "1.  In Microsoft Sentinel, analytical rules should be configured to trigger an incident.",
              "2.  Configure the automation rules to trigger the playbook."
            ],
            "lastUpdateTime": "2022-08-11T12:00:00Z",
            "tags": [
              "Incident management"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "URLhaus-CheckURLAndEnrichIncident",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "URLhaus",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_URLhausAPIConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_URLhaus-CheckHashAndEnrichIncident')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_URLhaus-CheckHostAndEnrichIncident')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_URLhaus-CheckURLAndEnrichIncident')]",
              "version": "[variables('playbookVersion4')]"
            }
          ]
        },
        "firstPublishDate": "2022-09-29",
        "providers": [
          "Microsoft"
        ],
        "categories": {
          "domains": [
            "Security - Threat Intelligence",
            "Security  Automation (SOAR)"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
