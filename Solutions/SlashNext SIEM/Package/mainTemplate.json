{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "SlashNext - support@slashnext.net",
    "comments": "Solution template for SlashNext SIEM"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@slashnext.net",
    "_email": "[variables('email')]",
    "_solutionName": "SlashNext SIEM",
    "_solutionVersion": "3.0.0",
    "solutionId": "azuresentinelslashnext.slashnext-security-events-for-microsoft-sentinel",
    "_solutionId": "[variables('solutionId')]",
    "SlashNextEventConnector": "SlashNextEventConnector",
    "_SlashNextEventConnector": "[variables('SlashNextEventConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "blanks": "[replace('b', 'b', '')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "SlashNextEventConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "SlashNextSecurityEventForMSSentinel": "SlashNextSecurityEventForMSSentinel",
    "_SlashNextSecurityEventForMSSentinel": "[variables('SlashNextSecurityEventForMSSentinel')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "SlashNextSecurityEventForMSSentinel",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlashNextEventConnector Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "slashnext_connection": {
              "type": "string",
              "defaultValue": "SlashNext-CMS"
            }
          },
          "variables": {
            "operationId-Listing": "Listing",
            "_operationId-Listing": "[[variables('operationId-Listing')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "SlashNextEventConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('slashnext_connection'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('slashnext_connection')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "API Key",
                      "description": "The API key used to authenticate with SlashNext cloud.",
                      "tooltip": "Provide your API key. If you don't have a valid API key, please reach us at support@slashnext.com or visit www.slashnext.com",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "backendService": {
                  "serviceUrl": "https://siemapis.slashnext.cloud"
                },
                "brandColor": "#FFFFFF",
                "description": "This is SlashNext SEIM integration connector to get incidents of a customer against it's api key",
                "displayName": "SlashNext",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOYAAADmCAIAAABOCG7sAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAA5qADAAQAAAABAAAA5gAAAACKLWacAAAYuUlEQVR4Ae2dedxWw/vHs+8ie9mj7GTJUl6obCklP4SiSMoeWUq0UPbyQiIqUSGyRL5ZsmaXLWuyRNnJvvP7vX9NruY7c8657+d+lnqe87n/eJ45c66Zc+73ue4511xzzUytWvqIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIQDUlULdu3VtuueWTTz754osv7r777oYNG1bTL6LbzgWBevXqff311//rfX755Zdtt902F19eX7I6Erj11ls9dZ2ffOaZZ6rjd9E954LAZ599FqvsX3/9tdhii+Xi+1fJl1y8Sq6ii4hAhRGQylYYSip67LHH4uqef/55mt44XzkisPAJ0P366quvfNtA3a+F/1TyfAerrLLKBhtskE1g7bXXHj169KxZs7BrJ0yYsOmmm2bLr7XWWhTJltFZESgzga233vrZZ591zeeXX3557LHHlrmKqECLFi1mzJjh6pw5c+a+++4biShDBEoisP7663/33Xf+65509+7dS6psfqGmTZv+/ffffp3//PPPnnvuWZ46VVYE5hO44YYbfN1y6R9//BFVLpkRztq4zhdffLHkClVQBBYQeP3112P1Iue+++5bIFSW1JJLLvn777/Hdf75559LL710WWqSrAgkEcB1FauXyznkkEOSShTOwyCO6/z2228Ll8y9hPyyhVVg4sSJaUI33XRTad2mxDpLbrbTbk/5NZnARhtt1Lhx4+WWWy7+kkssscTkyZPjRtHl0G0aOnToTjvthJgru+qqq24377PUUkvFtbkc/GVvvvmmX+c777xTp06dWB4rgsCaLbfc0uqPZZSTLwJoqmnPH3/8MWDAALQkQECQAI6tO+6446233vrggw9oIx944IGXXnrJ7/X/9NNPBBzSLbPM77//vkuXLkFVdrjsssueeeaZtKz333//2Wefnfhr6dy589y5c51mf/755+3atbPiSuSUAL1+FMtv7UgPHDiwSByrr756r1696DYFNfiHRxxxRJG1BWKHHnqoXw9pWvS99torENNhvghcc801gVpwSOzVyiuvXDyI3XbbLbE75Wr+8MMPi6/Kl7SBBv8Op06d6ssonTsCif5RVARXf5lY7LjjjpgEvm75aazbMtWG8EorreTXYOmff/65rFXVMPm8ewyIBEh8omn5icJkYtceeeSRiWdRsh9++CHxVEYmlnFiKSzajFI6VfMJHH744daAWWLatGmlfXMXZ2j1uARTwUqrbdSoUUFVHF588cWl1aZSNYfAdddd52sGMw232GKL+Ovx6u/du/dll11GryjN37TMMstMmTLFr+3VV19NdF25+rfffvuj53122GGH+Io4wl5++WW/tscffxw/QyyZqxxN8Pj/x81wQKtWrej+oyLDhw/HhxAowaWXXtqzZ0+bD4MZgDwurUCMQ2RwERDgwtArhvLIkSPxJ8Ri+NFwNdBvs1O00HgqAmHE8HM1adKEHuETTzwxZswYNNiK5DMhlS383A877LDbbrstkMM126ZNmyCz+MOOHTvGzq/x48djDBRfST4lpbKFn/ukSZNatmwZy/HGx88f5GMzNGrUaN1116WVpQ/3yiuv0JEKZDgkDHzNNdcM8okxSOvDBZJ5PgyHefLMIu27M5abeIoZCr7KMrmgT58+9Od845WILQZ7+/fvj+5aJag1RogdWoKCKDojcJajREwg706umEicM3369DgT45KoAMs/+OCD33vvvRNPPNHXV87SIcN+wAUxaNCgxRefT5sR3dmzZ1tZS8yZM0f6ajTSElLZNDIL8jExGSldcDwvNWTIkN9++81ldurUifCDFVdcMZCxQ/pkdLZGjBhhObfffrulLZGYaWeVcATmBx8JRwaBt99+m8Gw+vXrmwyrGBGh4lpELNd77703jqRBGFuWAWEmjW222WbLL788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8z7EVLhQLzpkLN1MSEZa8UUnfyEbBj4IGgC8hgD1M4tPM3hD34X+kw3zxGWxDbAZjj/++OJV1m3uVUKrFl89O4evT0AZnT9e31g4GLjZ8mU6i33cu3dvVwTjFZeIS2P2NGjQgOgcPC0IAKfkzczKdD/lEa46vywj9dn+P54Tn+wR3YyvyggFg6ujR4/OkHGdsPbt27tRdSS5JXpXGUXc2ZLvKqPm+BR+q6OPPhrd5RSj/7FAaTlYq7xe3AgwAzq+2YrHhh85ng1qZkQDra3sEY3SvoJfqupUFncsLgIcAonuTEZTGVHE3oo7+/7tpqV5cdPp5n3qPPNpYuTT0LIREp0w0rRnGKl0+2h341BdBAg+pCdE94heS0adFXiKrh4WQsEK0T/cCxkf03jsJfy+derUoc5Zs2axTa77Sdgl8NOhxG58AYzOZWtnc53An0WAPbzwCfDLZsoAxGnteDExLkXoCadifS2y+0XsKcXpHxRE7DphFhLK4AIPkrI43mlx6VqxLz0PGBcB2szV6VnTKvvVVlL3yy6BknF73JL7+I0iP+x/swv8txBvBmOdKP4BjHi7SpBga2nrivE+DM66w0Wk+5V4b5WYyePHJxDzRmXxg8YXRmmwbnnjp33q1q1bVldAoN8U79evn1Pc4MZwjeHHCO6qslWWy2Fc8sXdzZRHZelm2TcKHH/Bl6LZ5ifqtJbBSGyJQIDDRURlKzLCLf6SaTkQoRlj3IUpAHgJsBTxQyXuLci0rYw95Kkf/aPXxS9h6tSpxfjtKYLFHMvzzBjkZO4XvwEsPCK8CLZyo/DBt2A6CkMM9GBQ6OBUcEhkY8eOHfEKT5s2zZ1ivNq1YZS1PlBQyh0ywuIidbgNBrpdJg1wz549E+WDTGxWqDLPwplhdKoKeqOxl4DJq4+qcEIzPSEYX4AMHUTO4iPDwx1cscoOF47KVtnX04XKRICYZjobbqIEDi9ChRin5FOwh1Cmq5RTWCpbToA1rTjGPcEe9DuZnWvhYDgfiRxy6kuCWIjEV2LVsJDKVg3n6ncV9BXLjXaXDxrMBy8E25kzHs4IoraMrH5PVHcsAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAiIgAjWWwP8BIbRNsbNUaBAAAAAASUVORK5CYII=",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "version": "1.0.0",
                    "title": "SlashNext-CMS",
                    "description": "SlashNext "
                  },
                  "host": "siemapis.slashnext.cloud",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": [
                    "application/json"
                  ],
                  "paths": {
                    "/api/integration/v7/incidents/list": {
                      "post": {
                        "summary": "Events list",
                        "description": "This will get list of incidents of a customer",
                        "operationId": "[[variables('_operationId-Listing')]",
                        "parameters": [
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "rpp": {
                                  "type": "integer",
                                  "description": "rpp"
                                },
                                "page": {
                                  "type": "integer",
                                  "description": "page"
                                },
                                "filters": {
                                  "type": "array",
                                  "description": "filters",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "time": {
                                        "type": "string",
                                        "description": "time"
                                      },
                                      "vector": {
                                        "type": "array",
                                        "description": "vector",
                                        "items": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  }
                                },
                                "sortby": {
                                  "type": "string"
                                },
                                "sortorder": {
                                  "type": "string"
                                }
                              },
                              "default": {
                                "rpp": 10,
                                "page": 1,
                                "filters": [
                                  {
                                    "time": "[variables('blanks')]"
                                  },
                                  {
                                    "vector": "[variables('TemplateEmptyArray')]"
                                  }
                                ],
                                "sortby": "time",
                                "sortorder": "desc"
                              }
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "message": {
                                  "type": "string",
                                  "description": "message"
                                },
                                "code": {
                                  "type": "integer",
                                  "description": "code"
                                },
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "totalitems": {
                                      "type": "integer",
                                      "description": "totalitems"
                                    },
                                    "items": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "id": {
                                            "type": "integer",
                                            "description": "id"
                                          },
                                          "fullname": {
                                            "type": "string",
                                            "description": "fullname"
                                          },
                                          "email": {
                                            "type": "string",
                                            "description": "email"
                                          },
                                          "groupname": {
                                            "type": "string",
                                            "description": "groupname"
                                          },
                                          "totalincidents": {
                                            "type": "string",
                                            "description": "totalincidents"
                                          },
                                          "threatname": {
                                            "type": "string",
                                            "description": "threatname"
                                          },
                                          "threattypeText": {
                                            "type": "string",
                                            "description": "threattypeText"
                                          },
                                          "incidenttime": {
                                            "type": "string",
                                            "description": "incidenttime"
                                          },
                                          "loggingaction": {
                                            "type": "string",
                                            "description": "loggingaction"
                                          },
                                          "eptypeText": {
                                            "type": "string",
                                            "description": "eptypeText"
                                          },
                                          "phishingUrl": {
                                            "type": "string",
                                            "description": "phishingUrl"
                                          },
                                          "infectionvector": {
                                            "type": "string",
                                            "description": "infectionvector"
                                          },
                                          "threattype": {
                                            "type": "string",
                                            "description": "threattype"
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "securityDefinitions": {
                    "api_key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "apikey"
                    }
                  },
                  "security": "[variables('TemplateEmptyArray')]",
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "SlashNext SIEM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SlashNext",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "SlashNext",
                  "email": "support@slashnext.com",
                  "tier": "Partner",
                  "link": "https://slashnext.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "SlashNextEventConnector",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "SlashNextSecurityEventsforMicrosoftSentinel Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "Playbook Name": {
              "defaultValue": "SlashNextSecurityEventsforMicrosoftSentinel",
              "type": "String"
            },
            "Storage Account Name": {
              "type": "String",
              "metadata": {
                "description": "Name of Storage account to be created."
              }
            },
            "Storage Key": {
              "type": "secureString",
              "metadata": {
                "description": "Primary or secondary key of storage account"
              }
            },
            "Process x weeks Data": {
              "metadata": {
                "description": "Previous week from which scanning should start."
              },
              "type": "int",
              "defaultValue": 5
            },
            "Workspace ID": {
              "type": "String",
              "metadata": {
                "description": "Log analytic workspace ID"
              }
            },
            "Workspace Key": {
              "type": "secureString",
              "metadata": {
                "description": "Primary or secondary key of storage account"
              }
            },
            "Enable Email Incident": {
              "type": "bool",
              "metadata": {
                "description": "Enable email incidents logging."
              },
              "allowedValues": [
                true,
                false
              ],
              "defaultValue": true
            },
            "Enable Web Incident": {
              "type": "bool",
              "metadata": {
                "description": "Enable web incidents logging."
              },
              "allowedValues": [
                true,
                false
              ],
              "defaultValue": true
            },
            "Enable SMS Incident": {
              "type": "bool",
              "metadata": {
                "description": "Enable sms/mobile incidents logging."
              },
              "allowedValues": [
                true,
                false
              ],
              "defaultValue": true
            }
          },
          "variables": {
            "storage_path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('slashnextstorage'))}/files/@{encodeURIComponent(encodeURIComponent('JTJmb2Zmc2V0JTJmb2Zmc2V0LnR4dA=='))}/content",
            "slashnext_connection": "SlashNext-CMS",
            "blob_connection_name": "[[concat('SNX-Storage-', substring(toLower(uniqueString(resourceGroup().id, concat('[resourceGroup().locatio', 'n]'))),0,5))]",
            "workspace_connection_name": "[[concat('SNX-Workspace-', substring(toLower(uniqueString(resourceGroup().id, concat('[resourceGroup().locatio', 'n]'))),0,5))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', variables('slashnext_connection'))]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[subscriptionResourceId('Microsoft.Web/locations/managedApis',variables('workspace-location-inline'), 'azureloganalyticsdatacollector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[subscriptionResourceId('Microsoft.Web/locations/managedApis',variables('workspace-location-inline'), 'azureblob')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('slashnext_connection')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "Slashnext-CMS-Original",
                "parameterValues": {
                  "api_key": "1234"
                },
                "api": {
                  "name": "SlashNext-CMS",
                  "displayName": "SlashNext-CMS",
                  "description": "SlashNext-CMS is the integration API for Azure, it provide insight of the events occured on endpoint of a customer",
                  "iconUri": "https://content.powerapps.com/resource/makerx/static/media/default-connection-icon.00d06b6e.svg",
                  "id": "[[variables('_connection-1')]",
                  "type": "Microsoft.Web/customApis"
                },
                "testLinks": "[variables('TemplateEmptyArray')]"
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('workspace_connection_name')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('workspace_connection_name')]",
                "parameterValues": {
                  "username": "[[parameters('Workspace ID')]",
                  "password": "[[parameters('Workspace Key')]"
                },
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('blob_connection_name')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('blob_connection_name')]",
                "parameterValues": {
                  "accountName": "[[parameters('Storage Account Name')]",
                  "accessKey": "[[parameters('Storage Key')]"
                },
                "api": {
                  "name": "azureblob",
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('Playbook Name')]",
              "location": "[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('blob_connection_name'))]",
                "[[resourceId('Microsoft.Web/connections', variables('workspace_connection_name'))]",
                "[[resourceId('Microsoft.Web/connections', variables('slashnext_connection'))]"
              ],
              "properties": {
                "state": "Disabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Minute",
                        "interval": 3
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Minute",
                        "interval": 3
                      },
                      "type": "Recurrence",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "runs": 1
                        }
                      }
                    }
                  },
                  "actions": {
                    "Current_time": {
                      "type": "Expression",
                      "kind": "CurrentTime"
                    },
                    "Email_vector_var": {
                      "runAfter": {
                        "is_SMS": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email-vector",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "If_Web_Threats": {
                      "actions": {
                        "Set_Web_Vector": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "web-vector",
                            "value": "browser"
                          }
                        }
                      },
                      "runAfter": {
                        "if_Email_Threats": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@variables('is_web')",
                              true
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Initialize_min_offset": {
                      "runAfter": {
                        "Current_time": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "min_offset",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Iteration_Flag": {
                      "runAfter": {
                        "max_offset": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "iteration_flag",
                            "type": "integer",
                            "value": 1
                          }
                        ]
                      }
                    },
                    "SMS_vector_var": {
                      "runAfter": {
                        "Web_vector_var": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "SMS-vector",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Save_offset_condition": {
                      "actions": {
                        "create_file": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": "{\"offset\":\"@{variables('offset_max')}\"}",
                            "headers": {
                              "ReadFileMetadataFromServer": true
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azureblob']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('AccountNameFromSettings'))}/files",
                            "queries": {
                              "folderPath": "/offset",
                              "name": "offset.txt",
                              "queryParametersSingleEncoded": true
                            }
                          },
                          "runtimeConfiguration": {
                            "contentTransfer": {
                              "transferMode": "Chunked"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Traverse_each_item": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@variables('offset_save')",
                              1
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Scope": {
                      "actions": {
                        "Get_content": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azureblob']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "[[replace(variables('storage_path'),'slashnextstorage',parameters('Storage Account Name'))]",
                            "queries": {
                              "inferContentType": true
                            }
                          }
                        },
                        "Parse_data": {
                          "runAfter": {
                            "Get_content": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Get_content')",
                            "schema": {
                              "properties": {
                                "offset": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "Past_Time": {
                          "runAfter": {
                            "Get_content": [
                              "Failed"
                            ]
                          },
                          "type": "Expression",
                          "kind": "GetPastTime",
                          "inputs": {
                            "interval": "[[parameters('Process x weeks Data')]",
                            "timeUnit": "Week"
                          }
                        },
                        "date_updated": {
                          "runAfter": {
                            "Past_Time": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "min_offset",
                            "value": "@{formatDateTime(body('Past_Time'),'yyyy-MM-dd HH:mm:ss')}"
                          }
                        },
                        "minimum_offset": {
                          "runAfter": {
                            "Parse_data": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "min_offset",
                            "value": "@body('Parse_data')?['offset']"
                          }
                        }
                      },
                      "runAfter": {
                        "Initialize_min_offset": [
                          "Succeeded"
                        ]
                      },
                      "type": "Scope"
                    },
                    "Terminate": {
                      "runAfter": {
                        "Save_offset_condition": [
                          "Succeeded"
                        ]
                      },
                      "type": "Terminate",
                      "inputs": {
                        "runStatus": "Succeeded"
                      }
                    },
                    "Traverse_each_item": {
                      "actions": {
                        "Increment_Page": {
                          "runAfter": {
                            "On_success_response": [
                              "Succeeded"
                            ]
                          },
                          "type": "IncrementVariable",
                          "inputs": {
                            "name": "page",
                            "value": 1
                          }
                        },
                        "Loop_Break_condition": {
                          "actions": {
                            "set_iteration_flag": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "iteration_flag",
                                "value": 0
                              }
                            }
                          },
                          "runAfter": {
                            "Increment_Page": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@variables('counter')",
                                  "@body('incident_list_response')?['data']?['totalitems']"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "On_success_response": {
                          "actions": {
                            "For_each": {
                              "foreach": "@body('incident_list_response')?['data']?['items']",
                              "actions": {
                                "Increment_Counter": {
                                  "runAfter": {
                                    "Send_Data": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "IncrementVariable",
                                  "inputs": {
                                    "name": "counter",
                                    "value": 1
                                  }
                                },
                                "Parse_single_event": {
                                  "type": "ParseJson",
                                  "inputs": {
                                    "content": "@items('For_each')",
                                    "schema": {
                                      "properties": {
                                        "email": {
                                          "type": "string"
                                        },
                                        "eptypeText": {
                                          "type": "string"
                                        },
                                        "fullname": {
                                          "type": "string"
                                        },
                                        "groupname": {
                                          "type": "string"
                                        },
                                        "id": {
                                          "type": "integer"
                                        },
                                        "incidenttime": {
                                          "type": "string"
                                        },
                                        "infectionvector": {
                                          "type": "string"
                                        },
                                        "loggingaction": {
                                          "type": "string"
                                        },
                                        "phishingUrl": {
                                          "type": "string"
                                        },
                                        "threatname": {
                                          "type": "string"
                                        },
                                        "threattype": {
                                          "type": "string"
                                        },
                                        "threattypeText": {
                                          "type": "string"
                                        },
                                        "totalincidents": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "Send_Data": {
                                  "runAfter": {
                                    "Parse_single_event": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": "{\n\"Targeted User\":\"@{body('Parse_single_event')?['fullname']}\",\n\"Targeted User Email\":\"@{body('Parse_single_event')?['email']}\",\n\"Groups\":\"@{body('Parse_single_event')?['groupname']}\",\n\"Total Incidents\":\"@{body('Parse_single_event')?['totalincidents']}\",\n\"Blocked Threat Name\":\"@{body('Parse_single_event')?['threatname']}\",\n\"Blocked Threat Type\":\"@{body('Parse_single_event')?['threattype']}\",\n\"Incident Time\":\"@{body('Parse_single_event')?['incidenttime']}\",\n\"Action\":\"@{body('Parse_single_event')?['loggingaction']}\",\n\"End Point\":\"@{body('Parse_single_event')?['eptypeText']}\",\n\"Blocked URL\":\"@{body('Parse_single_event')?['phishingUrl']}\",\n\"Threat Type\":\"@{body('Parse_single_event')?['threattype']}\",\n\"Infection Vector\":\"@{body('Parse_single_event')?['infectionvector']}\"\n}",
                                    "headers": {
                                      "Log-Type": "SIEMCustomerLogs"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azureloganalyticsdatacollector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/api/logs"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "incident_list_response": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@body('incident_list_response')?['code']",
                                  200
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Set_Save_offset_true": {
                          "runAfter": {
                            "Loop_Break_condition": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "offset_save",
                            "value": 1
                          }
                        },
                        "incident_list_response": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "filters": [
                                {
                                  "time": "@{variables('min_offset')}#@{variables('offset_max')}",
                                  "vector": [
                                    "@variables('SMS-vector')",
                                    "@variables('web-vector')",
                                    "@variables('email-vector')"
                                  ]
                                }
                              ],
                              "page": "@variables('page')",
                              "rpp": "@variables('rpp')",
                              "sortby": "time",
                              "sortorder": "desc"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['SlashNext']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/integration/v7/incidents/list"
                          }
                        }
                      },
                      "runAfter": {
                        "save_offset": [
                          "Succeeded"
                        ]
                      },
                      "expression": "@not(equals(variables('iteration_stop'), variables('iteration_flag')))",
                      "limit": {
                        "count": 1000,
                        "timeout": "PT1H"
                      },
                      "type": "Until"
                    },
                    "Web_vector_var": {
                      "runAfter": {
                        "Email_vector_var": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "web-vector",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "counter": {
                      "runAfter": {
                        "iteration_stop": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "counter",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "if_Email_Threats": {
                      "actions": {
                        "Set_Email_Vector": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "email-vector",
                            "value": "email"
                          }
                        }
                      },
                      "runAfter": {
                        "SMS_vector_var": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@variables('is_email')",
                              true
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "if_SMS_Threats": {
                      "actions": {
                        "Set_SMS_vector": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "SMS-vector",
                            "value": "mobile"
                          }
                        }
                      },
                      "runAfter": {
                        "If_Web_Threats": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@variables('is_sms')",
                              true
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "is_Email": {
                      "runAfter": {
                        "Scope": [
                          "Succeeded",
                          "Failed"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "is_email",
                            "type": "boolean",
                            "value": "[[parameters('Enable Email Incident')]"
                          }
                        ]
                      }
                    },
                    "is_SMS": {
                      "runAfter": {
                        "is_Web": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "is_sms",
                            "type": "boolean",
                            "value": "[[parameters('Enable SMS Incident')]"
                          }
                        ]
                      }
                    },
                    "is_Web": {
                      "runAfter": {
                        "is_Email": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "is_web",
                            "type": "boolean",
                            "value": "[[parameters('Enable Web Incident')]"
                          }
                        ]
                      }
                    },
                    "iteration_stop": {
                      "runAfter": {
                        "Iteration_Flag": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "iteration_stop",
                            "type": "integer",
                            "value": 1
                          }
                        ]
                      }
                    },
                    "max_offset": {
                      "runAfter": {
                        "page": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "offset_max",
                            "type": "string",
                            "value": "@{formatDateTime(body('Current_Time'),'yyyy-MM-dd HH:mm:ss')}"
                          }
                        ]
                      }
                    },
                    "page": {
                      "runAfter": {
                        "rpp": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "page",
                            "type": "integer",
                            "value": 1
                          }
                        ]
                      }
                    },
                    "rpp": {
                      "runAfter": {
                        "if_SMS_Threats": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "rpp",
                            "type": "integer",
                            "value": 100
                          }
                        ]
                      }
                    },
                    "save_offset": {
                      "runAfter": {
                        "counter": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "offset_save",
                            "type": "integer",
                            "value": 1
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "SlashNext": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections',variables('slashnext_connection'))]",
                        "connectionName": "SlashNext-CMS",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', variables('slashnext_connection'))]"
                      },
                      "azureblob": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections',variables('blob_connection_name'))]",
                        "connectionName": "[[concat(parameters('Playbook Name'),'-storage')]",
                        "id": "[[subscriptionResourceId('Microsoft.Web/locations/managedApis', variables('workspace-location-inline'), 'azureblob')]"
                      },
                      "azureloganalyticsdatacollector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections',variables('workspace_connection_name'))]",
                        "connectionName": "[[concat(parameters('Playbook Name'),'-workspace')]",
                        "id": "[[subscriptionResourceId('Microsoft.Web/locations/managedApis', variables('workspace-location-inline'), 'azureloganalyticsdatacollector')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "SlashNext SIEM",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "SlashNext",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "SlashNext",
                  "email": "support@slashnext.com",
                  "tier": "Partner",
                  "link": "https://slashnext.com/support"
                }
              }
            }
          ],
          "metadata": {
            "title": "SlashNext Security Events for Microsoft Sentinel - Get customer incidents and log",
            "description": "The playbook will run after every 3 mintues to get list of events occured to a customer in that time and log them in Log Analytic Workspace.",
            "prerequisites": [
              "1.**SlashNext Logic Apps Connector** supports **Basic** authentication, while creating connection you will be asked to provide API key.",
              "To acquire SlashNext API key, please contact us at [support@slashnext.com](mailto:support@slashnext.com) or visit [SlashNext.com](www.slashnext.com)",
              "2. Prior to the deployment of this playbook, Azure log analytic workspace needs to be deployed under the same subscription.",
              "3. Prior to the deployment of this playbook, Azure storage account needs to be deployed under the same subscription.",
              "4. Prior to the deployment of this playbook, Inside storage account create a container named as offset."
            ],
            "postDeployment": [
              "1. Authorize each connection.",
              "2. Authorize SlashNext custom connector using SlashNext customer key.",
              "3. Check readme.md for detailed instructions."
            ],
            "lastUpdateTime": "2023-06-16T12:00:00Z",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "SlashNext Security Events for Microsoft Sentinel",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "SlashNextSecurityEventsforMicrosoftSentinel",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "SlashNext SIEM",
        "publisherDisplayName": "SlashNext",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>{The Slashnext SIEM logic app retrieves incidents associated with a customer from various sources such as SMS, mobile devices, web extensions, and emails. These incidents are then presented and recorded within the Log Analytic Workspace.}</p>\n<p><strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/SlashNext%20SIEM/Playbook/logo/slashnext-logo.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "SlashNext SIEM",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "SlashNext",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "SlashNext",
          "email": "support@slashnext.com",
          "tier": "Partner",
          "link": "https://slashnext.com/support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_SlashNextEventConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_SlashNextSecurityEventForMSSentinel')]",
              "version": "[variables('playbookVersion2')]"
            }
          ]
        },
        "firstPublishDate": "2023-05-26",
        "lastPublishDate": "2023-06-16",
        "providers": [
          "SlashNext"
        ],
        "categories": {
          "domains": [
            "Security - Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
