{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src ='https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg' width='75px' height='75px'>\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nMicrosoft Security Research, based on ongoing trends and exploits creates content that help identify existence of known IOCs based on known prevalent attacks and threat actor tactics/techniques, such as Nobelium, Gallium, Solorigate, etc. This solution contains packaged content written on some legacy IOCs that have been prevalent in the past but may still be relevant.\n\n**Pre-requisites:**\n\nThis is a [domain solution](https://learn.microsoft.com/azure/sentinel/sentinel-solutions-catalog#domain-solutions) and does not include any data connectors. The content in this solution supports the connectors listed below. Install one or more of the listed solutions, to unlock the value provided by this solution.\n\n1. [Squid Proxy](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-squidproxyazure-sentinel-solution-squidproxy)\n\n2. [Microsoft Windows DNS](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-dnsazure-sentinel-solution-dns)\n\n3. [Cisco ASA](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-ciscoasaazure-sentinel-solution-ciscoasa)\n\n4. [Palo Alto Networks](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-paloaltopanosazure-sentinel-solution-paloaltopanos)\n\n5. [Microsoft 365 Defender](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-microsoft365defenderazure-sentinel-solution-microsoft365defender)\n\n6. [Azure Firewall](https://ms.portal.azure.com/#create/sentinel4azurefirewall.sentinel4azurefirewallsentinel4azurefirewall)\n\n7. [ZScaler Internet Access](https://ms.portal.azure.com/#create/zscaler1579058425289.zscaler_internet_access_msszia_msentinel_v1)\n\n8. [Infoblox NIOS](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-infobloxniosazure-sentinel-solution-infobloxnios)\n\n9. [Google Cloud Platform DNS](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-gcpdnsazure-sentinel-solution-gcpdns)\n\n10. [NXLog DNS](https://ms.portal.azure.com/#create/nxlogltd1589381969261.nxlog_dns_logsnxlog-dns-plan1)\n\n11. [Cisco Umbrella](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-ciscoumbrellaazure-sentinel-solution-ciscoumbrella)\n\n12. [Corelight ](https://ms.portal.azure.com/#create/corelightinc1584998267292.corelight-for-azure-sentinelcorelight-for-azure-sentinel-solution-template)\n\n13. [Amazon Web Services](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-amazonwebservicesazure-sentinel-solution-amazonwebservices)\n\n14. [Windows Forwarded Events](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-windowsforwardedeventsazure-sentinel-solution-windowsforwardedevents)\n\n15. [Sysmon for Linux](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-sysmonforlinuxazure-sentinel-solution-sysmonforlinux)\n\n16. [Microsoft 365](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-office365azure-sentinel-solution-office365)\n\n17. [Windows Security Events](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-securityeventsazure-sentinel-solution-securityevents)\n\n18. [Azure Active Directory](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-azureactivedirectoryazure-sentinel-solution-azureactivedirectory)\n\n19. [Azure Activity](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-azureactivityazure-sentinel-solution-azureactivity)\n\n20. [F5 Advanced WAF](https://ms.portal.azure.com/#create/f5-networks.f5_bigip_mssf5-big-ip)\n\n21. [Fortinet FortiGate](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-fortinetfortigateazure-sentinel-solution-fortinetfortigate)\n\n22. [Check Point](https://ms.portal.azure.com/#create/checkpoint.checkpoint-sentinel-solutionssentinel-1)\n\n23. [Common Event Format](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-commoneventformatazure-sentinel-solution-commoneventformat)\n\n24. [Windows Firewall](https://ms.portal.azure.com/#create/azuresentinel.azure-sentinel-solution-windowsfirewallazure-sentinel-solution-windowsfirewall)\n\n**Analytic Rules:** 35, **Hunting Queries:** 10\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following analytic rule templates. After installing the solution, create and enable analytic rules in Manage solution view."
            }
          },
          {
            "name": "analytics-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "Aqua Blizzard Actor IOCs - Feb 2022",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for domains, hashes and commands related to an actor tracked by Microsoft as Aqua Blizzard."
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "Known Barium domains",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for domains IOCs related to the Barium activity group.\n References: https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer"
                }
              }
            ]
          },
          {
            "name": "analytic3",
            "type": "Microsoft.Common.Section",
            "label": "Known Barium IP",
            "elements": [
              {
                "name": "analytic3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for IP IOCs related to the Barium activity group.\n References: https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer"
                }
              }
            ]
          },
          {
            "name": "analytic4",
            "type": "Microsoft.Common.Section",
            "label": "Known Ruby Sleet domains and hashes",
            "elements": [
              {
                "name": "analytic4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Ruby Sleet malicious webserver and hash values for maldocs and malware. \n Matches domain name IOCs related to the Ruby Sleet activity group with CommonSecurityLog, DnsEvents, and VMConnection dataTypes."
                }
              }
            ]
          },
          {
            "name": "analytic5",
            "type": "Microsoft.Common.Section",
            "label": "Chia_Crypto_Mining - Domain, Process, Hash and IP IOCs - June 2021",
            "elements": [
              {
                "name": "analytic5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for domains, process, hashes and IP IOC related to Chia cryptocurrency farming/plotting activity."
                }
              }
            ]
          },
          {
            "name": "analytic6",
            "type": "Microsoft.Common.Section",
            "label": "DEV-0322 Serv-U related IOCs - July 2021",
            "elements": [
              {
                "name": "analytic6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across IOC's related to DEV-0322 targeting SolarWinds Serv-U software."
                }
              }
            ]
          },
          {
            "name": "analytic7",
            "type": "Microsoft.Common.Section",
            "label": "Dev-0530 IOC - July 2022",
            "elements": [
              {
                "name": "analytic7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a IOC match related to Dev-0530 actor across various data sources."
                }
              }
            ]
          },
          {
            "name": "analytic8",
            "type": "Microsoft.Common.Section",
            "label": "Cadet Blizzard Actor IOC - January 2022",
            "elements": [
              {
                "name": "analytic8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across IOC's related to an actor tracked by Microsoft as Cadet Blizzard\n Reference: https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/"
                }
              }
            ]
          },
          {
            "name": "analytic9",
            "type": "Microsoft.Common.Section",
            "label": "Exchange Server Vulnerabilities Disclosed March 2021 IoC Match",
            "elements": [
              {
                "name": "analytic9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This detection look for IoCs shared by Microsoft relating to attacks exploiting the Exchange Server vulnerabilities disclosed in March 2021. It looks for SHA256 file hashes, IP addresses and file paths in a number of data sources. This query can also be customized with additional data sources that may include these elements.\nRef: https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/"
                }
              }
            ]
          },
          {
            "name": "analytic10",
            "type": "Microsoft.Common.Section",
            "label": "Known Granite Typhoon domains and hashes",
            "elements": [
              {
                "name": "analytic10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Granite Typhoon command and control domains and hash values for tools and malware used by Granite Typhoon. \n Matches domain name IOCs related to the Granite Typhoon activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes.\n References: https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/ "
                }
              }
            ]
          },
          {
            "name": "analytic11",
            "type": "Microsoft.Common.Section",
            "label": "Silk Typhoon UM Service writing suspicious file",
            "elements": [
              {
                "name": "analytic11-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query looks for the Exchange server UM process writing suspicious files that may be indicative of webshells.\nReference: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/"
                }
              }
            ]
          },
          {
            "name": "analytic12",
            "type": "Microsoft.Common.Section",
            "label": "Hive Ransomware IOC - July 2022",
            "elements": [
              {
                "name": "analytic12-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a hash match related to Hive Ransomware across various data sources."
                }
              }
            ]
          },
          {
            "name": "analytic13",
            "type": "Microsoft.Common.Section",
            "label": "Known Seashell Blizzard IP",
            "elements": [
              {
                "name": "analytic13-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Seashell Blizzard command and control IP. Identifies a match across various data feeds for IP IOCs related to the Seashell Blizzard activity group."
                }
              }
            ]
          },
          {
            "name": "analytic14",
            "type": "Microsoft.Common.Section",
            "label": "Denim Tsunami AV Detection",
            "elements": [
              {
                "name": "analytic14-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query looks for Microsoft Defender AV detections related to the Denim Tsunami threat actor and the Corelump and Jumplump malware.\n  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/"
                }
              }
            ]
          },
          {
            "name": "analytic15",
            "type": "Microsoft.Common.Section",
            "label": "Denim Tsunami C2 Domains July 2022",
            "elements": [
              {
                "name": "analytic15-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query looks for references to known Denim Tsunami Domains in network logs.\n  This query was published July 2022.\n  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/"
                }
              }
            ]
          },
          {
            "name": "analytic16",
            "type": "Microsoft.Common.Section",
            "label": "Denim Tsunami File Hashes July 2022",
            "elements": [
              {
                "name": "analytic16-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query looks for references to known Denim Tsunami file hashes in various logs.\n  This query was published July 2022.\n  Ref: https://www.microsoft.com/security/blog/2022/07/27/untangling-knotweed-european-private-sector-offensive-actor-using-0-day-exploits/"
                }
              }
            ]
          },
          {
            "name": "analytic17",
            "type": "Microsoft.Common.Section",
            "label": "Known Mint Sandstorm group domains/IP - October 2020",
            "elements": [
              {
                "name": "analytic17-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Matches IOCs related to Mint Sandstorm group activity published October 2020 with CommonSecurityLog, DnsEvents, OfficeActivity and VMConnection dataTypes.\nReferences: "
                }
              }
            ]
          },
          {
            "name": "analytic18",
            "type": "Microsoft.Common.Section",
            "label": "Known Manganese IP and UserAgent activity",
            "elements": [
              {
                "name": "analytic18-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Matches IP plus UserAgent IOCs in OfficeActivity data, along with IP plus Connection string information in the CommonSecurityLog data related to Manganese group activity.\nReferences: \nhttps://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44101/\nhttps://fortiguard.com/psirt/FG-IR-18-384"
                }
              }
            ]
          },
          {
            "name": "analytic19",
            "type": "Microsoft.Common.Section",
            "label": "MSHTML vulnerability CVE-2021-40444 attack",
            "elements": [
              {
                "name": "analytic19-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query detects attacks that exploit the CVE-2021-40444 MSHTML vulnerability using specially crafted Microsoft Office documents. \n The detection searches for relevant files used in the attack along with regex matches in commnadline to look for pattern similar to : \".cpl:../../msword.inf\"\n Refrence: https://www.microsoft.com/security/blog/2021/09/15/analyzing-attacks-that-exploit-the-mshtml-cve-2021-40444-vulnerability/"
                }
              }
            ]
          },
          {
            "name": "analytic20",
            "type": "Microsoft.Common.Section",
            "label": "Known Nylon Typhoon domains and hashes",
            "elements": [
              {
                "name": "analytic20-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "IOC domains and hash values for tools and malware used by Nylon Typhoon. \n Matches domain name, hash IOCs and M365 Defender sigs related to the Nylon Typhoon activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes."
                }
              }
            ]
          },
          {
            "name": "analytic21",
            "type": "Microsoft.Common.Section",
            "label": "Midnight Blizzard - Domain and IP IOCs - March 2021",
            "elements": [
              {
                "name": "analytic21-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for domains and IP IOCs related to Midnight Blizzard.\n References: https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/"
                }
              }
            ]
          },
          {
            "name": "analytic22",
            "type": "Microsoft.Common.Section",
            "label": "Midnight Blizzard IOCs related to FoggyWeb backdoor",
            "elements": [
              {
                "name": "analytic22-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for IOCs related to FoggyWeb backdoor by the threat actor Midnight Blizzard.\n FoggyWeb is a passive and highly targeted backdoor capable of remotely exfiltrating sensitive information from a compromised AD FS server.\n It can also receive additional malicious components from a command-and-control (C2) server and execute them on the compromised server.\n Reference: https://aka.ms/nobelium-foggy-web"
                }
              }
            ]
          },
          {
            "name": "analytic23",
            "type": "Microsoft.Common.Section",
            "label": "Midnight Blizzard - Domain, Hash and IP IOCs - May 2021",
            "elements": [
              {
                "name": "analytic23-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for domains, hashes and IP IOCs related to Midnight Blizzard.\nRef: https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/"
                }
              }
            ]
          },
          {
            "name": "analytic24",
            "type": "Microsoft.Common.Section",
            "label": "Known Phosphorus group domains/IP",
            "elements": [
              {
                "name": "analytic24-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Matches domain name IOCs related to Phosphorus group activity with CommonSecurityLog, DnsEvents, OfficeActivity and VMConnection dataTypes.\nReferences: https://blogs.microsoft.com/on-the-issues/2019/03/27/new-steps-to-protect-customers-from-hacking/."
                }
              }
            ]
          },
          {
            "name": "analytic25",
            "type": "Microsoft.Common.Section",
            "label": "Known Plaid Rain IP",
            "elements": [
              {
                "name": "analytic25-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for IP IOCs related to the Plaid Rain activity group.  \n References: BLOGURL"
                }
              }
            ]
          },
          {
            "name": "analytic26",
            "type": "Microsoft.Common.Section",
            "label": "Solorigate Network Beacon",
            "elements": [
              {
                "name": "analytic26-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for domains IOCs related to the Solorigate incident.\n References: https://blogs.microsoft.com/on-the-issues/2020/12/13/customers-protect-nation-state-cyberattacks/, \n https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html?1"
                }
              }
            ]
          },
          {
            "name": "analytic27",
            "type": "Microsoft.Common.Section",
            "label": "Solorigate Domains Found in VM Insights",
            "elements": [
              {
                "name": "analytic27-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies connections to Solorigate-related DNS records based on VM insights data"
                }
              }
            ]
          },
          {
            "name": "analytic28",
            "type": "Microsoft.Common.Section",
            "label": "Caramel Tsunami Actor IOC - July 2021",
            "elements": [
              {
                "name": "analytic28-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across IOC's related to an actor tracked by Microsoft as Caramel Tsunami"
                }
              }
            ]
          },
          {
            "name": "analytic29",
            "type": "Microsoft.Common.Section",
            "label": "Possible Forest Blizzard attempted credential harvesting - Oct 2020",
            "elements": [
              {
                "name": "analytic29-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Surfaces potential Forest Blizzard group Office365 credential harvesting attempts within OfficeActivity Logon events."
                }
              }
            ]
          },
          {
            "name": "analytic30",
            "type": "Microsoft.Common.Section",
            "label": "SUNSPOT log file creation",
            "elements": [
              {
                "name": "analytic30-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query uses Microsoft Defender for Endpoint data and Windows Event Logs to look for IoCs associated with the SUNSPOT malware shared by Crowdstrike.\nMore details: \n  - https://www.crowdstrike.com/blog/sunspot-malware-technical-analysis/ \n  - https://techcommunity.microsoft.com/t5/azure-sentinel/monitoring-your-software-build-process-with-azure-sentinel/ba-p/2140807"
                }
              }
            ]
          },
          {
            "name": "analytic31",
            "type": "Microsoft.Common.Section",
            "label": "Tarrask malware IOC - April 2022",
            "elements": [
              {
                "name": "analytic31-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a hash match related to Tarrask malware across various data sources.\n Reference: https://www.microsoft.com/security/blog/2022/04/12/tarrask-malware-uses-scheduled-tasks-for-defense-evasion/"
                }
              }
            ]
          },
          {
            "name": "analytic32",
            "type": "Microsoft.Common.Section",
            "label": "Emerald Sleet domains included in DCU takedown",
            "elements": [
              {
                "name": "analytic32-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Emerald Sleet spearphishing and command and control domains included in December 2019 DCU/MSTIC takedown. \n Matches domain name IOCs related to the Emerald Sleet activity group with CommonSecurityLog, DnsEvents, VMConnection and SecurityEvents dataTypes.\n References: https://blogs.microsoft.com/on-the-issues/2019/12/30/microsoft-court-action-against-nation-state-cybercrime/ "
                }
              }
            ]
          },
          {
            "name": "analytic33",
            "type": "Microsoft.Common.Section",
            "label": "Alert for  IOCs related to Windows/ELF malware - IP, Hash IOCs - September 2021",
            "elements": [
              {
                "name": "analytic33-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identifies a match across various data feeds for IP,hashes and IOCs related to Windows/ELF malware published by Black Lotus Labs\nReference: \nhttps://blog.lumen.com/no-longer-just-theory-black-lotus-labs-uncovers-linux-executables-deployed-as-stealth-windows-loaders\nhttps://github.com/ManuelBerrueta/YARA-rules/blob/master/BlackLotusLabs-WSLMalware/BLL_SneakyWSL.yar"
                }
              }
            ]
          },
          {
            "name": "analytic34",
            "type": "Microsoft.Common.Section",
            "label": "Known Diamond Sleet Comebacker and Klackring malware hashes",
            "elements": [
              {
                "name": "analytic34-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Diamond Sleet attacks against security researcher campaign malware hashes."
                }
              }
            ]
          },
          {
            "name": "analytic35",
            "type": "Microsoft.Common.Section",
            "label": "Known Diamond Sleet related maldoc hash",
            "elements": [
              {
                "name": "analytic35-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Document hash used by Diamond Sleet in highly targeted spear phishing campaign."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "huntingqueries",
        "label": "Hunting Queries",
        "bladeTitle": "Hunting Queries",
        "elements": [
          {
            "name": "huntingqueries-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following hunting queries. After installing the solution, run these hunting queries to hunt for threats in Manage solution view. "
            }
          },
          {
            "name": "huntingqueries-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/hunting"
              }
            }
          },
          {
            "name": "huntingquery1",
            "type": "Microsoft.Common.Section",
            "label": "Dev-0056 Command Line Activity November 2021",
            "elements": [
              {
                "name": "huntingquery1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This hunting query looks for process command line activity related to activity observed by Dev-0056.The command lines this query hunts for are used as part of the threat actor's post exploitation activity. This hunting query depends on MicrosoftDefenderAdvancedThreatProtection MicrosoftThreatProtection WindowsSecurityEvents WindowsForwardedEvents data connector (SecurityAlert (MDATP) DeviceProcessEvents SecurityEvent WindowsEvent Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery2",
            "type": "Microsoft.Common.Section",
            "label": "Dev-0322 Command Line Activity November 2021 (ASIM Version)",
            "elements": [
              {
                "name": "huntingquery2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This hunting query looks for process command line activity related to activity observed by Dev-0322 relating to compromise of systems running the ZOHO ManageEngine ADSelfService Plus software.\n  The command lines this query hunts for are used as part of the threat actor's post exploitation activity. Some or all of the commands may be run by the threat actor.\n  The risk score associated with each result is based on a number of factors, hosts with higher risk events should be investigated first.\n  This query uses the Microsoft Sentinel Information Model - https://docs.microsoft.com/azure/sentinel/normalization This hunting query depends on MicrosoftDefenderAdvancedThreatProtection data connector (SecurityAlert (MDATP) Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery3",
            "type": "Microsoft.Common.Section",
            "label": "Dev-0322 Command Line Activity November 2021",
            "elements": [
              {
                "name": "huntingquery3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This hunting query looks for process command line activity related to activity observed by Dev-0322 relating to compromise of systems running the ZOHO ManageEngine ADSelfService Plus software.\n  The command lines this query hunts for are used as part of the threat actor's post exploitation activity. Some or all of the commands may be run by the threat actor.\n  The risk score associated with each result is based on a number of factors, hosts with higher risk events should be investigated first. This hunting query depends on MicrosoftDefenderAdvancedThreatProtection MicrosoftThreatProtection data connector (SecurityAlert (MDATP) DeviceProcessEvents Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery4",
            "type": "Microsoft.Common.Section",
            "label": "Dev-0322 File Drop Activity November 2021 (ASIM Version)",
            "elements": [
              {
                "name": "huntingquery4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This hunting query looks for file creation events related to activity observed by Dev-0322 relating to compromise of systems running the ZOHO ManageEngine ADSelfService Plus software.\n  The files this query hunts for are dropped as part of the threat actors post exploitation activity. Some or all of the files may be dropped by the threat actor.\n  The risk score associated with each result is based on a number of factors, hosts with higher risk events should be investigated first.\n  This query uses the Microsoft Sentinel Information Model - https://docs.microsoft.com/azure/sentinel/normalization This hunting query depends on MicrosoftDefenderAdvancedThreatProtection data connector (SecurityAlert (MDATP) Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery5",
            "type": "Microsoft.Common.Section",
            "label": "Dev-0322 File Drop Activity November 2021",
            "elements": [
              {
                "name": "huntingquery5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This hunting query looks for file creation events related to activity observed by Dev-0322 relating to compromise of systems running the ZOHO ManageEngine ADSelfService Plus software.\n  The files this query hunts for are dropped as part of the threat actors post exploitation activity. Some or all of the files may be dropped by the threat actor.\n  The risk score associated with each result is based on a number of factors, hosts with higher risk events should be investigated first. This hunting query depends on MicrosoftDefenderAdvancedThreatProtection MicrosoftThreatProtection data connector (SecurityAlert (MDATP) DeviceFileEvents DeviceProcessEvents Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery6",
            "type": "Microsoft.Common.Section",
            "label": "Connection from external IP to OMI related Ports",
            "elements": [
              {
                "name": "huntingquery6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query identifies connection attempts from the external IP addresses to the management ports(5985,5986,1270) related to Open Management Infrastructure(OMI). \n OMI is the Linux equivalent of Windows WMI and helps users manage configurations across remote and local environments. \n The query aims to find attacks targeting OMI vulnerability (CVE-2021-38647). The query primarily leverages the Network Session normalization schema(imNetworkSession) \n as well as a few other logs to look for this activity. The Network normalizing parsers can be deployed in a click using an ARM Template shared in the link below:\n Reference: https://techcommunity.microsoft.com/t5/azure-sentinel/hunting-for-omi-vulnerability-exploitation-with-azure-sentinel/ba-p/2764093\n Reference: https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure\n Reference: https://github.com/Azure/Azure-Sentinel/tree/master/Parsers/ASimNetworkSession This hunting query depends on AzureNetworkWatcher AzureMonitor(VMInsights) AzureFirewall data connector (AzureNetworkAnalytics_CL VMConnection AzureDiagnostics Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery7",
            "type": "Microsoft.Common.Section",
            "label": "Nylon Typhoon Command Line Activity November 2021",
            "elements": [
              {
                "name": "huntingquery7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This hunting query looks for process command line activity related to data collection and staging observed by Nylon Typhoon.\nIt hunts for use of tools such as xcopy and renamed archiving tools for data collection and staging purposes on the hosts with signatures observed related to Nylon Typhoon actor. This hunting query depends on MicrosoftDefenderAdvancedThreatProtection MicrosoftThreatProtection WindowsSecurityEvents WindowsForwardedEvents data connector (SecurityAlert (MDATP) DeviceProcessEvents SecurityEvent WindowsEvent Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery8",
            "type": "Microsoft.Common.Section",
            "label": "Known Nylon Typhoon Registry modifications patterns",
            "elements": [
              {
                "name": "huntingquery8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This query identifies instances where malware intentionally configures the browser settings for its use by modifying the following registry entries by Nylon Typhoon threat actor. This hunting query depends on SecurityEvents MicrosoftThreatProtection WindowsSecurityEvents WindowsForwardedEvents data connector (SecurityEvent DeviceRegistryEvents SecurityEvents WindowsEvent Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery9",
            "type": "Microsoft.Common.Section",
            "label": "SolarWinds Inventory",
            "elements": [
              {
                "name": "huntingquery9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Beyond your internal software management systems, it is possible you may not have visibility into your entire footprint of SolarWinds installations.  This is intended to help use process exection information to discovery any systems that have SolarWinds processes This hunting query depends on SecurityEvents MicrosoftThreatProtection WindowsSecurityEvents WindowsForwardedEvents data connector (SecurityEvent DeviceProcessEvents SecurityEvents WindowsEvent Parser or Table)"
                }
              }
            ]
          },
          {
            "name": "huntingquery10",
            "type": "Microsoft.Common.Section",
            "label": "Retrospective hunt for Forest Blizzard IP IOCs",
            "elements": [
              {
                "name": "huntingquery10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Matches domain name IOCs related to Forest Blizzard group activity with CommonSecurityLog and SecurityAlert dataTypes.\nThe query is scoped in the time window that these IOCs were active.\nReferences: https://blogs.microsoft.com/on-the-issues/2019/07/17/new-cyberthreats-require-new-ways-to-protect-democracy. This hunting query depends on CiscoASA PaloAltoNetworks AzureSecurityCenter data connector (CommonSecurityLog CommonSecurityLog SecurityAlert Parser or Table)"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]"
    }
  }
}
