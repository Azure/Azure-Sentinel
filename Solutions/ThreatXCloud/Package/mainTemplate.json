{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for ThreatXCloud"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-threatxwaf",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "ThreatXCustomConnector": "ThreatXCustomConnector",
    "_ThreatXCustomConnector": "[variables('ThreatXCustomConnector')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "ThreatXCustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "ThreatX-BlockIP-URL": "ThreatX-BlockIP-URL",
    "_ThreatX-BlockIP-URL": "[variables('ThreatX-BlockIP-URL')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "ThreatX-BlockIP-URL",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "blanks": "[replace('b', 'b', '')]",
    "ThreatX-Enrichment": "ThreatX-Enrichment",
    "_ThreatX-Enrichment": "[variables('ThreatX-Enrichment')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "ThreatX-Enrichment",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "properties": {
        "description": "ThreatXCustomConnector",
        "displayName": "ThreatXCustomConnector"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "ThreatXCustomConnector Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "ThreatX-WAFCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all ThreatX automation playbooks as well"
              }
            },
            "ThreatXURL": {
              "defaultValue": "provision.threatx.io",
              "type": "String",
              "metadata": {
                "description": "As per documentation of Threatx use the default url provided (provision.threatx.io). If still required please change Do NOT prefix with https:// or http:// etc"
              }
            }
          },
          "variables": {
            "api_host": "[[replace(replace(parameters('ThreatXURL'),'https://',''),'http://','')]",
			"ServiceName": "[[concat('https://', variables('api_host'))]",
            "operationId-Login_generateToken": "Login_generateToken",
            "_operationId-Login_generateToken": "[[variables('operationId-Login_generateToken')]",
            "operationId-Token_Refresh": "Token_Refresh",
            "_operationId-Token_Refresh": "[[variables('operationId-Token_Refresh')]",
            "operationId-Get_Post_IP_to_Blacklist_Blocklist_Whitelist": "Get_Post_IP_to_Blacklist_Blocklist_Whitelist",
            "_operationId-Get_Post_IP_to_Blacklist_Blocklist_Whitelist": "[[variables('operationId-Get_Post_IP_to_Blacklist_Blocklist_Whitelist')]",
            "operationId-Create_Customer_Rule": "Create_Customer_Rule",
            "_operationId-Create_Customer_Rule": "[[variables('operationId-Create_Customer_Rule')]",
            "operationId-Get_Entities": "Get_Entities",
            "_operationId-Get_Entities": "[[variables('operationId-Get_Entities')]",
            "operationId-Event_Logs": "Event_Logs",
            "_operationId-Event_Logs": "[[variables('operationId-Event_Logs')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId": "ThreatXCustomConnector",
            "playbookId": "[[resourceId('Microsoft.Web/customApis', parameters('CustomConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('CustomConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "description": "[[concat(parameters('CustomConnectorName'), 'connects to ThreatX WAF service end point to runs any ThreatX supported API get/post calls and gives response back in JSON format. \n\nNote: For better understanding , check https://support.threatx.com/')]",
                "displayName": "[[parameters('CustomConnectorName')]",
                "iconUri": "data:image/png;base64,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",
                "backendService": {
                  "serviceUrl": "[[variables('ServiceName')]"
                },
                "apiType": "Rest",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "version": "1.0.0",
                    "title": "ThreatX",
                    "description": "This custom connector connects to ThreatX WAF service end point to runs any ThreatX supported API get/post calls and gives response back in JSON format."
                  },
                  "host": "provision.threatx.io",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "produces": [
                    "application/json"
                  ],
                  "paths": {
                    "/tx_api/v1/login": {
                      "post": {
                        "summary": "Login Generate Token",
                        "description": "Login Generate Token",
                        "operationId": "[[variables('_operationId-Login_generateToken')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "Content-Type"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "command": {
                                  "type": "string",
                                  "description": "command",
                                  "title": "[variables('blanks')]",
                                  "default": "login"
                                },
                                "api_token": {
                                  "type": "string",
                                  "description": "api_token",
                                  "title": "[variables('blanks')]",
                                  "format": "password"
                                }
                              },
                              "default": {
                                "command": "login",
                                "api_token": "<api_key>"
                              },
                              "required": [
                                "api_token",
                                "command"
                              ]
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "Ok": {
                                  "type": "object",
                                  "properties": {
                                    "status": {
                                      "type": "boolean",
                                      "description": "status"
                                    },
                                    "token": {
                                      "type": "string",
                                      "description": "token"
                                    }
                                  },
                                  "description": "Ok"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/tx_api/v1/auth": {
                      "post": {
                        "summary": "Token Refresh",
                        "description": "Token Refresh",
                        "operationId": "[[variables('_operationId-Token_Refresh')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json",
                            "description": "Content-Type"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "command": {
                                  "type": "string",
                                  "description": "command",
                                  "title": "[variables('blanks')]",
                                  "default": "refresh"
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token",
                                  "title": "[variables('blanks')]"
                                }
                              },
                              "default": {
                                "command": "refresh",
                                "token": "<api_token>"
                              },
                              "required": [
                                "command",
                                "token"
                              ]
                            },
                            "required": true
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "Ok": {
                                  "type": "object",
                                  "properties": {
                                    "token": {
                                      "type": "string",
                                      "description": "token"
                                    },
                                    "exp": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "exp"
                                    },
                                    "user": {
                                      "type": "object",
                                      "properties": {
                                        "username": {
                                          "type": "string",
                                          "description": "username"
                                        },
                                        "active": {
                                          "type": "boolean",
                                          "description": "active"
                                        },
                                        "email": {
                                          "type": "string",
                                          "description": "email"
                                        },
                                        "requires_totp_auth": {
                                          "type": "boolean",
                                          "description": "requires_totp_auth"
                                        },
                                        "description": {
                                          "type": "string",
                                          "description": "description"
                                        },
                                        "current_password": {
                                          "type": "string",
                                          "description": "current_password"
                                        },
                                        "password": {
                                          "type": "string",
                                          "description": "password"
                                        },
                                        "given_name": {
                                          "type": "string",
                                          "description": "given_name"
                                        },
                                        "family_name": {
                                          "type": "string",
                                          "description": "family_name"
                                        },
                                        "phone": {
                                          "type": "string",
                                          "description": "phone"
                                        },
                                        "super_admin": {
                                          "type": "string",
                                          "description": "super_admin"
                                        },
                                        "tx_admin": {
                                          "type": "string",
                                          "description": "tx_admin"
                                        },
                                        "tenant_admin": {
                                          "type": "boolean",
                                          "description": "tenant_admin"
                                        },
                                        "read_only": {
                                          "type": "boolean",
                                          "description": "read_only"
                                        }
                                      },
                                      "description": "user"
                                    },
                                    "customer_name": {
                                      "type": "string",
                                      "description": "customer_name"
                                    },
                                    "channel_name": {
                                      "type": "string",
                                      "description": "channel_name"
                                    },
                                    "features": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "description": "features"
                                    }
                                  },
                                  "description": "Ok"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/tx_api/v1/lists": {
                      "post": {
                        "summary": "Get-Post Blacklist Blocklist Whitelist",
                        "description": "Get-Post Blacklist Blocklist Whitelist",
                        "operationId": "[[variables('_operationId-Get_Post_IP_to_Blacklist_Blocklist_Whitelist')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "command": {
                                  "type": "string",
                                  "description": "command",
                                  "title": "[variables('blanks')]",
                                  "enum": [
                                    "bulk_new_blacklist",
                                    "bulk_new_blocklist",
                                    "bulk_new_whitelist",
                                    "list_blocklist",
                                    "list_blacklist",
                                    "list_whitelist"
                                  ]
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token"
                                },
                                "customer_name": {
                                  "type": "string",
                                  "description": "customer_name",
                                  "title": "[variables('blanks')]"
                                },
                                "items": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "ip": {
                                        "type": "string",
                                        "description": "ip"
                                      },
                                      "description": {
                                        "type": "string",
                                        "description": "description"
                                      },
                                      "created": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "created",
                                        "title": "[variables('blanks')]",
                                        "default": 1
                                      }
                                    }
                                  },
                                  "description": "items"
                                }
                              },
                              "required": [
                                "command",
                                "customer_name"
                              ]
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "Error": {
                                  "type": "string",
                                  "description": "Error"
                                },
                                "Ok": {
                                  "type": "string",
                                  "description": "Ok"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/tx_api/v1/rules": {
                      "post": {
                        "summary": "List or Create Customer Rule",
                        "description": "List or Create Customer Rule",
                        "operationId": "[[variables('_operationId-Create_Customer_Rule')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "command": {
                                  "type": "string",
                                  "description": "command",
                                  "title": "[variables('blanks')]",
                                  "enum": [
                                    "new_customer_rule",
                                    "list_customer_rules"
                                  ]
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token",
                                  "title": "[variables('blanks')]"
                                },
                                "customer_name": {
                                  "type": "string",
                                  "description": "customer_name",
                                  "title": "[variables('blanks')]"
                                },
                                "rule": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "id"
                                    },
                                    "name": {
                                      "type": "string",
                                      "description": "name"
                                    },
                                    "description": {
                                      "type": "string",
                                      "description": "description"
                                    },
                                    "version_support": {
                                      "type": "string",
                                      "description": "version_support"
                                    },
                                    "classification": {
                                      "type": "string",
                                      "description": "classification",
                                      "title": "[variables('blanks')]",
                                      "enum": [
                                        "InfoLeak",
                                        "BadTraffic",
                                        "SqlInjection",
                                        "XSS",
                                        "RFI",
                                        "SessionHijacking",
                                        "DirTraversal",
                                        "Evasion",
                                        "Scan",
                                        "DOS",
                                        "Scanner",
                                        "BruteForce",
                                        "Executable",
                                        "WebMapping",
                                        "WebAttack",
                                        "BadHttpCode",
                                        "TrojanActivity',",
                                        "Drupal,",
                                        "Wordpress,"
                                      ]
                                    },
                                    "webtech": {
                                      "type": "string",
                                      "description": "webtech"
                                    },
                                    "state": {
                                      "type": "string",
                                      "description": "state",
                                      "title": "[variables('blanks')]",
                                      "enum": [
                                        "Recon",
                                        "Scanning",
                                        "WebMapping",
                                        "BruteForce",
                                        "Ddos",
                                        "Exploitation",
                                        "MalwareComm"
                                      ]
                                    },
                                    "contributing_score": {
                                      "type": "string",
                                      "description": "contributing_score"
                                    },
                                    "risk": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "risk"
                                    },
                                    "blocking": {
                                      "type": "boolean",
                                      "description": "blocking",
                                      "title": "[variables('blanks')]",
                                      "enum": [
                                        "",
                                        true,
                                        false
                                      ]
                                    },
                                    "tarpit": {
                                      "type": "string",
                                      "description": "tarpit"
                                    },
                                    "interogate": {
                                      "type": "string",
                                      "description": "interogate"
                                    },
                                    "beta": {
                                      "type": "string",
                                      "description": "beta"
                                    },
                                    "tags": {
                                      "type": "string",
                                      "description": "tags"
                                    },
                                    "matches": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "match": {
                                            "type": "array",
                                            "description": "match"
                                          },
                                          "op": {
                                            "type": "string",
                                            "description": "op"
                                          },
                                          "type": {
                                            "type": "string",
                                            "description": "type",
                                            "title": "[variables('blanks')]",
                                            "default": "boolean"
                                          }
                                        }
                                      },
                                      "description": "matches"
                                    }
                                  },
                                  "description": "rule"
                                }
                              },
                              "required": [
                                "command",
                                "customer_name",
                                "token"
                              ]
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "Ok": {
                                  "type": "string",
                                  "description": "Ok"
                                },
                                "Error": {
                                  "type": "string",
                                  "description": "Error"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/tx_api/v1/entities": {
                      "post": {
                        "summary": "Get Entities",
                        "description": "Get Entities",
                        "operationId": "[[variables('_operationId-Get_Entities')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "command": {
                                  "type": "string",
                                  "description": "command",
                                  "title": "[variables('blanks')]"
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token",
                                  "title": "[variables('blanks')]"
                                },
                                "customer_name": {
                                  "type": "string",
                                  "description": "customer_name",
                                  "title": "[variables('blanks')]"
                                },
                                "query": {
                                  "type": "object",
                                  "properties": {
                                    "ip_addresses": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "description": "ip_addresses"
                                    }
                                  },
                                  "description": "query"
                                }
                              },
                              "required": [
                                "command",
                                "customer_name",
                                "token"
                              ]
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "id": {
                                  "type": "string",
                                  "description": "id"
                                },
                                "codename": {
                                  "type": "string",
                                  "description": "codename"
                                },
                                "actors": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "id": {
                                        "type": "string",
                                        "description": "id"
                                      },
                                      "entity_id": {
                                        "type": "string",
                                        "description": "entity_id"
                                      },
                                      "entity_codename": {
                                        "type": "string",
                                        "description": "entity_codename"
                                      },
                                      "ip_address": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "ip_address"
                                      },
                                      "ip_addr": {
                                        "type": "string",
                                        "description": "ip_addr"
                                      },
                                      "state": {
                                        "type": "string",
                                        "description": "state"
                                      },
                                      "state_update": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "state_update"
                                      },
                                      "seq_blocks": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "seq_blocks"
                                      },
                                      "tags": {
                                        "type": "string",
                                        "description": "tags"
                                      },
                                      "interval_time_start": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "interval_time_start"
                                      },
                                      "interval_time_stop": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "interval_time_stop"
                                      },
                                      "is_embargoed": {
                                        "type": "boolean",
                                        "description": "is_embargoed"
                                      },
                                      "is_tor_exit": {
                                        "type": "boolean",
                                        "description": "is_tor_exit"
                                      },
                                      "geo_country": {
                                        "type": "string",
                                        "description": "geo_country"
                                      },
                                      "reputation": {
                                        "type": "integer",
                                        "format": "int32",
                                        "description": "reputation"
                                      },
                                      "geo_coordinates": {
                                        "type": "object",
                                        "properties": {
                                          "x": {
                                            "type": "number",
                                            "format": "float",
                                            "description": "x"
                                          },
                                          "y": {
                                            "type": "number",
                                            "format": "float",
                                            "description": "y"
                                          }
                                        },
                                        "description": "geo_coordinates"
                                      },
                                      "fingerprint": {
                                        "type": "object",
                                        "properties": {
                                          "count": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "count"
                                          },
                                          "last_seen": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "last_seen"
                                          },
                                          "user_agent": {
                                            "type": "string",
                                            "description": "user_agent"
                                          },
                                          "cookie": {
                                            "type": "string",
                                            "description": "cookie"
                                          },
                                          "js_fingerprint": {
                                            "type": "integer",
                                            "format": "int32",
                                            "description": "js_fingerprint"
                                          }
                                        },
                                        "description": "fingerprint"
                                      }
                                    }
                                  },
                                  "description": "actors"
                                },
                                "last_seen_intensity": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "last_seen_intensity"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/tx_api/v2/logs": {
                      "post": {
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "summary": "Event Logs",
                        "description": "Event Logs",
                        "operationId": "[[variables('_operationId-Event_Logs')]",
                        "parameters": [
                          {
                            "name": "Content-Type",
                            "in": "header",
                            "required": true,
                            "type": "string",
                            "default": "application/json"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "command": {
                                  "type": "string",
                                  "description": "command",
                                  "title": "[variables('blanks')]",
                                  "default": "match_events"
                                },
                                "token": {
                                  "type": "string",
                                  "description": "token",
                                  "title": "[variables('blanks')]"
                                },
                                "customer_name": {
                                  "type": "string",
                                  "description": "customer_name",
                                  "title": "[variables('blanks')]"
                                },
                                "limit": {
                                  "type": "integer",
                                  "format": "int32",
                                  "description": "limit",
                                  "title": "[variables('blanks')]",
                                  "default": 100
                                },
                                "ip_addresses": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "title": "[variables('blanks')]"
                                  },
                                  "description": "ip_addresses"
                                }
                              },
                              "required": [
                                "command",
                                "customer_name",
                                "limit",
                                "token"
                              ]
                            }
                          }
                        ]
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "ThreatXCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "ThreatX-BlockIP-URL playbook",
        "displayName": "ThreatX-BlockIP-URL playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "ThreatX-BlockIP-URL Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "ThreatX-BlockIP-URL",
              "type": "string"
            },
            "Customer name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Tenant name"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where secret key is stored"
              }
            },
            "Threatx Key name": {
              "type": "string",
              "metadata": {
                "description": "Your Key name for the api secret stored in keyvault under secrets"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "ThreatX-WAFCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all ThreatXCloud automation playbooks as well"
              }
            }
          },
          "variables": {
            "Threatx-WafcustomconnectorConnectionName": "[[concat('Threatx-Wafcustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Customer_name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Customer name')]"
                    },
                    "Threatx_Key_name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Threatx Key name')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Appending_blocklist_IP_to_oldblockip's": {
                      "foreach": "@body('Parse_JSON_of_blocklist_response')?['Ok']",
                      "actions": {
                        "Append_to_array_variable_4": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "Oldblockip",
                            "value": "@items('Appending_blocklist_IP_to_oldblockip''s')?['ip']"
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_of_blocklist_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Condition_4": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Get-Post_Blacklist_Blocklist_Whitelist_3": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>Provided Ip's are succesfully blocked at threatX .<br>\n<br>\n@{outputs('Compose')}<br>\n</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Compose": {
                          "runAfter": {
                            "For_each_-_creating_final_payload_of_IP's": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@variables('payload')"
                        },
                        "For_each_-_creating_final_payload_of_IP's": {
                          "foreach": "@variables('tempip')",
                          "actions": {
                            "Append_to_array_variable_6": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "payload",
                                "value": {
                                  "created": 1,
                                  "description": "Blocked by sentinel's @{triggerBody()?['object']?['properties']?['title']}",
                                  "ip": "@{items('For_each_-_creating_final_payload_of_IP''s')}"
                                }
                              }
                            }
                          },
                          "type": "Foreach"
                        },
                        "Get-Post_Blacklist_Blocklist_Whitelist_3": {
                          "runAfter": {
                            "Compose": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "command": "bulk_new_blacklist",
                              "customer_name": "@parameters('Customer_name')",
                              "items": "@variables('payload')",
                              "token": "@body('Login_Generate_Token')?['Ok']?['token']"
                            },
                            "headers": {
                              "Content-Type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/tx_api/v1/lists"
                          }
                        }
                      },
                      "runAfter": {
                        "for_loop_-_Checking_final_IP's_to_be_block_or_blacklist": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)_2": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>There is no IP's to be blocked / or provided one's are already blocked&nbsp;</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('tempip'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Condition_7": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_4": {
                          "runAfter": {
                            "List_or_Create_Customer_Rule_2": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>URL's has been blocked at threatx :<br>\nDetails provided below :<br>\n<br>\n@{variables('finaluri')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "For_each_-creating_final_payload": {
                          "foreach": "@variables('finaluri')",
                          "actions": {
                            "Append_to_array_variable_10": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "tempuri",
                                "value": {
                                  "match": {
                                    "match": "@{items('For_each_-creating_final_payload')}",
                                    "type": "contains"
                                  },
                                  "type": "uri"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Setting_variable_to_null_,_for_reuse": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "List_or_Create_Customer_Rule_2": {
                          "runAfter": {
                            "Set_variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "command": "new_customer_rule",
                              "customer_name": "@parameters('Customer_name')",
                              "rule": {
                                "blocking": true,
                                "classification": "BadTraffic",
                                "description": "@{variables('randvar')} - Blocked url by sentinel's @{triggerBody()?['object']?['properties']?['title']}",
                                "id": "@variables('randvar')",
                                "matches": [
                                  {
                                    "match": "@variables('tempuri')",
                                    "op": "or",
                                    "type": "boolean"
                                  }
                                ],
                                "risk": 20,
                                "state": "BruteForce"
                              },
                              "token": "@body('Login_Generate_Token')?['Ok']?['token']"
                            },
                            "headers": {
                              "Content-Type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/tx_api/v1/rules"
                          }
                        },
                        "Set_variable": {
                          "runAfter": {
                            "For_each_-creating_final_payload": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "randvar",
                            "value": "@rand(910000,999999)"
                          }
                        },
                        "Setting_variable_to_null_,_for_reuse": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "tempuri",
							"value": []
                          }
                        }
                      },
                      "runAfter": {
                        "For_each_-_checking_final_uri_to_be_blocked_": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)_3": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>There is no new url's to be blocked or none are provided</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('finaluri'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Creating_array_of_blocking_URL's": {
                      "foreach": "@body('Parse_JSON')",
                      "actions": {
                        "Condition_2": {
                          "actions": {
                            "Append_to_array_variable_2": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "Blockstrings",
                                "value": "@items('Creating_array_of_blocking_URL''s')?['properties']?['friendlyName']"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@items('Creating_array_of_blocking_URL''s')['kind']",
                                  "Url"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Login_Generate_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each": {
                      "foreach": "@body('Parse_JSON_response_of_List_customer_')?['Ok']",
                      "actions": {
                        "For_each_2": {
                          "foreach": "@items('For_each')?['matches']",
                          "actions": {
                            "For_each_3": {
                              "foreach": "@items('For_each_2')['match']",
                              "actions": {
                                "Condition_5": {
                                  "actions": {
                                    "Append_to_array_variable_7": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "oldblockedurl",
                                        "value": "@items('For_each_3')?['match']"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@items('For_each_3')?['type']",
                                          "uri"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_response_of_List_customer_": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_-_checking_final_uri_to_be_blocked_": {
                      "foreach": "@variables('Blockstrings')",
                      "actions": {
                        "Condition_6": {
                          "actions": {
                            "Append_to_array_variable_9": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "finaluri",
                                "value": "@items('For_each_-_checking_final_uri_to_be_blocked_')"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "contains": [
                                    "@variables('tempuri')",
                                    "@items('For_each_-_checking_final_uri_to_be_blocked_')"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "For_each_-_refining_uri_strings_to_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_-_refining_uri_strings_to_array": {
                      "foreach": "@body('Parse_JSON_2')",
                      "actions": {
                        "Append_to_array_variable_8": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "tempuri",
                            "value": "@items('For_each_-_refining_uri_strings_to_array')['match']"
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_2": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get-Post_Blacklist_Blocklist_Whitelist": {
                      "runAfter": {
                        "creating_array_of_blocking_IP's": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "command": "list_blacklist",
                          "customer_name": "@parameters('Customer_name')",
                          "token": "@body('Login_Generate_Token')?['Ok']?['token']"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/tx_api/v1/lists"
                      }
                    },
                    "Get-Post_Blacklist_Blocklist_Whitelist_2": {
                      "runAfter": {
                        "appending_blacklist_IP_to_oldblockip's": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "command": "list_blocklist",
                          "customer_name": "@parameters('Customer_name')",
                          "token": "@body('Login_Generate_Token')?['Ok']?['token']"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/tx_api/v1/lists"
                      }
                    },
                    "Get_secret": {
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Threatx_Key_name'))}/value"
                      }
                    },
                    "Initialize_array_for_block_URL_strings": {
                      "runAfter": {
                        "Initialize_array_for_storing_block_IP's": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Blockstrings",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_array_for_storing_block_IP's": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "blockip",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_array_for_storing_old_blocked_IP's": {
                      "runAfter": {
                        "Initialize_array_for_block_URL_strings": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Oldblockip",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_array_for_storing_old_blocked_URL's": {
                      "runAfter": {
                        "Initialize_array_for_storing_old_blocked_IP's": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "oldblockedurl",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_temp_variable": {
                      "runAfter": {
                        "Initialize_array_for_storing_old_blocked_URL's": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "tempip",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_temp_variable_for_uri": {
                      "runAfter": {
                        "Initialize_temp_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "tempuri",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_-_temp_variable_for_storing_final_uri_to_be_blocked": {
                      "runAfter": {
                        "Initialize_temp_variable_for_uri": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "finaluri",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_for_final_payload_IP": {
                      "runAfter": {
                        "Initialize_variable_-_temp_variable_for_storing_final_uri_to_be_blocked": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "payload",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_for_storing_random_number": {
                      "runAfter": {
                        "Initialize_variable_for_final_payload_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "randvar",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "List_or_Create_Customer_Rule": {
                      "runAfter": {
                        "Creating_array_of_blocking_URL's": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "command": "list_customer_rules",
                          "customer_name": "@parameters('Customer_name')",
                          "token": "@body('Login_Generate_Token')?['Ok']?['token']"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/tx_api/v1/rules"
                      }
                    },
                    "Login_Generate_Token": {
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "api_token": "@body('Get_secret')?['value']",
                          "command": "login"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/tx_api/v1/login"
                      }
                    },
                    "Parse_JSON": {
                      "runAfter": {
                        "Initialize_variable_for_storing_random_number": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "kind": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "address": {
                                    "type": "string"
                                  },
                                  "friendlyName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "type",
                              "kind",
                              "properties"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    },
                    "Parse_JSON_2": {
                      "runAfter": {
                        "For_each": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@variables('oldblockedurl')",
                        "schema": {
                          "items": {
                            "properties": {
                              "match": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "match",
                              "type"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    },
                    "Parse_JSON_of_Blacklist_response": {
                      "runAfter": {
                        "Get-Post_Blacklist_Blocklist_Whitelist": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Get-Post_Blacklist_Blocklist_Whitelist')",
                        "schema": {
                          "properties": {
                            "Ok": {
                              "items": {
                                "properties": {
                                  "created": {
                                    "type": "integer"
                                  },
                                  "description": {
                                    "type": "string"
                                  },
                                  "ip": {
                                    "type": "string"
                                  },
                                  "username": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "ip",
                                  "description",
                                  "created",
                                  "entity_hash",
                                  "entity_id",
                                  "username",
                                  "expires_at"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_JSON_of_blocklist_response": {
                      "runAfter": {
                        "Get-Post_Blacklist_Blocklist_Whitelist_2": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Get-Post_Blacklist_Blocklist_Whitelist_2')",
                        "schema": {
                          "properties": {
                            "Ok": {
                              "items": {
                                "properties": {
                                  "created": {
                                    "type": "integer"
                                  },
                                  "description": {
                                    "type": "string"
                                  },
                                  "ip": {
                                    "type": "string"
                                  },
                                  "username": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "ip",
                                  "description",
                                  "created",
                                  "entity_hash",
                                  "entity_id",
                                  "username",
                                  "expires_at"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Parse_JSON_response_of_List_customer_": {
                      "runAfter": {
                        "List_or_Create_Customer_Rule": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('List_or_Create_Customer_Rule')",
                        "schema": {
                          "properties": {
                            "Ok": {
                              "items": {
                                "properties": {
                                  "blocking": {
                                    "type": "boolean"
                                  },
                                  "classification": {
                                    "type": "string"
                                  },
                                  "description": {
                                    "type": "string"
                                  },
                                  "id": {
                                    "type": "integer"
                                  },
                                  "matches": {
                                    "items": {
                                      "properties": {
                                        "match": {
                                          "items": {
                                            "properties": {
                                              "match": {
                                                "properties": {
                                                  "match": {
                                                    "type": "string"
                                                  },
                                                  "type": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "type": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "match",
                                              "type"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "op": {
                                          "type": "string"
                                        },
                                        "type": {
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "match",
                                        "op",
                                        "type"
                                      ],
                                      "type": "object"
                                    },
                                    "type": "array"
                                  },
                                  "risk": {
                                    "type": "integer"
                                  },
                                  "state": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "id",
                                  "name",
                                  "description",
                                  "version_support",
                                  "classification",
                                  "webtech",
                                  "state",
                                  "contributing_score",
                                  "risk",
                                  "blocking",
                                  "tarpit",
                                  "interogate",
                                  "beta",
                                  "tags",
                                  "matches"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "appending_blacklist_IP_to_oldblockip's": {
                      "foreach": "@body('Parse_JSON_of_Blacklist_response')?['Ok']",
                      "actions": {
                        "Append_to_array_variable_3": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "Oldblockip",
                            "value": "@items('appending_blacklist_IP_to_oldblockip''s')?['ip']"
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_of_Blacklist_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "creating_array_of_blocking_IP's": {
                      "foreach": "@body('Parse_JSON')",
                      "actions": {
                        "Condition": {
                          "actions": {
                            "Append_to_array_variable": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "blockip",
                                "value": "@items('creating_array_of_blocking_IP''s')?['properties']?['address']"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@items('creating_array_of_blocking_IP''s')['kind']",
                                  "Ip"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Login_Generate_Token": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "for_loop_-_Checking_final_IP's_to_be_block_or_blacklist": {
                      "foreach": "@variables('blockip')",
                      "actions": {
                        "Condition_3": {
                          "actions": {
                            "Append_to_array_variable_5": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "tempip",
                                "value": "@items('for_loop_-_Checking_final_IP''s_to_be_block_or_blacklist')"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "contains": [
                                    "@variables('Oldblockip')",
                                    "@items('for_loop_-_Checking_final_IP''s_to_be_block_or_blacklist')"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Appending_blocklist_IP_to_oldblockip's": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "ThreatX-WAFCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Threatx-WafcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('Threatx-WafcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "ThreatX-BlockIP-URL",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('Threatx-WafcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Threatx-WafcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('Threatx-WafcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-4')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "ThreatXCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_ThreatXCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Block IP & URL on ThreatX-WAF cloud",
            "description": "This Playbook Provides the automation on blocking the suspicious/malicious IP and URL on ThreatX cloud waf",
            "prerequisites": [
              "1. ThreatX-WAF Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API Key . To get API Key, login into your ThreatX cloud instance dashboard and navigate to Settings --> API Key --> Add Api key",
              "3. [Important step]Store the API secret key in Key vault and provide the key name of the stored secret during deployment"
            ],
            "postDeployment": [
              "1. During deployment you need to provide your tenant name ,Key vault name and key name of stored secret key."
            ],
            "lastUpdateTime": "2022-09-05T00:00:00Z",
            "entities": [
              "ip",
              "url"
            ],
            "tags": [
              "Enrichment",
              "ThreatX",
              "WAF",
              "Cloud WAF",
              "Block IP",
              "Block URL"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "ThreatX-Enrichment playbook",
        "displayName": "ThreatX-Enrichment playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "ThreatX-Enrichment Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "ThreatX-Enrichment",
              "type": "string"
            },
            "customer name": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Tenant Name"
              }
            },
            "Keyvault name": {
              "defaultValue": "",
              "type": "String",
              "metadata": {
                "description": "Enter the key vault name where secret key is stored"
              }
            },
            "Threatx Key name": {
              "defaultValue": "",
              "type": "string",
              "metadata": {
                "description": "Your Key name for the api secret stored in keyvault under secrets"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "ThreatX-WAFCustomConnector",
              "type": "string",
              "metadata": {
                "description": "Name of the custom connector, if you want to change the default name, make sure to use the same in all ThreatXCloud automation playbooks as well"
              }
            }
          },
          "variables": {
            "Threatx-WafcustomconnectorConnectionName": "[[concat('Threatx-Wafcustomconnector-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "KeyvaultConnectionName": "[[concat('Keyvault-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/', 'keyvault')]",
            "_connection-4": "[[variables('connection-4')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "customer_name": {
                      "type": "string",
                      "defaultValue": "[[parameters('customer name')]"
                    },
                    "Threatx_Key_name": {
                      "type": "string",
                      "defaultValue": "[[parameters('Threatx Key name')]"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Condition_2": {
                      "actions": {
                        "Add_comment_to_incident_(V3)_2": {
                          "runAfter": {
                            "Create_HTML_table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>@{body('Create_HTML_table')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Create_HTML_table": {
                          "runAfter": {
                            "For_each": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('result_entities')"
                          }
                        },
                        "Event_Logs": {
                          "runAfter": {
                            "Login_Generate_Token": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "command": "match_events",
                              "customer_name": "@parameters('customer_name')",
                              "ip_addresses": "@variables('enrichip')",
                              "limit": 100,
                              "token": "@body('Login_Generate_Token')?['Ok']?['token']"
                            },
                            "headers": {
                              "Content-Type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/tx_api/v2/logs"
                          }
                        },
                        "For_each": {
                          "foreach": "@body('Parse_JSON')?['Ok']?['data']",
                          "actions": {
                            "For_each_2": {
                              "foreach": "@items('For_each')['rules']",
                              "actions": {
                                "Append_to_array_variable_2": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "result_entities",
                                    "value": {
                                      "Source_ip": "@items('For_each')?['ip']",
                                      "blocking": "@items('For_each_2')?['blocking']",
                                      "content_type": "@items('For_each')?['content_type']",
                                      "contrib_score": "@items('For_each_2')?['contrib_score']",
                                      "cookie": "@items('For_each')?['cookie']",
                                      "dest_host": "@items('For_each')?['dst_host']",
                                      "js_fingerprint": "@items('For_each')?['js_fingerprint']",
                                      "postblock_event": "@items('For_each')?['postblock_event']",
                                      "request_method": "@items('For_each')?['request_method']",
                                      "risk": "@items('For_each')?['risk']",
                                      "rule_classification": "@items('For_each_2')?['classification']",
                                      "rule_description": "@items('For_each_2')?['description']",
                                      "rule_state": "@items('For_each_2')?['state']",
                                      "ssl": "@items('For_each')?['ssl']",
                                      "status_code": "@items('For_each')?['status_code']",
                                      "timestamp": "@items('For_each')?['timestamp']",
                                      "tls_fingerprint": "@items('For_each')?['tls_fingerprint']",
                                      "uri": "@items('For_each')?['uri']",
                                      "user_agent": "@items('For_each')?['user_agent']"
                                    }
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Login_Generate_Token": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "api_token": "@body('Get_secret')?['value']",
                              "command": "login"
                            },
                            "headers": {
                              "Content-Type": "application/json"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['ThreatX-WAFCustomConnector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/tx_api/v1/login"
                          }
                        },
                        "Parse_JSON": {
                          "runAfter": {
                            "Event_Logs": [
                              "Succeeded"
                            ]
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Event_Logs')",
                            "schema": {
                              "properties": {
                                "Ok": {
                                  "properties": {
                                    "data": {
                                      "items": {
                                        "properties": {
                                          "args": {
                                            "type": "string"
                                          },
                                          "content_length": {
                                            "type": "integer"
                                          },
                                          "dst_host": {
                                            "type": "string"
                                          },
                                          "ip": {
                                            "type": "string"
                                          },
                                          "js_fingerprint": {
                                            "type": "string"
                                          },
                                          "postblock_event": {
                                            "type": "boolean"
                                          },
                                          "random_id": {
                                            "type": "string"
                                          },
                                          "request_id": {
                                            "type": "string"
                                          },
                                          "request_method": {
                                            "type": "string"
                                          },
                                          "risk": {
                                            "type": "integer"
                                          },
                                          "rules": {
                                            "items": {
                                              "properties": {
                                                "beta": {
                                                  "type": "boolean"
                                                },
                                                "blocking": {
                                                  "type": "boolean"
                                                },
                                                "classification": {
                                                  "type": "string"
                                                },
                                                "contrib_score": {
                                                  "type": "integer"
                                                },
                                                "description": {
                                                  "type": "string"
                                                },
                                                "id": {
                                                  "type": "integer"
                                                },
                                                "risk": {
                                                  "type": "integer"
                                                },
                                                "state": {
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "id",
                                                "description",
                                                "classification",
                                                "state",
                                                "contrib_score",
                                                "risk",
                                                "blocking",
                                                "beta"
                                              ],
                                              "type": "object"
                                            },
                                            "type": "array"
                                          },
                                          "ssl": {
                                            "type": "boolean"
                                          },
                                          "status_code": {
                                            "type": "integer"
                                          },
                                          "timestamp": {
                                            "type": "string"
                                          },
                                          "uri": {
                                            "type": "string"
                                          },
                                          "user_agent": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "timestamp",
                                          "request_id",
                                          "user_agent",
                                          "ip",
                                          "dst_host",
                                          "uri",
                                          "args",
                                          "status_code",
                                          "ssl",
                                          "risk",
                                          "request_method",
                                          "content_type",
                                          "content_length",
                                          "postblock_event",
                                          "random_id",
                                          "tls_fingerprint",
                                          "cookie",
                                          "js_fingerprint",
                                          "rules"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "is_complete": {
                                      "type": "boolean"
                                    },
                                    "last_seen_key": {
                                      "properties": {
                                        "request_id": {
                                          "type": "string"
                                        },
                                        "timestamp": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Get_secret": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_comment_to_incident_(V3)": {
                            "type": "ApiConnection",
                            "inputs": {
                              "body": {
                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                "message": "<p>No IP's are provided for the enrichment from threat X</p>"
                              },
                              "host": {
                                "connection": {
                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                }
                              },
                              "method": "post",
                              "path": "/Incidents/Comment"
                            }
                          }
                        }
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('enrichip'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "For_each_-_collecting_IP's_from_incident_response": {
                      "foreach": "@body('Parse_JSON_-_response_from_sentinel_incident')",
                      "actions": {
                        "Condition": {
                          "actions": {
                            "Append_to_array_variable": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "enrichip",
                                "value": "@items('For_each_-_collecting_IP''s_from_incident_response')?['properties']?['address']"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@items('For_each_-_collecting_IP''s_from_incident_response')['kind']",
                                  "Ip"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Parse_JSON_-_response_from_sentinel_incident": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_secret": {
                      "runAfter": {
                        "For_each_-_collecting_IP's_from_incident_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['keyvault']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/secrets/@{encodeURIComponent(parameters('Threatx_Key_name'))}/value"
                      }
                    },
                    "Initialize_variable_for_collecting_IP's_to_be_enriched": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "enrichip",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Initialize_variable_for_storing_result_of_entities": {
                      "runAfter": {
                        "Initialize_variable_for_collecting_IP's_to_be_enriched": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "result_entities",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Parse_JSON_-_response_from_sentinel_incident": {
                      "runAfter": {
                        "Initialize_variable_for_storing_result_of_entities": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "schema": {
                          "items": {
                            "properties": {
                              "kind": {
                                "type": "string"
                              },
                              "properties": {
                                "properties": {
                                  "address": {
                                    "type": "string"
                                  },
                                  "friendlyName": {
                                    "type": "string"
                                  }
                                },
                                "type": "object"
                              },
                              "type": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "type",
                              "kind",
                              "properties"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "ThreatX-WAFCustomConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Threatx-WafcustomconnectorConnectionName'))]",
                        "connectionName": "[[variables('Threatx-WafcustomconnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "keyvault": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]",
                        "connectionName": "[[variables('KeyvaultConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Keyvault')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "ThreatX-Enrichment",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('Threatx-WafcustomconnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('KeyvaultConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Threatx-WafcustomconnectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('Threatx-WafcustomconnectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/Connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('KeyvaultConnectionName')]",
              "kind": "V1",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-4')]",
                  "type": "Microsoft.Web/locations/managedApis"
                },
                "parameterValueType": "Alternative",
                "alternativeParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                },
                "displayName": "[[variables('KeyvaultConnectionName')]",
                "nonSecretParameterValues": {
                  "vaultName": "[[parameters('keyvault name')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "ThreatXCloud",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_ThreatXCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Fetch Threat Intel from ThreatX",
            "description": "This playbook provides/updates the threat intel and essential details in comments section of triggered incident so that SOC analysts can directly take corrective measure to stop the attack",
            "prerequisites": [
              "1. ThreatX-WAF Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription.",
              "2. API Key . To get API Key, login into your ThreatX cloud instance dashboard and navigate to Settings --> API Key --> Add Api key",
              "3. [Important step]Store the API secret key in Key vault and provide the key name of the stored secret during deployment"
            ],
            "postDeployment": [
              "1. During deployment you need to provide your tenant name ,Key vault name and key name of stored secret key."
            ],
            "lastUpdateTime": "2022-09-15T00:00:00Z",
            "entities": [
              "ip"
            ],
            "tags": [
              "Enrichment",
              "Notification",
              "ThreatIntelligence",
              "ThreatX",
              "WAF"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "ThreatXCloud",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_ThreatXCustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_ThreatX-BlockIP-URL')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_ThreatX-Enrichment')]",
              "version": "[variables('playbookVersion3')]"
            }
          ]
        },
        "firstPublishDate": "2022-09-23",
        "lastPublishDate": "2022-09-23",
        "providers": [
          "ThreatXCloud"
        ],
        "categories": {
          "domains": [
            "Security  Automation (SOAR)",
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
