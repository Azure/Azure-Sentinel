{
    "name": "IllumioInsightsDefinition",
    "apiVersion": "2022-09-01-preview",
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "IllumioInsightsDefinition",
            "title": "Illumio Insights",
            "descriptionMarkdown": "The Illumio Insights data connector allows ingesting logs from the Illumio API into Microsoft Sentinel. The data connector is built on Microsoft Sentinel Codeless Connector Platform. It uses the Illumio API to fetch logs and it supports DCR-based ingestion time transformations that parses the received security data into a custom table so that queries don't need to parse it again, thus resulting in better performance.",
            "publisher": "Microsoft",
            "graphQueries": [
                {
                    "metricName": "Total incident logs received",
                    "legend": "Illumio Insights incident Logs",
                    "baseQuery": "IlumioInsights"
                }
            ],
            "sampleQueries": [
                {
                    "description": "Get Sample of Illumio Insights logs",
                    "query": "IlumioInsights| take 10"
                }
            ],
            "dataTypes": [
                {
                    "name": "IlumioInsights",
                    "lastDataReceivedQuery": "IlumioInsights\n       | where TimeGenerated > ago(12h)                | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors",
                    "value": null
                }
            ],
            "availability": {
                "status": 1,
                "isPreview": false
            },
            "permissions": {
                "tenant": null,
                "licenses": null,
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "read": true,
                            "write": true,
                            "delete": true,
                            "action": false
                        }
                    }
                ]
            },
            "instructionSteps": [
                {
                    "instructions": [
                        {
                            "type": "Markdown",
                            "parameters": {
                                "content": "#### Configuration steps for the Illumio Insights API\n\n**Prerequisites**\n- Register and Login to Illumio Console with valid credentials\n- Client Credentials need to be stored in Microsoft Sentinel account for the tenant\n\n**Step 1: Register the Service Account**\n1. Go to **Illumio Console → Access → Service Accounts**\n2. Create a service account for the tenant\n3. Once you create a service account, you will receive the client credentials\n4. Copy the **Username** (API Key) and the **Secret**\n\n**Step 2: Add Client Credentials to Sentinel Account**\n- Add the API key and secret to Sentinel Account for tenant authentication\n- These credentials will be used to authenticate calls to the Illumio SaaS API\n\n**Step 3: API Usage**\nThe connector will use these credentials to call the Illumio SaaS API:\n- **Endpoint**: `GET https://insights.graph.illum.io/api/v1/resource-insights`\n- **Required Headers**:\n  - `x-azure-tenant-id`: Your Azure tenant ID\n  - `x-illumio-tenant-id`: Your Illumio tenant ID\n  - `x-auth-key`: The API key obtained from step 1\n\n**Authentication Validation**\nIllumio validates the request against:\n- Signature against Entra ID's public keys\n- Audience (aud) matches your API's App ID URI\n- Issuer validation\n\nPlease fill in the required fields below with the credentials obtained from the Illumio Console:"
                            }
                        },
                        {
							"type": "CopyableLabel",
							"parameters": {
								"label": "Tenant ID (Directory ID)",
								"fillWith": [
									"TenantId"
								]
							}
						},
                        {
                            "parameters": {
                                "label": "Azure tenant Id ",
                                "placeholder": "{tenantId}",
                                "type": "text",
                                "name": "tenantId"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "Illumio Tenant Id",
                                "placeholder": "{illumioTenantId}",
                                "type": "text",
                                "name": "illumioTenantId"
                            },
                            "type": "Textbox"
                        },
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "API Token",
                                "placeholder": "API Token",
                                "type": "password",
                                "name": "apiToken"
                            }
                        },
                        {
                            "parameters": {
                                "label": "toggle",
                                "name": "toggle"
                            },
                            "type": "ConnectionToggleButton"
                        }
                    ],
                    "innerSteps": null
                }
            ],
            "isConnectivityCriteriasMatchSome": false
        }
    }
}
