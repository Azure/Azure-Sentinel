{
    "type": "Microsoft.SecurityInsights/dataConnectors",
    "apiVersion": "2021-10-01-preview",
    "name": "IllumioInsights",
    "location": "{{location}}",
    "kind": "RestApiPoller",
    "properties": {
        "connectorDefinitionName": "IllumioInsightsDefinition",
        "dataType": "IlumioInsights",
        "auth": {
            "type": "APIKey",
            "ApiKey": "[[parameters('apiToken')]",
            "ApiKeyName": "X-api-secret"
        },
        "request": {
            "apiEndpoint": "https://gw.console.illum.io/api/v1/resource-insights",
            "queryWindowInMin": 15,
            "queryTimeFormat": "UnixTimestampInMills",
            "queryParameters": {
                "after": "{_QueryWindowEndTime}"
            },
            "timeoutInSeconds": 60,
            "rateLimitQPS": 10,
            "headers": {
                "Accept": "application/json",
                "User-Agent": "Scuba",                
                "x-illumio-tenant-id": "{{illumioTenantId}}",                
                "X-api-key": "[[parameters('apiKey')]"
            },
            "httpMethod": "Get"
        },
        "response": {
            "eventsJsonPaths": [
                "$"
            ],
            "ConvertChildPropertiesToArray": true,
            "format": "json"
        },
        "dcrConfig": {
            "streamName": "ILUMIO_INSIGHTS",
            "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
            "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}"
        }
    }
}