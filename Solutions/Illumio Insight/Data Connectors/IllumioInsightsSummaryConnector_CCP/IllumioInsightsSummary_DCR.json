{
  "name": "IllumioInsightsSummaryDCR",
  "apiVersion": "2021-09-01-preview",
  "type": "Microsoft.Insights/dataCollectionRules",
  "location": "{{location}}",
  "properties": {
    "dataCollectionEndpointId": "{{DataCollectionEndpointId}}",
    "streamDeclarations": {
      "Custom-IllumioInsightsSummary_CL": {
        "columns": [
          {
            "name": "ReportId",
            "type": "string"
          },
          {
            "name": "SummaryStartDate",
            "type": "string"
          },
          {
            "name": "SummaryEndDate",
            "type": "string"
          },
          {
            "name": "ComparisonStartDate",
            "type": "string"
          },
          {
            "name": "ComparisonEndDate",
            "type": "string"
          },
          {
            "name": "CreatedAt",
            "type": "long"
          },
          {
            "name": "Persona",
            "type": "string"
          },
          {
            "name": "DataSources",
            "type": "dynamic"
          },
          {
            "name": "ReportPayload",
            "type": "string"
          },
          {
            "name": "IllumioTenantId",
            "type": "string"
          },
          {
            "name": "Tags",
            "type": "dynamic"
          }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "{{workspaceResourceId}}",
          "name": "clv2ws1"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-IllumioInsightsSummary_CL"
        ],
        "destinations": [
          "clv2ws1"
        ],
        "outputStream": "Custom-IllumioInsightsSummary_CL",
        "transformKql": "source | extend TimeGenerated = iff(isempty(CreatedAt), now(), datetime_add('millisecond', tolong(CreatedAt), datetime(1970-01-01))) , ReportPayload = todynamic(ReportPayload) | project TimeGenerated , ReportId , SummaryStartDate , SummaryEndDate , ComparisonStartDate , ComparisonEndDate , CreatedAt , Persona , DataSources , ReportPayload , IllumioTenantId , Tags"
      }
    ]
  }
}