id: b8330f6e-fc47-40ce-b225-5d3b055c6446
name: Top 10 Targeted Users (Malware+Phish+Spam)
description: |
  Identifies the top 10 users receiving inbound emails classified as malware, phishing, or spam.
  Based on concepts from the Defender for Office 365 solution in Sentinel: https://techcommunity.microsoft.com/blog/microsoftdefenderforoffice365blog/part-2-build-custom-email-security-reports-and-dashboards-with-workbooks-in-micr/4411303
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - EmailEvents
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  EmailEvents 
  | where (ThreatTypes has "Malware" or ThreatTypes has "Phish" or ThreatTypes has "Spam") and EmailDirection == "Inbound"
  | summarize count() by RecipientEmailAddress
  | sort by count_
  | top 10 by count_
  | render piechart
version: 1.0.0