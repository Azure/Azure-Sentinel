id: 18fee342-8209-4270-9198-711646867e71
name: Expanding recipients into separate rows
description: |
  This query helps hunt for recipients of Teams messages.
description-detailed: |
  This query helps hunt for recipients of Teams messages by expanding the recipient details into separate rows, using Microsoft Defender for Office 365 and Advance hunting in Microsoft Defender XDR
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - MessageEvents
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  //Analyzing recipient details with a separate row for each recipient
  MessageEvents
  | mv-expand Recipients = RecipientDetails
  | extend RecipientSmtpAddress = Recipients.RecipientSmtpAddress, RecipientDisplayName = Recipients.RecipientDisplayName, RecipientObjectId = Recipients.RecipientObjectId, RecipientType = Recipients.RecipientType
  version: 1.0.0