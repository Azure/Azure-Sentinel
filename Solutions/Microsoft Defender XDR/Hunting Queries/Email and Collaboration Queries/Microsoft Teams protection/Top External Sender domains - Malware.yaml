id: 90cd91d1-7b90-421c-a5c9-0479b6b7e6a2
name: Top External Sender domains - Malware
description: |
  Top External Sender domains sending Teams message with Malware threats
description-detailed: |
  This query helps hunt for Top External Sender domains sending Teams message with Malware threats, using Microsoft Defender for Office 365 and Advance hunting in Microsoft Defender XDR
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - MessageEvents
tactics:
  - InitialAccess
relevantTechniques:
  - T1566
query: |
  //Top External Sender domains sending Teams message with Malware threats
  MessageEvents
  | where IsExternalThread==1 and IsOwnedThread==0
  | where ThreatTypes contains "Malware"
  | extend SenderDomain = tostring(split(SenderEmailAddress, "@")[1])
  | summarize count() by SenderDomain
version: 1.0.0