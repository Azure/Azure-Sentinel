id: c5b3e559-7c44-442c-9e73-c753abb02c13
name: Suspicious Tomcat Confluence Process Launch
description: | 
  The query checks for suspicious Tomcat process launches associated with likely exploitation of Confluence - CVE-2022-26134.
description-detailed: |
  The query checks for suspicious Tomcat process launches associated with likely exploitation of Confluence - CVE-2022-26134
  Read more here:.
  https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html
  https://nvd.nist.gov/vuln/detail/CVE-2022-26134
  Tags: #exploit #CVE-2022-26134
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - DeviceProcessEvents
tactics:
  - Execution
  - PrivilegeEscalation
relevantTechniques:
  - T1203
query: |
  DeviceProcessEvents
  | where InitiatingProcessFileName hasprefix "tomcat" and InitiatingProcessCommandLine has "confluence"
  | where (ProcessCommandLine has_any("certutil", "whoami", "nltest", " dir ", "curl", "ifconfig", "cat ", "net user",
  "net time /domain","tasklist","-c ls","ipconfig","arp","ping","net view","net group","netstat", "wmic datafile"))
  or (FileName =~ "powershell.exe" and ProcessCommandLine hasprefix "-e") 
version: 1.0.0