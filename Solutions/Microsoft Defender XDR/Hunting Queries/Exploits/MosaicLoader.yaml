id: 0efbcea0-1dc0-4844-8a9c-3a1d98fc1697
name: MosaicLoader
description: |
  This hunting query looks Malware Hides Itself Among Windows Defender Exclusions to Evade Detection.
description-detailed: |
  This hunting query looks Malware Hides Itself Among Windows Defender Exclusions to Evade Detection.
requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - DeviceRegistryEvents
tactics:
  - CommandAndControl
query: |
  DeviceRegistryEvents 
  | where ((ActionType == "RegistryValueSet") and (RegistryKey startswith @"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths" 
  or RegistryKey startswith @"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Exclusions\Extensions"
  or RegistryKey startswith @"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Exclusions\Processes"))
version: 1.0.0