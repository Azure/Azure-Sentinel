{
    "name": "NetskopeWebTxConnector",
    "apiVersion": "2022-09-01-preview",
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "NetskopeWebTxConnector",
            "title": "Netskope Web Transaction Connector (via Blob Storage)",
            "publisher": "Netskope",
            "descriptionMarkdown": "The Netskope Web Transaction connector ingests web transaction logs from Netskope Log Streaming into Microsoft Sentinel via Azure Blob Storage using the Codeless Connector Framework (CCF).",
            "graphQueries": [
                {
                    "metricName": "Total logs received",
                    "legend": "Netskope Web Transaction Logs",
                    "baseQuery": "{{graphQueriesTableName}}"
                }
            ],
            "sampleQueries": [
                {
                    "description": "Get Sample of Netskope Web Transaction Logs",
                    "query": "{{graphQueriesTableName}}\n| take 10"
                }
            ],
            "dataTypes": [
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | where name_s == \"no data test\" | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors",
                    "value": null
                }
            ],
            "availability": {
                "status": 1,
                "isPreview": false
            },
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "read": true,
                            "write": true,
                            "delete": true,
                            "action": false
                        }
                    },
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "read": false,
                            "write": false,
                            "delete": false,
                            "action": true
                        }
                    }
                ],
                "customs": [
                    {
                        "name": "Subscription permissions",
                        "description": "You need permissions to create the data flow resources: \n- storage queues (notification queue and dead-letter queue) \n- event grid topic and subscription (to send 'blob created event' notifications to the notification queue) \n- role assignments (to grant access for sentinel app to the blob container and the storage queues.)"
                    },
                    {
                        "name": "Storage Account Network Configuration",
                        "description": "Network restrictions (firewall/IP rules) on the Azure Blob Storage account are **not supported** for this connector due to [Azure Storage firewall restrictions and limitations](https://learn.microsoft.com/en-us/azure/storage/common/storage-network-security-limitations):\n- IP network rules have**no effect**on requests originating from the same Azure region as the storage account.\n- IP network rules**cannot restrict**access to Azure services deployed in the same region, as these services use private Azure IP addresses for communication.\n- Virtual network service endpoint rules do not apply to clients in a paired region.\n\nEnsure the storage account's **Networking** blade is set to **Enabled from all networks**."
                    },
                    {
                        "name": "Storage Account Role Assignments",
                        "description": "The following Azure RBAC roles must be assigned to the Sentinel enterprise application service principal (displayed below) on the **Storage Account** that contains your blob container:\n- **Storage Blob Data Contributor** — required for reading blob data from the container.\n- **Storage Queue Data Contributor** — required for managing notification and dead-letter queue messages.\n\nTo assign these roles: navigate to the Storage Account → **Access Control (IAM)** → **Add role assignment**, search for the service principal ID shown below, and assign both roles."
                    },
                    {
                        "name": "Collecting data from Netskope to your blob container",
                        "description": "Follow the steps in the [Netskope Log Streaming documentation](https://docs.netskope.com/en/log-streaming.html) to configure Netskope to stream Web Transaction logs to your Azure Blob Storage container."
                    }
                ]
            },
            "instructionSteps": [
                {
                    "title": "Connect Netskope WebTx Logs to Microsoft Sentinel",
                    "description": "To enable the Netskope WebTx Logs for Microsoft Sentinel, provide the required information below and click on Connect.\n>",
                    "instructions": [
                        {
                            "parameters": {
                                "tenantId": "[subscription().tenantId]",
                                "name": "principalId",
                                "appId": "4f05ce56-95b6-4612-9d98-a45c8cc33f9f"
                            },
                            "type": "ServicePrincipalIDTextBox_test"
                        },
                        {
                            "parameters": {
                                "label": "The blob container URL you want to collect data from",
                                "type": "text",
                                "name": "blobContainerUri"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "The blobs folder name in the container. Optional.",
                                "type": "text",
                                "name": "blobFolderName"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "The blob container's storage account location",
                                "type": "text",
                                "name": "StorageAccountlocation"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "The blob container's storage account resource group name",
                                "type": "text",
                                "name": "StorageAccountResourceGroupName"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "The blob container's storage account subscription id",
                                "type": "text",
                                "name": "StorageAccountSubscription"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "The event grid topic name of the blob container's storage account if exist. else keep empty.",
                                "description": "The data flow using event grid to send 'blob-created event' notifications. There could be only one event grid topic for each storage account.\nGo to your blob container's storage account and look in the 'Events' section. If you already have a topic, please provide it's name. Else, keep the text box empty.",
                                "type": "text",
                                "name": "EGSystemTopicName"
                            },
                            "type": "Textbox"
                        },
                        {
                            "parameters": {
                                "label": "toggle",
                                "name": "toggle"
                            },
                            "type": "ConnectionToggleButton"
                        }
                    ]
                }
            ],
            "isConnectivityCriteriasMatchSome": false,
            "graphQueriesTableName": "NetskopeWebTransactions_CL"
        }
    }
}