{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Lookout",
    "comments": "Solution template for Lookout"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Lookout",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook2-name": {
      "type": "string",
      "defaultValue": "Lookout Enhanced Security Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook3-name": {
      "type": "string",
      "defaultValue": "Lookout Security Investigation Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook4-name": {
      "type": "string",
      "defaultValue": "Lookout Executive Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook5-name": {
      "type": "string",
      "defaultValue": "Lookout IOA Investigation Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "Lookout",
    "_solutionVersion": "3.0.1",
    "solutionId": "lookoutinc.lookout_mtd_sentinel",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "LookoutAPI",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "LookoutAPI",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition2": "LookoutStreaming_Definition",
    "dataConnectorTemplateNameConnectorDefinition2": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition2')))]",
    "_dataConnectorContentIdConnections2": "LookoutStreaming_DefinitionConnections",
    "dataConnectorTemplateNameConnections2": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections2')))]",
    "dataCollectionEndpointId2": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.1",
      "_analyticRulecontentId1": "7593cc60-e294-402d-9202-279fb3c7d55f",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7593cc60-e294-402d-9202-279fb3c7d55f')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7593cc60-e294-402d-9202-279fb3c7d55f')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7593cc60-e294-402d-9202-279fb3c7d55f','-', '1.0.1')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "2.0.3",
      "_analyticRulecontentId2": "8b4a5c7e-2f91-4d8a-9e3b-1c6f8a2d4e9f",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '8b4a5c7e-2f91-4d8a-9e3b-1c6f8a2d4e9f')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('8b4a5c7e-2f91-4d8a-9e3b-1c6f8a2d4e9f')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','8b4a5c7e-2f91-4d8a-9e3b-1c6f8a2d4e9f','-', '2.0.3')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "2.0.3",
      "_analyticRulecontentId3": "9c5b6d8f-3a02-4e9b-af4c-2d7e9b1f5a8c",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '9c5b6d8f-3a02-4e9b-af4c-2d7e9b1f5a8c')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('9c5b6d8f-3a02-4e9b-af4c-2d7e9b1f5a8c')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','9c5b6d8f-3a02-4e9b-af4c-2d7e9b1f5a8c','-', '2.0.3')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "2.0.3",
      "_analyticRulecontentId4": "7a3e5f9b-4c8d-4a2e-9f1b-6d8e2a4c7f9e",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7a3e5f9b-4c8d-4a2e-9f1b-6d8e2a4c7f9e')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7a3e5f9b-4c8d-4a2e-9f1b-6d8e2a4c7f9e')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7a3e5f9b-4c8d-4a2e-9f1b-6d8e2a4c7f9e','-', '2.0.3')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "2.0.3",
      "_analyticRulecontentId5": "6b2d4e8a-5f7c-4b9e-8a1d-3c5e7a9b2f4d",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6b2d4e8a-5f7c-4b9e-8a1d-3c5e7a9b2f4d')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6b2d4e8a-5f7c-4b9e-8a1d-3c5e7a9b2f4d')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6b2d4e8a-5f7c-4b9e-8a1d-3c5e7a9b2f4d','-', '2.0.3')))]"
    },
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "LookoutEvents",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "workbookVersion2": "1.0.0",
    "workbookContentId2": "LookoutEventsV2",
    "workbookId2": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId2'))]",
    "workbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId2'))))]",
    "_workbookContentId2": "[variables('workbookContentId2')]",
    "_workbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId2'),'-', variables('workbookVersion2'))))]",
    "workbookVersion3": "1.0.0",
    "workbookContentId3": "LookoutSecurityInvestigationDashboard",
    "workbookId3": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId3'))]",
    "workbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId3'))))]",
    "_workbookContentId3": "[variables('workbookContentId3')]",
    "_workbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId3'),'-', variables('workbookVersion3'))))]",
    "workbookVersion4": "1.0.0",
    "workbookContentId4": "LookoutExecutiveDashboard",
    "workbookId4": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId4'))]",
    "workbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId4'))))]",
    "_workbookContentId4": "[variables('workbookContentId4')]",
    "_workbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId4'),'-', variables('workbookVersion4'))))]",
    "workbookVersion5": "1.0.0",
    "workbookContentId5": "LookoutIOAInvestigationDashboard",
    "workbookId5": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId5'))]",
    "workbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId5'))))]",
    "_workbookContentId5": "[variables('workbookContentId5')]",
    "_workbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId5'),'-', variables('workbookVersion5'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','Lookout Data Parser')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Lookout Data Parser')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('LookoutEvents-Parser')))]",
      "parserVersion1": "3.0.0",
      "parserContentId1": "LookoutEvents-Parser"
    },
    "huntingQueryObject1": {
      "huntingQueryVersion1": "1.0.0",
      "_huntingQuerycontentId1": "lookout-advanced-threat-hunting",
      "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-hq-',uniquestring('lookout-advanced-threat-hunting')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Lookout data connector with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "[DEPRECATED] Lookout",
                  "publisher": "Lookout",
                  "descriptionMarkdown": "The [Lookout](https://lookout.com) data connector provides the capability to ingest [Lookout](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#commoneventfields) events into Microsoft Sentinel through the Mobile Risk API. Refer to [API documentation](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide) for more information. The [Lookout](https://lookout.com) data connector provides ability to get events which helps to examine potential security risks and more.\n\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCF data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
                  "additionalRequirementBanner": "This data connector depends on a parser based on a Kusto Function to work as expected [**LookoutEvents**](https://aka.ms/sentinel-lookoutapi-parser) which is deployed with the Microsoft Sentinel Solution.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "Lookout_CL",
                      "baseQuery": "Lookout_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Lookout Events - All Activities.",
                      "query": "Lookout_CL\n | sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "Lookout_CL",
                      "lastDataReceivedQuery": "Lookout_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "Lookout_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "Mobile Risk API Credentials/permissions",
                        "description": "**EnterpriseName** & **ApiKey** are required for Mobile Risk API. [See the documentation to learn more about API](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide). Check all [requirements and follow  the instructions](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#authenticatingwiththemobileriskapi) for obtaining credentials."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This [Lookout](https://lookout.com) data connector uses Azure Functions to connect to the Mobile Risk API to pull its events into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**LookoutEvents**](https://aka.ms/sentinel-lookoutapi-parser) which is deployed with the Microsoft Sentinel Solution."
                    },
                    {
                      "description": "**STEP 1 - Configuration steps for the Mobile Risk API**\n\n [Follow the instructions](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#authenticatingwiththemobileriskapi) to obtain the credentials. \n"
                    },
                    {
                      "description": "**STEP 2 - Follow below mentioned instructions to deploy the [Lookout](https://lookout.com) data connector and the associated Azure Function**\n\n>**IMPORTANT:** Before starting the deployment of the [Lookout](https://lookout.com) data connector, make sure to have the Workspace ID and Workspace Key ready (can be copied from the following).",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Workspace Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Follow below steps for automated deployment of the [Lookout](https://lookout.com) data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-lookoutapi-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Region**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **Function Name**, **Workspace ID**,**Workspace Key**,**Enterprise Name** & **Api Key** and deploy. \n4. Click **Create** to deploy.",
                      "title": "Azure Resource Manager (ARM) Template"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "[DEPRECATED] Lookout",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Lookout",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Lookout"
        },
        "support": {
          "name": "Lookout",
          "tier": "Partner",
          "link": "https://www.lookout.com/support"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "[DEPRECATED] Lookout",
          "publisher": "Lookout",
          "descriptionMarkdown": "The [Lookout](https://lookout.com) data connector provides the capability to ingest [Lookout](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#commoneventfields) events into Microsoft Sentinel through the Mobile Risk API. Refer to [API documentation](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide) for more information. The [Lookout](https://lookout.com) data connector provides ability to get events which helps to examine potential security risks and more.\n\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: This data connector has been deprecated, consider moving to the CCF data connector available in the solution which replaces ingestion via the <a href='https://learn.microsoft.com/en-us/azure/azure-monitor/logs/custom-logs-migrate' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>.</p>",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "Lookout_CL",
              "baseQuery": "Lookout_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "Lookout_CL",
              "lastDataReceivedQuery": "Lookout_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "Lookout_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Lookout Events - All Activities.",
              "query": "Lookout_CL\n | sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "Mobile Risk API Credentials/permissions",
                "description": "**EnterpriseName** & **ApiKey** are required for Mobile Risk API. [See the documentation to learn more about API](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide). Check all [requirements and follow  the instructions](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#authenticatingwiththemobileriskapi) for obtaining credentials."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This [Lookout](https://lookout.com) data connector uses Azure Functions to connect to the Mobile Risk API to pull its events into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected [**LookoutEvents**](https://aka.ms/sentinel-lookoutapi-parser) which is deployed with the Microsoft Sentinel Solution."
            },
            {
              "description": "**STEP 1 - Configuration steps for the Mobile Risk API**\n\n [Follow the instructions](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#authenticatingwiththemobileriskapi) to obtain the credentials. \n"
            },
            {
              "description": "**STEP 2 - Follow below mentioned instructions to deploy the [Lookout](https://lookout.com) data connector and the associated Azure Function**\n\n>**IMPORTANT:** Before starting the deployment of the [Lookout](https://lookout.com) data connector, make sure to have the Workspace ID and Workspace Key ready (can be copied from the following).",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Workspace Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Follow below steps for automated deployment of the [Lookout](https://lookout.com) data connector using an ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-lookoutapi-azuredeploy)\n2. Select the preferred **Subscription**, **Resource Group** and **Region**. \n> **NOTE:** Within the same resource group, you can't mix Windows and Linux apps in the same region. Select existing resource group without Windows apps in it or create new resource group.\n3. Enter the **Function Name**, **Workspace ID**,**Workspace Key**,**Enterprise Name** & **Api Key** and deploy. \n4. Click **Create** to deploy.",
              "title": "Azure Resource Manager (ARM) Template"
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "This data connector depends on a parser based on a Kusto Function to work as expected [**LookoutEvents**](https://aka.ms/sentinel-lookoutapi-parser) which is deployed with the Microsoft Sentinel Solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition2'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition2')]",
        "displayName": "Lookout Mobile Threat Detection Connector (via Codeless Connector Framework) (Preview)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition2'))]",
              "apiVersion": "2025-09-01",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "LookoutStreaming_Definition",
                  "title": "Lookout Mobile Threat Detection Connector (via Codeless Connector Framework) (Preview)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The [Lookout Mobile Threat Detection](https://lookout.com) data connector provides the capability to ingest events related to mobile security risks into Microsoft Sentinel through the Mobile Risk API. Refer to [API documentation](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide) for more information. This connector helps you examine potential security risks detected in mobile devices.",
                  "graphQueriesTableName": "LookoutMtdV2_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total events received",
                      "legend": "Events",
                      "baseQuery": "LookoutMtdV2_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Lookout Mobile Threat Detection Events - All Activities.",
                      "query": "LookoutMtdV2_CL\n | take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "LookoutMtdV2_CL",
                      "lastDataReceivedQuery": "LookoutMtdV2_CL\n | summarize Time = max(TimeGenerated)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": false,
                          "action": false
                        }
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "Connect Lookout Mobile Threat Defence connector to Microsoft Sentinel",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "Before connecting to Lookout, ensure the following prerequisites are completed."
                          }
                        },
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "#### 1.  **ApiKey** is required for Mobile Threat Detection API. See the [documentation](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide) to learn more about API. Check all requirements and follow  the [instructions](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#authenticatingwiththemobileriskapi) for obtaining credentials."
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API key",
                            "placeholder": "Enter your API key ",
                            "type": "password",
                            "name": "applicationKey",
                            "required": true
                          }
                        },
                        {
                          "type": "ConnectionToggleButton",
                          "parameters": {
                            "connectLabel": "Connect",
                            "name": "toggle"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition2')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition2'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections2')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "LookoutMtdDCR",
              "apiVersion": "2024-03-11",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId2')]",
                "streamDeclarations": {
                  "Custom-LookoutMtdV2_CL": {
                    "columns": [
                      {
                        "name": "id",
                        "type": "string"
                      },
                      {
                        "name": "enterprise_guid",
                        "type": "string"
                      },
                      {
                        "name": "created_time",
                        "type": "datetime"
                      },
                      {
                        "name": "type",
                        "type": "string"
                      },
                      {
                        "name": "change_type",
                        "type": "string"
                      },
                      {
                        "name": "device",
                        "type": "dynamic"
                      },
                      {
                        "name": "threat",
                        "type": "dynamic"
                      },
                      {
                        "name": "audit",
                        "type": "dynamic"
                      },
                      {
                        "name": "smishing_alert",
                        "type": "dynamic"
                      },
                      {
                        "name": "target",
                        "type": "dynamic"
                      },
                      {
                        "name": "actor",
                        "type": "dynamic"
                      },
                      {
                        "name": "TimeGenerated",
                        "type": "datetime"
                      },
                      {
                        "name": "log_type",
                        "type": "string"
                      },
                      {
                        "name": "actor_device_guid",
                        "type": "string"
                      },
                      {
                        "name": "event_type",
                        "type": "string"
                      },
                      {
                        "name": "device_guid",
                        "type": "string"
                      },
                      {
                        "name": "device_activated_at",
                        "type": "datetime"
                      },
                      {
                        "name": "device_activation_status",
                        "type": "string"
                      },
                      {
                        "name": "device_checkin_time",
                        "type": "datetime"
                      },
                      {
                        "name": "device_customer_id",
                        "type": "string"
                      },
                      {
                        "name": "device_deactivated_at",
                        "type": "datetime"
                      },
                      {
                        "name": "device_group_guid",
                        "type": "string"
                      },
                      {
                        "name": "device_platform",
                        "type": "string"
                      },
                      {
                        "name": "device_os_version",
                        "type": "string"
                      },
                      {
                        "name": "device_manufacturer",
                        "type": "string"
                      },
                      {
                        "name": "device_model",
                        "type": "string"
                      },
                      {
                        "name": "device_email_address",
                        "type": "string"
                      },
                      {
                        "name": "device_security_status",
                        "type": "string"
                      },
                      {
                        "name": "client_lookout_sdk_version",
                        "type": "string"
                      },
                      {
                        "name": "client_ota_version",
                        "type": "string"
                      },
                      {
                        "name": "client_package_name",
                        "type": "string"
                      },
                      {
                        "name": "client_package_version",
                        "type": "string"
                      },
                      {
                        "name": "mdm_connector_id",
                        "type": "int"
                      },
                      {
                        "name": "mdm_connector_uuid",
                        "type": "string"
                      },
                      {
                        "name": "mdm_external_id",
                        "type": "string"
                      },
                      {
                        "name": "threat_id",
                        "type": "string"
                      },
                      {
                        "name": "threat_type",
                        "type": "string"
                      },
                      {
                        "name": "threat_action",
                        "type": "string"
                      },
                      {
                        "name": "threat_severity",
                        "type": "string"
                      },
                      {
                        "name": "threat_classification",
                        "type": "string"
                      },
                      {
                        "name": "threat_classifications",
                        "type": "string"
                      },
                      {
                        "name": "threat_risk",
                        "type": "string"
                      },
                      {
                        "name": "threat_status",
                        "type": "string"
                      },
                      {
                        "name": "threat_assessments",
                        "type": "string"
                      },
                      {
                        "name": "threat_description",
                        "type": "string"
                      },
                      {
                        "name": "threat_application_name",
                        "type": "string"
                      },
                      {
                        "name": "threat_package_name",
                        "type": "string"
                      },
                      {
                        "name": "threat_package_sha",
                        "type": "string"
                      },
                      {
                        "name": "threat_file_name",
                        "type": "string"
                      },
                      {
                        "name": "threat_file_path",
                        "type": "string"
                      },
                      {
                        "name": "threat_pcp_reporting_reason",
                        "type": "string"
                      },
                      {
                        "name": "threat_pcp_device_response",
                        "type": "string"
                      },
                      {
                        "name": "audit_type",
                        "type": "string"
                      },
                      {
                        "name": "actor_type",
                        "type": "string"
                      },
                      {
                        "name": "actor_guid",
                        "type": "string"
                      },
                      {
                        "name": "target_type",
                        "type": "string"
                      },
                      {
                        "name": "target_guid",
                        "type": "string"
                      },
                      {
                        "name": "target_email_address",
                        "type": "string"
                      },
                      {
                        "name": "target_platform",
                        "type": "string"
                      },
                      {
                        "name": "target_os_version",
                        "type": "string"
                      },
                      {
                        "name": "target_manufacturer",
                        "type": "string"
                      },
                      {
                        "name": "target_model",
                        "type": "string"
                      },
                      {
                        "name": "smishing_alert_id",
                        "type": "string"
                      },
                      {
                        "name": "smishing_alert_type",
                        "type": "string"
                      },
                      {
                        "name": "smishing_alert_severity",
                        "type": "string"
                      },
                      {
                        "name": "smishing_alert_description",
                        "type": "string"
                      },
                      {
                        "name": "device_permissions",
                        "type": "dynamic"
                      },
                      {
                        "name": "device_settings",
                        "type": "dynamic"
                      },
                      {
                        "name": "device_vulns",
                        "type": "dynamic"
                      },
                      {
                        "name": "risky_config",
                        "type": "dynamic"
                      },
                      {
                        "name": "audit_attribute_changes",
                        "type": "dynamic"
                      },
                      {
                        "name": "smishing_detections",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-LookoutMtdV2_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = todatetime(created_time), event_type = tostring(type), log_type = tostring(type), actor_device_guid = tostring(actor.guid), device_guid = tostring(device.guid), device_activated_at = todatetime(device.activated_at), device_activation_status = tostring(device.activation_status), device_checkin_time = todatetime(device.checkin_time), device_customer_id = tostring(device.customer_device_id), device_deactivated_at = todatetime(device.deactivated_at), device_group_guid = tostring(device.device_group_guid), device_platform = tostring(device.platform), device_os_version = tostring(device.os_version), device_manufacturer = tostring(device.manufacturer), device_model = tostring(device.model), device_email_address = tostring(device.email_address), device_security_status = tostring(device.security_status), client_lookout_sdk_version = tostring(device.client.lookout_sdk_version), client_ota_version = tostring(device.client.ota_version), client_package_name = tostring(device.client.package_name), client_package_version = tostring(device.client.package_version), mdm_connector_id = toint(device.details.mdm_connector_id), mdm_connector_uuid = tostring(device.details.mdm_connector_uuid), mdm_external_id = tostring(device.details.external_id), threat_id = tostring(threat.id), threat_type = tostring(threat.type), threat_action = tostring(threat.action), threat_severity = tostring(threat.severity), threat_classification = tostring(threat.classification), threat_classifications = tostring(threat.classifications), threat_risk = tostring(threat.risk), threat_status = tostring(threat.status), threat_assessments = tostring(threat.assessments), threat_description = tostring(threat.description), threat_application_name = tostring(threat.application_name), threat_package_name = tostring(threat.package_name), threat_package_sha = tostring(threat.package_sha), threat_file_name = tostring(threat.file_name), threat_file_path = tostring(threat.path), threat_pcp_reporting_reason = tostring(threat.pcp_reporting_reason), threat_pcp_device_response = tostring(threat.pcp_device_response), audit_type = tostring(audit.type), actor_type = tostring(actor.type), actor_guid = tostring(actor.guid), target_type = tostring(target.type), target_guid = tostring(target.guid), target_email_address = tostring(target.email_address), target_platform = tostring(target.platform), target_os_version = tostring(target.os_version), target_manufacturer = tostring(target.manufacturer), target_model = tostring(target.model), smishing_alert_id = tostring(smishing_alert.id), smishing_alert_type = tostring(smishing_alert.type), smishing_alert_severity = tostring(smishing_alert.severity), smishing_alert_description = tostring(smishing_alert.description), device_permissions = device.device_permissions, device_settings = device.device_settings, device_vulns = device.device_vulns, risky_config = device.risky_config, audit_attribute_changes = audit.attribute_changes, smishing_detections = detections",
                    "outputStream": "Custom-LookoutMtdV2_CL"
                  }
                ]
              }
            },
            {
              "name": "LookoutMtdV2_CL",
              "apiVersion": "2025-07-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "LookoutMtdV2_CL",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime"
                    },
                    {
                      "name": "id",
                      "type": "string"
                    },
                    {
                      "name": "enterprise_guid",
                      "type": "string"
                    },
                    {
                      "name": "actor_device_guid",
                      "type": "string"
                    },
                    {
                      "name": "created_time",
                      "type": "datetime"
                    },
                    {
                      "name": "log_type",
                      "type": "string"
                    },
                    {
                      "name": "change_type",
                      "type": "string"
                    },
                    {
                      "name": "device",
                      "type": "dynamic"
                    },
                    {
                      "name": "threat",
                      "type": "dynamic"
                    },
                    {
                      "name": "audit",
                      "type": "dynamic"
                    },
                    {
                      "name": "smishing_alert",
                      "type": "dynamic"
                    },
                    {
                      "name": "target",
                      "type": "dynamic"
                    },
                    {
                      "name": "actor",
                      "type": "dynamic"
                    },
                    {
                      "name": "event_type",
                      "type": "string"
                    },
                    {
                      "name": "device_guid",
                      "type": "string"
                    },
                    {
                      "name": "device_activated_at",
                      "type": "datetime"
                    },
                    {
                      "name": "device_activation_status",
                      "type": "string"
                    },
                    {
                      "name": "device_checkin_time",
                      "type": "datetime"
                    },
                    {
                      "name": "device_customer_id",
                      "type": "string"
                    },
                    {
                      "name": "device_deactivated_at",
                      "type": "datetime"
                    },
                    {
                      "name": "device_group_guid",
                      "type": "string"
                    },
                    {
                      "name": "device_platform",
                      "type": "string"
                    },
                    {
                      "name": "device_os_version",
                      "type": "string"
                    },
                    {
                      "name": "device_manufacturer",
                      "type": "string"
                    },
                    {
                      "name": "device_model",
                      "type": "string"
                    },
                    {
                      "name": "device_email_address",
                      "type": "string"
                    },
                    {
                      "name": "device_security_status",
                      "type": "string"
                    },
                    {
                      "name": "client_lookout_sdk_version",
                      "type": "string"
                    },
                    {
                      "name": "client_ota_version",
                      "type": "string"
                    },
                    {
                      "name": "client_package_name",
                      "type": "string"
                    },
                    {
                      "name": "client_package_version",
                      "type": "string"
                    },
                    {
                      "name": "mdm_connector_id",
                      "type": "int"
                    },
                    {
                      "name": "mdm_connector_uuid",
                      "type": "string"
                    },
                    {
                      "name": "mdm_external_id",
                      "type": "string"
                    },
                    {
                      "name": "threat_id",
                      "type": "string"
                    },
                    {
                      "name": "threat_type",
                      "type": "string"
                    },
                    {
                      "name": "threat_action",
                      "type": "string"
                    },
                    {
                      "name": "threat_severity",
                      "type": "string"
                    },
                    {
                      "name": "threat_classification",
                      "type": "string"
                    },
                    {
                      "name": "threat_classifications",
                      "type": "string"
                    },
                    {
                      "name": "threat_risk",
                      "type": "string"
                    },
                    {
                      "name": "threat_status",
                      "type": "string"
                    },
                    {
                      "name": "threat_assessments",
                      "type": "string"
                    },
                    {
                      "name": "threat_description",
                      "type": "string"
                    },
                    {
                      "name": "threat_application_name",
                      "type": "string"
                    },
                    {
                      "name": "threat_package_name",
                      "type": "string"
                    },
                    {
                      "name": "threat_package_sha",
                      "type": "string"
                    },
                    {
                      "name": "threat_file_name",
                      "type": "string"
                    },
                    {
                      "name": "threat_file_path",
                      "type": "string"
                    },
                    {
                      "name": "threat_pcp_reporting_reason",
                      "type": "string"
                    },
                    {
                      "name": "threat_pcp_device_response",
                      "type": "string"
                    },
                    {
                      "name": "audit_type",
                      "type": "string"
                    },
                    {
                      "name": "actor_type",
                      "type": "string"
                    },
                    {
                      "name": "actor_guid",
                      "type": "string"
                    },
                    {
                      "name": "target_type",
                      "type": "string"
                    },
                    {
                      "name": "target_guid",
                      "type": "string"
                    },
                    {
                      "name": "target_email_address",
                      "type": "string"
                    },
                    {
                      "name": "target_platform",
                      "type": "string"
                    },
                    {
                      "name": "target_os_version",
                      "type": "string"
                    },
                    {
                      "name": "target_manufacturer",
                      "type": "string"
                    },
                    {
                      "name": "target_model",
                      "type": "string"
                    },
                    {
                      "name": "smishing_alert_id",
                      "type": "string"
                    },
                    {
                      "name": "smishing_alert_type",
                      "type": "string"
                    },
                    {
                      "name": "smishing_alert_severity",
                      "type": "string"
                    },
                    {
                      "name": "smishing_alert_description",
                      "type": "string"
                    },
                    {
                      "name": "device_permissions",
                      "type": "dynamic"
                    },
                    {
                      "name": "device_settings",
                      "type": "dynamic"
                    },
                    {
                      "name": "device_vulns",
                      "type": "dynamic"
                    },
                    {
                      "name": "risky_config",
                      "type": "dynamic"
                    },
                    {
                      "name": "audit_attribute_changes",
                      "type": "dynamic"
                    },
                    {
                      "name": "smishing_detections",
                      "type": "dynamic"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition2'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition2'))]",
      "apiVersion": "2025-09-01",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "LookoutStreaming_Definition",
          "title": "Lookout Mobile Threat Detection Connector (via Codeless Connector Framework) (Preview)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The [Lookout Mobile Threat Detection](https://lookout.com) data connector provides the capability to ingest events related to mobile security risks into Microsoft Sentinel through the Mobile Risk API. Refer to [API documentation](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide) for more information. This connector helps you examine potential security risks detected in mobile devices.",
          "graphQueriesTableName": "LookoutMtdV2_CL",
          "graphQueries": [
            {
              "metricName": "Total events received",
              "legend": "Events",
              "baseQuery": "LookoutMtdV2_CL"
            }
          ],
          "sampleQueries": [
            {
              "description": "Lookout Mobile Threat Detection Events - All Activities.",
              "query": "LookoutMtdV2_CL\n | take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "LookoutMtdV2_CL",
              "lastDataReceivedQuery": "LookoutMtdV2_CL\n | summarize Time = max(TimeGenerated)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": false,
                  "action": false
                }
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "Connect Lookout Mobile Threat Defence connector to Microsoft Sentinel",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "Before connecting to Lookout, ensure the following prerequisites are completed."
                  }
                },
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "#### 1.  **ApiKey** is required for Mobile Threat Detection API. See the [documentation](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide) to learn more about API. Check all requirements and follow  the [instructions](https://enterprise.support.lookout.com/hc/en-us/articles/115002741773-Mobile-Risk-API-Guide#authenticatingwiththemobileriskapi) for obtaining credentials."
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API key",
                    "placeholder": "Enter your API key ",
                    "type": "password",
                    "name": "applicationKey",
                    "required": true
                  }
                },
                {
                  "type": "ConnectionToggleButton",
                  "parameters": {
                    "connectLabel": "Connect",
                    "name": "toggle"
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition2')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition2'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "Lookout"
        },
        "support": {
          "name": "Lookout",
          "tier": "Partner",
          "link": "https://www.lookout.com/support"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections2')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections2'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections2')]",
        "displayName": "Lookout Mobile Threat Detection Connector (via Codeless Connector Framework) (Preview)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "Lookout Mobile Threat Detection Connector (via Codeless Connector Framework) (Preview)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "applicationKey": {
              "defaultValue": "applicationKey",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections2": "[variables('_dataConnectorContentIdConnections2')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections2')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections2'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections2')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'LookoutMtd_PollingConfig', parameters('guidValue'))]",
              "apiVersion": "2025-09-01",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "LookoutStreaming_Definition",
                "dataType": "LookoutMtdV2_CL",
                "dcrConfig": {
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                  "streamName": "Custom-LookoutMtdV2_CL"
                },
                "auth": {
                  "type": "OAuth2",
                  "isCredentialsInHeaders": true,
                  "ClientId": "NA",
                  "ClientSecret": "NA",
                  "APIKey": "[[parameters('applicationKey')]]",
                  "grantType": "client_credentials",
                  "tokenEndpoint": "https://api.lookout.com/oauth2/token",
                  "tokenEndpointHeaders": {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "Accept": "application/json",
                    "Kind": "SSE"
                  },
                  "TokenEndpointQueryParameters": {}
                },
                "request": {
                  "apiEndpoint": "https://api.lookout.com/mra/stream/v2/events",
                  "httpMethod": "GET",
                  "queryWindowInMin": 3,
                  "queryTimeFormat": "yyyy-MM-dd'T'HH:mm:ss",
                  "rateLimitQps": 10,
                  "retryCount": 5,
                  "logResponseContent": true,
                  "startTimeAttributeName": "start_time",
                  "timeoutInSeconds": 120,
                  "queryParameters": {
                    "types": "THREAT,DEVICE,SMISHING_ALERT,AUDIT"
                  },
                  "headers": {
                    "Accept": "text/event-stream",
                    "User-Agent": "Microsoft-Sentinel-Lookout-v2",
                    "X-Priority-Filter": "THREAT,DEVICE,SMISHING_ALERT,AUDIT",
                    "X-Event-Version": "v2"
                  }
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.events"
                  ],
                  "format": "json"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections2'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutThreatEvent_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Created to detect new Threat events from the data which is recently synced by Lookout Solution.",
                "displayName": "Lookout - New Threat events found.",
                "enabled": false,
                "query": "Lookout_CL\n| where details_action_s == 'DETECTED' and type_s == 'THREAT'\n| extend DetailsPackageName = details_packageName_s\n| extend TargetPlatform = target_platform_s\n| extend TargetOsVersion = target_osVersion_s\n| extend Type = type_s\n| extend Severity = details_severity_s\n| extend Classifications = details_classifications_s\n| extend Platform = target_platform_s\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Lookout_CL"
                    ],
                    "connectorId": "LookoutAPI"
                  }
                ],
                "tactics": [
                  "Discovery"
                ],
                "techniques": [
                  "T1057"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DetailsPackageName",
                        "identifier": "FullName"
                      },
                      {
                        "columnName": "TargetPlatform",
                        "identifier": "OSFamily"
                      },
                      {
                        "columnName": "TargetOsVersion",
                        "identifier": "OSVersion"
                      }
                    ]
                  }
                ],
                "customDetails": {
                  "Type": "Type",
                  "Classification": "Classifications",
                  "Severity": "Severity",
                  "Platform": "Platform"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "Lookout Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Lookout - New Threat events found.",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutThreatEventV2_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects high severity mobile threats from Lookout Mobile Risk API v2 with enhanced threat intelligence and device context. This rule leverages the comprehensive v2 field set to provide detailed threat classification, risk assessment, and device compliance status for improved security monitoring.",
                "displayName": "Lookout - High Severity Mobile Threats Detected (v2)",
                "enabled": false,
                "query": "LookoutEvents\n| where EventType == \"THREAT\"\n| where ThreatSeverity in (\"CRITICAL\", \"HIGH\")\n| where ThreatAction == \"DETECTED\"\n| where ThreatStatus in (\"OPEN\", \"ACTIVE\")\n| extend \n    ThreatRiskScore = case(\n        ThreatSeverity == \"CRITICAL\", 10,\n        ThreatSeverity == \"HIGH\", 8,\n        ThreatSeverity == \"MEDIUM\", 5,\n        ThreatSeverity == \"LOW\", 2,\n        1\n    ),\n    DeviceRiskLevel = case(\n        DeviceSecurityStatus == \"THREATS_HIGH\", \"High\",\n        DeviceSecurityStatus == \"THREATS_MEDIUM\", \"Medium\",\n        DeviceSecurityStatus == \"THREATS_LOW\", \"Low\",\n        \"Unknown\"\n    ),\n    ThreatCategory = case(\n        ThreatClassifications has \"MALWARE\", \"Malware\",\n        ThreatClassifications has \"PHISHING\", \"Phishing\", \n        ThreatClassifications has \"SPYWARE\", \"Spyware\",\n        ThreatClassifications has \"TROJAN\", \"Trojan\",\n        ThreatClassifications has \"ADWARE\", \"Adware\",\n        \"Other\"\n    )\n| extend ComplianceImpact = case(\n    DeviceComplianceStatus == \"Non-Compliant\" and ThreatRiskScore >= 8, \"Critical\",\n    DeviceComplianceStatus == \"Non-Compliant\" and ThreatRiskScore >= 5, \"High\", \n    DeviceComplianceStatus == \"Partial\" and ThreatRiskScore >= 8, \"High\",\n    DeviceComplianceStatus == \"Partial\" and ThreatRiskScore >= 5, \"Medium\",\n    \"Low\"\n)\n| project\n    TimeGenerated,\n    EventId,\n    ThreatId,\n    ThreatType,\n    ThreatSeverity,\n    ThreatRiskScore,\n    ThreatCategory,\n    ThreatClassifications,\n    ThreatStatus,\n    ThreatDescription,\n    ThreatApplicationName,\n    ThreatPackageName,\n    ThreatPackageSha,\n    DeviceGuid,\n    DevicePlatform,\n    DeviceOSVersion,\n    DeviceManufacturer,\n    DeviceModel,\n    DeviceEmailAddress,\n    DeviceSecurityStatus,\n    DeviceRiskLevel,\n    DeviceComplianceStatus,\n    ComplianceImpact,\n    ClientLookoutSDKVersion,\n    MDMConnectorId,\n    MDMExternalId,\n    TargetEmailAddress,\n    TargetPlatform,\n    ActorType,\n    ActorGuid\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "LookoutEvents"
                    ],
                    "connectorId": "LookoutAPI"
                  }
                ],
                "tactics": [
                  "Discovery",
                  "DefenseEvasion",
                  "Persistence",
                  "PrivilegeEscalation"
                ],
                "techniques": [
                  "T1424",
                  "T1418",
                  "T1629",
                  "T1630"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "DeviceEmailAddress",
                        "identifier": "FullName"
                      },
                      {
                        "columnName": "TargetEmailAddress",
                        "identifier": "Name"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DeviceGuid",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DevicePlatform",
                        "identifier": "OSFamily"
                      },
                      {
                        "columnName": "DeviceOSVersion",
                        "identifier": "OSVersion"
                      }
                    ]
                  },
                  {
                    "entityType": "FileHash",
                    "fieldMappings": [
                      {
                        "columnName": "ThreatApplicationName",
                        "identifier": "Algorithm"
                      },
                      {
                        "columnName": "ThreatPackageSha",
                        "identifier": "Value"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "ComplianceImpact": "ComplianceImpact",
                  "DeviceRiskLevel": "DeviceRiskLevel",
                  "ThreatSeverity": "ThreatSeverity",
                  "ThreatType": "ThreatType",
                  "ThreatCategory": "ThreatCategory",
                  "DevicePlatform": "DevicePlatform",
                  "DeviceSecStatus": "DeviceSecurityStatus",
                  "MDMConnectorId": "MDMConnectorId",
                  "ThreatStatus": "ThreatStatus",
                  "ThreatRiskScore": "ThreatRiskScore",
                  "ThreatClasses": "ThreatClassifications"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "ThreatSeverity",
                  "alertTacticsColumnName": "ThreatCategory",
                  "alertDisplayNameFormat": "High Severity Mobile Threat: {{ThreatType}} on {{DevicePlatform}} Device",
                  "alertDescriptionFormat": "{{ThreatSeverity}} {{ThreatCategory}} threat on {{DevicePlatform}}"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [
                      "Account",
                      "Host"
                    ],
                    "matchingMethod": "Selected",
                    "groupByCustomDetails": [
                      "ThreatCategory",
                      "DevicePlatform"
                    ],
                    "lookbackDuration": "P1D",
                    "reopenClosedIncident": false,
                    "groupByAlertDetails": [
                      "ThreatType",
                      "DeviceGuid"
                    ]
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "Lookout Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Lookout - High Severity Mobile Threats Detected (v2)",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutDeviceComplianceV2_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Monitors device compliance status changes and security posture degradation using Lookout Mobile Risk API v2 enhanced device fields. Detects devices becoming non-compliant, security status changes, and potential device compromise indicators with detailed device context and MDM integration data.",
                "displayName": "Lookout - Device Compliance and Security Status Changes (v2)",
                "enabled": false,
                "query": "LookoutEvents\n| where EventType == \"DEVICE\"\n| where DeviceComplianceStatus in (\"Non-Compliant\", \"Partial\") \n   or DeviceSecurityStatus in (\"THREATS_HIGH\", \"THREATS_MEDIUM\")\n   or ChangeType == \"UPDATE\"\n| extend \n    DeviceRiskScore = case(\n        DeviceSecurityStatus == \"THREATS_HIGH\", 9,\n        DeviceSecurityStatus == \"THREATS_MEDIUM\", 6,\n        DeviceSecurityStatus == \"THREATS_LOW\", 3,\n        DeviceComplianceStatus == \"Non-Compliant\", 7,\n        DeviceComplianceStatus == \"Partial\", 4,\n        1\n    ),\n    ComplianceReason = case(\n        isempty(DeviceCheckinTime), \"No Recent Check-in\",\n        DeviceActivationStatus != \"ACTIVE\", \"Inactive Device\",\n        isempty(ClientLookoutSDKVersion), \"Missing Security Client\",\n        \"Configuration Issue\"\n    ),\n    PlatformRisk = case(\n        DevicePlatform == \"ANDROID\" and DeviceOSVersion matches regex @\"^[1-9]\\..*\", \"Outdated Android\",\n        DevicePlatform == \"IOS\" and DeviceOSVersion matches regex @\"^1[0-4]\\..*\", \"Outdated iOS\",\n        DevicePlatform == \"UNKNOWN\", \"Unknown Platform\",\n        \"Current\"\n    )\n| extend MDMIntegrationStatus = case(\n    isnotempty(MDMConnectorId) and isnotempty(MDMExternalId), \"Fully Integrated\",\n    isnotempty(MDMConnectorId), \"Partial Integration\", \n    \"Not Integrated\"\n)\n| extend SecurityPosture = case(\n    DeviceRiskScore >= 8, \"Critical\",\n    DeviceRiskScore >= 6, \"High\",\n    DeviceRiskScore >= 4, \"Medium\",\n    \"Low\"\n)\n| project\n    TimeGenerated,\n    EventId,\n    DeviceGuid,\n    DevicePlatform,\n    DeviceOSVersion,\n    DeviceManufacturer,\n    DeviceModel,\n    DeviceEmailAddress,\n    DeviceActivationStatus,\n    DeviceSecurityStatus,\n    DeviceComplianceStatus,\n    DeviceRiskScore,\n    SecurityPosture,\n    ComplianceReason,\n    PlatformRisk,\n    DeviceCheckinTime,\n    DeviceActivatedAt,\n    DeviceDeactivatedAt,\n    DeviceGroupGuid,\n    ClientLookoutSDKVersion,\n    ClientOTAVersion,\n    ClientPackageName,\n    ClientPackageVersion,\n    MDMConnectorId,\n    MDMConnectorUuid,\n    MDMExternalId,\n    MDMIntegrationStatus,\n    ActorType,\n    ActorGuid,\n    ChangeType\n",
                "queryFrequency": "PT10M",
                "queryPeriod": "PT30M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "LookoutEvents"
                    ],
                    "connectorId": "LookoutAPI"
                  }
                ],
                "tactics": [
                  "Discovery",
                  "DefenseEvasion",
                  "Persistence"
                ],
                "techniques": [
                  "T1418",
                  "T1629",
                  "T1655"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "DeviceEmailAddress",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DeviceGuid",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DevicePlatform",
                        "identifier": "OSFamily"
                      },
                      {
                        "columnName": "DeviceOSVersion",
                        "identifier": "OSVersion"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "PlatformRisk": "PlatformRisk",
                  "DevCompliance": "DeviceComplianceStatus",
                  "ClientSDKVersion": "ClientLookoutSDKVersion",
                  "DeviceManufacturer": "DeviceManufacturer",
                  "DevicePlatform": "DevicePlatform",
                  "ComplianceReason": "ComplianceReason",
                  "DeviceSecStatus": "DeviceSecurityStatus",
                  "DeviceModel": "DeviceModel",
                  "SecurityPosture": "SecurityPosture",
                  "DeviceRiskScore": "DeviceRiskScore",
                  "MDMIntegration": "MDMIntegrationStatus"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "SecurityPosture",
                  "alertTacticsColumnName": "SecurityPosture",
                  "alertDisplayNameFormat": "Device Compliance Issue: {{SecurityPosture}} Risk on {{DevicePlatform}} Device",
                  "alertDescriptionFormat": "{{SecurityPosture}} posture with {{DeviceComplianceStatus}} compliance"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [
                      "Account",
                      "Host"
                    ],
                    "matchingMethod": "Selected",
                    "groupByCustomDetails": [
                      "SecurityPosture",
                      "DevicePlatform"
                    ],
                    "lookbackDuration": "P1D",
                    "reopenClosedIncident": false,
                    "groupByAlertDetails": [
                      "DeviceGuid"
                    ]
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "Lookout Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Lookout - Device Compliance and Security Status Changes (v2)",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutSmishingAlertV2_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects critical smishing (SMS phishing) and phishing alerts from Lookout Mobile Risk API v2. This rule identifies sophisticated social engineering attacks including CEO fraud, credential harvesting, and malicious link campaigns targeting mobile devices. Leverages enhanced v2 smishing detection capabilities for comprehensive mobile threat protection.",
                "displayName": "Lookout - Critical Smishing and Phishing Alerts (v2)",
                "enabled": false,
                "query": "LookoutEvents\n| where EventType == \"SMISHING_ALERT\"\n| where SmishingAlertSeverity in (\"CRITICAL\", \"HIGH\")\n| where SmishingAlertType in (\"PHISHING_DETECTION\", \"FRAUD_DETECTION\", \"CREDENTIAL_HARVESTING\")\n| extend \n    AlertRiskScore = case(\n        SmishingAlertSeverity == \"CRITICAL\", 10,\n        SmishingAlertSeverity == \"HIGH\", 8,\n        SmishingAlertSeverity == \"MEDIUM\", 5,\n        SmishingAlertSeverity == \"LOW\", 2,\n        1\n    ),\n    ThreatCategory = case(\n        SmishingAlertType == \"PHISHING_DETECTION\", \"Phishing\",\n        SmishingAlertType == \"FRAUD_DETECTION\", \"Fraud\",\n        SmishingAlertType == \"CREDENTIAL_HARVESTING\", \"Credential Theft\",\n        SmishingAlertType == \"MALICIOUS_LINK\", \"Malicious Link\",\n        \"Other\"\n    ),\n    ImpersonationRisk = case(\n        SmishingAlertDescription has \"CEO\" or SmishingAlertDescription has \"executive\", \"Executive Impersonation\",\n        SmishingAlertDescription has \"IT\" or SmishingAlertDescription has \"support\", \"IT Support Impersonation\", \n        SmishingAlertDescription has \"bank\" or SmishingAlertDescription has \"financial\", \"Financial Impersonation\",\n        SmishingAlertDescription has \"delivery\" or SmishingAlertDescription has \"package\", \"Delivery Impersonation\",\n        \"Generic Phishing\"\n    )\n| extend DeviceRiskLevel = case(\n    DeviceSecurityStatus == \"THREATS_HIGH\", \"High\",\n    DeviceSecurityStatus == \"THREATS_MEDIUM\", \"Medium\", \n    DeviceSecurityStatus == \"THREATS_LOW\", \"Low\",\n    \"Unknown\"\n)\n| extend CampaignIndicators = case(\n    AlertRiskScore >= 8 and DeviceRiskLevel == \"High\", \"Targeted Campaign\",\n    AlertRiskScore >= 6 and ImpersonationRisk != \"Generic Phishing\", \"Sophisticated Attack\",\n    AlertRiskScore >= 5, \"Coordinated Threat\",\n    \"Isolated Incident\"\n)\n| project\n    TimeGenerated,\n    EventId,\n    SmishingAlertId,\n    SmishingAlertType,\n    SmishingAlertSeverity,\n    SmishingAlertDescription,\n    AlertRiskScore,\n    ThreatCategory,\n    ImpersonationRisk,\n    CampaignIndicators,\n    DeviceGuid,\n    DevicePlatform,\n    DeviceOSVersion,\n    DeviceManufacturer,\n    DeviceModel,\n    DeviceEmailAddress,\n    DeviceSecurityStatus,\n    DeviceRiskLevel,\n    TargetEmailAddress,\n    TargetPlatform,\n    ActorType,\n    ActorGuid,\n    ChangeType\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT15M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "LookoutEvents"
                    ],
                    "connectorId": "LookoutAPI"
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "CredentialAccess",
                  "Collection",
                  "Discovery"
                ],
                "techniques": [
                  "T1660",
                  "T1417",
                  "T1423"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "DeviceEmailAddress",
                        "identifier": "FullName"
                      },
                      {
                        "columnName": "TargetEmailAddress",
                        "identifier": "Name"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "DeviceGuid",
                        "identifier": "HostName"
                      },
                      {
                        "columnName": "DevicePlatform",
                        "identifier": "OSFamily"
                      },
                      {
                        "columnName": "DeviceOSVersion",
                        "identifier": "OSVersion"
                      }
                    ]
                  },
                  {
                    "entityType": "URL",
                    "fieldMappings": [
                      {
                        "columnName": "SmishingAlertDescription",
                        "identifier": "Url"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "CampaignIndicators": "CampaignIndicators",
                  "SmishAlertType": "SmishingAlertType",
                  "DeviceRiskLevel": "DeviceRiskLevel",
                  "ThreatCategory": "ThreatCategory",
                  "DevicePlatform": "DevicePlatform",
                  "AlertRiskScore": "AlertRiskScore",
                  "DeviceSecStatus": "DeviceSecurityStatus",
                  "ImpersonationRisk": "ImpersonationRisk",
                  "SmishSeverity": "SmishingAlertSeverity"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "SmishingAlertSeverity",
                  "alertTacticsColumnName": "ThreatCategory",
                  "alertDisplayNameFormat": "Critical Smishing Alert: {{ThreatCategory}} targeting {{DevicePlatform}} Device",
                  "alertDescriptionFormat": "{{SmishingAlertSeverity}} {{ThreatCategory}} attack on {{DevicePlatform}}"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [
                      "Account",
                      "Host"
                    ],
                    "matchingMethod": "Selected",
                    "groupByCustomDetails": [
                      "ThreatCategory",
                      "ImpersonationRisk",
                      "CampaignIndicators"
                    ],
                    "lookbackDuration": "P1D",
                    "reopenClosedIncident": false,
                    "groupByAlertDetails": [
                      "SmishAlertType",
                      "DeviceGuid"
                    ]
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "Lookout Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Lookout - Critical Smishing and Phishing Alerts (v2)",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutAuditEventV2_AnalyticalRules Analytics Rule with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Monitors critical audit events and policy changes from Lookout Mobile Risk API v2. Detects unauthorized configuration changes, policy modifications, security setting adjustments, and administrative actions that could impact mobile security posture. Provides comprehensive audit trail for compliance and security governance.",
                "displayName": "Lookout - Critical Audit and Policy Changes (v2)",
                "enabled": false,
                "query": "LookoutEvents\n| where EventType == \"AUDIT\"\n| where AuditType in (\"POLICY_CHANGE\", \"SECURITY_SETTING_CHANGE\", \"USER_MANAGEMENT\", \"CONFIGURATION_CHANGE\")\n| extend \n    ChangeImpact = case(\n        AuditType == \"POLICY_CHANGE\", \"High\",\n        AuditType == \"SECURITY_SETTING_CHANGE\", \"High\",\n        AuditType == \"USER_MANAGEMENT\", \"Medium\",\n        AuditType == \"CONFIGURATION_CHANGE\", \"Medium\",\n        \"Low\"\n    ),\n    RiskLevel = case(\n        ActorType == \"SYSTEM\" and AuditType in (\"POLICY_CHANGE\", \"SECURITY_SETTING_CHANGE\"), \"Automated Change\",\n        ActorType == \"ADMIN_USER\" and AuditType == \"POLICY_CHANGE\", \"Administrative Change\",\n        ActorType == \"USER\" and AuditType in (\"POLICY_CHANGE\", \"SECURITY_SETTING_CHANGE\"), \"Unauthorized Change\",\n        ActorType == \"UNKNOWN\", \"Suspicious Change\",\n        \"Standard Change\"\n    )\n| extend SecurityImplications = case(\n    AuditAttributeChanges has \"threat_response_level\" and AuditAttributeChanges has \"LOW\", \"Threat Response Weakened\",\n    AuditAttributeChanges has \"auto_quarantine_enabled\" and AuditAttributeChanges has \"false\", \"Auto-Quarantine Disabled\",\n    AuditAttributeChanges has \"compliance_enforcement\" and AuditAttributeChanges has \"false\", \"Compliance Enforcement Disabled\",\n    AuditAttributeChanges has \"device_wipe_enabled\" and AuditAttributeChanges has \"false\", \"Device Wipe Disabled\",\n    AuditAttributeChanges has \"admin\" or AuditAttributeChanges has \"privilege\", \"Privilege Changes\",\n    \"Configuration Update\"\n)\n| extend ComplianceRisk = case(\n    SecurityImplications in (\"Threat Response Weakened\", \"Auto-Quarantine Disabled\", \"Compliance Enforcement Disabled\"), \"Critical\",\n    SecurityImplications == \"Device Wipe Disabled\", \"High\",\n    SecurityImplications == \"Privilege Changes\", \"High\",\n    RiskLevel == \"Unauthorized Change\", \"High\",\n    RiskLevel == \"Suspicious Change\", \"Medium\",\n    \"Low\"\n)\n| extend ChangeDetails = case(\n    isnotempty(AuditAttributeChanges), strcat(\"Attribute changes: \", tostring(AuditAttributeChanges)),\n    isnotempty(TargetGuid), strcat(\"Target: \", TargetType, \" (\", TargetGuid, \")\"),\n    \"General audit event\"\n)\n| project\n    TimeGenerated,\n    EventId,\n    AuditType,\n    ChangeImpact,\n    RiskLevel,\n    SecurityImplications,\n    ComplianceRisk,\n    ChangeDetails,\n    AuditAttributeChanges,\n    ActorType,\n    ActorGuid,\n    TargetType,\n    TargetGuid,\n    TargetEmailAddress,\n    ChangeType,\n    EnterpriseGuid\n",
                "queryFrequency": "PT15M",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "LookoutEvents"
                    ],
                    "connectorId": "LookoutAPI"
                  }
                ],
                "tactics": [
                  "DefenseEvasion",
                  "Persistence",
                  "PrivilegeEscalation",
                  "Impact"
                ],
                "techniques": [
                  "T1629",
                  "T1626"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "ActorGuid",
                        "identifier": "FullName"
                      },
                      {
                        "columnName": "TargetEmailAddress",
                        "identifier": "Name"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "TargetGuid",
                        "identifier": "HostName"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "ActorType": "ActorType",
                  "RiskLevel": "RiskLevel",
                  "AuditType": "AuditType",
                  "ChangeImpact": "ChangeImpact",
                  "SecurityImpact": "SecurityImplications",
                  "ChangeType": "ChangeType",
                  "TargetType": "TargetType",
                  "ComplianceRisk": "ComplianceRisk"
                },
                "alertDetailsOverride": {
                  "alertSeverityColumnName": "ComplianceRisk",
                  "alertTacticsColumnName": "SecurityImplications",
                  "alertDisplayNameFormat": "Critical Audit Event: {{SecurityImplications}} by {{ActorType}}",
                  "alertDescriptionFormat": "{{AuditType}} by {{ActorType}} with {{ComplianceRisk}} risk"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [
                      "Account"
                    ],
                    "matchingMethod": "Selected",
                    "groupByCustomDetails": [
                      "SecurityImpact",
                      "ComplianceRisk",
                      "ActorType"
                    ],
                    "lookbackDuration": "P1D",
                    "reopenClosedIncident": false,
                    "groupByAlertDetails": [
                      "AuditType",
                      "ActorGuid"
                    ]
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "Lookout Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Lookout - Critical Audit and Policy Changes (v2)",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutEvents Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Sets the time name for analysis"
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**NOTE**: This workbook depends on a parser based on Kusto Function to work as expected [**LookoutEvents**](https://aka.ms/sentinel-lookoutapi-parser) which is deployed with the Azure Sentinel Solution.\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"fed5b1d8-5baa-44e8-b4e2-5da29af20794\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":7776000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents \\n| where EventStartTime {TimeRange} and DetailsSeverity in (\\\"LOW\\\",\\\"MEDIUM\\\",\\\"HIGH\\\")\\n| summarize count() by DetailsSeverity\",\"size\":3,\"title\":\"Event Severity Chart\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"Event Severity Chart\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents \\n| where EventStartTime  {TimeRange}\\n| where DetailsAction == \\\"DETECTED\\\" and DetailsSeverity in (\\\"LOW\\\",\\\"MEDIUM\\\",\\\"HIGH\\\")\\n| summarize count() by DetailsType,DetailsSeverity\\n| render barchart\",\"size\":1,\"title\":\"Active Issues\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"DetailsType\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"xAxis\":\"DetailsType\",\"group\":\"DetailsSeverity\",\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents \\n| where  EventStartTime {TimeRange}\\n| project EventStartTime, Type, ActorType, DetailsApplicationName, TargetPlatform,DetailsAction,DetailsClassifications,DetailsSeverity\",\"size\":1,\"title\":\"Event List\",\"noDataMessage\":\"No events to display\",\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"showExpandCollapseGrid\":true,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":5},{\"columnMatch\":\"EventVendor\",\"formatter\":5},{\"columnMatch\":\"ID\",\"formatter\":5},{\"columnMatch\":\"ChangeType\",\"formatter\":5},{\"columnMatch\":\"ActorId\",\"formatter\":5},{\"columnMatch\":\"DetailsActivationStatus\",\"formatter\":5},{\"columnMatch\":\"DetailsSecurityStatus\",\"formatter\":5},{\"columnMatch\":\"DetailsProtectionStatus\",\"formatter\":5},{\"columnMatch\":\"UpdatedDetails\",\"formatter\":5},{\"columnMatch\":\"DetailsDescription\",\"formatter\":5},{\"columnMatch\":\"DetailsPackageName\",\"formatter\":5},{\"columnMatch\":\"DetailsPath\",\"formatter\":5},{\"columnMatch\":\"DetailsFileName\",\"formatter\":5},{\"columnMatch\":\"DetailsPackageSha\",\"formatter\":5},{\"columnMatch\":\"DetailsAttributeChanges\",\"formatter\":5},{\"columnMatch\":\"DetailsId\",\"formatter\":5},{\"columnMatch\":\"DetailsAssessments\",\"formatter\":5},{\"columnMatch\":\"DetailsPcpReportingReason\",\"formatter\":5},{\"columnMatch\":\"DetailsPcpDeviceResponse\",\"formatter\":5},{\"columnMatch\":\"TargetType\",\"formatter\":5},{\"columnMatch\":\"TargetId\",\"formatter\":5},{\"columnMatch\":\"TargetEmailAddress\",\"formatter\":5},{\"columnMatch\":\"TargetOSVersion\",\"formatter\":5},{\"columnMatch\":\"TargetManufacturer\",\"formatter\":5},{\"columnMatch\":\"TargetModel\",\"formatter\":5}],\"rowLimit\":250,\"filter\":true,\"labelSettings\":[{\"columnId\":\"EventStartTime\",\"label\":\"Time\"},{\"columnId\":\"Type\"},{\"columnId\":\"ActorType\",\"label\":\"\"},{\"columnId\":\"DetailsApplicationName\",\"label\":\"ApplicationName\"},{\"columnId\":\"TargetPlatform\",\"label\":\"Platform\"},{\"columnId\":\"DetailsAction\",\"label\":\"Action\"},{\"columnId\":\"DetailsClassifications\",\"label\":\"Classifications\"},{\"columnId\":\"DetailsSeverity\",\"label\":\"Severity\"}]}},\"name\":\"Event List\"}],\"fromTemplateId\":\"sentinel-LookoutEvents\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=LookoutEvents; logoFileName=lookout.svg; description=Sets the time name for analysis; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Lookout; templateRelativePath=LookoutEvents.json; subtitle=; provider=Lookout}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "Lookout_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "LookoutAPI",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutEventsV2 Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId2')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "This workbook leverages the enhanced Lookout Mobile Risk API v2 data with comprehensive field extraction and advanced threat intelligence. It depends on the LookoutEvents parser deployed with the Azure Sentinel Solution."
              },
              "properties": {
                "displayName": "[parameters('workbook2-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Lookout Mobile Risk API v2 - Enhanced Security Dashboard\\n\\n**NOTE**: This workbook leverages the enhanced Lookout Mobile Risk API v2 data with comprehensive field extraction and advanced threat intelligence. It depends on the [**LookoutEvents**](https://aka.ms/sentinel-lookoutapi-parser) parser deployed with the Azure Sentinel Solution.\\n\\n## Key Features\\n- **Multi-Vector Threat Analysis**: Correlates threats, smishing alerts, and device compliance\\n- **Enhanced Device Intelligence**: Leverages v2 device fields including MDM integration\\n- **Advanced Risk Scoring**: Comprehensive risk assessment across all event types\\n- **Campaign Detection**: Identifies coordinated attacks and threat patterns\\n- **Compliance Monitoring**: Real-time device compliance and security posture tracking\"},\"name\":\"text - header\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"timerange-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"enterprise-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EnterpriseGuid\",\"type\":2,\"isRequired\":false,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| distinct EnterpriseGuid\\n| order by EnterpriseGuid asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"defaultValue\":\"value::all\"},{\"id\":\"platform-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DevicePlatform\",\"type\":2,\"isRequired\":false,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| distinct DevicePlatform\\n| order by DevicePlatform asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"*\"},\"defaultValue\":\"value::all\"}]},\"name\":\"parameters\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| summarize \\n    TotalEvents = count(),\\n    ThreatEvents = countif(EventType == \\\"THREAT\\\"),\\n    SmishingAlerts = countif(EventType == \\\"SMISHING_ALERT\\\"),\\n    DeviceEvents = countif(EventType == \\\"DEVICE\\\"),\\n    AuditEvents = countif(EventType == \\\"AUDIT\\\"),\\n    CriticalThreats = countif(EventType == \\\"THREAT\\\" and ThreatSeverity == \\\"CRITICAL\\\"),\\n    HighThreats = countif(EventType == \\\"THREAT\\\" and ThreatSeverity == \\\"HIGH\\\"),\\n    CriticalSmishing = countif(EventType == \\\"SMISHING_ALERT\\\" and SmishingAlertSeverity == \\\"CRITICAL\\\"),\\n    NonCompliantDevices = countif(EventType == \\\"DEVICE\\\" and DeviceComplianceStatus == \\\"Non-Compliant\\\"),\\n    HighRiskDevices = countif(EventType == \\\"DEVICE\\\" and DeviceSecurityStatus == \\\"THREATS_HIGH\\\")\\n| extend \\n    ThreatRate = round(todouble(ThreatEvents) / todouble(TotalEvents) * 100, 2),\\n    CriticalThreatRate = round(todouble(CriticalThreats) / todouble(ThreatEvents) * 100, 2),\\n    ComplianceRate = round((1.0 - todouble(NonCompliantDevices) / todouble(DeviceEvents)) * 100, 2)\",\"size\":4,\"title\":\"Security Overview - Key Metrics\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"TotalEvents\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"TotalEvents\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"secondaryContent\":{\"columnMatch\":\"ThreatRate\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"name\":\"overview-metrics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| where EventType == \\\"THREAT\\\"\\n| where ThreatSeverity in (\\\"CRITICAL\\\", \\\"HIGH\\\")\\n| extend RiskScore = case(\\n    ThreatSeverity == \\\"CRITICAL\\\", 10,\\n    ThreatSeverity == \\\"HIGH\\\", 8,\\n    ThreatSeverity == \\\"MEDIUM\\\", 5,\\n    ThreatSeverity == \\\"LOW\\\", 2,\\n    1\\n)\\n| summarize \\n    ThreatCount = count(),\\n    AvgRiskScore = avg(RiskScore),\\n    MaxRiskScore = max(RiskScore),\\n    AffectedDevices = dcount(DeviceGuid),\\n    ThreatTypes = make_set(ThreatType),\\n    Classifications = make_set(ThreatClassifications)\\n    by bin(TimeGenerated, 1h), ThreatSeverity\\n| order by TimeGenerated asc\",\"size\":0,\"title\":\"High Severity Threat Timeline\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"threat-timeline\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| where EventType == \\\"SMISHING_ALERT\\\"\\n| extend ImpersonationType = case(\\n    SmishingAlertDescription has \\\"CEO\\\" or SmishingAlertDescription has \\\"executive\\\", \\\"Executive Impersonation\\\",\\n    SmishingAlertDescription has \\\"IT\\\" or SmishingAlertDescription has \\\"support\\\", \\\"IT Support Impersonation\\\",\\n    SmishingAlertDescription has \\\"bank\\\" or SmishingAlertDescription has \\\"financial\\\", \\\"Financial Impersonation\\\",\\n    SmishingAlertDescription has \\\"delivery\\\" or SmishingAlertDescription has \\\"package\\\", \\\"Delivery Impersonation\\\",\\n    \\\"Generic Phishing\\\"\\n)\\n| summarize \\n    AlertCount = count(),\\n    AffectedDevices = dcount(DeviceGuid),\\n    CriticalAlerts = countif(SmishingAlertSeverity == \\\"CRITICAL\\\"),\\n    HighAlerts = countif(SmishingAlertSeverity == \\\"HIGH\\\")\\n    by ImpersonationType, SmishingAlertType\\n| extend TotalHighRisk = CriticalAlerts + HighAlerts\\n| order by TotalHighRisk desc\",\"size\":0,\"title\":\"Smishing Attack Analysis - Impersonation Patterns\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"smishing-analysis\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| where EventType == \\\"DEVICE\\\"\\n| extend DeviceRiskScore = case(\\n    DeviceSecurityStatus == \\\"THREATS_HIGH\\\", 9,\\n    DeviceSecurityStatus == \\\"THREATS_MEDIUM\\\", 6,\\n    DeviceSecurityStatus == \\\"THREATS_LOW\\\", 3,\\n    DeviceComplianceStatus == \\\"Non-Compliant\\\", 7,\\n    DeviceComplianceStatus == \\\"Partial\\\", 4,\\n    1\\n)\\n| extend MDMStatus = case(\\n    isnotempty(MDMConnectorId) and isnotempty(MDMExternalId), \\\"Fully Integrated\\\",\\n    isnotempty(MDMConnectorId), \\\"Partial Integration\\\",\\n    \\\"Not Integrated\\\"\\n)\\n| summarize \\n    DeviceCount = dcount(DeviceGuid),\\n    AvgRiskScore = avg(DeviceRiskScore),\\n    NonCompliantDevices = dcountif(DeviceGuid, DeviceComplianceStatus == \\\"Non-Compliant\\\"),\\n    HighRiskDevices = dcountif(DeviceGuid, DeviceSecurityStatus == \\\"THREATS_HIGH\\\"),\\n    OutdatedSDK = dcountif(DeviceGuid, ClientLookoutSDKVersion < \\\"2.0\\\")\\n    by DevicePlatform, MDMStatus\\n| extend ComplianceRate = round((1.0 - todouble(NonCompliantDevices) / todouble(DeviceCount)) * 100, 2)\\n| order by AvgRiskScore desc\",\"size\":0,\"title\":\"Device Security Posture by Platform and MDM Integration\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"device-posture\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let campaignWindow = 48h;\\nlet minDevices = 3;\\nLookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| where EventType in (\\\"THREAT\\\", \\\"SMISHING_ALERT\\\")\\n| extend ThreatIndicator = case(\\n    EventType == \\\"THREAT\\\", ThreatType,\\n    EventType == \\\"SMISHING_ALERT\\\", SmishingAlertType,\\n    \\\"Unknown\\\"\\n)\\n| extend ThreatSev = case(\\n    EventType == \\\"THREAT\\\", ThreatSeverity,\\n    EventType == \\\"SMISHING_ALERT\\\", SmishingAlertSeverity,\\n    \\\"Unknown\\\"\\n)\\n| where ThreatSev in (\\\"CRITICAL\\\", \\\"HIGH\\\")\\n| summarize \\n    AffectedDevices = dcount(DeviceGuid),\\n    DeviceList = make_set(DeviceGuid),\\n    EmailList = make_set(DeviceEmailAddress),\\n    PlatformDistribution = make_set(DevicePlatform),\\n    FirstIncident = min(TimeGenerated),\\n    LastIncident = max(TimeGenerated),\\n    EventTypes = make_set(EventType)\\n    by EnterpriseGuid, ThreatIndicator\\n| where AffectedDevices >= minDevices\\n| extend CampaignDuration = LastIncident - FirstIncident\\n| extend CampaignRisk = case(\\n    AffectedDevices >= 10, \\\"Critical\\\",\\n    AffectedDevices >= 5, \\\"High\\\",\\n    \\\"Medium\\\"\\n)\\n| project ThreatIndicator, AffectedDevices, CampaignRisk, CampaignDuration, FirstIncident, LastIncident, PlatformDistribution, EventTypes\\n| order by AffectedDevices desc\",\"size\":0,\"title\":\"Potential Threat Campaigns - Multi-Device Attacks\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"campaign-detection\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| where EventType == \\\"AUDIT\\\"\\n| where AuditType in (\\\"POLICY_CHANGE\\\", \\\"SECURITY_SETTING_CHANGE\\\", \\\"USER_MANAGEMENT\\\")\\n| extend SecurityImplication = case(\\n    AuditAttributeChanges has \\\"threat_response_level\\\" and AuditAttributeChanges has \\\"LOW\\\", \\\"Threat Response Weakened\\\",\\n    AuditAttributeChanges has \\\"auto_quarantine_enabled\\\" and AuditAttributeChanges has \\\"false\\\", \\\"Auto-Quarantine Disabled\\\",\\n    AuditAttributeChanges has \\\"compliance_enforcement\\\" and AuditAttributeChanges has \\\"false\\\", \\\"Compliance Enforcement Disabled\\\",\\n    AuditAttributeChanges has \\\"admin\\\" or AuditAttributeChanges has \\\"privilege\\\", \\\"Privilege Changes\\\",\\n    \\\"Configuration Update\\\"\\n)\\n| extend RiskLevel = case(\\n    ActorType == \\\"SYSTEM\\\", \\\"Automated\\\",\\n    ActorType == \\\"ADMIN_USER\\\", \\\"Administrative\\\",\\n    ActorType == \\\"USER\\\", \\\"User-Initiated\\\",\\n    \\\"Unknown\\\"\\n)\\n| summarize \\n    ChangeCount = count(),\\n    UniqueActors = dcount(ActorGuid),\\n    HighRiskChanges = countif(SecurityImplication in (\\\"Threat Response Weakened\\\", \\\"Auto-Quarantine Disabled\\\", \\\"Compliance Enforcement Disabled\\\")),\\n    PrivilegeChanges = countif(SecurityImplication == \\\"Privilege Changes\\\")\\n    by bin(TimeGenerated, 1d), AuditType, RiskLevel\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Security Configuration Changes - Audit Trail\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"audit-trail\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| where EventType in (\\\"THREAT\\\", \\\"SMISHING_ALERT\\\", \\\"DEVICE\\\")\\n| extend RiskScore = case(\\n    EventType == \\\"THREAT\\\" and ThreatSeverity == \\\"CRITICAL\\\", 10,\\n    EventType == \\\"THREAT\\\" and ThreatSeverity == \\\"HIGH\\\", 8,\\n    EventType == \\\"SMISHING_ALERT\\\" and SmishingAlertSeverity == \\\"CRITICAL\\\", 9,\\n    EventType == \\\"SMISHING_ALERT\\\" and SmishingAlertSeverity == \\\"HIGH\\\", 7,\\n    EventType == \\\"DEVICE\\\" and DeviceSecurityStatus == \\\"THREATS_HIGH\\\", 6,\\n    EventType == \\\"DEVICE\\\" and DeviceComplianceStatus == \\\"Non-Compliant\\\", 5,\\n    2\\n)\\n| where RiskScore >= 6\\n| summarize \\n    TotalRiskScore = sum(RiskScore),\\n    EventCount = count(),\\n    ThreatEvents = countif(EventType == \\\"THREAT\\\"),\\n    SmishingEvents = countif(EventType == \\\"SMISHING_ALERT\\\"),\\n    DeviceEvents = countif(EventType == \\\"DEVICE\\\"),\\n    LastActivity = max(TimeGenerated),\\n    DeviceInfo = take_any(strcat(DeviceManufacturer, \\\" \\\", DeviceModel, \\\" (\\\", DevicePlatform, \\\" \\\", DeviceOSVersion, \\\")\\\"))\\n    by DeviceGuid, DeviceEmailAddress\\n| extend OverallRisk = case(\\n    TotalRiskScore >= 25, \\\"Critical\\\",\\n    TotalRiskScore >= 15, \\\"High\\\",\\n    TotalRiskScore >= 8, \\\"Medium\\\",\\n    \\\"Low\\\"\\n)\\n| where OverallRisk in (\\\"Critical\\\", \\\"High\\\")\\n| project DeviceGuid, DeviceEmailAddress, DeviceInfo, OverallRisk, TotalRiskScore, EventCount, ThreatEvents, SmishingEvents, DeviceEvents, LastActivity\\n| order by TotalRiskScore desc\\n| take 20\",\"size\":0,\"title\":\"Top 20 High-Risk Devices - Comprehensive Risk Assessment\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"high-risk-devices\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutEvents\\n| where TimeGenerated {TimeRange}\\n| where EnterpriseGuid in ({EnterpriseGuid}) or '*' in ({EnterpriseGuid})\\n| where DevicePlatform in ({DevicePlatform}) or '*' in ({DevicePlatform})\\n| summarize EventCount = count() by EventType, bin(TimeGenerated, 1h)\\n| render timechart\",\"size\":0,\"title\":\"Event Volume Trends by Type\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"event-trends\"},{\"type\":1,\"content\":{\"json\":\"## Advanced Analytics and Recommendations\\n\\n### Key Insights from v2 Data:\\n- **Enhanced Threat Intelligence**: Leverages comprehensive threat classification and assessment data\\n- **Smishing Detection**: New v2 capability providing advanced SMS phishing protection\\n- **Device Compliance Monitoring**: Real-time compliance status with MDM integration details\\n- **Audit Trail**: Complete administrative action tracking for compliance and security governance\\n\\n### Recommended Actions:\\n1. **High-Risk Devices**: Review devices with critical risk scores and implement remediation\\n2. **Campaign Detection**: Investigate potential coordinated attacks affecting multiple devices\\n3. **Compliance Gaps**: Address non-compliant devices and MDM integration issues\\n4. **Configuration Changes**: Review high-risk audit events and unauthorized modifications\\n\\n### Next Steps:\\n- Configure automated response playbooks for critical threats\\n- Implement device quarantine policies for high-risk devices\\n- Set up alerting for potential threat campaigns\\n- Review and update security policies based on audit findings\"},\"name\":\"recommendations\"}],\"fallbackResourceIds\":[\"Azure Monitor\"],\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId2'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=LookoutEventsV2; logoFileName=lookout.svg; description=This workbook leverages the enhanced Lookout Mobile Risk API v2 data with comprehensive field extraction and advanced threat intelligence. It depends on the LookoutEvents parser deployed with the Azure Sentinel Solution.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Lookout Enhanced Security Dashboard; templateRelativePath=LookoutEventsV2.json; subtitle=; provider=Lookout}.description",
                "parentId": "[variables('workbookId2')]",
                "contentId": "[variables('_workbookContentId2')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "LookoutEvents",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "LookoutAPI",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId2')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook2-name')]",
        "contentProductId": "[variables('_workbookcontentProductId2')]",
        "id": "[variables('_workbookcontentProductId2')]",
        "version": "[variables('workbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutSecurityInvestigationDashboard Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId3')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Real-time mobile threat investigation and incident response"
              },
              "properties": {
                "displayName": "[parameters('workbook3-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Lookout Mobile Security - Investigation Dashboard\\n\\n**Real-time mobile threat investigation and incident response**\"},\"name\":\"text - title\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"time-range-param\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - time range\"},{\"type\":1,\"content\":{\"json\":\"###  Critical Alerts - Requires Immediate Action\"},\"name\":\"text - critical section\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    ThreatSeverity = tostring(threat.severity),\\n    DeviceEmail = tostring(device.email),\\n    ThreatType = tostring(threat.type),\\n    ThreatDescription = tostring(threat.description)\\n| where EventType == \\\"THREAT\\\" and ThreatSeverity in (\\\"HIGH\\\", \\\"CRITICAL\\\")\\n| summarize \\n    Count = count(),\\n    LatestThreat = max(TimeGenerated),\\n    Devices = dcount(DeviceEmail)\\n| extend Status = case(\\n    Count > 10, \\\" Critical\\\",\\n    Count > 5, \\\" High\\\", \\n    \\\" Medium\\\"\\n)\\n| project Status, ActiveThreats = Count, AffectedDevices = Devices, LastDetected = LatestThreat\",\"size\":3,\"title\":\"High Severity Threats\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"ActiveThreats\",\"formatter\":12,\"formatOptions\":{\"palette\":\"redBright\"}},\"secondaryContent\":{\"columnMatch\":\"AffectedDevices\",\"formatter\":1},\"showBorder\":true}},\"name\":\"query - critical threats\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| where EventType == \\\"SMISHING_ALERT\\\"\\n| summarize SmishingAlerts = count()\\n| extend Status = case(SmishingAlerts > 0, \\\" Active\\\", \\\" None\\\")\\n| project Status, SmishingAlerts\",\"size\":3,\"title\":\"Smishing Campaigns\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":true,\"titleContent\":{\"columnMatch\":\"Status\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"SmishingAlerts\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orange\"}}}},\"name\":\"query - smishing\"},{\"type\":1,\"content\":{\"json\":\"###  Recent Threat Activity - Last 24 Hours\"},\"name\":\"text - recent activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Devices = LookoutMtdV2_CL\\n| where TimeGenerated > ago(30d)\\n| where log_type == \\\"DEVICE\\\"\\n| extend DeviceEmail = tostring(device.info.email)\\n| where isnotempty(DeviceEmail)\\n| summarize arg_max(TimeGenerated, *) by DeviceEmail\\n| project DeviceEmail, DevicePlatform = tostring(device.platform), DeviceOS = tostring(device.info.os_version), DeviceManufacturer = tostring(device.info.manufacturer), DeviceModel = tostring(device.info.model);\\nLookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| where EventType == \\\"THREAT\\\"\\n| extend \\n    ThreatType = tostring(threat.type),\\n    ThreatSeverity = tostring(threat.severity),\\n    ThreatDescription = tostring(threat.description),\\n    DeviceEmail = tostring(threat.device.email),\\n    ThreatStatus = tostring(threat.status),\\n    ThreatID = tostring(threat.guid)\\n| join kind=leftouter (Devices) on DeviceEmail\\n| project \\n    TimeGenerated,\\n    Severity = ThreatSeverity,\\n    Type = ThreatType,\\n    Description = ThreatDescription,\\n    [\\\"User Email\\\"] = DeviceEmail,\\n    Platform = strcat(DevicePlatform, \\\" \\\", DeviceOS),\\n    Device = strcat(DeviceManufacturer, \\\" \\\", DeviceModel),\\n    Status = ThreatStatus,\\n    ThreatID\\n| order by TimeGenerated desc\\n| take 50\",\"size\":0,\"title\":\"Latest Threats Detected\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"CRITICAL\",\"representation\":\"redBright\",\"text\":\"CRITICAL\"},{\"operator\":\"==\",\"thresholdValue\":\"HIGH\",\"representation\":\"red\",\"text\":\"HIGH\"},{\"operator\":\"==\",\"thresholdValue\":\"MEDIUM\",\"representation\":\"orange\",\"text\":\"MEDIUM\"},{\"operator\":\"Default\",\"representation\":\"yellow\",\"text\":\"LOW\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"RESOLVED\",\"representation\":\"green\",\"text\":\"RESOLVED\"},{\"operator\":\"Default\",\"representation\":\"orange\",\"text\":\"ACTIVE\"}]}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"TimeGenerated\",\"sortOrder\":2}]},\"name\":\"query - recent threats table\"},{\"type\":1,\"content\":{\"json\":\"###  Device Risk Analysis\"},\"name\":\"text - device section\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    DeviceEmail = coalesce(tostring(threat.device.email), tostring(device.info.email)),\\n    DevicePlatform = coalesce(tostring(threat.device.platform), tostring(device.platform)),\\n    DeviceManufacturer = coalesce(tostring(threat.device.manufacturer), tostring(device.info.manufacturer)),\\n    DeviceModel = coalesce(tostring(threat.device.model), tostring(device.info.model)),\\n    DeviceOS = coalesce(tostring(threat.device.os_version), tostring(device.info.os_version)),\\n    SecurityStatus = coalesce(tostring(threat.device.security_status), tostring(device.security_status))\\n| where isnotempty(DeviceEmail)\\n| summarize \\n    ThreatCount = countif(EventType == \\\"THREAT\\\"),\\n    LastSeen = max(TimeGenerated),\\n    Platform = any(DevicePlatform),\\n    OS = any(DeviceOS),\\n    DeviceType = any(strcat(DeviceManufacturer, \\\" \\\", DeviceModel)),\\n    SecurityStatus = any(SecurityStatus)\\n    by DeviceEmail\\n| extend RiskLevel = case(\\n    ThreatCount >= 5, \\\" High Risk\\\",\\n    ThreatCount >= 2, \\\" Medium Risk\\\",\\n    \\\" Low Risk\\\"\\n)\\n| project [\\\"User Email\\\"] = DeviceEmail, RiskLevel, Threats = ThreatCount, Platform, OS, DeviceType, SecurityStatus, LastSeen\\n| order by Threats desc\\n| take 20\",\"size\":0,\"title\":\"Top Devices by Risk\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"query - device risk\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    DevicePlatform = tostring(device.platform)\\n| where isnotempty(DevicePlatform)\\n| summarize Count = count() by DevicePlatform, EventType\\n| order by Count desc\",\"size\":0,\"title\":\"Events by Platform\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query - platform distribution\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and isnotempty(ThreatType)\\n| summarize Count = count() by ThreatType\\n| order by Count desc\",\"size\":0,\"title\":\"Threat Types\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - threat types\"},{\"type\":1,\"content\":{\"json\":\"###  Trend Analysis\"},\"name\":\"text - trends\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| summarize Count = count() by bin(TimeGenerated, 1h), EventType\\n| render timechart\",\"size\":0,\"title\":\"Event Volume Over Time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"query - timeline\"},{\"type\":1,\"content\":{\"json\":\"###  Investigation Tools\"},\"name\":\"text - investigation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| where EventType == \\\"AUDIT\\\"\\n| extend \\n    AuditType = tostring(audit.type),\\n    ActorEmail = tostring(actor.guid),\\n    TargetEmail = tostring(target.email_address)\\n| project TimeGenerated, AuditType, Actor = ActorEmail, Target = TargetEmail\\n| order by TimeGenerated desc\\n| take 25\",\"size\":0,\"title\":\"Recent Audit Events - Configuration Changes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"name\":\"query - audit log\"}],\"fromTemplateId\":\"sentinel-LookoutInvestigation\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId3'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=LookoutSecurityInvestigationDashboard; logoFileName=lookout.svg; description=Real-time mobile threat investigation and incident response; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Lookout Security Investigation Dashboard; templateRelativePath=LookoutSecurityInvestigationDashboard.json; subtitle=; provider=Lookout}.description",
                "parentId": "[variables('workbookId3')]",
                "contentId": "[variables('_workbookContentId3')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "LookoutMtdV2_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "LookoutAPI",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId3')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook3-name')]",
        "contentProductId": "[variables('_workbookcontentProductId3')]",
        "id": "[variables('_workbookcontentProductId3')]",
        "version": "[variables('workbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutExecutiveDashboard Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId4')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Real-time mobile threat detection and device security monitoring"
              },
              "properties": {
                "displayName": "[parameters('workbook4-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Lookout Mobile Security - Executive Dashboard\\n\\n**Real-time mobile threat detection and device security monitoring**\"},\"name\":\"text - title\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"TimeRange\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000,\"createdTime\":\"2023-01-01T00:00:00Z\",\"isInitialTime\":false,\"grain\":1,\"useDashboardTimeRange\":false},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000}],\"allowCustom\":true}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Severity = tostring(threat.severity)\\n| where EventType == \\\"THREAT\\\" and Severity in (\\\"HIGH\\\", \\\"CRITICAL\\\")\\n| summarize Count = count()\",\"size\":4,\"title\":\"Active High Severity Threats\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"red\"}},\"showBorder\":true,\"size\":\"auto\"}},\"customWidth\":\"20\",\"name\":\"query - high severity count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Status = tostring(threat.status)\\n| where EventType == \\\"THREAT\\\" and Status in (\\\"RESOLVED\\\", \\\"CLOSED\\\", \\\"BLOCKED\\\")\\n| summarize Count = count()\",\"size\":4,\"title\":\"Threats Resolved\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"green\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"query - threats resolved\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, DeviceEmail = tostring(threat.device.email)\\n| where EventType == \\\"THREAT\\\" and isnotempty(DeviceEmail)\\n| summarize Count = dcount(DeviceEmail)\",\"size\":4,\"title\":\"Devices with Threats\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orange\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"query - devices with threats\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| where EventType == \\\"AUDIT\\\"\\n| summarize Count = count()\",\"size\":4,\"title\":\"Audit Events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"query - audit events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, TotalEvents = tostring(\\\"Total\\\")\\n| summarize Count = count()\",\"size\":4,\"title\":\"Total Events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Count\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"gray\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"query - total events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and isnotempty(ThreatType)\\n| summarize Count = count() by ThreatType\\n| sort by Count desc\\n| take 10\",\"size\":0,\"title\":\"Threat Type Distribution\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Count\",\"color\":\"orange\"}]}},\"customWidth\":\"33\",\"name\":\"query - threat distribution\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Status = tostring(threat.status)\\n| where EventType == \\\"THREAT\\\"\\n| summarize Count = count() by Status\\n| sort by Count desc\",\"size\":0,\"title\":\"Threat Status Overview\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - threat status\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Severity = tostring(threat.severity)\\n| where EventType == \\\"THREAT\\\" and isnotempty(Severity)\\n| summarize Count = count() by Severity\\n| sort by Count desc\",\"size\":0,\"title\":\"Severity Breakdown\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"columnchart\",\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}}}}},\"customWidth\":\"34\",\"name\":\"query - severity breakdown\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Severity = tostring(threat.severity)\\n| where EventType == \\\"THREAT\\\"\\n| summarize Count = count() by bin(TimeGenerated, 1h), Severity\\n| render timechart\",\"size\":0,\"title\":\"Threat Activity Timeline\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"name\":\"query - timeline\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Platform = tostring(threat.device.platform)\\n| where EventType == \\\"THREAT\\\" and isnotempty(Platform)\\n| summarize Count = count() by Platform\",\"size\":0,\"title\":\"Devices by Platform\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - platform distribution\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    ThreatType = tostring(threat.type),\\n    Severity = tostring(threat.severity),\\n    Status = tostring(threat.status),\\n    DeviceEmail = tostring(threat.device.email),\\n    DevicePlatform = tostring(threat.device.platform),\\n    ThreatDetails = tostring(threat.details.network_ssid)\\n| where EventType == \\\"THREAT\\\" and Severity in (\\\"HIGH\\\", \\\"CRITICAL\\\")\\n| project \\n    TimeGenerated,\\n    Severity,\\n    ThreatType,\\n    Status,\\n    DeviceEmail,\\n    DevicePlatform,\\n    ThreatDetails\\n| sort by TimeGenerated desc\\n| take 20\",\"size\":0,\"title\":\"HIGH PRIORITY - Recent High-Severity Threats\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"CRITICAL\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"HIGH\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"gray\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"OPEN\",\"representation\":\"red\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"RESOLVED\",\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}}]}},\"customWidth\":\"100\",\"name\":\"query - high priority table\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    DeviceEmail = tostring(threat.device.email),\\n    ThreatType = tostring(threat.type),\\n    Severity = tostring(threat.severity)\\n| where EventType == \\\"THREAT\\\" and isnotempty(DeviceEmail)\\n| summarize \\n    ThreatCount = count(),\\n    HighestSeverity = max(Severity),\\n    ThreatTypes = make_set(ThreatType),\\n    LastSeen = max(TimeGenerated)\\n    by DeviceEmail\\n| sort by ThreatCount desc\\n| take 20\",\"size\":0,\"title\":\"Most Targeted Devices\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"query - targeted devices\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    NetworkSSID = tostring(threat.details.network_ssid),\\n    ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and ThreatType == \\\"NETWORK\\\" and isnotempty(NetworkSSID)\\n| summarize \\n    DetectionCount = count(),\\n    UniqueDevices = dcount(tostring(threat.device.email)),\\n    LastSeen = max(TimeGenerated)\\n    by NetworkSSID\\n| sort by DetectionCount desc\\n| take 15\",\"size\":0,\"title\":\"Rogue WiFi Networks Detected\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"query - rogue networks\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| summarize Count = count() by EventType\\n| render piechart\",\"size\":0,\"title\":\"Event Type Distribution\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - event types\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    ActorType = tostring(actor.type)\\n| where EventType == \\\"AUDIT\\\" and isnotempty(ActorType)\\n| summarize Count = count() by ActorType\\n| sort by Count desc\",\"size\":0,\"title\":\"Audit Events by Actor\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"columnchart\"},\"customWidth\":\"50\",\"name\":\"query - audit actors\"}],\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId4'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=LookoutExecutiveDashboard; logoFileName=lookout.svg; description=Real-time mobile threat detection and device security monitoring; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Lookout Executive Dashboard; templateRelativePath=LookoutExecutiveDashboard.json; subtitle=; provider=Lookout}.description",
                "parentId": "[variables('workbookId4')]",
                "contentId": "[variables('_workbookContentId4')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "LookoutMtdV2_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "LookoutAPI",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId4')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook4-name')]",
        "contentProductId": "[variables('_workbookcontentProductId4')]",
        "id": "[variables('_workbookcontentProductId4')]",
        "version": "[variables('workbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutIOAInvestigationDashboard Workbook with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId5')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Comprehensive mobile threat intelligence, device investigation, and security posture monitoring"
              },
              "properties": {
                "displayName": "[parameters('workbook5-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Lookout IOA Detection and Investigation Dashboard\\n\\n**Comprehensive mobile threat intelligence, device investigation, and security posture monitoring**\"},\"name\":\"text - main title\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"TimeRange\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000}],\"allowCustom\":true}},{\"id\":\"FocusDevice\",\"name\":\"FocusDevice\",\"label\":\"Focus Device (Optional)\",\"type\":2,\"isRequired\":false,\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend DeviceEmail = tostring(threat.device.email)\\n| where isnotempty(DeviceEmail)\\n| distinct DeviceEmail\\n| order by DeviceEmail asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - filters\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  Executive Summary - Key Risk Indicators\"},\"name\":\"text - executive header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, SmishingURL = tostring(smishing_alert.url)\\n| where EventType == \\\"SMISHING_ALERT\\\" and isnotempty(SmishingURL)\\n| summarize Count = dcount(SmishingURL) by DeviceEmail = tostring(threat.device.email)\\n| summarize PhishingCampaigns = count()\",\"size\":4,\"title\":\"Phishing Campaign Alerts (3+ Same URL)\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"PhishingCampaigns\",\"formatter\":12,\"formatOptions\":{\"palette\":\"redBright\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"kpi - phishing campaigns\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and ThreatType in (\\\"MALWARE\\\", \\\"VULNERABILITY\\\")\\n| summarize ActiveVulns = dcount(tostring(threat.guid))\",\"size\":4,\"title\":\"Active Vulnerabilities\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"ActiveVulns\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orange\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"kpi - active vulns\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and ThreatType == \\\"WEB_CONTENT\\\"\\n| summarize HighRiskDevices = dcount(tostring(threat.device.email))\\n| extend HighRiskDevices = iff(HighRiskDevices >= 10, HighRiskDevices, 0)\",\"size\":4,\"title\":\"High-Risk Devices (10+ Web Threats)\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"HighRiskDevices\",\"formatter\":12,\"formatOptions\":{\"palette\":\"red\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"kpi - high risk devices\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and ThreatType == \\\"OS\\\"\\n| summarize OutdatedOS = dcount(tostring(threat.device.guid))\",\"size\":4,\"title\":\"Outdated OS Devices\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"OutdatedOS\",\"formatter\":12,\"formatOptions\":{\"palette\":\"yellow\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"kpi - outdated os\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, ThreatType = tostring(threat.type), DeviceEmail = tostring(threat.device.email)\\n| where EventType == \\\"THREAT\\\" and isnotempty(DeviceEmail)\\n| summarize Count = count() by DeviceEmail\\n| summarize PoorHygiene = countif(Count >= 5)\",\"size\":4,\"title\":\"Poor Hygiene Devices (5+ Non-Web Events)\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"PoorHygiene\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orange\"}},\"showBorder\":true}},\"customWidth\":\"20\",\"name\":\"kpi - poor hygiene\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  Smishing & Phishing Analysis\"},\"name\":\"text - smishing header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type\\n| where EventType == \\\"SMISHING_ALERT\\\"\\n| summarize Count = count()\",\"size\":4,\"title\":\"Smishing Detections\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"red\",\"aggregation\":\"Sum\"}},\"showBorder\":true}},\"customWidth\":\"25\",\"name\":\"smishing - count\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, Category = tostring(smishing_alert.category)\\n| where EventType == \\\"SMISHING_ALERT\\\" and isnotempty(Category)\\n| summarize Count = count() by Category\",\"size\":0,\"title\":\"Smishing Detection Category\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"smishing - category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend EventType = log_type, SmishingType = tostring(smishing_alert.type)\\n| where EventType == \\\"SMISHING_ALERT\\\" and isnotempty(SmishingType)\\n| summarize Count = count() by SmishingType\",\"size\":0,\"title\":\"Smishing Attacks by Type\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"columnchart\"},\"customWidth\":\"50\",\"name\":\"smishing - by type\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    SmishingURL = tostring(smishing_alert.url),\\n    DeviceEmail = tostring(threat.device.email)\\n| where EventType == \\\"SMISHING_ALERT\\\" and isnotempty(SmishingURL)\\n| summarize \\n    HitCount = count(),\\n    UniqueDevices = dcount(DeviceEmail),\\n    LastSeen = max(TimeGenerated)\\n    by SmishingURL\\n| where HitCount >= 2\\n| sort by HitCount desc\\n| take 20\",\"size\":0,\"title\":\"Smishing - Phishing / Malicious URLs (2+ Hits)\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"100\",\"name\":\"smishing - malicious urls\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  IOC Analysis - Malicious File Hashes\"},\"name\":\"text - ioc header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    PackageSHA = tostring(threat.package_sha),\\n    AppName = tostring(threat.application_name),\\n    ThreatType = tostring(threat.type),\\n    DeviceEmail = tostring(threat.device.email)\\n| where EventType == \\\"THREAT\\\" and isnotempty(PackageSHA)\\n| summarize \\n    DetectionCount = count(),\\n    DevicesAffected = dcount(DeviceEmail),\\n    Applications = make_set(AppName),\\n    ThreatTypes = make_set(ThreatType),\\n    LastSeen = max(TimeGenerated)\\n    by PackageSHA\\n| sort by DetectionCount desc\\n| take 20\",\"size\":0,\"title\":\"Malicious File Hashes - Top 20\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DetectionCount\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"max\":30,\"palette\":\"greenRed\"}}]}},\"name\":\"ioc - file hashes\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  Device & Application Analysis\"},\"name\":\"text - device header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    AppName = tostring(threat.application_name),\\n    PackageSHA = tostring(threat.package_sha),\\n    DeviceEmail = tostring(threat.device.email),\\n    Severity = tostring(threat.severity)\\n| where EventType == \\\"THREAT\\\" and isnotempty(AppName)\\n| summarize \\n    EventCount = count(),\\n    DevicesAffected = dcount(DeviceEmail),\\n    ThreatTypes = make_set(tostring(threat.type)),\\n    PackageSHAs = make_set(PackageSHA)\\n    by AppName\\n| where EventCount >= 2\\n| sort by EventCount desc\\n| take 15\",\"size\":0,\"title\":\"Targeted Application Campaigns - Apps with 2+ Events\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"EventCount\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"blue\"}}]}},\"customWidth\":\"50\",\"name\":\"app - targeted campaigns\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    AppName = tostring(threat.application_name),\\n    Severity = tostring(threat.severity),\\n    DeviceEmail = tostring(threat.device.email)\\n| where EventType == \\\"THREAT\\\" and ThreatType in (\\\"APPLICATION\\\", \\\"MALWARE\\\")\\n| summarize \\n    OpenVulns = countif(tostring(threat.status) == \\\"OPEN\\\"),\\n    DevicesAffected = dcount(DeviceEmail),\\n    Severities = make_set(Severity)\\n    by AppName\\n| where OpenVulns > 0\\n| sort by OpenVulns desc\\n| take 10\",\"size\":0,\"title\":\"Active Vulnerable Applications\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"OpenVulns\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}}]}},\"customWidth\":\"50\",\"name\":\"app - vulnerable\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    DeviceEmail = tostring(threat.device.email),\\n    ThreatType = tostring(threat.type)\\n| where EventType == \\\"THREAT\\\" and ThreatType == \\\"WEB_CONTENT\\\"\\n| summarize \\n    WebThreatCount = count(),\\n    LastSeen = max(TimeGenerated)\\n    by DeviceEmail\\n| sort by WebThreatCount desc\\n| take 10\",\"size\":0,\"title\":\"Top 10 Devices - Web Content Threats\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"device - web threats\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    OSVersion = tostring(threat.device.os_version),\\n    DeviceEmail = tostring(threat.device.email),\\n    Platform = tostring(threat.device.platform)\\n| where EventType == \\\"DEVICE\\\" and isnotempty(OSVersion)\\n| summarize arg_max(TimeGenerated, *) by DeviceEmail\\n| project DeviceEmail, Platform, OSVersion, TimeGenerated\\n| take 20\",\"size\":0,\"title\":\"Out of Date OS Devices\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\"},\"customWidth\":\"50\",\"name\":\"device - outdated os\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  Threat Resolution Performance\"},\"name\":\"text - resolution header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    ThreatType = tostring(threat.type),\\n    Status = tostring(threat.status)\\n| where EventType == \\\"THREAT\\\"\\n| summarize \\n    TotalEvents = count(),\\n    Resolved = countif(Status in (\\\"RESOLVED\\\", \\\"CLOSED\\\")),\\n    StillOpen = countif(Status == \\\"OPEN\\\")\\n    by ThreatType\\n| extend ResolutionRate = round(todouble(Resolved) * 100.0 / todouble(TotalEvents), 2)\\n| project ThreatType, TotalEvents, Resolved, StillOpen, ResolutionRate\\n| sort by TotalEvents desc\",\"size\":0,\"title\":\"Threat Resolution Performance by Type\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ResolutionRate\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"greenRed\"}}]}},\"name\":\"resolution - performance\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  Threat Status Distribution Over Time\"},\"name\":\"text - timeline header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend \\n    EventType = log_type,\\n    Status = tostring(threat.status)\\n| where EventType == \\\"THREAT\\\"\\n| summarize Count = count() by bin(TimeGenerated, 1h), Status\\n| render areachart\",\"size\":0,\"title\":\"Threat Status Over Time\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"name\":\"timeline - status\"},{\"type\":1,\"content\":{\"json\":\"---\\n##  Device Investigation Timeline - Selected Device\"},\"conditionalVisibility\":{\"parameterName\":\"FocusDevice\",\"comparison\":\"isNotEqualTo\",\"value\":\"value::all\"},\"name\":\"text - device investigation header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"LookoutMtdV2_CL\\n| where TimeGenerated {TimeRange}\\n| extend DeviceEmail = tostring(threat.device.email)\\n| where DeviceEmail == '{FocusDevice}'\\n| extend \\n    EventType = log_type,\\n    ThreatType = tostring(threat.type),\\n    Severity = tostring(threat.severity),\\n    Status = tostring(threat.status),\\n    Classification = tostring(threat.classifications),\\n    URL = tostring(smishing_alert.url),\\n    AppName = tostring(threat.application_name)\\n| project \\n    TimeGenerated,\\n    ThreatType,\\n    Severity,\\n    Classification,\\n    Status,\\n    URL,\\n    AppName\\n| sort by TimeGenerated desc\",\"size\":0,\"title\":\"Device Investigation Timeline - {FocusDevice}\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"HIGH\",\"representation\":\"orange\"},{\"operator\":\"==\",\"thresholdValue\":\"CRITICAL\",\"representation\":\"red\"},{\"operator\":\"==\",\"thresholdValue\":\"MEDIUM\",\"representation\":\"yellow\"},{\"operator\":\"Default\",\"representation\":\"gray\"}]}},{\"columnMatch\":\"Status\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"OPEN\",\"representation\":\"red\"},{\"operator\":\"==\",\"thresholdValue\":\"RESOLVED\",\"representation\":\"green\"},{\"operator\":\"Default\",\"representation\":\"blue\"}]}}]}},\"conditionalVisibility\":{\"parameterName\":\"FocusDevice\",\"comparison\":\"isNotEqualTo\",\"value\":\"value::all\"},\"name\":\"device investigation - timeline\"}],\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId5'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=LookoutIOAInvestigationDashboard; logoFileName=lookout.svg; description=Comprehensive mobile threat intelligence, device investigation, and security posture monitoring; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Lookout IOA Investigation Dashboard; templateRelativePath=LookoutIOAInvestigationDashboard.json; subtitle=; provider=Lookout}.description",
                "parentId": "[variables('workbookId5')]",
                "contentId": "[variables('_workbookContentId5')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "LookoutMtdV2_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "LookoutAPI",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId5')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook5-name')]",
        "contentProductId": "[variables('_workbookcontentProductId5')]",
        "id": "[variables('_workbookcontentProductId5')]",
        "version": "[variables('workbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutEvents Data Parser with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Lookout Data Parser",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "LookoutEvents",
                "query": "let LookoutEvents_view = view () { \n    LookoutMtdV2_CL\n    | extend \n        // Core Event Fields\n        EventVendor = \"Lookout\",\n        EventProduct = \"Lookout Mobile Risk API v2\",\n        EventType = coalesce(log_type, event_type),  // Support both v1 and v2 API field names\n        EventId = id,\n        EventTime = TimeGenerated,\n        EventStartTime = TimeGenerated,\n        EventEndTime = TimeGenerated,\n        ChangeType = change_type,\n        \n        // Threat Information (from nested threat object)\n        ThreatId = tostring(threat.guid),\n        ThreatType = tostring(threat.type),\n        ThreatAction = tostring(threat.action),\n        ThreatSeverity = tostring(threat.severity),\n        ThreatClassification = tostring(threat.classification),\n        ThreatClassifications = tostring(threat.classifications),\n        ThreatRisk = tostring(threat.risk),\n        ThreatStatus = tostring(threat.status),\n        ThreatAssessments = tostring(threat.assessments),\n        ThreatDescription = tostring(threat.description),\n        ThreatApplicationName = tostring(threat.application_name),\n        ThreatPackageName = tostring(threat.package_name),\n        ThreatPackageSha = tostring(threat.package_sha),\n        ThreatFileName = tostring(threat.file_name),\n        ThreatFilePath = tostring(threat.file_path),\n        ThreatDetectedAt = todatetime(threat.detected_at),\n        ThreatPcpReportingReason = tostring(threat.pcp_reporting_reason),\n        ThreatPcpDeviceResponse = tostring(threat.pcp_device_response),\n        \n        // Device Information (from nested threat.device object)\n        DeviceGuid = coalesce(tostring(threat.device.guid), tostring(device.guid)),\n        DeviceEmailAddress = coalesce(tostring(threat.device.email), tostring(device.email)),\n        DevicePlatform = coalesce(tostring(threat.device.platform), tostring(device.platform)),\n        DeviceOSVersion = coalesce(tostring(threat.device.os_version), tostring(device.os_version)),\n        DeviceManufacturer = coalesce(tostring(threat.device.manufacturer), tostring(device.manufacturer)),\n        DeviceModel = coalesce(tostring(threat.device.model), tostring(device.model)),\n        DeviceSecurityStatus = coalesce(tostring(threat.device.security_status), tostring(device.security_status)),\n        DeviceActivationStatus = coalesce(tostring(threat.device.activation_status), tostring(device.activation_status)),\n        DeviceSeverity = tostring(threat.device.severity),\n        DeviceStatus = tostring(threat.device.status),\n        DeviceType = tostring(threat.device.type),\n        \n        // Threat Details (from nested threat.details object)\n        ThreatNetworkSSID = tostring(threat.details.network_ssid),\n        ThreatDNSIpAddresses = tostring(threat.details.dns_ip_addresses),\n        ThreatMacAddress = tostring(threat.details.mac_address),\n        ThreatProxyPort = tostring(threat.details.proxy_port),\n        \n        // Actor Information (from nested actor object)\n        ActorType = tostring(actor.type),\n        ActorGuid = tostring(actor.guid),\n        ActorDeviceGuid = tostring(actor.device_guid),\n        \n        // Target Information (from nested target object)\n        TargetType = tostring(target.type),\n        TargetGuid = tostring(target.guid),\n        TargetEmailAddress = tostring(target.email_address),\n        TargetPlatform = tostring(target.platform),\n        TargetOSVersion = tostring(target.os_version),\n        TargetManufacturer = tostring(target.manufacturer),\n        TargetModel = tostring(target.model),\n        \n        // Audit Information (from nested audit object)\n        AuditType = tostring(audit.type),\n        AuditAttributeChanges = tostring(audit.attribute_changes),\n        \n        // Smishing Alert Information (from nested smishing_alert object)\n        SmishingAlertId = tostring(smishing_alert.id),\n        SmishingAlertType = tostring(smishing_alert.type),\n        SmishingAlertSeverity = tostring(smishing_alert.severity),\n        SmishingAlertDescription = tostring(smishing_alert.description),\n        SmishingAlertCategory = tostring(smishing_alert.category),\n        SmishingAlertURL = tostring(smishing_alert.url),\n        SmishingDetections = tostring(smishing_alert.detections),\n        \n        // Legacy field mappings for backward compatibility\n        Type = coalesce(log_type, event_type),\n        ID = id,\n        EnterpriseName = enterprise_guid,\n        DetailsSeverity = tostring(threat.severity),\n        DetailsClassifications = tostring(threat.classifications),\n        DetailsActivationStatus = tostring(threat.device.activation_status),\n        DetailsSecurityStatus = tostring(threat.device.security_status),\n        DetailsDescription = tostring(threat.description),\n        DetailsApplicationName = tostring(threat.application_name),\n        DetailsPackageName = tostring(threat.package_name),\n        DetailsFileName = tostring(threat.file_name),\n        DetailsPath = tostring(threat.file_path),\n        DetailsPackageSha = tostring(threat.package_sha),\n        DetailsType = tostring(threat.type),\n        DetailsId = tostring(threat.guid),\n        DetailsAction = tostring(threat.action),\n        DetailsAssessments = tostring(threat.assessments),\n        DetailsPcpReportingReason = tostring(threat.pcp_reporting_reason),\n        DetailsPcpDeviceResponse = tostring(threat.pcp_device_response),\n        ActorId = tostring(actor.guid)\n        \n    // Event Type Classification for Priority Processing\n    | extend EventPriority = case(\n        coalesce(log_type, event_type) == \"THREAT\", 1,\n        coalesce(log_type, event_type) == \"DEVICE\", 2,\n        coalesce(log_type, event_type) == \"SMISHING_ALERT\", 3,\n        coalesce(log_type, event_type) == \"AUDIT\", 4,\n        5\n    )\n    \n    // Security Risk Classification\n    | extend SecurityRiskLevel = case(\n        tostring(threat.severity) in (\"CRITICAL\", \"HIGH\") or tostring(threat.device.security_status) == \"THREATS_HIGH\", \"High\",\n        tostring(threat.severity) == \"MEDIUM\" or tostring(threat.device.security_status) == \"THREATS_MEDIUM\", \"Medium\",\n        tostring(threat.severity) == \"LOW\" or tostring(threat.device.security_status) == \"THREATS_LOW\", \"Low\",\n        \"Unknown\"\n    )\n    \n    // Device Compliance Status\n    | extend DeviceComplianceStatus = case(\n        device_activation_status == \"ACTIVE\" and isnotempty(device_checkin_time), \"Compliant\",\n        device_activation_status == \"INACTIVE\", \"Non-Compliant\",\n        isempty(device_checkin_time), \"Unknown\",\n        \"Partial\"\n    )\n    \n    | project\n        // Core Event Information\n        TimeGenerated,\n        EventVendor,\n        EventProduct,\n        EventType,\n        EventId,\n        EventTime,\n        EventStartTime,\n        EventEndTime,\n        ChangeType,\n        EventPriority,\n        SecurityRiskLevel,\n        EnterpriseGuid = enterprise_guid,\n        \n        // Device Information\n        DeviceGuid,\n        DeviceActivatedAt = device_activated_at,\n        DeviceActivationStatus,\n        DeviceCheckinTime = device_checkin_time,\n        DeviceCustomerId = device_customer_id,\n        DeviceDeactivatedAt = device_deactivated_at,\n        DeviceGroupGuid = device_group_guid,\n        DevicePlatform,\n        DeviceOSVersion,\n        DeviceManufacturer,\n        DeviceModel,\n        DeviceEmailAddress,\n        DeviceSecurityStatus,\n        DeviceComplianceStatus,\n        \n        // Client Application Information\n        ClientLookoutSDKVersion = client_lookout_sdk_version,\n        ClientOTAVersion = client_ota_version,\n        ClientPackageName = client_package_name,\n        ClientPackageVersion = client_package_version,\n        \n        // MDM Integration\n        MDMConnectorId = mdm_connector_id,\n        MDMConnectorUuid = mdm_connector_uuid,\n        MDMExternalId = mdm_external_id,\n        \n        // Threat Information\n        ThreatId,\n        ThreatType,\n        ThreatAction,\n        ThreatSeverity,\n        ThreatClassification,\n        ThreatClassifications,\n        ThreatRisk,\n        ThreatStatus,\n        ThreatAssessments,\n        ThreatDescription,\n        ThreatApplicationName,\n        ThreatPackageName,\n        ThreatPackageSha,\n        ThreatFileName,\n        ThreatFilePath,\n        ThreatPcpReportingReason,\n        ThreatPcpDeviceResponse,\n        \n        // Actor Information\n        ActorType,\n        ActorGuid,\n        ActorDeviceGuid,\n        \n        // Target Information\n        TargetType,\n        TargetGuid,\n        \n        // Audit Information\n        AuditType,\n        AuditAttributeChanges,\n        \n        // Smishing Alert Information\n        SmishingAlertId,\n        SmishingAlertType,\n        SmishingAlertSeverity,\n        SmishingAlertDescription,\n        \n        // Dynamic Objects (preserved for advanced analysis)\n        device,\n        threat,\n        audit,\n        smishing_alert,\n        target,\n        actor,\n        device_permissions,\n        device_settings,\n        device_vulns,\n        risky_config,\n        audit_attribute_changes,\n        smishing_detections,\n        \n        // Legacy field mappings for backward compatibility\n        Type,\n        ID,\n        EnterpriseName,\n        DetailsSeverity,\n        DetailsClassifications,\n        DetailsActivationStatus,\n        DetailsSecurityStatus,\n        DetailsDescription,\n        DetailsApplicationName,\n        DetailsPackageName,\n        DetailsFileName,\n        DetailsPath,\n        DetailsPackageSha,\n        DetailsType,\n        DetailsId,\n        DetailsAction,\n        DetailsAssessments,\n        DetailsPcpReportingReason,\n        DetailsPcpDeviceResponse,\n        ActorId\n};\nLookoutEvents_view\n",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": ""
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Lookout Data Parser')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "Lookout",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Lookout Data Parser",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '3.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '3.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Lookout Data Parser",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "LookoutEvents",
        "query": "let LookoutEvents_view = view () { \n    LookoutMtdV2_CL\n    | extend \n        // Core Event Fields\n        EventVendor = \"Lookout\",\n        EventProduct = \"Lookout Mobile Risk API v2\",\n        EventType = coalesce(log_type, event_type),  // Support both v1 and v2 API field names\n        EventId = id,\n        EventTime = TimeGenerated,\n        EventStartTime = TimeGenerated,\n        EventEndTime = TimeGenerated,\n        ChangeType = change_type,\n        \n        // Threat Information (from nested threat object)\n        ThreatId = tostring(threat.guid),\n        ThreatType = tostring(threat.type),\n        ThreatAction = tostring(threat.action),\n        ThreatSeverity = tostring(threat.severity),\n        ThreatClassification = tostring(threat.classification),\n        ThreatClassifications = tostring(threat.classifications),\n        ThreatRisk = tostring(threat.risk),\n        ThreatStatus = tostring(threat.status),\n        ThreatAssessments = tostring(threat.assessments),\n        ThreatDescription = tostring(threat.description),\n        ThreatApplicationName = tostring(threat.application_name),\n        ThreatPackageName = tostring(threat.package_name),\n        ThreatPackageSha = tostring(threat.package_sha),\n        ThreatFileName = tostring(threat.file_name),\n        ThreatFilePath = tostring(threat.file_path),\n        ThreatDetectedAt = todatetime(threat.detected_at),\n        ThreatPcpReportingReason = tostring(threat.pcp_reporting_reason),\n        ThreatPcpDeviceResponse = tostring(threat.pcp_device_response),\n        \n        // Device Information (from nested threat.device object)\n        DeviceGuid = coalesce(tostring(threat.device.guid), tostring(device.guid)),\n        DeviceEmailAddress = coalesce(tostring(threat.device.email), tostring(device.email)),\n        DevicePlatform = coalesce(tostring(threat.device.platform), tostring(device.platform)),\n        DeviceOSVersion = coalesce(tostring(threat.device.os_version), tostring(device.os_version)),\n        DeviceManufacturer = coalesce(tostring(threat.device.manufacturer), tostring(device.manufacturer)),\n        DeviceModel = coalesce(tostring(threat.device.model), tostring(device.model)),\n        DeviceSecurityStatus = coalesce(tostring(threat.device.security_status), tostring(device.security_status)),\n        DeviceActivationStatus = coalesce(tostring(threat.device.activation_status), tostring(device.activation_status)),\n        DeviceSeverity = tostring(threat.device.severity),\n        DeviceStatus = tostring(threat.device.status),\n        DeviceType = tostring(threat.device.type),\n        \n        // Threat Details (from nested threat.details object)\n        ThreatNetworkSSID = tostring(threat.details.network_ssid),\n        ThreatDNSIpAddresses = tostring(threat.details.dns_ip_addresses),\n        ThreatMacAddress = tostring(threat.details.mac_address),\n        ThreatProxyPort = tostring(threat.details.proxy_port),\n        \n        // Actor Information (from nested actor object)\n        ActorType = tostring(actor.type),\n        ActorGuid = tostring(actor.guid),\n        ActorDeviceGuid = tostring(actor.device_guid),\n        \n        // Target Information (from nested target object)\n        TargetType = tostring(target.type),\n        TargetGuid = tostring(target.guid),\n        TargetEmailAddress = tostring(target.email_address),\n        TargetPlatform = tostring(target.platform),\n        TargetOSVersion = tostring(target.os_version),\n        TargetManufacturer = tostring(target.manufacturer),\n        TargetModel = tostring(target.model),\n        \n        // Audit Information (from nested audit object)\n        AuditType = tostring(audit.type),\n        AuditAttributeChanges = tostring(audit.attribute_changes),\n        \n        // Smishing Alert Information (from nested smishing_alert object)\n        SmishingAlertId = tostring(smishing_alert.id),\n        SmishingAlertType = tostring(smishing_alert.type),\n        SmishingAlertSeverity = tostring(smishing_alert.severity),\n        SmishingAlertDescription = tostring(smishing_alert.description),\n        SmishingAlertCategory = tostring(smishing_alert.category),\n        SmishingAlertURL = tostring(smishing_alert.url),\n        SmishingDetections = tostring(smishing_alert.detections),\n        \n        // Legacy field mappings for backward compatibility\n        Type = coalesce(log_type, event_type),\n        ID = id,\n        EnterpriseName = enterprise_guid,\n        DetailsSeverity = tostring(threat.severity),\n        DetailsClassifications = tostring(threat.classifications),\n        DetailsActivationStatus = tostring(threat.device.activation_status),\n        DetailsSecurityStatus = tostring(threat.device.security_status),\n        DetailsDescription = tostring(threat.description),\n        DetailsApplicationName = tostring(threat.application_name),\n        DetailsPackageName = tostring(threat.package_name),\n        DetailsFileName = tostring(threat.file_name),\n        DetailsPath = tostring(threat.file_path),\n        DetailsPackageSha = tostring(threat.package_sha),\n        DetailsType = tostring(threat.type),\n        DetailsId = tostring(threat.guid),\n        DetailsAction = tostring(threat.action),\n        DetailsAssessments = tostring(threat.assessments),\n        DetailsPcpReportingReason = tostring(threat.pcp_reporting_reason),\n        DetailsPcpDeviceResponse = tostring(threat.pcp_device_response),\n        ActorId = tostring(actor.guid)\n        \n    // Event Type Classification for Priority Processing\n    | extend EventPriority = case(\n        coalesce(log_type, event_type) == \"THREAT\", 1,\n        coalesce(log_type, event_type) == \"DEVICE\", 2,\n        coalesce(log_type, event_type) == \"SMISHING_ALERT\", 3,\n        coalesce(log_type, event_type) == \"AUDIT\", 4,\n        5\n    )\n    \n    // Security Risk Classification\n    | extend SecurityRiskLevel = case(\n        tostring(threat.severity) in (\"CRITICAL\", \"HIGH\") or tostring(threat.device.security_status) == \"THREATS_HIGH\", \"High\",\n        tostring(threat.severity) == \"MEDIUM\" or tostring(threat.device.security_status) == \"THREATS_MEDIUM\", \"Medium\",\n        tostring(threat.severity) == \"LOW\" or tostring(threat.device.security_status) == \"THREATS_LOW\", \"Low\",\n        \"Unknown\"\n    )\n    \n    // Device Compliance Status\n    | extend DeviceComplianceStatus = case(\n        device_activation_status == \"ACTIVE\" and isnotempty(device_checkin_time), \"Compliant\",\n        device_activation_status == \"INACTIVE\", \"Non-Compliant\",\n        isempty(device_checkin_time), \"Unknown\",\n        \"Partial\"\n    )\n    \n    | project\n        // Core Event Information\n        TimeGenerated,\n        EventVendor,\n        EventProduct,\n        EventType,\n        EventId,\n        EventTime,\n        EventStartTime,\n        EventEndTime,\n        ChangeType,\n        EventPriority,\n        SecurityRiskLevel,\n        EnterpriseGuid = enterprise_guid,\n        \n        // Device Information\n        DeviceGuid,\n        DeviceActivatedAt = device_activated_at,\n        DeviceActivationStatus,\n        DeviceCheckinTime = device_checkin_time,\n        DeviceCustomerId = device_customer_id,\n        DeviceDeactivatedAt = device_deactivated_at,\n        DeviceGroupGuid = device_group_guid,\n        DevicePlatform,\n        DeviceOSVersion,\n        DeviceManufacturer,\n        DeviceModel,\n        DeviceEmailAddress,\n        DeviceSecurityStatus,\n        DeviceComplianceStatus,\n        \n        // Client Application Information\n        ClientLookoutSDKVersion = client_lookout_sdk_version,\n        ClientOTAVersion = client_ota_version,\n        ClientPackageName = client_package_name,\n        ClientPackageVersion = client_package_version,\n        \n        // MDM Integration\n        MDMConnectorId = mdm_connector_id,\n        MDMConnectorUuid = mdm_connector_uuid,\n        MDMExternalId = mdm_external_id,\n        \n        // Threat Information\n        ThreatId,\n        ThreatType,\n        ThreatAction,\n        ThreatSeverity,\n        ThreatClassification,\n        ThreatClassifications,\n        ThreatRisk,\n        ThreatStatus,\n        ThreatAssessments,\n        ThreatDescription,\n        ThreatApplicationName,\n        ThreatPackageName,\n        ThreatPackageSha,\n        ThreatFileName,\n        ThreatFilePath,\n        ThreatPcpReportingReason,\n        ThreatPcpDeviceResponse,\n        \n        // Actor Information\n        ActorType,\n        ActorGuid,\n        ActorDeviceGuid,\n        \n        // Target Information\n        TargetType,\n        TargetGuid,\n        \n        // Audit Information\n        AuditType,\n        AuditAttributeChanges,\n        \n        // Smishing Alert Information\n        SmishingAlertId,\n        SmishingAlertType,\n        SmishingAlertSeverity,\n        SmishingAlertDescription,\n        \n        // Dynamic Objects (preserved for advanced analysis)\n        device,\n        threat,\n        audit,\n        smishing_alert,\n        target,\n        actor,\n        device_permissions,\n        device_settings,\n        device_vulns,\n        risky_config,\n        audit_attribute_changes,\n        smishing_detections,\n        \n        // Legacy field mappings for backward compatibility\n        Type,\n        ID,\n        EnterpriseName,\n        DetailsSeverity,\n        DetailsClassifications,\n        DetailsActivationStatus,\n        DetailsSecurityStatus,\n        DetailsDescription,\n        DetailsApplicationName,\n        DetailsPackageName,\n        DetailsFileName,\n        DetailsPath,\n        DetailsPackageSha,\n        DetailsType,\n        DetailsId,\n        DetailsAction,\n        DetailsAssessments,\n        DetailsPcpReportingReason,\n        DetailsPcpDeviceResponse,\n        ActorId\n};\nLookoutEvents_view\n",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": ""
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'Lookout Data Parser')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "Lookout",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Lookout"
        },
        "support": {
          "name": "Lookout",
          "tier": "Partner",
          "link": "https://www.lookout.com/support"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('huntingQueryObject1').huntingQueryTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "LookoutAdvancedThreatHunting_HuntingQueries Hunting Query with template version 3.0.1",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('huntingQueryObject1').huntingQueryVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.OperationalInsights/savedSearches",
              "apiVersion": "2022-10-01",
              "name": "Lookout_Hunting_Query_1",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Lookout Advanced Threat Hunting - Multi-Vector Attacks",
                "category": "Hunting Queries",
                "query": "let timeWindow = 24h;\nlet threatEvents = LookoutEvents\n| where TimeGenerated > ago(timeWindow)\n| where EventType == \"THREAT\"\n| where ThreatSeverity in (\"CRITICAL\", \"HIGH\")\n| summarize \n    ThreatTypes = make_set(ThreatType),\n    ThreatCount = count(),\n    FirstThreat = min(TimeGenerated),\n    LastThreat = max(TimeGenerated),\n    ThreatClassifications = make_set(ThreatClassifications)\n    by DeviceGuid, DeviceEmailAddress;\nlet smishingEvents = LookoutEvents\n| where TimeGenerated > ago(timeWindow)\n| where EventType == \"SMISHING_ALERT\"\n| where SmishingAlertSeverity in (\"CRITICAL\", \"HIGH\")\n| summarize \n    SmishingTypes = make_set(SmishingAlertType),\n    SmishingCount = count(),\n    FirstSmishing = min(TimeGenerated)\n    by DeviceGuid;\nthreatEvents\n| join kind=inner (smishingEvents) on DeviceGuid\n| where ThreatCount >= 2 or SmishingCount >= 1\n| extend AttackDuration = LastThreat - FirstThreat\n| extend MultiVectorRisk = case(\n    ThreatCount >= 3 and SmishingCount >= 1, \"Critical\",\n    ThreatCount >= 2 and SmishingCount >= 1, \"High\", \n    ThreatCount >= 3, \"High\",\n    \"Medium\"\n)\n| project DeviceGuid, DeviceEmailAddress, ThreatTypes, SmishingTypes, \n          ThreatCount, SmishingCount, AttackDuration, MultiVectorRisk,\n          FirstThreat, LastThreat, ThreatClassifications\n| order by MultiVectorRisk desc, ThreatCount desc\n",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "Identifies devices experiencing multiple threat types within a short timeframe, indicating coordinated attacks"
                  },
                  {
                    "name": "tactics",
                    "value": "Discovery,Persistence,DefenseEvasion"
                  },
                  {
                    "name": "techniques",
                    "value": "T1057,T1418,T1566"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1),'/'))))]",
              "properties": {
                "description": "Lookout Hunting Query 1",
                "parentId": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('huntingQueryObject1')._huntingQuerycontentId1)]",
                "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
                "kind": "HuntingQuery",
                "version": "[variables('huntingQueryObject1').huntingQueryVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "Lookout",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Lookout"
                },
                "support": {
                  "name": "Lookout",
                  "tier": "Partner",
                  "link": "https://www.lookout.com/support"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
        "contentKind": "HuntingQuery",
        "displayName": "Lookout Advanced Threat Hunting - Multi-Vector Attacks",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','hq','-', uniqueString(concat(variables('_solutionId'),'-','HuntingQuery','-',variables('huntingQueryObject1')._huntingQuerycontentId1,'-', '1.0.0')))]",
        "version": "1.0.0"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.1",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Lookout",
        "publisherDisplayName": "Lookout",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Lookout/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://lookout.com\">Lookout</a> solution provides the capability to ingest <a href=\"https://enterprise.support.lookout.com/hc/articles/115002741773-Mobile-Risk-API-Guide#commoneventfields\">Lookout events</a> into Microsoft Sentinel through the Mobile Risk API. It can get events which helps to examine potential security risks and more. Refer to <a href=\"https://enterprise.support.lookout.com/hc/articles/115002741773-Mobile-Risk-API-Guide\">API documentation</a> for more information .</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ol type=\"a\">\n<li><p><a href=\"https://docs.microsoft.com/azure/azure-monitor/logs/data-collector-api\">Azure Monitor HTTP Data Collector API</a></p>\n</li>\n<li><p><a href=\"https://aka.ms/Sentinel-CCP_Platform\">Microsoft Sentinel Codeless Connector Platform</a></p>\n</li>\n</ol>\n<p><span style='color:red; font-weight:bold;'>NOTE</span>: Microsoft recommends installation of \"LookoutStreaming_Definition\" (via Codeless Connector Framework). This connector is build on the Codeless Connector Framework (CCF), which uses the Log Ingestion API, which replaces ingestion via the <a href='https://aka.ms/Sentinel-Logs_migration' style='color:#1890F1;'>deprecated HTTP Data Collector API</a>. CCF-based data connectors also support <a href='https://aka.ms/Sentinel-DCR_Overview' style='color:#1890F1;'>Data Collection Rules</a> (DCRs) offering transformations and enrichment.</p>\n<p><span style='color:red; font-weight:bold;'>Important</span>: While the updated connector(s) can coexist with their legacy versions, running them together will result in duplicated data ingestion. You can disable the older versions of these connectors to avoid duplication of data..</p>\n<p><strong>Data Connectors:</strong> 2, <strong>Parsers:</strong> 1, <strong>Workbooks:</strong> 5, <strong>Analytic Rules:</strong> 5, <strong>Hunting Queries:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Lookout/Workbooks/Images/Logo/lookout.svg\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Lookout",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Lookout"
        },
        "support": {
          "name": "Lookout",
          "tier": "Partner",
          "link": "https://www.lookout.com/support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections2')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId2')]",
              "version": "[variables('workbookVersion2')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId3')]",
              "version": "[variables('workbookVersion3')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId4')]",
              "version": "[variables('workbookVersion4')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId5')]",
              "version": "[variables('workbookVersion5')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "HuntingQuery",
              "contentId": "[variables('huntingQueryObject1')._huntingQuerycontentId1]",
              "version": "[variables('huntingQueryObject1').huntingQueryVersion1]"
            }
          ]
        },
        "firstPublishDate": "2021-10-18",
        "lastPublishDate": "2025-11-07",
        "providers": [
          "Lookout"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
