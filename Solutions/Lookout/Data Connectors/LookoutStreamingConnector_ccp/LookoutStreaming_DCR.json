[
    {
        "name": "LookoutMtdDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-LookoutMtdV2_CL": {
                    "columns": [
                        {
                            "name": "id",
                            "type": "string"
                        },
                        {
                            "name": "enterprise_guid",
                            "type": "string"
                        },
                        {
                            "name": "created_time",
                            "type": "datetime"
                        },
                        {
                            "name": "type",
                            "type": "string"
                        },
                        {
                            "name": "change_type",
                            "type": "string"
                        },
                        {
                            "name": "device",
                            "type": "dynamic"
                        },
                        {
                            "name": "threat",
                            "type": "dynamic"
                        },
                        {
                            "name": "audit",
                            "type": "dynamic"
                        },
                        {
                            "name": "smishing_alert",
                            "type": "dynamic"
                        },
                        {
                            "name": "target",
                            "type": "dynamic"
                        },
                        {
                            "name": "actor",
                            "type": "dynamic"
                        },
                        {
                            "name": "TimeGenerated",
                            "type": "datetime"
                        },
                        {
                            "name": "log_type",
                            "type": "string"
                        },
                        {
                            "name": "actor_device_guid",
                            "type": "string"
                        },
                        {
                            "name": "event_type",
                            "type": "string"
                        },
                        {
                            "name": "device_guid",
                            "type": "string"
                        },
                        {
                            "name": "device_activated_at",
                            "type": "datetime"
                        },
                        {
                            "name": "device_activation_status",
                            "type": "string"
                        },
                        {
                            "name": "device_checkin_time",
                            "type": "datetime"
                        },
                        {
                            "name": "device_customer_id",
                            "type": "string"
                        },
                        {
                            "name": "device_deactivated_at",
                            "type": "datetime"
                        },
                        {
                            "name": "device_group_guid",
                            "type": "string"
                        },
                        {
                            "name": "device_platform",
                            "type": "string"
                        },
                        {
                            "name": "device_os_version",
                            "type": "string"
                        },
                        {
                            "name": "device_manufacturer",
                            "type": "string"
                        },
                        {
                            "name": "device_model",
                            "type": "string"
                        },
                        {
                            "name": "device_email_address",
                            "type": "string"
                        },
                        {
                            "name": "device_security_status",
                            "type": "string"
                        },
                        {
                            "name": "client_lookout_sdk_version",
                            "type": "string"
                        },
                        {
                            "name": "client_ota_version",
                            "type": "string"
                        },
                        {
                            "name": "client_package_name",
                            "type": "string"
                        },
                        {
                            "name": "client_package_version",
                            "type": "string"
                        },
                        {
                            "name": "mdm_connector_id",
                            "type": "int"
                        },
                        {
                            "name": "mdm_connector_uuid",
                            "type": "string"
                        },
                        {
                            "name": "mdm_external_id",
                            "type": "string"
                        },
                        {
                            "name": "threat_id",
                            "type": "string"
                        },
                        {
                            "name": "threat_type",
                            "type": "string"
                        },
                        {
                            "name": "threat_action",
                            "type": "string"
                        },
                        {
                            "name": "threat_severity",
                            "type": "string"
                        },
                        {
                            "name": "threat_classification",
                            "type": "string"
                        },
                        {
                            "name": "threat_classifications",
                            "type": "string"
                        },
                        {
                            "name": "threat_risk",
                            "type": "string"
                        },
                        {
                            "name": "threat_status",
                            "type": "string"
                        },
                        {
                            "name": "threat_assessments",
                            "type": "string"
                        },
                        {
                            "name": "threat_description",
                            "type": "string"
                        },
                        {
                            "name": "threat_application_name",
                            "type": "string"
                        },
                        {
                            "name": "threat_package_name",
                            "type": "string"
                        },
                        {
                            "name": "threat_package_sha",
                            "type": "string"
                        },
                        {
                            "name": "threat_file_name",
                            "type": "string"
                        },
                        {
                            "name": "threat_file_path",
                            "type": "string"
                        },
                        {
                            "name": "threat_pcp_reporting_reason",
                            "type": "string"
                        },
                        {
                            "name": "threat_pcp_device_response",
                            "type": "string"
                        },
                        {
                            "name": "audit_type",
                            "type": "string"
                        },
                        {
                            "name": "actor_type",
                            "type": "string"
                        },
                        {
                            "name": "actor_guid",
                            "type": "string"
                        },
                        {
                            "name": "target_type",
                            "type": "string"
                        },
                        {
                            "name": "target_guid",
                            "type": "string"
                        },
                        {
                            "name": "target_email_address",
                            "type": "string"
                        },
                        {
                            "name": "target_platform",
                            "type": "string"
                        },
                        {
                            "name": "target_os_version",
                            "type": "string"
                        },
                        {
                            "name": "target_manufacturer",
                            "type": "string"
                        },
                        {
                            "name": "target_model",
                            "type": "string"
                        },
                        {
                            "name": "smishing_alert_id",
                            "type": "string"
                        },
                        {
                            "name": "smishing_alert_type",
                            "type": "string"
                        },
                        {
                            "name": "smishing_alert_severity",
                            "type": "string"
                        },
                        {
                            "name": "smishing_alert_description",
                            "type": "string"
                        },
                        {
                            "name": "device_permissions",
                            "type": "dynamic"
                        },
                        {
                            "name": "device_settings",
                            "type": "dynamic"
                        },
                        {
                            "name": "device_vulns",
                            "type": "dynamic"
                        },
                        {
                            "name": "risky_config",
                            "type": "dynamic"
                        },
                        {
                            "name": "audit_attribute_changes",
                            "type": "dynamic"
                        },
                        {
                            "name": "smishing_detections",
                            "type": "dynamic"
                        }
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-LookoutMtdV2_CL"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = todatetime(created_time), event_type = tostring(type), log_type = tostring(type), actor_device_guid = tostring(actor.guid), device_guid = tostring(device.guid), device_activated_at = todatetime(device.activated_at), device_activation_status = tostring(device.activation_status), device_checkin_time = todatetime(device.checkin_time), device_customer_id = tostring(device.customer_device_id), device_deactivated_at = todatetime(device.deactivated_at), device_group_guid = tostring(device.device_group_guid), device_platform = tostring(device.platform), device_os_version = tostring(device.os_version), device_manufacturer = tostring(device.manufacturer), device_model = tostring(device.model), device_email_address = tostring(device.email_address), device_security_status = tostring(device.security_status), client_lookout_sdk_version = tostring(device.client.lookout_sdk_version), client_ota_version = tostring(device.client.ota_version), client_package_name = tostring(device.client.package_name), client_package_version = tostring(device.client.package_version), mdm_connector_id = toint(device.details.mdm_connector_id), mdm_connector_uuid = tostring(device.details.mdm_connector_uuid), mdm_external_id = tostring(device.details.external_id), threat_id = tostring(threat.id), threat_type = tostring(threat.type), threat_action = tostring(threat.action), threat_severity = tostring(threat.severity), threat_classification = tostring(threat.classification), threat_classifications = tostring(threat.classifications), threat_risk = tostring(threat.risk), threat_status = tostring(threat.status), threat_assessments = tostring(threat.assessments), threat_description = tostring(threat.description), threat_application_name = tostring(threat.application_name), threat_package_name = tostring(threat.package_name), threat_package_sha = tostring(threat.package_sha), threat_file_name = tostring(threat.file_name), threat_file_path = tostring(threat.path), threat_pcp_reporting_reason = tostring(threat.pcp_reporting_reason), threat_pcp_device_response = tostring(threat.pcp_device_response), audit_type = tostring(audit.type), actor_type = tostring(actor.type), actor_guid = tostring(actor.guid), target_type = tostring(target.type), target_guid = tostring(target.guid), target_email_address = tostring(target.email_address), target_platform = tostring(target.platform), target_os_version = tostring(target.os_version), target_manufacturer = tostring(target.manufacturer), target_model = tostring(target.model), smishing_alert_id = tostring(smishing_alert.id), smishing_alert_type = tostring(smishing_alert.type), smishing_alert_severity = tostring(smishing_alert.severity), smishing_alert_description = tostring(smishing_alert.description), device_permissions = device.device_permissions, device_settings = device.device_settings, device_vulns = device.device_vulns, risky_config = device.risky_config, audit_attribute_changes = audit.attribute_changes, smishing_detections = detections",
                    "outputStream": "Custom-LookoutMtdV2_CL"
                }
            ]
        }
    }
]