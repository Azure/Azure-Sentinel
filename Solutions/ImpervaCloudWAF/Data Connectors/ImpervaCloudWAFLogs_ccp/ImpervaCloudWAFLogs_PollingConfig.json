[
    {
        "type": "Microsoft.SecurityInsights/dataConnectors",
        "apiVersion": "2025-03-01",
        "name": "{{innerWorkspace}}//Microsoft.SecurityInsights/ImpervaCloudWAFLogsCCP{{apiId}}",
        "kind": "RestApiPoller",
        "properties": {
            "connectorDefinitionName": "ImpervaCloudWAFLogsCCPDefinition",
            "dataType": "ImpervaCloudWAFV2_CL",
            "addOnAttributes": {
                "ApiId": "[[parameters('apiId')]"
            },
            "auth": {
                "type": "Basic",
                "UserName": "[[parameters('apiId')]",
                "Password": "[[parameters('apikey')]"
            },
            "request": {
                "apiEndpoint": "{{logServer}}logs.index",
                "httpMethod": "GET",
                "queryWindowInMin": 10,
                "timeoutInSeconds": 60,
                "headers": {
                    "User-Agent": "Scuba"
                }
            },
            "response": {
                "eventsJsonPaths": [
                    "$"
                ],
                "format": "csv",
                "HasCsvHeader": false,
                "CsvDelimiter": "|"
            },
            "stepInfo": {
                "stepType": "Nested",
                "nextSteps": [
                    {
                        "stepId": "LogFile",
                        "stepPlaceholdersParsingKql": "source | project fileName = tostring(Field1)"
                    }
                ]
            },
            "stepCollectorConfigs": {
                "LogFile": {
                    "request": {
                        "httpMethod": "GET",
                        "apiEndpoint": "{{logServer}}$fileName$",
                        "logResponseContent": true,
                        "headers": {
                            "User-Agent": "Scuba"
                        }
                    },
                    "response": {
                        "format": "csv",
                        "eventsJsonPaths": [
                            "$"
                        ],
                        "HasCsvHeader": false,
                        "CsvDelimiter": "|"
                    }
                }
            },
            "dcrConfig": {
                "streamName": "Custom-ImpervaCloudWAF",
                "dataCollectionEndpoint": "{{dataCollectionEndpoint}}",
                "dataCollectionRuleImmutableId": "{{dataCollectionRuleImmutableId}}"
            },
            "paging": {
                "pagingType": "LinkHeader"
            },
            "isActive": true
        }
    }
]