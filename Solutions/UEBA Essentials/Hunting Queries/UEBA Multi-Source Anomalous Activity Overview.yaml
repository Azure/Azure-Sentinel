id: b2c3d4e5-f6g7-8901-bcde-fg2345678901
name: UEBA Multi-Source Anomalous Activity Overview
description: |
  'Retrieves and displays anomalous activity detected across multiple identity and cloud sources (AWS CloudTrail, Okta, GCP Audit Logs, and general authentication events) using UEBA anomaly templates. The query provides key details such as timestamp, workspace, anomaly type, score, description, and associated insights (user, device, activity) along with MITRE ATT&CK tactics and techniques for deeper investigation.'
requiredDataConnectors:
  - connectorId: BehaviorAnalytics
    dataTypes:
      - Anomalies
tactics:
  - InitialAccess
  - CredentialAccess
  - Persistence
  - PrivilegeEscalation
relevantTechniques:
  - T1078
  - T1110
  - T1556
  - T1548
query: |
  Anomalies
  | where AnomalyTemplateName in (  
      "UEBA Anomalous Logon in AwsCloudTrail", // AWS ClousTrail anomalies 
      "UEBA Anomalous MFA Failures in Okta_CL", "UEBA Anomalous Activity in Okta_CL", // Okta Anomalies 
      "UEBA Anomalous Activity in GCP Audit Logs", // GCP Failed IAM access anomalies 
      "UEBA Anomalous Authentication" // For Authentication related anomalies 
  ) 
  | project TimeGenerated, WorkspaceId, AnomalyTemplateName, Score, Description, AnomalyDetails, ActivityInsights, DeviceInsights, UserInsights, Tactics, Techniques
  | extend Account_0_Name = tostring(UserInsights.UserPrincipalName)
  | extend IP_0_Address = tostring(ActivityInsights.SourceIPAddress)
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: Account_0_Name
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: IP_0_Address
version: 2.0.0