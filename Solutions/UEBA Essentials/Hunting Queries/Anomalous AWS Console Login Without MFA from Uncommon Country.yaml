id: a1b2c3d4-e5f6-7890-abcd-ef1234567890
name: Anomalous AWS Console Login Without MFA from Uncommon Country
description: |
  'Detect unusual logon times, MFA fatigue, or service principal misuse across hybrid environments. Get visibility into geo-location of events and Threat Intelligence insights. Here''s an example of how you can easily discover Accounts authenticating without MFA and from uncommonly connected countries using UEBA behaviorAnalytics table:'
requiredDataConnectors:
  - connectorId: BehaviorAnalytics
    dataTypes:
      - BehaviorAnalytics
tactics:
  - InitialAccess
  - CredentialAccess
relevantTechniques:
  - T1078
  - T1110
query: |
  BehaviorAnalytics
  | where TimeGenerated > ago(7d)
  | where EventSource contains "aws"
  | where ActionType == "ConsoleLogin" and ActivityType == "signin.amazonaws.com"
  | where ActivityInsights.IsMfaUsed == "No"
  | where ActivityInsights.CountryUncommonlyConnectedFromInTenant == True
  | where InvestigationPriority > 0
  | project TimeGenerated, EventSource, ActionType, ActivityType, InvestigationPriority, 
            SourceIPAddress, SourceIPLocation, UsersInsights, ActivityInsights
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AWS_UserIdentityArn
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIPAddress
version: 2.0.0