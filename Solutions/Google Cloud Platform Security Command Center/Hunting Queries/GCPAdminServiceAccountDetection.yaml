id: f26cff6f-1a57-4462-a956-162639d14c3f
name: Identify GCP Service Account with Overly Permissive Roles
description: |
  This query identifies Google Cloud Platform (GCP) service accounts with admin privileges using findings from the Security Command Center.
description-detailed: |
  This query helps identify service accounts in GCP that have been assigned admin, owner, or editor roles. Service accounts with elevated privileges can pose a security risk if misused or compromised. Regular monitoring of such accounts is essential to maintain a secure environment.
requiredDataConnectors:
  - connectorId: GoogleSCCDefinition
    dataTypes:
      - GoogleCloudSCC
tactics:
  - PrivilegeEscalation
  - Persistence
relevantTechniques:
  - T1078.004
  - T1098
  - T1136.003
tags:
  - CIS GCP Foundations Benchmark v3.0
  - NIST 800-53 R5 AC-6
  - Cloud Controls Matrix 4 IAM-09
  - ISO-27001 v2022 A.5.15, A.8.2
  - CIS Controls 8.0 5.4
query: |
  GoogleCloudSCC
  | where tostring(Findings.state) == "ACTIVE"
  | extend FindingCategory = tostring(Findings.category)
  | where FindingCategory == "ADMIN_SERVICE_ACCOUNT"
  | extend OffendingRoles = todynamic(Findings.iamBindings)
  | mv-expand OffendingRoles
  | extend ServiceAccount = tostring(split(OffendingRoles.member, "serviceAccount:")[1]), Role = tostring(split(OffendingRoles.role, "roles/")[1])
  | extend
    Severity = tostring(Findings.severity),
    ResourceType = tostring(FindingsResource.type),
    ResourceName = tostring(FindingsResource.displayName),
    CloudResource = coalesce(tostring(FindingsResource.name), tostring(FindingsResource.displayName))
  | summarize TimeGenerated = max(TimeGenerated) by ServiceAccount, Role, Severity, ResourceType, ResourceName, CloudResource
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: ServiceAccount
  - entityType: CloudApplication
    fieldMappings:
      - identifier: Name
        columnName: CloudResource
version: 1.0.0