id: 8b7a1a64-8ef2-4000-b8c9-9bca3b93aace
name: Vectra Create Incident Based on Tag for Hosts
version: 1.1.0
kind: Scheduled
description: Create an incident when the host entity presents a specific tag. If the tag is present, an incident should be created and marked with highest priority.
status: Available
requiredDataConnectors:
  - connectorId: VectraXDR
    dataTypes:
      - Entities_Data_CL
severity: High
queryFrequency: 10m
queryPeriod: 10m
suppressionDuration: PT1H
suppressionEnabled: false
triggerOperator: GreaterThan
triggerThreshold: 0
tactics: 
  - Persistence
relevantTechniques:
  - T1546
query: |
  Entities_Data_CL
  | where entity_type == "host"
  | extend Tags = todynamic(tags)
  | where set_has_element(Tags, "MDR - Customer Escalation")
  | summarize arg_max(['last_modified_timestamp'], *) by ['name']
entityMappings:
- entityType: Host
  fieldMappings:
  - identifier: HostName
    columnName: name
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: P7D
    matchingMethod: AllEntities
    groupByEntities: [Host]
    groupByAlertDetails: [DisplayName]
customDetails:
  entity_id: id
  entity_type: entity_type
  tags: tags
  attack_profile: attack_profile
  ip_address: ip
alertDetailsOverride:
  alertDisplayNameFormat: Vectra AI Incident- {{name}} 
  alertDescriptionFormat: An incident has been escalated for Vectra AI entity {{name}} that is presenting an urgency score of {{urgency_score}}
  alertDynamicProperties:
    - alertProperty: "AlertLink"
      value: "url"
eventGroupingSettings:
  aggregationKind: AlertPerResult