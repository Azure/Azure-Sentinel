{
    "id": "VeeamCustomTablesDataConnector",
    "title": "Veeam Data Connector",
    "publisher": "Veeam",
    "descriptionMarkdown": "Veeam Data Connector allows you to ingest Veeam telemetry data from multiple custom tables into Microsoft Sentinel.\n\nThe connector supports integration with Veeam Backup & Replication, Veeam ONE and Coveware platforms to provide comprehensive monitoring and security analytics. The data is collected through Azure Functions and stored in custom Log Analytics tables with dedicated Data Collection Rules (DCR) and Data Collection Endpoints (DCE).\n\n**Custom Tables Included:**\n- **VeeamMalwareEvents_CL**: Malware detection events from Veeam Backup & Replication\n- **VeeamSecurityComplianceAnalyzer_CL**: Security & Compliance Analyzer results collected from Veeam backup infrastructure components\n- **VeeamAuthorizationEvents_CL**: Authorization and authentication events\n- **VeeamOneTriggeredAlarms_CL**: Triggered alarms from Veeam ONE servers\n- **VeeamCovewareFindings_CL**: Security findings from Coveware solution\n- **VeeamSession_CL**: Session data and user activity events",
    "additionalRequirementBanner": "The following queries and workbooks require a parser based on Kusto to work properly. To use **VeeamSyslogEventsV2** alias for Kusto functions in queries and workbooks, see [this instruction](https://aka.ms/sentinel-veeam-function) ",    "graphQueries": [
        {
            "metricName": "All malware events",
            "legend": "VeeamMalwareEvents_CL",
            "baseQuery": "VeeamMalwareEvents_CL"
        },
        {
            "metricName": "Critical malware events",
            "legend": "VeeamMalwareEvents_CL",
            "baseQuery": "VeeamMalwareEvents_CL\n| where Severity == \"Critical\""
        },
        {
            "metricName": "Security & Compliance Analyzer results",
            "legend": "VeeamSecurityComplianceAnalyzer_CL",
            "baseQuery": "VeeamSecurityComplianceAnalyzer_CL"
        },
        {
            "metricName": "Veeam ONE alarms",
            "legend": "VeeamOneTriggeredAlarms_CL",
            "baseQuery": "VeeamOneTriggeredAlarms_CL"
        },
        {
            "metricName": "Authorization events",
            "legend": "VeeamAuthorizationEvents_CL",
            "baseQuery": "VeeamAuthorizationEvents_CL"
        },
        {
            "metricName": "Coveware findings",
            "legend": "VeeamCovewareFindings_CL",
            "baseQuery": "VeeamCovewareFindings_CL"
        },
        {
            "metricName": "Session events",
            "legend": "VeeamSession_CL",
            "baseQuery": "VeeamSession_CL"
        }
    ],"sampleQueries": [
        
    ],    "dataTypes": [
        {
            "name": "VeeamMalwareEvents_CL",
            "lastDataReceivedQuery": "VeeamMalwareEvents_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
        },
        {
            "name": "VeeamSecurityComplianceAnalyzer_CL",
            "lastDataReceivedQuery": "VeeamSecurityComplianceAnalyzer_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
        },
        {
            "name": "VeeamAuthorizationEvents_CL",
            "lastDataReceivedQuery": "VeeamAuthorizationEvents_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
        },
        {
            "name": "VeeamOneTriggeredAlarms_CL",
            "lastDataReceivedQuery": "VeeamOneTriggeredAlarms_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
        },
        {
            "name": "VeeamCovewareFindings_CL",
            "lastDataReceivedQuery": "VeeamCovewareFindings_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
        },
        {
            "name": "VeeamSession_CL",
            "lastDataReceivedQuery": "VeeamSession_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
        }
    ],    "connectivityCriterias": [
        {
            "type": "IsConnectedQuery",
            "value": [
                "union VeeamMalwareEvents_CL, VeeamSecurityComplianceAnalyzer_CL, VeeamAuthorizationEvents_CL, VeeamOneTriggeredAlarms_CL, VeeamCovewareFindings_CL, VeeamSession_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(3d)"
            ]
        }
    ],
    "availability": {
        "status": 1,
        "isPreview": false
    },
    "permissions": {
        "resourceProvider": [
            {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                    "write": true,
                    "read": true,
                    "delete": true
                }
            },
            {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                    "action": true
                }
            }
        ],        "customs": [
            {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
            },
            {
                "name": "Veeam Infrastructure Access",
                "description": "Access to Veeam Backup & Replication REST API and Veeam ONE monitoring platform is required. This includes proper authentication credentials and network connectivity."
            }
        ]
    },    "instructionSteps": [
        {
            "title": "",
            "description": ">**NOTE:** This connector uses Azure Functions to connect to Veeam APIs and pull data into Microsoft Sentinel custom tables. This may result in additional data ingestion costs. See the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
        },
        {
            "title": "",
            "description": "**STEP 1 - Select the deployment option for Veeam Data Connector and associated Azure Functions**\n\n>**IMPORTANT:** Before you deploy Veeam Data Connector, prepare Workspace ID and Workspace Primary Key (can be copied from the following).",
            "instructions": [
                {
                    "parameters": {
                        "fillWith": [
                            "WorkspaceId"
                        ],
                        "label": "Workspace ID"
                    },
                    "type": "CopyableLabel"
                },
                {
                    "parameters": {
                        "fillWith": [
                            "PrimaryKey"
                        ],
                        "label": "Primary Key"
                    },
                    "type": "CopyableLabel"
                }
            ]
        },
        {
            "instructions": [
                {
                    "parameters": {
                        "instructionSteps": [
                            {                                "title": "Option 1 - Azure Resource Manager (ARM) Template",
                                "description": "Use this option to automatically deploy Veeam Data Connector using an ARM Template.\n\n1. Click **Deploy to Azure**. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Fmaster%2FSolutions%2FVeeam%2FData%2520Connectors%2FFunctionApp%2Fazuredeploy.json)\n2. Select the preferred values for **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace ID**. \n4. Click **Purchase** to deploy."
                            },
                            {                                "title": "Option 2 - Manual Deployment of Azure Functions",
                                "description": "To deploy Veeam Data Connector with Azure Functions manually using Visual Studio Code, perform the following steps:",
                                "instructions": [
                                    {
                                        "parameters": {
                                            "instructionSteps": [
                                                {
                                                    "title": "Step 1 - Deploy a Function App",
                                                    "description": "**NOTE:** [Prepare Visual Studio Code](https://docs.microsoft.com/azure/azure-functions/create-first-function-vs-code-python) for Azure Functions development.\n\n1. Download the [Azure Functions App](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Veeam/Data%20Connectors/functionapp.zip) file. Extract the archive to your computer.\n2. Follow the [instructions](https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AzureFunctionsManualDeploymentWithPythonVersion3.9.md#function-app-manual-deployment-instructions) to deploy the Azure Functions app using Visual Studio Code."
                                                },
                                                {
                                                    "title": "Step 2 - Configure the Function App",
                                                    "description": "1. In the Function App, select the Function App Name and click **Configuration**.\n2. On the **Application settings** tab, select **+ New application setting**.\n3. Add each of the following application settings individually, with their respective string values (case-sensitive): \n\t\tWorkspaceID\n\t\tWorkspaceKey\n\t\tVeeamServerUrl\n\t\tVeeamUsername\n\t\tVeeamPassword\n\t\tVeeamOneServerUrl\n\t\tVeeamOneUsername\n\t\tVeeamOnePassword\n\t\tDCEEndpoint\n\t\tDCRImmutableId\n\t\tlogAnalyticsUri (optional)\n> - Use logAnalyticsUri to override the log analytics API endpoint for dedicated cloud. For example, for public cloud, leave the value empty; for Azure GovUS cloud environment, specify the value in the following format: `https://<CustomerId>.ods.opinsights.azure.us`.\n4. Click **Save**."
                                                }
                                            ]
                                        },
                                        "type": "InstructionStepsGroup"
                                    }
                                ]
                            }
                        ]
                    },
                    "type": "InstructionStepsGroup"
                }
            ]
        }
    ]
}