{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "6f2383c9-5b86-4365-95b4-8ac7d2321e53",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Detect",
                  "subTarget": "Detect",
                  "preText": "Detect",
                  "style": "link"
                },
                {
                  "id": "ce743dcd-55b5-42f7-8553-a9d120b1d74b",
                  "cellValue": "setTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Audit",
                  "subTarget": "Audit",
                  "style": "link"
                }
              ]
            },
            "name": "links - 0"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "92ced0af-f421-44ab-9af8-b4faef3c4af7",
                        "cellValue": "setTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Entity",
                        "subTarget": "Entity",
                        "style": "link"
                      },
                      {
                        "id": "592f3c92-9e4a-4b59-943f-fe239f83bdd8",
                        "cellValue": "setTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Detections",
                        "subTarget": "Detections",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "c2e47223-15df-44b3-8040-0bfc72eeab0a",
                              "version": "KqlParameterItem/1.0",
                              "name": "timerange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 604800000
                              }
                            },
                            {
                              "id": "f909ea8d-ce5f-41a1-8b26-d2e34169f149",
                              "version": "KqlParameterItem/1.0",
                              "name": "View",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"true\", \"label\":\"Prioritized\" },\r\n    { \"value\":\"false\", \"label\":\"Not Prioritized\" }\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": [
                                "true"
                              ]
                            },
                            {
                              "id": "732ba446-ecc2-49fd-be25-53ee45d3f9c2",
                              "version": "KqlParameterItem/1.0",
                              "name": "DataSource",
                              "label": "Data Source",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "VectraEntityScoring\r\n| where ['Event Timestamp'] {timerange}\r\n| summarize arg_max(['Event Timestamp'],*) by Name, URL\r\n| where ('*' in ({View}) or [\"Is Prioritized\"] in ({View}))\r\n| extend source = iff(isempty(tostring(split(Name,\":\")[0])),'NA',tostring(split(Name,\":\")[0]))\r\n| distinct source",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "*",
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "e2fa7c64-c20c-4e7b-9557-81c64f2c5b58",
                              "version": "KqlParameterItem/1.0",
                              "name": "EntityType",
                              "label": "Entity Type",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "VectraEntityScoring\r\n| where ['Event Timestamp'] {timerange} \r\n| summarize arg_max(['Event Timestamp'],*) by Name, URL\r\n| where ('*' in ({View}) or [\"Is Prioritized\"] in ({View}))\r\n| extend source = tostring(split(Name,\":\")[0])\r\n| extend source2 = iff(isempty(source),\"NA\",source)\r\n| where ('*' in ({DataSource}) or source2 in ({DataSource}))\r\n| summarize arg_max(TimeGenerated, *) by [\"Entity Type\"]\r\n| distinct ID, ['Entity Type']\r\n| extend splitted_entity_type = split(['Entity Type'],\"_\")\r\n| mv-expand splitted_entity_type = splitted_entity_type\r\n| extend cap = toupper(substring(splitted_entity_type,0,1)), rest_string = substring(splitted_entity_type,1)\r\n| extend joined_str = strcat(cap,rest_string)\r\n| distinct joined_str,ID,['Entity Type']\r\n| summarize joined_array = make_list(todynamic(joined_str)) by ID, ['Entity Type']\r\n| extend capitalized_Category = strcat_array(joined_array, \" \")\r\n| distinct ['Entity Type'], capitalized_Category",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "*",
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces",
                              "value": [
                                "value::all"
                              ]
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraEntityScoring\r\n| where ['Event Timestamp'] {timerange}\r\n| summarize arg_max(['Event Timestamp'],*) by Name, URL\r\n| where ('*' in ({View}) or [\"Is Prioritized\"] in ({View})) and ('*' in ({EntityType}) or [\"Entity Type\"] in ({EntityType}))\r\n| extend ['Data Source'] = tostring(split(Name,\":\")[0])\r\n| extend source2 = iff(isempty(['Data Source']),\"NA\",['Data Source'])\r\n| where ('*' in ({DataSource}) or source2 in ({DataSource}))\r\n| extend priority = case(\r\n    ['Is Prioritized'] == true, \"Prioritized\",\r\n    ['Is Prioritized'] == false, \"Not Prioritized\",\r\n    \"Unknown\"\r\n)\r\n| summarize count() by priority\r\n| order by priority desc",
                          "size": 3,
                          "title": "Entity Count by Priority",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "priority",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Prioritized",
                                    "representation": "red",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Not Prioritized",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "lightBlue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              },
                              "numberFormat": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal"
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 4"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraEntityScoring\r\n| where ['Event Timestamp'] {timerange} \r\n| summarize arg_max(['Event Timestamp'],*) by Name, URL\r\n| where ('*' in ({View}) or [\"Is Prioritized\"] in ({View})) and ('*' in ({EntityType}) or [\"Entity Type\"] in ({EntityType}))\r\n| extend ['Data Source'] = tostring(split(Name,\":\")[0])\r\n| extend source2 = iff(isempty(['Data Source']),\"NA\",['Data Source'])\r\n| where ('*' in ({DataSource}) or source2 in ({DataSource}))\r\n| sort by ['Urgency Score'] desc, ['Entity Importance'] desc\r\n| extend ['Entity Importance'] = case(\r\n    ['Entity Importance'] == 0, \"Low\",\r\n    ['Entity Importance'] == 1, \"Medium\",\r\n    ['Entity Importance'] == 2, \"High\",\r\n    \"Unknown\"\r\n), Velocity = case(\r\n    ['Velocity Contrib'] == 0, \"Low\",\r\n    ['Velocity Contrib'] == 1, \"Medium\",\r\n    ['Velocity Contrib'] == 2, \"High\",\r\n    \"Unknown\"\r\n)\r\n| project-rename ['Entity Name'] = Name, ['Deep Link'] = URL, ['Latest Update'] = ['Event Timestamp']\r\n| project ['Urgency Score'], ['Entity Name'], ['Entity Importance'], ['Data Source'], ['Deep Link'], ['Latest Update'],  Velocity\r\n// | project ['Urgency Score'], ['Entity Name'], ['Entity Importance'],\"Attack Rating\", \"Attack Profile\", \"Determiing Factor\", ['Data Source'], ['Deep Link'], ['Latest Update'],  Velocity, \"Assignment\"",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Entity View",
                          "showRefreshButton": true,
                          "exportFieldName": "Deep Link",
                          "exportParameterName": "P_deep_url",
                          "exportDefaultValue": "None",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Deep Link",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "name": "query - 3",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "üí° _Click on a row in the above Entity View grid to view more details_"
                        },
                        "name": "text - 8"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraEntityScoring\r\n| where ['Event Timestamp'] {timerange} \r\n| summarize arg_max(['Event Timestamp'],*) by Name, URL\r\n| where ('*' in ({View}) or [\"Is Prioritized\"] in ({View})) and ('*' in ({EntityType}) or [\"Entity Type\"] in ({EntityType}))\r\n| extend ['Data Source'] = tostring(split(Name,\":\")[0])\r\n| extend source2 = iff(isempty(['Data Source']),\"NA\",['Data Source'])\r\n| where ('*' in ({DataSource}) or source2 in ({DataSource})) and URL == '{P_deep_url}'\r\n| project ID, ['Entity ID'], Name, ['Entity Importance'], ['Entity Type'], ['Is Prioritized'], Severity, [\"Urgency Score\"], URL, Category, ['Last Detection URL'], ['Last Detection Type'], [\"Last Detection ID\"], ['Active Detection Types'], ['Event Timestamp'], ['Breadth Contrib'], ['Velocity Contrib']",
                          "size": 4,
                          "showAnalytics": true,
                          "title": "Selected Entity View data",
                          "showRefreshButton": true,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table"
                        },
                        "conditionalVisibility": {
                          "parameterName": "P_deep_url",
                          "comparison": "isNotEqualTo",
                          "value": "None"
                        },
                        "name": "query - 7",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraAccountDetection\r\n| where ['Event Timestamp'] {timerange} and ['Account href'] == '{P_deep_url}'\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type']\r\n| extend ['Data Source'] = tostring(split(['Account UID'],\":\")[0])\r\n| extend Category = case(Category==\"info\",\"Info\",Category==\"command_and_control\",\"Command and Control\",Category==\"reconnaissance\",\"Reconnaissance\",Category==\"lateral_movement\",\"Lateral Movement\",Category==\"exfiltration\",\"Exfiltration\",\"Unknown\")\r\n| project-rename ['Detection Time'] = ['Event Timestamp'], ['Detection Name'] = ['Detection Type'], ['Deep Link'] = ['Detection href'], ['Detection Category'] = Category, ['Source IP'] = IP\r\n| project ['Detection Time'],  ['Detection Name'], ['Data Source'], ['Deep Link'], Triaged, ['Detection Category'], ['Source IP'], Severity\r\n// | project ['Detection Time'],  ['Detection Name'], ['Data Source'], ['Deep Link'], Triaged, ['Detection Category'], ['Source IP'], \"Destination IP\", Severity, \"Assignment\"\r\n| sort by ['Detection Time'] desc",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Detection List",
                          "showRefreshButton": true,
                          "exportFieldName": "Deep Link",
                          "exportParameterName": "P_detection_url",
                          "exportDefaultValue": "None",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Deep Link",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "conditionalVisibility": {
                          "parameterName": "P_deep_url",
                          "comparison": "isNotEqualTo",
                          "value": "None"
                        },
                        "name": "query - 4",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "üí° _Click on a row in the above Detection List grid to view more details_"
                        },
                        "conditionalVisibility": {
                          "parameterName": "P_deep_url",
                          "comparison": "isNotEqualTo",
                          "value": "None"
                        },
                        "name": "text - 9"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraAccountDetection\r\n| where ['Event Timestamp'] {timerange} and ['Account href'] == '{P_deep_url}'\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type']\r\n| where ['Detection href'] == '{P_detection_url}'\r\n| extend Category = case(Category==\"info\",\"Info\",Category==\"command_and_control\",\"Command and Control\",Category==\"reconnaissance\",\"Reconnaissance\",Category==\"lateral_movement\",\"Lateral Movement\",Category==\"exfiltration\",\"Exfiltration\",\"Unknown\")\r\n| project ID, Category, Threat, Certainty, Triaged, [\"Detection Type\"], [\"D Type Vname\"], [\"Detection ID\"], [\"Detection href\"], [\"Account ID\"], [\"Account href\"], href, [\"Account UID\"], [\"Src Account\"], [\"Event Timestamp\"], IP, Details, Severity",
                          "size": 4,
                          "showAnalytics": true,
                          "title": "Selected Detection List Data",
                          "showRefreshButton": true,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table"
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "P_deep_url",
                            "comparison": "isNotEqualTo",
                            "value": "None"
                          },
                          {
                            "parameterName": "P_detection_url",
                            "comparison": "isNotEqualTo",
                            "value": "None"
                          }
                        ],
                        "name": "query - 7",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "setTab",
                    "comparison": "isEqualTo",
                    "value": "Entity"
                  },
                  "name": "Entity"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "8ba900f4-2667-4651-87ee-866de79ed08f",
                              "version": "KqlParameterItem/1.0",
                              "name": "TimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "isRequired": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 300000
                                  },
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2419200000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "value": {
                                "durationMs": 604800000
                              }
                            },
                            {
                              "id": "41b0ee6f-04db-423c-a0fd-babfda10e619",
                              "version": "KqlParameterItem/1.0",
                              "name": "DataSource",
                              "label": "Data Source",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "VectraAccountDetection\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type'], ['Account href']\r\n| extend source = tostring(split(['Account UID'],\":\")[0])\r\n| distinct source\r\n| sort by source asc",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "*",
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "bd9a1ea9-0bec-457d-a24b-f84e15e1af42",
                              "version": "KqlParameterItem/1.0",
                              "name": "DetectionCategory",
                              "label": "Detection Category",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "*",
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    {\"value\":\"info\", \"label\":\"Info\"},\r\n    {\"value\":\"command_and_control\",\"label\":\"Command and Control\"},\r\n    {\"value\":\"reconnaissance\",\"label\":\"Reconnaissance\"},\r\n    {\"value\":\"lateral_movement\",\"label\":\"Lateral Movement\"},\r\n    {\"value\":\"exfiltration\",\"label\":\"Exfiltration\"}\r\n]",
                              "defaultValue": "value::all",
                              "value": [
                                "value::all"
                              ]
                            },
                            {
                              "id": "1144f1b6-24e0-422c-bc8c-9bd87f6d258e",
                              "version": "KqlParameterItem/1.0",
                              "name": "DetectionType",
                              "label": "Detection Type",
                              "type": 2,
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "VectraAccountDetection\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type'], ['Account href']\r\n| extend source = tostring(split(['Account UID'],\":\")[0])\r\n| where ('*' in ({DataSource}) or source in ({DataSource})) and ('*' in ({DetectionCategory}) or Category in ({DetectionCategory}))\r\n| distinct ['Detection Type']\r\n| sort by ['Detection Type'] asc",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "selectAllValue": "*",
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "datatable (Count:long, Category:string, category_count:long) [0,\"Info\",1, 0,\"Command and Control\",2, 0,\"Reconnaissance\",3, 0,\"Lateral Movement\",4, 0,\"Exfiltration\",5]\r\n|union\r\n(\r\nVectraAccountDetection\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type'], ['Account href']\r\n| extend source = tostring(split(['Account UID'],\":\")[0])\r\n| where ('*' in ({DataSource}) or source in ({DataSource}))\r\n| where ('*' in ({DetectionCategory}) or Category in ({DetectionCategory})) and ('*' in ({DetectionType}) or ['Detection Type'] in ({DetectionType}))\r\n| extend Category = case(Category==\"info\",\"Info\",Category==\"command_and_control\",\"Command and Control\",Category==\"reconnaissance\",\"Reconnaissance\",Category==\"lateral_movement\",\"Lateral Movement\",Category==\"exfiltration\",\"Exfiltration\",\"Unknown\")\r\n| extend category_count=case(Category==\"Info\",1,Category==\"Command and Control\",2,Category==\"Reconnaissance\",3,Category==\"Lateral Movement\",4,Category==\"Exfiltration\",5,6)\r\n| summarize Count=count() by Category, category_count\r\n)\r\n| summarize Count=sum(Count) by Category, category_count\r\n| sort by category_count asc",
                          "size": 3,
                          "title": "Detection Category Count",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Category",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Command and Control",
                                    "representation": "yellow",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Exfiltration",
                                    "representation": "purple",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Lateral Movement",
                                    "representation": "red",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Reconnaissance",
                                    "representation": "green",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Info",
                                    "representation": "gray",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "lightBlue",
                                    "text": "{0}{1}"
                                  }
                                ]
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "name": "query - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraAccountDetection\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type'], ['Account href']\r\n| extend ['Data Source'] = tostring(split(['Account UID'],\":\")[0])\r\n| where ('*' in ({DataSource}) or ['Data Source'] in ({DataSource}))\r\n| where ('*' in ({DetectionCategory}) or Category in ({DetectionCategory})) and ('*' in ({DetectionType}) or ['Detection Type'] in ({DetectionType}))\r\n| extend Category = case(Category==\"info\",\"Info\",Category==\"command_and_control\",\"Command and Control\",Category==\"reconnaissance\",\"Reconnaissance\",Category==\"lateral_movement\",\"Lateral Movement\",Category==\"exfiltration\",\"Exfiltration\",\"Unknown\")\r\n| project-rename ['Detection Time'] = ['Event Timestamp'], ['Detection Name'] = ['Detection Type'], ['Deep Link'] = ['Detection href'], ['Source IP'] = IP\r\n| project ['Detection Time'], ['Account ID'], ['Detection Name'], ['Data Source'], ['Deep Link'], Triaged, ['Detection Category']=Category, ['Source IP'], Severity\r\n// | project ['Detection Time'],  ['Detection Name'], ['Data Source'], ['Deep Link'], Triaged, ['Detection Category'], ['Source IP'], \"Destination IP\", Severity, \"Assignment\"\r\n| sort by ['Detection Time'] desc",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Detection View",
                          "showRefreshButton": true,
                          "exportFieldName": "Deep Link",
                          "exportParameterName": "P_detection_link",
                          "exportDefaultValue": "None",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Deep Link",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "Url"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true
                          }
                        },
                        "name": "query - 2",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "üí° _Click on a row in the above Detection View grid to view more details_"
                        },
                        "name": "text - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "VectraAccountDetection\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(['Event Timestamp'],*) by ['Detection Type'], ['Account href']\r\n| extend ['Data Source'] = tostring(split(['Account UID'],\":\")[0])\r\n| where ('*' in ({DataSource}) or ['Data Source'] in ({DataSource}))\r\n| where ('*' in ({DetectionCategory}) or Category in ({DetectionCategory})) and ('*' in ({DetectionType}) or ['Detection Type'] in ({DetectionType})) and ['Detection href'] == '{P_detection_link}'\r\n| extend Category = case(Category==\"info\",\"Info\",Category==\"command_and_control\",\"Command and Control\",Category==\"reconnaissance\",\"Reconnaissance\",Category==\"lateral_movement\",\"Lateral Movement\",Category==\"exfiltration\",\"Exfiltration\",\"Unknown\")\r\n| project ID, Category, Threat, Certainty, Triaged, [\"Detection Type\"], [\"D Type Vname\"], [\"Detection ID\"], [\"Detection href\"], [\"Account ID\"], [\"Account href\"], href, [\"Account UID\"], [\"Src Account\"], [\"Event Timestamp\"], IP, Details, Severity",
                          "size": 4,
                          "showAnalytics": true,
                          "title": "Selected Detection View Data",
                          "showRefreshButton": true,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table"
                        },
                        "conditionalVisibility": {
                          "parameterName": "P_detection_link",
                          "comparison": "isNotEqualTo",
                          "value": "None"
                        },
                        "name": "query - 4",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "setTab",
                    "comparison": "isEqualTo",
                    "value": "Detections"
                  },
                  "name": "Detections"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "üìù ***Refresh the web page to fetch details of recently collected events***"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "Detect"
            },
            "name": "detect"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "9b914837-bb6a-4932-92ce-9671341c2e55",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": {
                          "durationMs": 604800000
                        }
                      },
                      {
                        "id": "faf02ab6-e28d-4d11-84d7-3039ae73bb37",
                        "version": "KqlParameterItem/1.0",
                        "name": "ResultStatus",
                        "label": "Result Status",
                        "type": 2,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"success\", \"label\":\"Success\", \"selected\":true },\r\n    { \"value\":\"failure\", \"label\":\"Failure\" },\r\n    {\"value\":\"\",\"label\":\"NA\"}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraAudits\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(TimeGenerated,*) by ID\r\n| where ('*' in ({ResultStatus}) or ['Result Status'] in ({ResultStatus}))\r\n| extend ['Result Status'] = tolower(['Result Status'])\r\n| extend Result_status = case(\r\n    ['Result Status'] == \"success\", \"Success\",\r\n    ['Result Status'] == \"failure\", \"Failure\",\r\n    ['Result Status'] == \"\",\"NA\"\r\n    ,\"Unknown\"\r\n)\r\n| extend importance = case(\r\n    Result_status == \"Success\", 0,\r\n    Result_status == \"Failure\", 1,\r\n    Result_status == \"NA\",2\r\n    ,3\r\n)\r\n| summarize count() by Result_status, importance\r\n| sort by importance asc",
                    "size": 3,
                    "title": "Audit Logs Count",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Result_status",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Success",
                              "representation": "green",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Failure",
                              "representation": "red",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "NA",
                              "representation": "gray",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "lightBlue",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "none"
                        }
                      },
                      "showBorder": true,
                      "size": "auto"
                    }
                  },
                  "name": "query - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VectraAudits\r\n| where ['Event Timestamp'] {TimeRange}\r\n| summarize arg_max(TimeGenerated,*) by ID\r\n| where ('*' in ({ResultStatus}) or ['Result Status'] in ({ResultStatus}))\r\n| project-rename ['Time Generated'] = ['Event Timestamp'], User = Username, Role = ['User Role']\r\n| project ['Time Generated'], User, Role, ['Source IP'], Message, ['Result Status']\r\n| sort by ['Time Generated'] desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Audit View",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000,
                      "filter": true
                    }
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "üìù ***Refresh the web page to fetch details of recently collected events***"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "setTab",
              "comparison": "isEqualTo",
              "value": "Audit"
            },
            "name": "audit",
            "styleSettings": {
              "margin": "10px"
            }
          }
        ]
      },
      "name": "main"
    }
  ],
  "fromTemplateId": "sentinel-VectraCloud",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}