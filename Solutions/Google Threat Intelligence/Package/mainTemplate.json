{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Google",
    "comments": "Solution template for Google Threat Intelligence"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "_solutionName": "Google Threat Intelligence",
    "_solutionVersion": "3.0.0",
    "solutionId": "virustotalsl1681486227461.azure-sentinel-solution-google",
    "_solutionId": "[variables('solutionId')]",
    "GTICustomConnector": "GTICustomConnector",
    "_GTICustomConnector": "[variables('GTICustomConnector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "GTICustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "GTI-EnrichIncident": "GTI-EnrichIncident",
    "_GTI-EnrichIncident": "[variables('GTI-EnrichIncident')]",
    "playbookVersion2": "2.8",
    "playbookContentId2": "GTI-EnrichIncident",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "GTI-EnrichAlert": "GTI-EnrichAlert",
    "_GTI-EnrichAlert": "[variables('GTI-EnrichAlert')]",
    "playbookVersion3": "2.8",
    "playbookContentId3": "GTI-EnrichAlert",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "GTI-EnrichIP": "GTI-EnrichIP",
    "_GTI-EnrichIP": "[variables('GTI-EnrichIP')]",
    "playbookVersion4": "2.8",
    "playbookContentId4": "GTI-EnrichIP",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "GTI-EnrichURL": "GTI-EnrichURL",
    "_GTI-EnrichURL": "[variables('GTI-EnrichURL')]",
    "playbookVersion5": "2.8",
    "playbookContentId5": "GTI-EnrichURL",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5'))))]",
    "_playbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId5'),'-', variables('playbookVersion5'))))]",
    "GTI-EnrichFilehash": "GTI-EnrichFilehash",
    "_GTI-EnrichFilehash": "[variables('GTI-EnrichFilehash')]",
    "playbookVersion6": "2.8",
    "playbookContentId6": "GTI-EnrichFilehash",
    "_playbookContentId6": "[variables('playbookContentId6')]",
    "playbookId6": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
    "playbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId6'))))]",
    "_playbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId6'),'-', variables('playbookVersion6'))))]",
    "GTI-EnrichDomain": "GTI-EnrichDomain",
    "_GTI-EnrichDomain": "[variables('GTI-EnrichDomain')]",
    "playbookVersion7": "2.8",
    "playbookContentId7": "GTI-EnrichDomain",
    "_playbookContentId7": "[variables('playbookContentId7')]",
    "playbookId7": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId7'))]",
    "playbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId7'))))]",
    "_playbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId7'),'-', variables('playbookVersion7'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GTICustomConnector Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "ConnectorName": {
              "defaultValue": "GoogleThreatIntelligence-CustomConnector",
              "type": "String",
              "metadata": {
                "description": "Google Threat Intelligence Custom Connector"
              }
            },
            "BackendService": {
              "defaultValue": "https://www.virustotal.com/api/v3",
              "type": "String",
              "metadata": {
                "description": "Google Threat Intelligence API"
              }
            }
          },
          "variables": {
            "operationId-get_file": "get_file",
            "_operationId-get_file": "[[variables('operationId-get_file')]",
            "operationId-get_ip": "get_ip",
            "_operationId-get_ip": "[[variables('operationId-get_ip')]",
            "operationId-get_domain": "get_domain",
            "_operationId-get_domain": "[[variables('operationId-get_domain')]",
            "operationId-get_url": "get_url",
            "_operationId-get_url": "[[variables('operationId-get_url')]",
            "operationId-post_file": "post_file",
            "_operationId-post_file": "[[variables('operationId-post_file')]",
            "operationId-retrieve_url_file": "retrieve_url_file",
            "_operationId-retrieve_url_file": "[[variables('operationId-retrieve_url_file')]",
            "operationId-analyze_url": "analyze_url",
            "_operationId-analyze_url": "[[variables('operationId-analyze_url')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "GTICustomConnector",
            "playbookId1": "[[resourceId('Microsoft.Web/customApis', parameters('ConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('ConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring"
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('BackendService')]"
                },
                "capabilities": "[variables('TemplateEmptyArray')]",
                "brandColor": "#FFFFFF",
                "description": "This connector provides access to various Google Threat Intelligence API endpoints for retrieving file, IP, domain, and URL analysis reports.",
                "displayName": "[[parameters('ConnectorName')]",
                "iconUri": "https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/GoogleThreatIntelligence.svg",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Google Threat Intelligence",
                    "description": "This connector provides access to various Google Threat Intelligence API endpoints for retrieving file, IP, domain, and URL analysis reports.",
                    "version": "1.0",
                    "contact": {
                      "name": "Google Threat Intelligence",
                      "url": "https://www.virustotal.com/gui/contact-us/support"
                    }
                  },
                  "x-ms-connector-metadata": [
                    {
                      "propertyName": "Website",
                      "propertyValue": "https://www.virustotal.com"
                    },
                    {
                      "propertyName": "Privacy policy",
                      "propertyValue": "https://virustotal.readme.io/docs/historic-privacy-policy"
                    },
                    {
                      "propertyName": "Categories",
                      "propertyValue": "Data"
                    }
                  ],
                  "host": "www.virustotal.com",
                  "basePath": "/api/v3",
                  "schemes": [
                    "https"
                  ],
                  "consumes": "[variables('TemplateEmptyArray')]",
                  "produces": "[variables('TemplateEmptyArray')]",
                  "paths": {
                    "/files/{id}": {
                      "get": {
                        "summary": "Get File Report",
                        "description": "Retrieve detailed analysis report for a specific file by its ID.",
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "string",
                                      "description": "The unique identifier (SHA-256 hash) of the file."
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "The type of object being analyzed (in this case, \"file\")."
                                    },
                                    "links": {
                                      "type": "object",
                                      "properties": {
                                        "self": {
                                          "type": "string",
                                          "description": "The URL to retrieve this file's report."
                                        }
                                      },
                                      "description": "Links to related resources."
                                    },
                                    "attributes": {
                                      "type": "object",
                                      "properties": {
                                        "type_extension": {
                                          "type": "string",
                                          "description": "The file extension (if available)."
                                        },
                                        "times_submitted": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The number of times this file has been submitted to Google Threat Intelligence."
                                        },
                                        "meaningful_name": {
                                          "type": "string",
                                          "description": "A human-readable name for the file (if available)."
                                        },
                                        "sha1": {
                                          "type": "string",
                                          "description": "The SHA-1 hash of the file."
                                        },
                                        "magic": {
                                          "type": "string",
                                          "description": "A textual description of the file type, as determined by libmagic."
                                        },
                                        "total_votes": {
                                          "type": "object",
                                          "properties": {
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of votes classifying this file as harmless.",
                                              "title": "total votes harmless"
                                            },
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of votes classifying this file as malicious.",
                                              "title": "total votes malicious"
                                            }
                                          },
                                          "description": "Aggregated votes from the community."
                                        },
                                        "type_tag": {
                                          "type": "string",
                                          "description": "A high-level categorization of the file type (e.g., \"PE executable\", \"PDF document\")."
                                        },
                                        "last_analysis_stats": {
                                          "type": "object",
                                          "properties": {
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that detected the file as malicious in the latest analysis.",
                                              "title": "last analysis malicious"
                                            },
                                            "suspicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that detected the file as suspicious in the latest analysis.",
                                              "title": "last analysis suspicious"
                                            },
                                            "undetected": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that did not detect any threats in the file in the latest analysis.",
                                              "title": "last analysis undetected"
                                            },
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that explicitly classified the file as harmless in the latest analysis.",
                                              "title": "last analysis harmless"
                                            },
                                            "timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that timed out during the latest analysis.",
                                              "title": "last analysis timeout"
                                            },
                                            "confirmed-timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that experienced a confirmed timeout during the latest analysis.",
                                              "title": "last analysis confirmed-timeout"
                                            },
                                            "failure": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that encountered an error during the latest analysis.",
                                              "title": "last analysis failure"
                                            },
                                            "type-unsupported": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of antivirus engines that do not support the analysis of this file type.",
                                              "title": "last analysis type-unsupported"
                                            }
                                          },
                                          "description": "Statistics from the latest analysis."
                                        },
                                        "ssdeep": {
                                          "type": "string",
                                          "description": "The ssdeep fuzzy hash of the file, used for similarity comparison."
                                        },
                                        "type_description": {
                                          "type": "string",
                                          "description": "A more detailed description of the file type (e.g., \"Microsoft Word Document\")."
                                        },
                                        "tlsh": {
                                          "type": "string",
                                          "description": "The TLSH fuzzy hash of the file, used for similarity comparison."
                                        },
                                        "reputation": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The reputation score of the file, calculated based on various factors."
                                        },
                                        "sha256": {
                                          "type": "string",
                                          "description": "The SHA-256 hash of the file."
                                        },
                                        "unique_sources": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The number of unique sources from which this file has been submitted."
                                        },
                                        "names": {
                                          "type": "array",
                                          "items": {
                                            "type": "string"
                                          },
                                          "description": "A list of names associated with the file."
                                        },
                                        "tags": {
                                          "type": "array",
                                          "items": {
                                            "type": "string"
                                          },
                                          "description": "Tags associated with the file, providing additional context or categorization."
                                        },
                                        "last_submission_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp of the last time this file was submitted to Google Threat Intelligence."
                                        },
                                        "last_modification_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp of the last modification date of the file (if available)."
                                        },
                                        "size": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The size of the file in bytes."
                                        },
                                        "md5": {
                                          "type": "string",
                                          "description": "The MD5 hash of the file."
                                        },
                                        "gti_assessment": {
                                          "type": "object",
                                          "properties": {
                                            "severity": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The severity level assigned by Google Threat Intelligence's GTI (e.g., \"SEVERITY_NONE\", \"SEVERITY_LOW\", etc.).",
                                                  "title": "severity"
                                                }
                                              },
                                              "description": "The severity assessment of the file."
                                            },
                                            "threat_score": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The threat score assigned by Google Threat Intelligence's GTI, indicating the likelihood of the file being malicious.",
                                                  "title": "threat score"
                                                }
                                              },
                                              "description": "The threat score assessment of the file."
                                            },
                                            "verdict": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The overall verdict of the file's analysis by Google Threat Intelligence's GTI (e.g., \"VERDICT_UNDETECTED\", \"VERDICT_MALICIOUS\", etc.).",
                                                  "title": "verdict"
                                                }
                                              },
                                              "description": "The overall verdict of the file's analysis."
                                            },
                                            "description": {
                                              "type": "string",
                                              "description": "A textual description of the GTI assessment."
                                            }
                                          },
                                          "description": "GTI's (Google Threat Intelligence) assessment of the file."
                                        }
                                      },
                                      "description": "Attributes and metadata associated with the file."
                                    }
                                  },
                                  "description": "Data containing the file report."
                                }
                              }
                            }
                          },
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-get_file')]",
                        "parameters": [
                          {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-summary": "File ID",
                            "description": "Hash value of the file",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "in": "header",
                            "name": "x-tool",
                            "type": "string",
                            "required": true,
                            "default": "MSFTSentinel"
                          }
                        ]
                      }
                    },
                    "/ip_addresses/{ip}": {
                      "get": {
                        "summary": "Get IP Report",
                        "description": "Retrieve analysis and reputation information about a specific IP address.",
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "string",
                                      "description": "The unique identifier for this IP address report."
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "The type of object represented."
                                    },
                                    "links": {
                                      "type": "object",
                                      "properties": {
                                        "self": {
                                          "type": "string",
                                          "description": "The URL to retrieve this IP address report."
                                        }
                                      },
                                      "description": "Links to related resources."
                                    },
                                    "attributes": {
                                      "type": "object",
                                      "properties": {
                                        "asn": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Autonomous System Number (ASN) associated with the IP address."
                                        },
                                        "network": {
                                          "type": "string",
                                          "description": "The network or CIDR block the IP address belongs to."
                                        },
                                        "last_https_certificate_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date of the last HTTPS certificate seen for this IP address (Unix timestamp)."
                                        },
                                        "country": {
                                          "type": "string",
                                          "description": "The country associated with the IP address."
                                        },
                                        "as_owner": {
                                          "type": "string",
                                          "description": "The name of the organization that owns the ASN associated with the IP address."
                                        },
                                        "reputation": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The reputation score of the IP address (-100 to 100)."
                                        },
                                        "total_votes": {
                                          "type": "object",
                                          "properties": {
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of votes classifying the IP address as harmless.",
                                              "title": "total votes harmless"
                                            },
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of votes classifying the IP address as malicious.",
                                              "title": "total votes malicious"
                                            }
                                          },
                                          "description": "The breakdown of votes on the IP address's maliciousness."
                                        },
                                        "whois": {
                                          "type": "string",
                                          "description": "The raw WHOIS data for the IP address."
                                        },
                                        "tags": {
                                          "type": "array",
                                          "description": "Tags associated with the IP address based on community analysis."
                                        },
                                        "last_analysis_stats": {
                                          "type": "object",
                                          "properties": {
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that detected the IP address as malicious.",
                                              "title": "last analysis malicious"
                                            },
                                            "suspicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that detected the IP address as suspicious.",
                                              "title": "last analysis suspicious"
                                            },
                                            "undetected": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that did not detect the IP address as malicious or suspicious.",
                                              "title": "last analysis undetected"
                                            },
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that detected the IP address as harmless.",
                                              "title": "last analysis harmless"
                                            },
                                            "timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that timed out during the analysis of the IP address.",
                                              "title": "last analysis timeout"
                                            }
                                          },
                                          "description": "Statistics from the last analysis of the IP address."
                                        },
                                        "whois_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date the WHOIS data was last updated."
                                        },
                                        "regional_internet_registry": {
                                          "type": "string",
                                          "description": "The Regional Internet Registry (RIR) responsible for the IP address."
                                        },
                                        "last_modification_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date the IP address report was last modified."
                                        },
                                        "continent": {
                                          "type": "string",
                                          "description": "The continent where the IP address is located."
                                        },
                                        "gti_assessment": {
                                          "type": "object",
                                          "properties": {
                                            "severity": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The severity level assigned by GTI.",
                                                  "title": "severity"
                                                }
                                              },
                                              "description": "The severity level assigned by GTI."
                                            },
                                            "threat_score": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The threat score assigned by GTI (0-100).",
                                                  "title": "threat score"
                                                }
                                              },
                                              "description": "The threat score assigned by GTI (0-100)."
                                            },
                                            "verdict": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The overall verdict from GTI.",
                                                  "title": "verdict"
                                                }
                                              },
                                              "description": "The overall verdict from GTI."
                                            },
                                            "contributing_factors": {
                                              "type": "object",
                                              "properties": {
                                                "mandiant_confidence_score": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The confidence score assigned by Mandiant (0-100)."
                                                },
                                                "normalised_categories": {
                                                  "type": "array",
                                                  "items": {
                                                    "type": "string"
                                                  },
                                                  "description": "Normalized categories associated with the IP address."
                                                },
                                                "pervasive_indicator": {
                                                  "type": "boolean",
                                                  "description": "Indicates if the IP address is a pervasive indicator."
                                                },
                                                "safebrowsing_verdict": {
                                                  "type": "string",
                                                  "description": "The verdict from Google Safe Browsing."
                                                }
                                              },
                                              "description": "Factors contributing to the GTI assessment."
                                            },
                                            "description": {
                                              "type": "string",
                                              "description": "A description of the GTI assessment."
                                            }
                                          },
                                          "description": "Google Threat Intelligence (GTI) assessment of the IP address."
                                        }
                                      },
                                      "description": "attributes"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-get_ip')]",
                        "parameters": [
                          {
                            "name": "ip",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-summary": "Ip address",
                            "description": "Ip address to obtain the report",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "in": "header",
                            "name": "x-tool",
                            "type": "string",
                            "required": true,
                            "default": "MSFTSentinel"
                          }
                        ]
                      }
                    },
                    "/domains/{id}": {
                      "get": {
                        "summary": "Get Domain Report",
                        "description": "Retrieve analysis and reputation information about a specific domain.",
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "string",
                                      "description": "The id of the domain"
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "The type of the domain"
                                    },
                                    "links": {
                                      "type": "object",
                                      "properties": {
                                        "self": {
                                          "type": "string",
                                          "description": "The url to retrieve this domain report."
                                        }
                                      },
                                      "description": "links to related resources."
                                    },
                                    "attributes": {
                                      "type": "object",
                                      "properties": {
                                        "total_votes": {
                                          "type": "object",
                                          "properties": {
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The count of votes indicating the domain is safe.",
                                              "title": "total votes harmless"
                                            },
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The count of votes suggesting the domain is harmful.",
                                              "title": "total votes malicious"
                                            }
                                          },
                                          "description": "his object provides a summary of community votes regarding the domain's potential maliciousness."
                                        },
                                        "reputation": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "A numerical score ranging from -100 to 100, reflecting the domain's overall reputation based on various factors."
                                        },
                                        "whois": {
                                          "type": "string",
                                          "description": "The raw WHOIS data associated with the domain, containing registration details and contact information."
                                        },
                                        "last_https_certificate_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp indicating when the last HTTPS certificate for this domain was observed."
                                        },
                                        "last_dns_records_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp representing the last time DNS records were fetched for this domain."
                                        },
                                        "registrar": {
                                          "type": "string",
                                          "description": "The entity responsible for registering the domain name."
                                        },
                                        "last_modification_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp showing when the domain report was last updated."
                                        },
                                        "creation_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp marking the domain's initial registration date."
                                        },
                                        "tags": {
                                          "type": "array",
                                          "description": "An array of tags assigned to the domain based on community analysis and observations."
                                        },
                                        "last_update_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The Unix timestamp indicating the most recent update to the domain's information."
                                        },
                                        "last_analysis_stats": {
                                          "type": "object",
                                          "properties": {
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of analysis engines flagging the domain as malicious.",
                                              "title": "last analysis malicious"
                                            },
                                            "suspicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The count of engines raising suspicion about the domain.",
                                              "title": "last analysis suspicious"
                                            },
                                            "undetected": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that didn't detect any malicious or suspicious activity.",
                                              "title": "last analysis undetected"
                                            },
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The count of engines explicitly classifying the domain as safe.",
                                              "title": "last analysis harmless"
                                            },
                                            "timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that timed out during the analysis.",
                                              "title": "last analysis timeout"
                                            }
                                          },
                                          "description": "Statistics derived from the latest analysis of the domain."
                                        },
                                        "gti_assessment": {
                                          "type": "object",
                                          "properties": {
                                            "severity": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The severity level assigned by GTI.",
                                                  "title": "severity"
                                                }
                                              },
                                              "description": "The severity level assigned by GTI."
                                            },
                                            "threat_score": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The threat score assigned by GTI (0-100).",
                                                  "title": "threat score"
                                                }
                                              },
                                              "description": "The threat score assigned by GTI (0-100)."
                                            },
                                            "verdict": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The overall verdict from GTI.",
                                                  "title": "verdict"
                                                }
                                              },
                                              "description": "The overall verdict from GTI."
                                            },
                                            "contributing_factors": {
                                              "type": "object",
                                              "properties": {
                                                "mandiant_confidence_score": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The confidence score assigned by Mandiant (0-100)."
                                                },
                                                "normalised_categories": {
                                                  "type": "array",
                                                  "items": {
                                                    "type": "string"
                                                  },
                                                  "description": "Normalized categories associated with the IP address."
                                                },
                                                "pervasive_indicator": {
                                                  "type": "boolean",
                                                  "description": "Indicates if the IP address is a pervasive indicator."
                                                },
                                                "safebrowsing_verdict": {
                                                  "type": "string",
                                                  "description": "The verdict from Google Safe Browsing."
                                                }
                                              },
                                              "description": "Factors contributing to the GTI assessment."
                                            },
                                            "description": {
                                              "type": "string",
                                              "description": "A description of the GTI assessment."
                                            }
                                          },
                                          "description": "Google Threat Intelligence (GTI) assessment of the IP address."
                                        }
                                      },
                                      "description": "attributes"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-get_domain')]",
                        "parameters": [
                          {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-summary": "Domain name",
                            "description": "Domain to obtain the report",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "in": "header",
                            "name": "x-tool",
                            "type": "string",
                            "required": true,
                            "default": "MSFTSentinel"
                          }
                        ]
                      }
                    },
                    "/urls/{id}": {
                      "get": {
                        "summary": "Get URL Report",
                        "description": "Retrieve analysis and reputation information about a specific URL.",
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "string",
                                      "description": "The id of the url"
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "The type of object being analyzed"
                                    },
                                    "links": {
                                      "type": "object",
                                      "properties": {
                                        "self": {
                                          "type": "string",
                                          "description": "Url to retrieve this url report"
                                        }
                                      },
                                      "description": "Links to related resources"
                                    },
                                    "attributes": {
                                      "type": "object",
                                      "properties": {
                                        "last_final_url": {
                                          "type": "string",
                                          "description": "The final URL after any redirects."
                                        },
                                        "total_votes": {
                                          "type": "object",
                                          "properties": {
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "Number of votes indicating the URL is safe.",
                                              "title": "total votes harmless"
                                            },
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "Number of votes indicating the URL is harmful.",
                                              "title": "total votes malicious"
                                            }
                                          },
                                          "description": "The breakdown of votes from the Google Threat Intelligence community on whether the URL is considered harmless or malicious."
                                        },
                                        "tags": {
                                          "type": "array",
                                          "description": "Community-assigned tags providing additional context or categorization for the URL."
                                        },
                                        "times_submitted": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The total number of times this URL has been submitted to Google Threat Intelligence for analysis."
                                        },
                                        "last_modification_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date (in Unix timestamp format) when the URL report was last modified."
                                        },
                                        "reputation": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "A score ranging from -100 to 100, representing the URL's reputation based on various factors and community assessments."
                                        },
                                        "last_analysis_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date (in Unix timestamp format) when the last analysis of the URL was performed."
                                        },
                                        "last_analysis_stats": {
                                          "type": "object",
                                          "properties": {
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that detected the URL as malicious.",
                                              "title": "last analysis malicious"
                                            },
                                            "suspicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that flagged the URL as suspicious.",
                                              "title": "last analysis suspicious"
                                            },
                                            "undetected": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that did not detect any threats in the URL.",
                                              "title": "last analysis undetected"
                                            },
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that explicitly classified the URL as harmless.",
                                              "title": "last analysis harmless"
                                            },
                                            "timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that timed out during the analysis.",
                                              "title": "last analysis timeout"
                                            }
                                          },
                                          "description": "A summary of the results from the most recent analysis of the URL by different antivirus engines."
                                        },
                                        "last_submission_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "he date (in Unix timestamp format) when the URL was last submitted for analysis."
                                        },
                                        "url": {
                                          "type": "string",
                                          "description": "The actual URL that was analyzed."
                                        },
                                        "first_submission_date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date (in Unix timestamp format) of the very first time this URL was submitted to Google Threat Intelligence."
                                        },
                                        "title": {
                                          "type": "string",
                                          "description": "The title or webpage name extracted from the URL"
                                        },
                                        "gti_assessment": {
                                          "type": "object",
                                          "properties": {
                                            "severity": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The severity level assigned by GTI.",
                                                  "title": "severity"
                                                }
                                              },
                                              "description": "The severity level assigned by GTI."
                                            },
                                            "threat_score": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The threat score assigned by GTI (0-100).",
                                                  "title": "threat score"
                                                }
                                              },
                                              "description": "The threat score assigned by GTI (0-100)."
                                            },
                                            "verdict": {
                                              "type": "object",
                                              "properties": {
                                                "value": {
                                                  "type": "string",
                                                  "description": "The overall verdict from GTI.",
                                                  "title": "verdict"
                                                }
                                              },
                                              "description": "The overall verdict from GTI."
                                            },
                                            "contributing_factors": {
                                              "type": "object",
                                              "properties": {
                                                "mandiant_confidence_score": {
                                                  "type": "integer",
                                                  "format": "int32",
                                                  "description": "The confidence score assigned by Mandiant (0-100)."
                                                },
                                                "normalised_categories": {
                                                  "type": "array",
                                                  "items": {
                                                    "type": "string"
                                                  },
                                                  "description": "Normalized categories associated with the IP address."
                                                },
                                                "pervasive_indicator": {
                                                  "type": "boolean",
                                                  "description": "Indicates if the IP address is a pervasive indicator."
                                                },
                                                "safebrowsing_verdict": {
                                                  "type": "string",
                                                  "description": "The verdict from Google Safe Browsing."
                                                }
                                              },
                                              "description": "Factors contributing to the GTI assessment."
                                            },
                                            "description": {
                                              "type": "string",
                                              "description": "A description of the GTI assessment."
                                            }
                                          },
                                          "description": "Google Threat Intelligence (GTI) assessment of the IP address."
                                        }
                                      },
                                      "description": "attributes"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-get_url')]",
                        "parameters": [
                          {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-summary": "URL id",
                            "description": "URL id to obtain the report",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "in": "header",
                            "name": "x-tool",
                            "type": "string",
                            "required": true,
                            "default": "MSFTSentinel"
                          }
                        ]
                      }
                    },
                    "/files/": {
                      "post": {
                        "summary": "Upload File",
                        "description": "Upload a file for analysis.",
                        "consumes": [
                          "multipart/form-data"
                        ],
                        "parameters": [
                          {
                            "in": "formData",
                            "name": "file",
                            "description": "The file to upload for analysis",
                            "required": true,
                            "type": "file",
                            "x-ms-summary": "File"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-post_file')]"
                      }
                    },
                    "/analyses/{id}": {
                      "get": {
                        "summary": "Retrieve information about a file or URL analysis",
                        "description": "Get the status and results of a file or URL analysis.",
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "string",
                                      "description": "The unique identifier for this analysis request."
                                    },
                                    "type": {
                                      "type": "string",
                                      "description": "Indicates the type of analysis performed, either \"file\" or \"url\"."
                                    },
                                    "links": {
                                      "type": "object",
                                      "properties": {
                                        "self": {
                                          "type": "string",
                                          "description": "The URL to retrieve the analysis information itself."
                                        },
                                        "item": {
                                          "type": "string",
                                          "description": "The URL to access the analyzed file or URL."
                                        }
                                      },
                                      "description": "Provides URLs related to the analysis."
                                    },
                                    "attributes": {
                                      "type": "object",
                                      "properties": {
                                        "stats": {
                                          "type": "object",
                                          "properties": {
                                            "malicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that flagged the item as malicious."
                                            },
                                            "suspicious": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that flagged the item as malicious."
                                            },
                                            "undetected": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that didn't detect any threats."
                                            },
                                            "harmless": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that explicitly classified the item as harmless."
                                            },
                                            "timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that timed out during the analysis."
                                            },
                                            "confirmed-timeout": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that experienced a confirmed timeout."
                                            },
                                            "failure": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that encountered an error during analysis."
                                            },
                                            "type-unsupported": {
                                              "type": "integer",
                                              "format": "int32",
                                              "description": "The number of engines that don't support analyzing this type of item."
                                            }
                                          },
                                          "description": "Summarizes the detection results from various antivirus engines."
                                        },
                                        "date": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "The date (in Unix timestamp format) when the analysis was completed."
                                        },
                                        "status": {
                                          "type": "string",
                                          "description": "The current status of the analysis."
                                        }
                                      },
                                      "description": "attributes"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-retrieve_url_file')]",
                        "parameters": [
                          {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-summary": "Id of the analysis",
                            "description": "Analysis id to obtain the report",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "in": "header",
                            "name": "x-tool",
                            "type": "string",
                            "required": true,
                            "default": "MSFTSentinel"
                          }
                        ]
                      }
                    },
                    "/urls": {
                      "post": {
                        "summary": "Analyse URL",
                        "description": "Submit a URL for analysis.",
                        "consumes": [
                          "multipart/form-data"
                        ],
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "type": {
                                      "type": "string",
                                      "description": "type"
                                    },
                                    "id": {
                                      "type": "string",
                                      "description": "id"
                                    }
                                  },
                                  "description": "data"
                                }
                              }
                            }
                          },
                          "default": {
                            "description": "default"
                          }
                        },
                        "operationId": "[[variables('_operationId-analyze_url')]",
                        "parameters": [
                          {
                            "name": "url",
                            "in": "formData",
                            "required": true,
                            "type": "string",
                            "description": "URL to scan",
                            "x-ms-summary": "URL",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "in": "header",
                            "name": "x-tool",
                            "type": "string",
                            "required": true,
                            "default": "MSFTSentinel"
                          }
                        ]
                      }
                    }
                  },
                  "securityDefinitions": {
                    "api_key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "x-apikey"
                    }
                  },
                  "security": [
                    {
                      "api_key": "[variables('TemplateEmptyArray')]"
                    }
                  ],
                  "tags": "[variables('TemplateEmptyArray')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "GTICustomConnector",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GoogleThreatIntelligence-IOCEnrichmentIncident Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "GoogleThreatIntelligence-IOCEnrichmentIncident",
              "type": "string"
            }
          },
          "variables": {
            "GoogleThreatIntelligenceConnectionName": "GoogleThreatIntelligence-CustomConnector",
            "AzureSentinelConnectionName": "GoogleThreatIntelligence-MicrosoftSentinelConnection",
            "connection-2": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.8",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "For_each_IP": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Get_IP_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/ip_addresses/@{encodeURIComponent(item()?['Address'])}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Ip": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI IP Report</h2><p class=\"editor-paragraph\"><br><b><strong class=\"editor-text-bold\">IP:</strong></b> @{body('Get_IP_Report')?['data']?['id']}<br><b><strong class=\"editor-text-bold\">Reputation is:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['reputation']}</p><h3 class=\"editor-heading-h3\">GTI Assessment</h3><p class=\"editor-paragraph\"><br>- <b><strong class=\"editor-text-bold\">Score:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>- <b><strong class=\"editor-text-bold\">Verdict:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}<br>- <b><strong class=\"editor-text-bold\">Severity:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p><br>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_IP_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "path": "/entities/ip"
                      }
                    },
                    "Entities_-_Get_FileHashes": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "path": "/entities/filehash"
                      }
                    },
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "path": "/entities/url"
                      }
                    },
                    "For_each_File": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_FileHashes')?['Filehashes']",
                      "actions": {
                        "Get_File_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/files/@{encodeURIComponent(item()?['Value'])}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Hash": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI File Report</h2><p class=\"editor-paragraph\"><br>Hash: @{body('Get_File_Report')?['data']?['id']}<br>Reputation is: @{body('Get_File_Report')?['data']?['attributes']?['reputation']}</p><h3 class=\"editor-heading-h3\"><br>GTI Assessment</h3><p class=\"editor-paragraph\"><br>-Score: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>-Verdict: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}<br>-Severity: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p><br>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_File_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_FileHashes": [
                          "Succeeded"
                        ]
                      }
                    },
                    "For_each_Url": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Get_URL_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/urls/@{encodeURIComponent(replace(base64(item()?['Url']),'=',''))}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Url": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI URL Report</h2><p class=\"editor-paragraph\"><br>URL: @{body('Get_URL_Report')?['data']?['attributes']?['url']}<br>ID: @{body('Get_URL_Report')?['data']?['id']}<br>Suspicious: <br>Malicious: </p><h3 class=\"editor-heading-h3\"><br>Gti Assessment</h3><p class=\"editor-paragraph\"><br>- Score: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>- Severity: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}<br>- Verdict: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}</p>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_URL_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      }
                    },
                    "For_each_Domain": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_DNS')?['Dnsresolutions']",
                      "actions": {
                        "Get_Domain_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/domains/@{encodeURIComponent(item()?['DomainName'])}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Domain": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI Domain Report</h2><p class=\"editor-paragraph\"><br>Domain: @{body('Get_Domain_Report')?['data']?['id']}<br>Reputation is: @{body('Get_Domain_Report')?['data']?['attributes']?['reputation']}</p><h3 class=\"editor-heading-h3\"><br>GTI Assessment</h3><p class=\"editor-paragraph\"><br>- Score: @{body('Get_Domain_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>- Verdict: @{body('Get_Domain_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}<br>- Severity: @{body('Get_Domain_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_Domain_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_DNS": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Entities_-_Get_DNS": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "path": "/entities/dnsresolution"
                      }
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "googlethreatintelligence": {
                        "id": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('GoogleThreatIntelligenceConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('GoogleThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ],
          "metadata": {
            "title": "Google Threat Intelligence - IOC Enrichment",
            "description": "This playbook will enrich IP, Hash, URL & Domain entities found in incidents.",
            "prerequisites": [
              "You will need to register to Google Threat Intelligence for an API key"
            ],
            "postDeployment": [
              "After deployment, attach this playbook to an **automation rule** so it runs when the incident is created."
            ],
            "lastUpdateTime": "2024-11-15T00:00:00Z",
            "entities": [
              "ip",
              "url",
              "dnsresolution",
              "filehash"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "IOC Enrichment - Google Threat Intelligence report",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "GoogleThreatIntelligence-IOCEnrichmentIncident",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GoogleThreatIntelligence-IOCEnrichmentAlert Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "GoogleThreatIntelligence-IOCEnrichmentAlert",
              "type": "string"
            }
          },
          "variables": {
            "GoogleThreatIntelligenceConnectionName": "GoogleThreatIntelligence-Connector",
            "AzureSentinelConnectionName": "GoogleThreatIntelligence-MicrosoftSentinelConnection",
            "connection-2": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.8",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Microsoft_Sentinel_alert": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "path": "/subscribe"
                      }
                    }
                  },
                  "actions": {
                    "Alert_-_Get_incident": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/Incidents/subscriptions/@{encodeURIComponent(triggerBody()?['WorkspaceSubscriptionId'])}/resourceGroups/@{encodeURIComponent(triggerBody()?['WorkspaceResourceGroup'])}/workspaces/@{encodeURIComponent(triggerBody()?['WorkspaceId'])}/alerts/@{encodeURIComponent(triggerBody()?['SystemAlertId'])}"
                      }
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['Entities']",
                        "path": "/entities/ip"
                      },
                      "runAfter": {
                        "Alert_-_Get_incident": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Entities_-_Get_FileHashes": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['Entities']",
                        "path": "/entities/filehash"
                      },
                      "runAfter": {
                        "Alert_-_Get_incident": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['Entities']",
                        "path": "/entities/url"
                      },
                      "runAfter": {
                        "Alert_-_Get_incident": [
                          "Succeeded"
                        ]
                      }
                    },
                    "For_each_IP": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Get_IP_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/ip_addresses/@{encodeURIComponent(item()?['Address'])}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Ip": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@body('Alert_-_Get_incident')?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI IP Report</h2><p class=\"editor-paragraph\"><br><b><strong class=\"editor-text-bold\">IP:</strong></b> @{body('Get_IP_Report')?['data']?['id']}<br><b><strong class=\"editor-text-bold\">Reputation is:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['reputation']}</p><h3 class=\"editor-heading-h3\">GTI Assessment</h3><p class=\"editor-paragraph\"><br>- <b><strong class=\"editor-text-bold\">Score:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>- <b><strong class=\"editor-text-bold\">Verdict:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}<br>- <b><strong class=\"editor-text-bold\">Severity:</strong></b> @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p><br>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_IP_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      }
                    },
                    "For_each_File": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_FileHashes')?['Filehashes']",
                      "actions": {
                        "Get_File_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/files/@{encodeURIComponent(item()?['Value'])}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Hash": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@body('Alert_-_Get_incident')?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI File Report</h2><p class=\"editor-paragraph\"><br>Hash: @{body('Get_File_Report')?['data']?['id']}<br>Reputation is: @{body('Get_File_Report')?['data']?['attributes']?['reputation']}</p><h3 class=\"editor-heading-h3\"><br>GTI Assessment</h3><p class=\"editor-paragraph\"><br>-Score: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>-Verdict: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}<br>-Severity: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p><br>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_File_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_FileHashes": [
                          "Succeeded"
                        ]
                      }
                    },
                    "For_each_Url-copy": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Get_URL_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/urls/@{encodeURIComponent(replace(base64(item()?['Url']),'=',''))}"
                          }
                        },
                        "Add_comment_to_incident_(V3)_Url": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@body('Alert_-_Get_incident')?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI URL Report</h2><p class=\"editor-paragraph\"><br>URL: @{body('Get_URL_Report')?['data']?['attributes']?['url']}<br>ID: @{body('Get_URL_Report')?['data']?['id']}<br>Suspicious: <br>Malicious: </p><h3 class=\"editor-heading-h3\"><br>Gti Assessment</h3><p class=\"editor-paragraph\"><br>- Score: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}<br>- Severity: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}<br>- Verdict: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}</p>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_URL_Report": [
                              "Succeeded"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      }
                    },
                    "For_each_Domain": {
                      "type": "Foreach",
                      "foreach": "@body('Entities_-_Get_DNS')?['Dnsresolutions']",
                      "actions": {
                        "Add_comment_to_incident_(V3)_Domain": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@body('Alert_-_Get_incident')?['id']",
                              "message": "<h2 class=\"editor-heading-h2\">GTI Domain Report</h2><p class=\"editor-paragraph\"><br>Domain: <br>Reputation is: </p><h3 class=\"editor-heading-h3\"><br>GTI Assessment</h3><p class=\"editor-paragraph\"><br>- Score: <br>- Verdict: <br>- Severity: </p>"
                            },
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Get_Domain_Report": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Get_Domain_Report": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/domains/@{encodeURIComponent(item()?['DomainName'])}"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_DNS": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Entities_-_Get_DNS": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "body": "@triggerBody()?['Entities']",
                        "path": "/entities/dnsresolution"
                      },
                      "runAfter": {
                        "Alert_-_Get_incident": [
                          "Succeeded"
                        ]
                      }
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "googlethreatintelligence": {
                        "id": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('GoogleThreatIntelligenceConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('GoogleThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ],
          "metadata": {
            "title": "Google Threat Intelligence - IOC Enrichment",
            "description": "This playbook will enrich IP, Hash, URL & Domain entities found in alerts.",
            "prerequisites": [
              "You will need to register to Google Threat Intelligence for an API key"
            ],
            "postDeployment": [
              ""
            ],
            "lastUpdateTime": "2024-11-15T00:00:00Z",
            "entities": [
              "ip",
              "url",
              "dnsresolution",
              "filehash"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "IOC Enrichment - Google Threat Intelligence report",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "GoogleThreatIntelligence-IOCEnrichmentAlert",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GoogleThreatIntelligence-IOCEnrichmentIP Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "GoogleThreatIntelligence-IOCEnrichmentIP",
              "type": "string"
            }
          },
          "variables": {
            "GoogleThreatIntelligenceConnectionName": "GoogleThreatIntelligence-Connector",
            "AzureSentinelConnectionName": "GoogleThreatIntelligence-MicrosoftSentinelConnection",
            "connection-2": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.8",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Microsoft_Sentinel_entity": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "path": "/entity/@{encodeURIComponent('IP')}"
                      }
                    }
                  },
                  "actions": {
                    "Get_IP_Report": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/ip_addresses/@{encodeURIComponent(triggerBody()?['Entity']?['properties']?['Address'])}"
                      }
                    },
                    "Condition": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "not": {
                              "equals": [
                                "@triggerBody()?['IncidentArmID']",
                                "@null"
                              ]
                            }
                          }
                        ]
                      },
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['IncidentArmID']",
                              "message": "<h1 class=\"editor-heading-h1\"><u><b><strong style=\"font-size: 18px;\" class=\"editor-text-bold editor-text-underline\">GTI IP Report</strong></b></u></h1><p class=\"editor-paragraph\">Id: @{body('Get_IP_Report')?['data']?['id']}</p><p class=\"editor-paragraph\">Reputation is: @{body('Get_IP_Report')?['data']?['attributes']?['reputation']}</p><p class=\"editor-paragraph\">Harmless: @{body('Get_IP_Report')?['data']?['attributes']?['last_analysis_stats']?['harmless']}</p><p class=\"editor-paragraph\">Malicious: @{body('Get_IP_Report')?['data']?['attributes']?['last_analysis_stats']?['malicious']}</p><p class=\"editor-paragraph\">Suspicious: @{body('Get_IP_Report')?['data']?['attributes']?['last_analysis_stats']?['suspicious']}</p><p class=\"editor-paragraph\">Timeout: @{body('Get_IP_Report')?['data']?['attributes']?['last_analysis_stats']?['timeout']}</p><p class=\"editor-paragraph\">Undetected: @{body('Get_IP_Report')?['data']?['attributes']?['last_analysis_stats']?['undetected']}</p><p class=\"editor-paragraph\"></p><br><p class=\"editor-paragraph\">Country: @{body('Get_IP_Report')?['data']?['attributes']?['country']}</p><p class=\"editor-paragraph\">Continent: @{body('Get_IP_Report')?['data']?['attributes']?['continent']}</p><p class=\"editor-paragraph\">Owner: @{body('Get_IP_Report')?['data']?['attributes']?['as_owner']}</p><p class=\"editor-paragraph\">Total votes harmless: @{body('Get_IP_Report')?['data']?['attributes']?['total_votes']?['harmless']}</p><p class=\"editor-paragraph\">Total votes malicious: @{body('Get_IP_Report')?['data']?['attributes']?['total_votes']?['malicious']}</p><h2 class=\"editor-heading-h2\"><u><span style=\"font-size: 15px;\" class=\"editor-text-underline\">GTI Assessment</span></u></h2><p class=\"editor-paragraph\"><b><strong class=\"editor-text-bold\">-Score</strong></b>: @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}</p><p class=\"editor-paragraph\"><b><strong class=\"editor-text-bold\">-Verdict</strong></b>: @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}</p><p class=\"editor-paragraph\"><b><strong class=\"editor-text-bold\">-Severity</strong></b>: @{body('Get_IP_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p><br>"
                            },
                            "path": "/Incidents/Comment"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_IP_Report": [
                          "Succeeded"
                        ]
                      }
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "googlethreatintelligence": {
                        "id": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('GoogleThreatIntelligenceConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('GoogleThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ],
          "metadata": {
            "title": "Google Threat Intelligence - IP Enrichment",
            "description": "This playbook will enrich IP entities.",
            "prerequisites": [
              "You will need to register to Google Threat Intelligence for an API key"
            ],
            "postDeployment": [
              "You can trigger manually in entities"
            ],
            "lastUpdateTime": "2024-11-15T00:00:00Z",
            "entities": [
              "ip"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "IP Enrichment - Google Threat Intelligence report",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "GoogleThreatIntelligence-IOCEnrichmentIP",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GoogleThreatIntelligence-IOCEnrichmentURL Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "GoogleThreatIntelligence-IOCEnrichmentURL",
              "type": "string"
            }
          },
          "variables": {
            "GoogleThreatIntelligenceConnectionName": "GoogleThreatIntelligence-Connector",
            "AzureSentinelConnectionName": "GoogleThreatIntelligence-MicrosoftSentinelConnection",
            "connection-2": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.8",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Microsoft_Sentinel_entity": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "path": "/entity/@{encodeURIComponent('UrlEntity')}"
                      }
                    }
                  },
                  "actions": {
                    "Condition": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "not": {
                              "equals": [
                                "@triggerBody()?['IncidentArmID']",
                                "@null"
                              ]
                            }
                          }
                        ]
                      },
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['IncidentArmID']",
                              "message": "<h1 class=\"editor-heading-h1\"><u><b><strong class=\"editor-text-bold editor-text-underline\">GTI URL Report</strong></b></u></h1><p class=\"editor-paragraph\">URL: @{body('Get_URL_Report')?['data']?['attributes']?['url']}</p><p class=\"editor-paragraph\">ID: @{body('Get_URL_Report')?['data']?['id']}</p><p class=\"editor-paragraph\">Reputation is: @{body('Get_URL_Report')?['data']?['attributes']?['reputation']}</p><p class=\"editor-paragraph\">Harmless: @{body('Get_URL_Report')?['data']?['attributes']?['last_analysis_stats']?['harmless']}</p><p class=\"editor-paragraph\">Malicious: @{body('Get_URL_Report')?['data']?['attributes']?['last_analysis_stats']?['malicious']}</p><p class=\"editor-paragraph\">Suspicious: @{body('Get_URL_Report')?['data']?['attributes']?['last_analysis_stats']?['suspicious']}</p><p class=\"editor-paragraph\">Timeout: @{body('Get_URL_Report')?['data']?['attributes']?['last_analysis_stats']?['timeout']}</p><p class=\"editor-paragraph\">Undetected: @{body('Get_URL_Report')?['data']?['attributes']?['last_analysis_stats']?['undetected']}</p><p class=\"editor-paragraph\">Total votes harmless: @{body('Get_URL_Report')?['data']?['attributes']?['total_votes']?['harmless']}</p><p class=\"editor-paragraph\">Total votes malicious: @{body('Get_URL_Report')?['data']?['attributes']?['total_votes']?['malicious']}</p><h2 class=\"editor-heading-h2\"><u><span class=\"editor-text-underline\">GTI Assessment</span></u></h2><p class=\"editor-paragraph\">- Threat score: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}</p><p class=\"editor-paragraph\">- Verdict: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}</p><p class=\"editor-paragraph\">- Severity: @{body('Get_URL_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']} </p>"
                            },
                            "path": "/Incidents/Comment"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_URL_Report": [
                          "Succeeded"
                        ]
                      }
                    },
                    "Get_URL_Report": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/urls/@{encodeURIComponent(replace(base64(triggerBody()?['Entity']?['properties']?['Url']),'=',''))}"
                      }
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "googlethreatintelligence": {
                        "id": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('GoogleThreatIntelligenceConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('GoogleThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ],
          "metadata": {
            "title": "Google Threat Intelligence - URL Enrichment",
            "description": "This playbook will enrich URL entities.",
            "prerequisites": [
              "You will need to register to Google Threat Intelligence for an API key"
            ],
            "postDeployment": [
              "You can trigger manually in entities"
            ],
            "lastUpdateTime": "2024-11-15T00:00:00Z",
            "entities": [
              "url"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "URL Enrichment - Google Threat Intelligence report",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId5')]",
        "contentKind": "Playbook",
        "displayName": "GoogleThreatIntelligence-IOCEnrichmentURL",
        "contentProductId": "[variables('_playbookcontentProductId5')]",
        "id": "[variables('_playbookcontentProductId5')]",
        "version": "[variables('playbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GoogleThreatIntelligence-IOCEnrichmentFileHash Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion6')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "GoogleThreatIntelligence-IOCEnrichmentFileHash",
              "type": "string"
            }
          },
          "variables": {
            "GoogleThreatIntelligenceConnectionName": "GoogleThreatIntelligence-Connector",
            "AzureSentinelConnectionName": "GoogleThreatIntelligence-MicrosoftSentinelConnection",
            "connection-2": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.8",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Microsoft_Sentinel_entity": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "path": "/entity/@{encodeURIComponent('FileHash')}"
                      }
                    }
                  },
                  "actions": {
                    "Get_File_Report": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/files/@{encodeURIComponent(triggerBody()?['Entity']?['properties']?['Value'])}"
                      }
                    },
                    "Condition": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "not": {
                              "equals": [
                                "@triggerBody()?['IncidentArmID']",
                                "@null"
                              ]
                            }
                          }
                        ]
                      },
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['IncidentArmID']",
                              "message": "<h1 class=\"editor-heading-h1\"><u><b><strong style=\"font-size: 18px;\" class=\"editor-text-bold editor-text-underline\">GTI File Report</strong></b></u></h1><p class=\"editor-paragraph\">Hash: @{body('Get_File_Report')?['data']?['id']}</p><p class=\"editor-paragraph\">Reputation is: @{body('Get_File_Report')?['data']?['attributes']?['reputation']}</p><p class=\"editor-paragraph\">Harmless: @{body('Get_File_Report')?['data']?['attributes']?['last_analysis_stats']?['harmless']}</p><p class=\"editor-paragraph\">Malicious: @{body('Get_File_Report')?['data']?['attributes']?['last_analysis_stats']?['malicious']}</p><p class=\"editor-paragraph\">Suspicious: @{body('Get_File_Report')?['data']?['attributes']?['last_analysis_stats']?['suspicious']}</p><p class=\"editor-paragraph\">Timeout: @{body('Get_File_Report')?['data']?['attributes']?['last_analysis_stats']?['timeout']}</p><p class=\"editor-paragraph\">Undetected: @{body('Get_File_Report')?['data']?['attributes']?['last_analysis_stats']?['undetected']}</p><p class=\"editor-paragraph\">Total votes harmless: @{body('Get_File_Report')?['data']?['attributes']?['total_votes']?['harmless']} </p><p class=\"editor-paragraph\">Total votes malicious: @{body('Get_File_Report')?['data']?['attributes']?['total_votes']?['malicious']}</p><h2 class=\"editor-heading-h2\"><u><span style=\"font-size: 15px;\" class=\"editor-text-underline\">GTI Assessment</span></u></h2><p class=\"editor-paragraph\"><b><strong class=\"editor-text-bold\">-Score</strong></b>: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}</p><p class=\"editor-paragraph\"><b><strong class=\"editor-text-bold\">-Verdict</strong></b>: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}</p><p class=\"editor-paragraph\"><b><strong class=\"editor-text-bold\">-Severity</strong></b>: @{body('Get_File_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p><br>"
                            },
                            "path": "/Incidents/Comment"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_File_Report": [
                          "Succeeded"
                        ]
                      }
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "googlethreatintelligence": {
                        "id": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('GoogleThreatIntelligenceConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('GoogleThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId6'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId6')]",
                "contentId": "[variables('_playbookContentId6')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ],
          "metadata": {
            "title": "Google Threat Intelligence - FileHash Enrichment",
            "description": "This playbook will enrich FileHash entities.",
            "prerequisites": [
              "You will need to register to Google Threat Intelligence for an API key"
            ],
            "postDeployment": [
              "You can trigger manually in entities"
            ],
            "lastUpdateTime": "2024-11-15T00:00:00Z",
            "entities": [
              "filehash"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "FileHash Enrichment - Google Threat Intelligence report",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId6')]",
        "contentKind": "Playbook",
        "displayName": "GoogleThreatIntelligence-IOCEnrichmentFileHash",
        "contentProductId": "[variables('_playbookcontentProductId6')]",
        "id": "[variables('_playbookcontentProductId6')]",
        "version": "[variables('playbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "GoogleThreatIntelligence-IOCEnrichmentDomain Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion7')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "GoogleThreatIntelligence-IOCEnrichmentDomain",
              "type": "string"
            }
          },
          "variables": {
            "GoogleThreatIntelligenceConnectionName": "GoogleThreatIntelligence-Connector",
            "AzureSentinelConnectionName": "GoogleThreatIntelligence-MicrosoftSentinelConnection",
            "connection-2": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.8",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Microsoft_Sentinel_entity": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "path": "/entity/@{encodeURIComponent('DNS')}"
                      }
                    }
                  },
                  "actions": {
                    "Get_Domain_Report": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['googlethreatintelligence']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/domains/@{encodeURIComponent(triggerBody()?['Entity']?['properties']?['DomainName'])}"
                      }
                    },
                    "Condition": {
                      "type": "If",
                      "expression": {
                        "and": [
                          {
                            "not": {
                              "equals": [
                                "@triggerBody()?['IncidentArmID']",
                                "@null"
                              ]
                            }
                          }
                        ]
                      },
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "body": {
                              "incidentArmId": "@triggerBody()?['IncidentArmID']",
                              "message": "<h1 class=\"editor-heading-h1\"><u><b><strong class=\"editor-text-bold editor-text-underline\">GTI Domain Report</strong></b></u></h1><p class=\"editor-paragraph\">Domain: @{body('Get_Domain_Report')?['data']?['id']}</p><p class=\"editor-paragraph\">Reputation is: @{body('Get_Domain_Report')?['data']?['attributes']?['reputation']}</p><p class=\"editor-paragraph\">Harmless: @{body('Get_Domain_Report')?['data']?['attributes']?['last_analysis_stats']?['harmless']}</p><p class=\"editor-paragraph\">Malicious: @{body('Get_Domain_Report')?['data']?['attributes']?['last_analysis_stats']?['malicious']}</p><p class=\"editor-paragraph\">Suspicious: @{body('Get_Domain_Report')?['data']?['attributes']?['last_analysis_stats']?['suspicious']}</p><p class=\"editor-paragraph\">Timeout: @{body('Get_Domain_Report')?['data']?['attributes']?['last_analysis_stats']?['timeout']}</p><p class=\"editor-paragraph\">Undetected: @{body('Get_Domain_Report')?['data']?['attributes']?['last_analysis_stats']?['undetected']}</p><p class=\"editor-paragraph\">Total votes harmless: @{body('Get_Domain_Report')?['data']?['attributes']?['total_votes']?['harmless']}</p><p class=\"editor-paragraph\">Total votes malicious: @{body('Get_Domain_Report')?['data']?['attributes']?['total_votes']?['malicious']}</p><h2 class=\"editor-heading-h2\"><u><span class=\"editor-text-underline\">GTI Assessment</span></u></h2><p class=\"editor-paragraph\">- Threat score: @{body('Get_Domain_Report')?['data']?['attributes']?['gti_assessment']?['threat_score']?['value']}</p><p class=\"editor-paragraph\">- Verdict: @{body('Get_Domain_Report')?['data']?['attributes']?['gti_assessment']?['verdict']?['value']}</p><p class=\"editor-paragraph\">- Severity: @{body('Get_Domain_Report')?['data']?['attributes']?['gti_assessment']?['severity']?['value']}</p>"
                            },
                            "path": "/Incidents/Comment"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_Domain_Report": [
                          "Succeeded"
                        ]
                      }
                    }
                  },
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "googlethreatintelligence": {
                        "id": "[[concat(resourceGroup().id,'/providers/Microsoft.Web/customApis/GoogleThreatIntelligence-CustomConnector')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GoogleThreatIntelligenceConnectionName'))]",
                        "connectionName": "[[variables('GoogleThreatIntelligenceConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('GoogleThreatIntelligenceConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId7'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId7')]",
                "contentId": "[variables('_playbookContentId7')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Google Threat Intelligence",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Google"
                },
                "support": {
                  "name": "Google",
                  "email": "contact@virustotal.com",
                  "tier": "Partner",
                  "link": "https://www.virustotal.com/gui/contact-us"
                }
              }
            }
          ],
          "metadata": {
            "title": "Google Threat Intelligence - Domain Enrichment",
            "description": "This playbook will enrich Domain entities.",
            "prerequisites": [
              "You will need to register to Google Threat Intelligence for an API key"
            ],
            "postDeployment": [
              "You can trigger manually in entities"
            ],
            "lastUpdateTime": "2024-11-15T00:00:00Z",
            "entities": [
              "dnsresolution"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Domain Enrichment - Google Threat Intelligence report",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId7')]",
        "contentKind": "Playbook",
        "displayName": "GoogleThreatIntelligence-IOCEnrichmentDomain",
        "contentProductId": "[variables('_playbookcontentProductId7')]",
        "id": "[variables('_playbookcontentProductId7')]",
        "version": "[variables('playbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Google Threat Intelligence",
        "publisherDisplayName": "Google",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Google%20Threat%20Intelligence/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>This Google Threat Intelligence Solution contains Playbooks that can help enrich incident information with threat information and intelligence for IPs, file hashes and URLs from Google Threat Intelligence. Enriched information can help drive focused investigations in Security Operations.</p>\n<p><strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 6</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/GoogleThreatIntelligence.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Google Threat Intelligence",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Google"
        },
        "support": {
          "name": "Google",
          "email": "contact@virustotal.com",
          "tier": "Partner",
          "link": "https://www.virustotal.com/gui/contact-us"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_GTICustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_GTI-EnrichIncident')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_GTI-EnrichAlert')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_GTI-EnrichIP')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_GTI-EnrichURL')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_GTI-EnrichFilehash')]",
              "version": "[variables('playbookVersion6')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_GTI-EnrichDomain')]",
              "version": "[variables('playbookVersion7')]"
            }
          ]
        },
        "firstPublishDate": "2024-10-26",
        "lastPublishDate": "2024-10-26",
        "providers": [
          "Google"
        ],
        "categories": {
          "domains": [
            "Security - Threat Intelligence"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
