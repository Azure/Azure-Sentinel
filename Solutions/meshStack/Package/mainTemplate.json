{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "meshcloud - support@meshcloud.io",
    "comments": "Solution template for meshStack"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "support@meshcloud.io",
    "_email": "[variables('email')]",
    "_solutionName": "meshStack",
    "_solutionVersion": "3.0.0",
    "solutionId": "meshcloudgmbh5353994.azure-sentinel-solution-meshstack",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "meshStackEventLogsDefinition",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "meshStackEventLogsDefinitionConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "meshStack Event Logs",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "meshStackEventLogsDefinition",
                  "title": "meshStack Event Logs",
                  "publisher": "meshcloud",
                  "descriptionMarkdown": "The meshStack Event Logs connector provides the capability to ingest meshStack platform events into Microsoft Sentinel. By connecting meshStack event logs into Microsoft Sentinel, you can view this data in workbooks, use it to create custom alerts, and improve your investigation process for cloud platform governance, audit, and compliance monitoring.",
                  "graphQueriesTableName": "meshStackEventLogs_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total events received",
                      "legend": "meshStack Event Logs",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All meshStack Event Logs",
                      "query": "{{graphQueriesTableName}}\n| take 10"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max(TimeGenerated)\n|where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors"
                    }
                  ],
                  "availability": {
                    "isPreview": true
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "meshStack OAuth2 API Key",
                        "description": "A valid meshStack API Key with the 'Admin: List Event Logs in any Workspace' permission is required. Create the API Key in the meshStack Admin Panel under Access Control > API Keys. The API Key provides OAuth2 credentials (Key ID as client_id and Key Secret as client_secret) for authentication. Note: The API Key is bound to a workspace but can access events from all workspaces."
                      },
                      {
                        "name": "meshStack Instance",
                        "description": "Access to a meshStack instance with the Events API enabled."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Enter your meshStack instance API URL and OAuth2 credentials from the API Key. The API URL format should be: `https://your-meshstack-instance.io`. Create an API Key in meshStack (Admin Panel > Access Control > API Keys) with the 'Admin: List Event Logs in any Workspace' permission. The API Key provides a **Key ID** (client_id) and **Key Secret** (client_secret) for OAuth2 authentication.",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "meshStack API URL",
                            "placeholder": "https://your-meshstack-instance.io",
                            "type": "text",
                            "name": "ApiUrl",
                            "validations": {
                              "required": true
                            }
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Client ID (Key ID)",
                            "placeholder": "Enter Key ID from API Key",
                            "type": "text",
                            "name": "ClientId",
                            "validations": {
                              "required": true
                            }
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "Client Secret (Key Secret)",
                            "placeholder": "Enter Key Secret from API Key",
                            "type": "password",
                            "name": "ClientSecret",
                            "validations": {
                              "required": true
                            }
                          }
                        },
                        {
                          "parameters": {
                            "label": "toggle",
                            "name": "toggle"
                          },
                          "type": "ConnectionToggleButton"
                        }
                      ],
                      "title": "Connect meshStack Event Logs to Microsoft Sentinel"
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "meshcloud",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "meshcloud GmbH",
                  "email": "support@meshcloud.io",
                  "tier": "Partner",
                  "link": "https://feedback.meshcloud.io"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "meshStackEventLogsDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-meshStackEventLogs_CL": {
                    "columns": [
                      {
                        "name": "metadata",
                        "type": "dynamic"
                      },
                      {
                        "name": "spec",
                        "type": "dynamic"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-meshStackEventLogs_CL"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source\n| extend metadata_parsed = parse_json(metadata)\n| extend spec_parsed = parse_json(spec)\n| extend TimeGenerated = todatetime(metadata_parsed['createdAt'])\n| extend author_parsed = spec_parsed['author']\n| extend workspaceRef_parsed = spec_parsed['workspaceRef']\n| extend EventTitle = tostring(spec_parsed['title'])\n| extend EventType = tostring(spec_parsed['eventType'])\n| extend EventDescription = tostring(spec_parsed['description'])\n| extend EventContent = spec_parsed['content']\n| extend AuthorIdentifier = tostring(author_parsed['identifier'])\n| extend AuthorType = tostring(author_parsed['authorType'])\n| extend WorkspaceName = tostring(workspaceRef_parsed['name'])\n| project-away metadata, metadata_parsed, spec, spec_parsed, author_parsed, workspaceRef_parsed",
                    "outputStream": "Custom-meshStackEventLogs_CL"
                  }
                ]
              }
            },
            {
              "name": "meshStackEventLogs_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "meshStackEventLogs_CL",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "Datetime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "EventTitle",
                      "type": "string",
                      "description": "Event title"
                    },
                    {
                      "name": "EventDescription",
                      "type": "string",
                      "description": "Event description"
                    },
                    {
                      "name": "EventType",
                      "type": "string",
                      "description": "Event type identifier"
                    },
                    {
                      "name": "WorkspaceName",
                      "type": "string",
                      "description": "meshStack workspace name"
                    },
                    {
                      "name": "EventContent",
                      "type": "dynamic",
                      "description": "Event content with additional details"
                    },
                    {
                      "name": "AuthorIdentifier",
                      "type": "string",
                      "description": "Author identifier extracted from author object"
                    },
                    {
                      "name": "AuthorType",
                      "type": "string",
                      "description": "Author type extracted from author object"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "meshStackEventLogsDefinition",
          "title": "meshStack Event Logs",
          "publisher": "meshcloud",
          "descriptionMarkdown": "The meshStack Event Logs connector provides the capability to ingest meshStack platform events into Microsoft Sentinel. By connecting meshStack event logs into Microsoft Sentinel, you can view this data in workbooks, use it to create custom alerts, and improve your investigation process for cloud platform governance, audit, and compliance monitoring.",
          "graphQueriesTableName": "meshStackEventLogs_CL",
          "graphQueries": [
            {
              "metricName": "Total events received",
              "legend": "meshStack Event Logs",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All meshStack Event Logs",
              "query": "{{graphQueriesTableName}}\n| take 10"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n|summarize Time = max(TimeGenerated)\n|where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors"
            }
          ],
          "availability": {
            "isPreview": true
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "meshStack OAuth2 API Key",
                "description": "A valid meshStack API Key with the 'Admin: List Event Logs in any Workspace' permission is required. Create the API Key in the meshStack Admin Panel under Access Control > API Keys. The API Key provides OAuth2 credentials (Key ID as client_id and Key Secret as client_secret) for authentication. Note: The API Key is bound to a workspace but can access events from all workspaces."
              },
              {
                "name": "meshStack Instance",
                "description": "Access to a meshStack instance with the Events API enabled."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Enter your meshStack instance API URL and OAuth2 credentials from the API Key. The API URL format should be: `https://your-meshstack-instance.io`. Create an API Key in meshStack (Admin Panel > Access Control > API Keys) with the 'Admin: List Event Logs in any Workspace' permission. The API Key provides a **Key ID** (client_id) and **Key Secret** (client_secret) for OAuth2 authentication.",
              "instructions": [
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "meshStack API URL",
                    "placeholder": "https://your-meshstack-instance.io",
                    "type": "text",
                    "name": "ApiUrl",
                    "validations": {
                      "required": true
                    }
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Client ID (Key ID)",
                    "placeholder": "Enter Key ID from API Key",
                    "type": "text",
                    "name": "ClientId",
                    "validations": {
                      "required": true
                    }
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "Client Secret (Key Secret)",
                    "placeholder": "Enter Key Secret from API Key",
                    "type": "password",
                    "name": "ClientSecret",
                    "validations": {
                      "required": true
                    }
                  }
                },
                {
                  "parameters": {
                    "label": "toggle",
                    "name": "toggle"
                  },
                  "type": "ConnectionToggleButton"
                }
              ],
              "title": "Connect meshStack Event Logs to Microsoft Sentinel"
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "meshcloud",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "meshcloud GmbH",
          "email": "support@meshcloud.io",
          "tier": "Partner",
          "link": "https://feedback.meshcloud.io"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "meshStack Event Logs",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "meshStack Event Logs",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "ApiUrl": {
              "defaultValue": "ApiUrl",
              "type": "securestring",
              "minLength": 1
            },
            "ClientId": {
              "defaultValue": "ClientId",
              "type": "securestring",
              "minLength": 1
            },
            "ClientSecret": {
              "defaultValue": "ClientSecret",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "meshcloud",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "meshcloud GmbH",
                  "email": "support@meshcloud.io",
                  "tier": "Partner",
                  "link": "https://feedback.meshcloud.io"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'meshStackEventLogsRequest', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "meshStackEventLogsDefinition",
                "dcrConfig": {
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]",
                  "streamName": "Custom-meshStackEventLogs_CL"
                },
                "dataType": "meshStackEventLogs_CL",
                "addOnAttributes": {
                  "ApiUrl": "[[parameters('ApiUrl')]"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$._embedded.meshEventLogs[*]"
                  ],
                  "format": "json"
                },
                "paging": {
                  "pagingType": "CountBasedPaging",
                  "pageNumberParaName": "page",
                  "zeroBasedIndexing": true,
                  "totalResultsJsonPath": "$.page.totalElements",
                  "pageNumberJsonPath": "$.page.number",
                  "pageCountJsonPath": "$.page.totalPages"
                },
                "auth": {
                  "type": "OAuth2",
                  "ClientId": "[[parameters('ClientId')]",
                  "ClientSecret": "[[parameters('ClientSecret')]",
                  "GrantType": "client_credentials",
                  "TokenEndpoint": "[[concat(parameters('ApiUrl'),'/api/login')]",
                  "TokenEndpointHeaders": {
                    "Content-Type": "application/x-www-form-urlencoded"
                  },
                  "TokenEndpointQueryParameters": {}
                },
                "request": {
                  "apiEndpoint": "[[concat(parameters('ApiUrl'),'/api/meshobjects/mesheventlogs')]",
                  "rateLimitQPS": 10,
                  "queryWindowInMin": 5,
                  "httpMethod": "GET",
                  "queryTimeFormat": "yyyy-MM-dd'T'HH:mm:ss'Z'",
                  "retryCount": 2,
                  "timeoutInSeconds": 30,
                  "headers": {
                    "Accept": "application/vnd.meshcloud.api.mesheventlog.v1-preview.hal+json",
                    "User-Agent": "Azure-Sentinel"
                  },
                  "queryParameters": {
                    "size": 500,
                    "from": "{_QueryWindowStartTime}",
                    "until": "{_QueryWindowEndTime}"
                  }
                },
                "isActive": true
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "meshStack",
        "publisherDisplayName": "meshcloud GmbH",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/meshStack/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The meshStack solution for Microsoft Sentinel enables you to ingest meshStack Event Logs into Microsoft Sentinel.</p>\n<p><strong>Data Connectors:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/meshcloud.svg\" width=\"400px\" height=\"40px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "meshStack",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "meshcloud",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "meshcloud GmbH",
          "email": "support@meshcloud.io",
          "tier": "Partner",
          "link": "https://feedback.meshcloud.io"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            }
          ]
        },
        "firstPublishDate": "2025-12-15",
        "providers": [
          "meshcloud GmbH"
        ],
        "categories": {
          "domains": [
            "Application",
            "IT Operations"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
