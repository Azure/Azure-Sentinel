[
    {
        "name": "meshStackEventLogsDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-meshStackEventLogs_CL": {
                    "columns": [
                        {
                            "name": "metadata",
                            "type": "dynamic"
                        },
                        {
                            "name": "spec",
                            "type": "dynamic"
                        }
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-meshStackEventLogs_CL"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                    "transformKql": "source\n| extend metadata_parsed = parse_json(metadata)\n| extend spec_parsed = parse_json(spec)\n| extend TimeGenerated = todatetime(metadata_parsed['createdAt'])\n| extend author_parsed = spec_parsed['author']\n| extend workspaceRef_parsed = spec_parsed['workspaceRef']\n| extend EventTitle = tostring(spec_parsed['title'])\n| extend EventType = tostring(spec_parsed['eventType'])\n| extend EventDescription = tostring(spec_parsed['description'])\n| extend EventContent = spec_parsed['content']\n| extend AuthorIdentifier = tostring(author_parsed['identifier'])\n| extend AuthorType = tostring(author_parsed['authorType'])\n| extend WorkspaceName = tostring(workspaceRef_parsed['name'])\n| project-away metadata, metadata_parsed, spec, spec_parsed, author_parsed, workspaceRef_parsed",
                    "outputStream": "Custom-meshStackEventLogs_CL"
                }
            ]
        }
    }
]
