[
    {
        "name": "GCPDNSDCR",
        "apiVersion": "2021-09-01-preview",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "{{location}}",
        "properties": {
            "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
            "streamDeclarations": {
                "Custom-GCPDNS": {
                    "columns": [
<<<<<<< Updated upstream
                        {
                            "name": "insertId",
                            "type": "string"
                        },
                        {
                            "name": "logName",
                            "type": "string"
                        },
                        {
                            "name": "protoPayload",
                            "type": "string"
                        },
                        {
                            "name": "receiveTimestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "resource",
                            "type": "string"
                        },
                        {
                            "name": "severity",
                            "type": "string"
                        },
                        {
                            "name": "timestamp",
                            "type": "datetime"
                        },
                        {
                            "name": "MG",
                            "type": "string"
                        },
                        {
                            "name": "ManagementGroupName",
                            "type": "string"
                        },
                        {
                            "name": "Computer",
                            "type": "string"
                        },
                        {
                            "name": "RawData",
                            "type": "string"
                        }
=======
                        { "name": "insertId", "type": "string" },
                        { "name": "logName", "type": "string" },
                        { "name": "protoPayload", "type": "string" },
                        { "name": "receiveTimestamp", "type": "datetime" },
                        { "name": "resource", "type": "string" },
                        { "name": "severity", "type": "string" },
                        { "name": "timestamp", "type": "datetime" },
                        { "name": "MG", "type": "string" },
                        { "name": "ManagementGroupName", "type": "string" },
                        { "name": "Computer", "type": "string" },
                        { "name": "RawData", "type": "string" },
                        { "name": "payload_authenticationInfo_principalEmail_s", "type": "string" },
                        { "name": "payload_methodName_s", "type": "string" },
                        { "name": "payload_serviceName_s", "type": "string" },
                        { "name": "resource_labels_location_s", "type": "string" },
                        { "name": "resource_labels_project_id_s", "type": "string" },
                        { "name": "resource_labels_zone_name_s", "type": "string" },
                        { "name": "resource_type_s", "type": "string" },
                        { "name": "payload_requestMetadata_callerIp_s", "type": "string" },
                        { "name": "payload_authorizationInfo_s", "type": "string" },
                        { "name": "payload_resourceName_s", "type": "string" },
                        { "name": "payload_request_project_s", "type": "string" },
                        { "name": "payload_request_managedZone_s", "type": "string" },
                        { "name": "payload__type_s", "type": "string" },
                        { "name": "payload_request__type_s", "type": "string" },
                        { "name": "payload_request_change_deletions_s", "type": "string" },
                        { "name": "payload_response__type_s", "type": "string" },
                        { "name": "payload_response_change_deletions_s", "type": "string" },
                        { "name": "payload_response_change_status_s", "type": "string" },
                        { "name": "payload_response_change_id_s", "type": "string" },
                        { "name": "payload_authenticationInfo_principalSubject_s", "type": "string" },
                        { "name": "payload_requestMetadata_callerSuppliedUserAgent_s", "type": "string" },
                        { "name": "payload_request_name_s", "type": "string" },
                        { "name": "payload_request_type_s", "type": "string" },
                        { "name": "payload_request_change_additions_s", "type": "string" },
                        { "name": "payload_response_change_additions_s", "type": "string" }
>>>>>>> Stashed changes
                    ]
                }
            },
            "destinations": {
                "logAnalytics": [
                    {
                        "workspaceResourceId": "{{workspaceResourceId}}",
                        "name": "clv2ws1"
                    }
                ]
            },
            "dataFlows": [
                {
                    "streams": [
                        "Custom-GCPDNS"
                    ],
                    "destinations": [
                        "clv2ws1"
                    ],
                    "transformKql": "source
                    | extend protoPayloadDynamic = parse_json(protoPayload)
                    | extend resourceDynamic = parse_json(resource)
                    | extend insert_id_s = insertId
                    | extend log_name_s = logName
                    | extend severity_s = severity
                    | extend timestamp_t = timestamp
                    | extend payload_authenticationInfo_principalEmail_s = tostring(protoPayloadDynamic['authenticationInfo']['principalEmail'])
                    | extend payload_methodName_s = tostring(protoPayloadDynamic['methodName'])
                    | extend payload_serviceName_s = tostring(protoPayloadDynamic['serviceName'])
                    | extend resource_labels_location_s = tostring(resourceDynamic['labels']['location'])
                    | extend resource_labels_project_id_s = tostring(resourceDynamic['labels']['project_id'])
                    | extend resource_labels_zone_name_s = tostring(resourceDynamic['labels']['zone_name'])
<<<<<<< Updated upstream
                    | extend TimeGenerated = receiveTimestamp| extend SourceSystem = tostring('CloudDNSAPI')
=======
                    | extend TimeGenerated = receiveTimestamp
                    | extend SourceSystem = tostring('CloudDNSAPI')
>>>>>>> Stashed changes
                    | extend resource_type_s = tostring(resourceDynamic['type'])
                    | extend payload_requestMetadata_callerIp_s = tostring(protoPayloadDynamic['requestMetadata']['callerIp'])
                    | extend payload_authorizationInfo_s = tostring(protoPayloadDynamic['authorizationInfo'])
                    | extend payload_resourceName_s = tostring(protoPayloadDynamic['resourceName'])
                    | extend payload_request_project_s = tostring(protoPayloadDynamic['request']['project'])
                    | extend payload_request_managedZone_s = tostring(protoPayloadDynamic['request']['managedZone'])
                    | extend payload__type_s = tostring(protoPayloadDynamic['@type'])
                    | extend payload_request__type_s = tostring(protoPayloadDynamic['request']['@type'])
                    | extend payload_request_change_deletions_s = tostring(protoPayloadDynamic['request']['change']['deletions'])
                    | extend payload_response__type_s = tostring(protoPayloadDynamic['response']['@type'])
                    | extend payload_response_change_deletions_s = tostring(protoPayloadDynamic['response']['change']['deletions'])
                    | extend payload_response_change_status_s = tostring(protoPayloadDynamic['response']['change']['status'])
                    | extend payload_response_change_id_s = tostring(protoPayloadDynamic['response']['change']['id'])
                    | extend payload_authenticationInfo_principalSubject_s = tostring(protoPayloadDynamic['authenticationInfo']['principalSubject'])
                    | extend payload_requestMetadata_callerSuppliedUserAgent_s = tostring(protoPayloadDynamic['requestMetadata']['callerSuppliedUserAgent'])
                    | extend payload_request_name_s = tostring(protoPayloadDynamic['request']['name'])
                    | extend payload_request_type_s = tostring(protoPayloadDynamic['request']['type'])
                    | extend payload_request_change_additions_s = tostring(protoPayloadDynamic['request']['change']['additions'])
                    | extend payload_response_change_additions_s = tostring(protoPayloadDynamic['response']['change']['additions'])
                    | project insert_id_s, log_name_s, TimeGenerated, severity_s, timestamp_t, payload_authenticationInfo_principalEmail_s, payload_methodName_s, payload_serviceName_s, resource_labels_location_s, resource_labels_project_id_s, resource_labels_zone_name_s, SourceSystem, resource_type_s, payload_requestMetadata_callerIp_s, payload_authorizationInfo_s, payload_resourceName_s, payload_request_project_s, payload_request_managedZone_s, payload__type_s, payload_request__type_s, MG, ManagementGroupName, Computer, RawData, payload_request_change_deletions_s, payload_response__type_s, payload_response_change_deletions_s, payload_response_change_status_s, payload_response_change_id_s, payload_authenticationInfo_principalSubject_s, payload_requestMetadata_callerSuppliedUserAgent_s, payload_request_name_s, payload_request_type_s, payload_request_change_additions_s, payload_response_change_additions_s",
                    "outputStream": "Custom-GCP_DNS_CL"
                }
            ]
        }
    }
]
