# Lumen Defender Threat Feed Connector - Azure Durable Functions

## Overview

This Azure Functions data connector uploads threat intelligence indicators generated by Black Lotus Labs to Microsoft Sentinel.

**Current Version: 1.1 (Delta Sync)**

## What It Does

The connector automatically:

- **V1.1 Delta Sync (Current):**
  - Queries the Lumen Delta API every 15 minutes for changed indicators
  - Polls for query completion
  - Downloads only delta changes (combined ipv4 + domain indicators)
  - Stores threat intel data to blob storage for processing
  - Uploads chunks (100 indicators per request) to Microsoft Sentinel via the [STIX Object Upload API](https://learn.microsoft.com/en-us/azure/sentinel/stix-objects-api)
  - Cleans up temp files in blob storage after upload is complete

## Requirements

- Azure Functions runtime v4 (`FUNCTIONS_EXTENSION_VERSION=~4`)
- Python 3.11 (`linuxFxVersion: Python|3.11`)
- Durable Functions extension (`azure-functions-durable`)

## Schedule

- **V1.1:** Runs every 15 minutes via timer trigger (`0 */15 * * * *`)
- Each run processes delta changes from the last 15-minute window

## Architecture

1. **Timer Function:** Initiates delta query, downloads results to blob storage
2. **Orchestrator:** Coordinates parallel upload activities with rate limit handling
3. **Activity Functions:** Upload indicators from blobs to Sentinel in chunks of 100

## Support

For technical issues or questions about this connector:

- **Lumen API access**: Contact Lumen support
- **Azure configuration**: Contact your system administrator  
- **Connector functionality**: Review Azure Functions logs in the Azure portal

---

*This connector requires active Lumen Reputation API access and Microsoft Sentinel workspace permissions.*

**Version History:**
- **V1.1** (Oct 2025) - Delta sync with 15-minute intervals
- **V1.0** (Earlier) - Daily full sync
