{
   "id": "LumenThreatFeedConnector",
   "title": "Lumen Defender Threat Feed Data Connector",
   "publisher": "Lumen Technologies, Inc.",
   "descriptionMarkdown": "The [Lumen Defender Threat Feed](https://bll-analytics.mss.lumen.com/analytics) connector provides the capability to ingest STIX-formatted threat intelligence indicators from Lumen's Black Lotus Labs research team into Microsoft Sentinel. The connector automatically downloads and uploads daily threat intelligence indicators including IPv4 addresses and domains to the ThreatIntelIndicators table via the STIX Objects Upload API.",
   "additionalRequirementBanner": "This connector requires API access to Lumen Defender Threat Feed API service, Microsoft Sentinel STIX Objects API permissions, and proper configuration of Azure AD authentication components.",
   "graphQueries": [
     {
       "metricName": "Total Threat Intelligence Indicators",
       "legend": "ThreatIntelIndicators",
       "baseQuery": "ThreatIntelIndicators | where SourceSystem == 'Lumen'"
     }
   ],
   "sampleQueries": [
     {
       "description": "All Lumen Threat Intelligence Indicators",
       "query": "ThreatIntelIndicators | where SourceSystem == 'Lumen' | sort by TimeGenerated desc"
     },
     {
       "description": "High Confidence Indicators",
       "query": "ThreatIntelIndicators | where SourceSystem == 'Lumen' and Confidence >= 80 | sort by TimeGenerated desc"
     },
     {
       "description": "Malicious IP Indicators",
       "query": "ThreatIntelIndicators | where SourceSystem == 'Lumen' and ObservableValue != '' and ObservableKey == 'ipv4-addr:value' | sort by TimeGenerated desc"
     },
     {
       "description": "Malicious Domain Indicators",
       "query": "ThreatIntelIndicators | where SourceSystem == 'Lumen' and ObservableValue != '' and ObservableKey == 'domain-name:value' | sort by TimeGenerated desc"
     },
     {
       "description": "Recent Indicators (Last 7 Days)",
       "query": "ThreatIntelIndicators | where SourceSystem == 'Lumen' and TimeGenerated > ago(7d) | summarize count() by bin(TimeGenerated, 1d)"
     }
   ],
   "dataTypes": [
     {
       "name": "ThreatIntelIndicators(Lumen)",
       "lastDataReceivedQuery": "ThreatIntelIndicators | where SourceSystem == 'Lumen' | summarize Time = max(TimeGenerated) | where isnotempty(Time)"
     }
   ],
   "connectivityCriterias": [
     {
       "type": "IsConnectedQuery",
       "value": [
         "ThreatIntelIndicators | where SourceSystem == 'Lumen' | summarize LastLogReceived = max(TimeGenerated) | project IsConnected = LastLogReceived > ago(30d)"
       ]
     }
   ],
   "availability": {
     "status": 1,
     "isPreview": true
   },
   "permissions": {
     "resourceProvider": [
       {
         "provider": "Microsoft.OperationalInsights/workspaces",
         "permissionsDisplayText": "Read and write permissions on the Log Analytics workspace are required.",
         "providerDisplayName": "Log Analytics Workspace",
         "scope": "Workspace",
         "requiredPermissions": {
           "write": true,
           "read": true,
           "delete": false
         }
       }
     ],
     "customs": [
       {
         "name": "Microsoft.Web/sites permissions",
         "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
       },
       {
         "name": "Azure Entra App Registration",
         "description": "An Azure Entra application registration with the Microsoft Sentinel Contributor role assigned is required for STIX Objects API access. [See the documentation to learn more about Azure Entra applications](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app)."
       },
       {
         "name": "Microsoft Sentinel Contributor Role",
         "description": "Microsoft Sentinel Contributor role is required for the Azure Entra application to upload threat intelligence indicators."
       },
       {
         "name": "Lumen Defender Threat Feed API Key",
         "description": "A Lumen Defender Threat Feed API Key is required for accessing threat intelligence data. [Contact Lumen for API access](mailto:DefenderThreatFeedSales@Lumen.com?subject=API%20Access%20Request)."
       }
     ]
   },
   "instructionSteps": [
     {
       "title": "",
       "description": ">**NOTE:** This connector uses Azure Functions with Durable Functions to connect to the Lumen Defender Threat Feed API and upload threat intelligence indicators to Microsoft Sentinel via the STIX Objects API. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
     },
     {
       "title": "Configuration",
       "description": "**STEP 1 - Obtain Lumen Defender Threat Feed API Key**\n\n1. [Contact Lumen](mailto:DefenderThreatFeedSales@Lumen.com?subject=API%20Access%20Request) to obtain API access to our Threat Feed API service\n2. Obtain your API key for authentication."
     },
     {
       "title": "",
       "description": "**STEP 2 - Configure Azure Entra ID Application and gather information**\n\n1. Create an Entra application. [See the documentation for a guide to registering an application in Microsoft Entra ID.](https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app)\n2. Create a client secret and note the Application ID, Tenant ID, and Client Secret\n4. Assign the **Microsoft Sentinel Contributor** role to the application on your Microsoft Sentinel Log Analytics Workspace\n5. Make note of your Workspace ID, as well as the App Insights Workspace Resource ID, which can be obtained from the overview page of the Log Analytics Workspace for your Microsoft Sentinel instance. Click on the “JSON View” link in the top right and the Resource ID will be displayed at the top with a copy button.",
       "instructions":[
         {
             "parameters": {
                 "fillWith": [
                     "TenantId"
                 ],
                 "label": "Tenant ID"
             },
             "type": "CopyableLabel"
         },
         {
             "parameters": {
                 "fillWith": [
                     "WorkspaceId"
                 ],
                 "label": "Workspace ID"
             },
             "type": "CopyableLabel"
         }
       ]
     },
     {
       "title": "",
       "description": "**STEP 3 - Enable the Threat Intelligence Upload Indicators API (Preview) data connector in Microsoft Sentinel**\n\n1. Deploy the **Threat Intelligence (New) Solution**, which includes the **Threat Intelligence Upload Indicators API (Preview)**\n2. Browse to the Content Hub, find and select the **Threat Intelligence (NEW)** solution.\n3. Select the **Install/Update** button."
     },
     {
       "title": "",
       "description": "**STEP 4 - Deploy the Azure Function**\n\n**IMPORTANT:** Before deploying the Lumen Defender Threat Feed connector, have the Tenant ID, Workspace ID, App Insights Workspace Resource ID, Azure Entra application details (Client ID, Client Secret), and Lumen API key readily available.\n\n1. Click the Deploy to Azure button.\n\n[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Fmaster%2FSolutions%2FLumen%20Defender%20Threat%20Feed%2FData%2520Connectors%2FLumenThreatFeed%2Fazuredeploy_Connector_LumenThreatFeed_AzureFunction.json)\n\n2. Fill in the appropriate values for each parameter:\n\n- Subscription: Confirm the correct subscription is selected or use the dropdown to change your selection\n- Resource Group: Select the resource group to be used by the Function App and related resources\n- Function Name: Enter a globally unique name with an 11-character limit. Adhere to your organization’s naming convention and ensure the name is globally unique since it is used (along with the uniqueString() function) to identify the ARM template being deployed.\n- Workspace ID: Found in the \"Overview\" tab for the Log Analytics Workspace of the Microsoft Sentinel instance and provided for convenience on the connector information page.\n- Lumen API Key: Obtain an API key through Lumen support\n- Lumen Base URL: Filled in automatically and should generally not be changed. This URL contains API endpoints used by the connector\n- Tenant ID: Obtained from the Entra App Registration overview page for the registered application (listed as Directory ID) and can also be obtained from the Tenant Information page in Azure\n- Client ID: Obtained from the Entra App Registration overview page for the registered application (listed as Application ID)\n- Client Secret: Obtained when the secret is created during the app registration process. It can only be viewed when first created and is hidden permanently afterwards. Rerun the app registration process to obtain a new Client Secret if necessary.\n- App Insights Workspace Resource ID: Obtained from the overview page of the Log Analytics Workspace for your Microsoft Sentinel instance. Click on the \"JSON View\" link in the top right and the Resource ID will be displayed at the top with a copy button.\n- Blob Container Name: Use the default name unless otherwise required. Azure Blob Storage is used for temporary storage and processing of threat indicators."
     },
     {
       "title": "",
       "description": "**STEP 5 - Verify Deployment**\n\n1. The connector polls for indicator updates every 15 minutes.\n2. Monitor the Function App logs in the Azure Portal to verify successful execution\n3. After the app performs its first run, review the indicators ingested by either viewing the “Lumen Defender Threat Feed Overview” workbook or viewing the “Threat Intelligence” section in Microsoft Sentinel. In Microsoft Sentinel “Threat Intelligence”, filter for source “Lumen” to display only Lumen generated indicators."
     }
   ],
   "metadata": {
       "id": "8d7d3b0e-4f6a-4f2a-bc2d-6d9f5a3c7e21",
       "version": "1.0.0",
       "kind": "dataConnector",
       "source": {
           "kind": "solution",
           "name": "Lumen Defender Threat Feed for Microsoft Sentinel"
       },
       "author": {
           "name": "Lumen Technologies, Inc."
       },
       "support": {
           "tier": "developer",
           "name": "Lumen Technologies, Inc."
       }
    }
}

