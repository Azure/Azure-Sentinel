{
  "id": "WindowsFirewallAma",
  "title": "Windows Firewall Events via AMA (Preview)",
  "publisher": "Microsoft",
  "descriptionMarkdown": "Windows Firewall is a Microsoft Windows application that filters information coming to your system from the internet and blocking potentially harmful programs. The firewall software blocks most programs from communicating through the firewall. Customers wishing to stream their Windows Firewall application logs collected from their machines can now use the AMA to stream those logs to the Microsoft Sentinel workspace. For more information, see the [Microsoft Sentinel documentation](https://go.microsoft.com/fwlink/p/?linkid=2228623&wt.mc_id=sentinel_dataconnectordocs_content_cnl_csasci).",
  "graphQueries": [
    {
      "metricName": "Total data received",
      "legend": "ASimNetworkSessionLogs",
      "baseQuery": "ASimNetworkSessionLogs\n| where EventProduct == \"Windows Firewall\""
    }
  ],
  "sampleQueries": [
    {
      "description": "All logs",
      "query": "ASimNetworkSessionLogs\n| where EventProduct == \"Windows Firewall\"\n            | sort by TimeGenerated"
    }
  ],
  "connectivityCriterias": [
    {
      "type": "ASimNetworkSessionLogs",
      "value": null
    }
  ],
  "dataTypes": [
    {
      "name": "ASimNetworkSessionLogs",
      "lastDataReceivedQuery": "ASimNetworkSessionLogs\n| where EventProduct == \"Windows Firewall\"\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
    }
  ],
  "availability": {
    "status": 2,
	"isPreview": false,
    "featureFlag": {
      "feature": "WindowsFirewallAMA",
      "featureStates": {
        "1": 1,
        "2": 1,
        "3": 1,
        "4": 1
      }
    }
  },
  "permissions": {
    "resourceProvider": [
      {
        "provider": "Microsoft.OperationalInsights/workspaces/datasources",
        "permissionsDisplayText": "read and write permissions.",
        "providerDisplayName": "Workspace data sources",
        "scope": "Workspace",
        "requiredPermissions": {
          "read": true,
          "write": true
        }
      }
    ],
    "customs": [
      {
        "description": "To collect data from non-Azure VMs, they must have Azure Arc installed and enabled. [Learn more](https://docs.microsoft.com/azure/azure-monitor/agents/azure-monitor-agent-install?tabs=ARMAgentPowerShell,PowerShellWindows,PowerShellWindowsArc,CLIWindows,CLIWindowsArc)"
      }
    ]
  },
  "instructionSteps": [
    {
      "title": "Enable data collection rule",
      "description": "> Windows Firewall events are collected only from Windows agents.",
      "instructions": [
        {
          "type": "WindowsFirewallAma"
        }
      ]
    },
    {
      "instructions": [
        {
          "parameters": {
            "linkType": "OpenCreateDataCollectionRule",
            "dataCollectionRuleType": 4
          },
          "type": "InstallAgent"
        }
      ]
    }
  ]
}
