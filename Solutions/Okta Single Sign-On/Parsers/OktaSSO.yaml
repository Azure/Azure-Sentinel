id: ee884976-418c-472d-8a91-3533f4aa15d0
Function:
  Title: Backward Compatibility Parser for Okta SSO
  Version: '1.0.2'
  LastUpdated: '2023-09-07'
Category: Microsoft Sentinel Parser
FunctionName: OktaSSO
FunctionAlias: OktaSSO
FunctionQuery: |
      let Okta_SSO = view () {
      let Oktav1_empty = datatable(
        actor_alternateId_s:string,
        actor_detailEntry_s:string,
        actor_displayName_s:string,
        actor_id_s:string,
        actor_type_s:string,
        authenticationContext_authenticationProvider_s:string,
        authenticationContext_authenticationStep_d:double,
        authenticationContext_credentialProvider_s:string,
        authenticationContext_credentialType_s:string,
        authenticationContext_externalSessionId_s:string,
        authenticationContext_interface_s:string,
        authenticationContext_issuerId_s:string,
        authenticationContext_issuerType_s:string,
        client_device_s:string,
        client_geographicalContext_city_s:string,
        client_geographicalContext_country_s:string,
        client_geographicalContext_geolocation_lat_d:double,
        client_geographicalContext_geolocation_lon_d:double,
        client_geographicalContext_postalCode_s:string,
        client_geographicalContext_state_s:string,
        client_id_s:string,
        client_ipAddress_s:string,
        client_userAgent_browser_s:string,
        client_userAgent_os_s:string,
        client_userAgent_rawUserAgent_s:string,
        client_zone_s:string,
        debugContext_debugData_s:string,
        displayMessage_s:string,
        eventType_s:string,
        legacyEventType_s:string,
        uuid_g:string,
        outcome_reason_s:string,
        outcome_result_s:string,
        request_ipChain_s:string,
        securityContext_asNumber_d:double,
        securityContext_asOrg_s:string,
        securityContext_domain_s:string,
        securityContext_isp_s:string,
        securityContext_isProxy_b:bool,
        severity_s:string,
        target_s:string,
        transaction_details_s:string,
        transaction_id_s:string,
        transaction_type_s:string,
        version_s:string
        )[];
        let Oktav2_empty = datatable(
        TimeGenerated:datetime,
        OriginalActorAlternateId:string,
        ActorDetailEntry:dynamic,
        ActorDisplayName:string,
        OriginalUserId:string,
        OriginalUserType:string,
        AuthenticationContextAuthenticationProvider:string,
        AuthenticationContextAuthenticationStep: int,
        AuthenticationContextCredentialProvider: string,
        LogonMethod: string,
        ActorSessionId: string,
        AuthenticationContextInterface:string,
        AuthenticationContextIssuerId:string,
        AuthenticationContextIssuerType:string,
        OriginalClientDevice:string,
        SrcGeoCity:string,
        SrcGeoCountry:string,
        SrcGeoLatitude: double,
        SrcGeoLongtitude: double,
        SrcGeoPostalCode: string,
        SrcGeoRegion: string,
        SrcDvcId: string,
        SrcIpAddr: string,
        ActingAppName: string,
        SrcDvcOs: string,
        HttpUserAgent: string,
        SrcZone: string,
        DebugData: dynamic,
        EventMessage: string,
        EventOriginalType: string,
        LegacyEventType: string,
        EventOriginalUid: string,
        EventOriginalResultDetails: string,
        OriginalOutcomeResult: string,
        Request: dynamic,
        SecurityContextAsNumber: int,
        SecurityContextAsOrg: string,
        SecurityContextDomain: string,
        SrcIsp: string,
        DomainName: string ,
        SecurityContextIsProxy: bool,
        OriginalSeverity: string,
        OriginalTarget: dynamic,
        TransactionDetail: dynamic,
        TransactionId: string,
        TransactionType: string,
        Version: string
      )[];
      let Oktav2 = union isfuzzy=true Oktav2_empty, OktaV2_CL |
        project TimeGenerated,
        actor_alternateId_s=OriginalActorAlternateId,
        actor_detailEntry_s=tostring(ActorDetailEntry),
        domain_s=DomainName,
        actor_displayName_s=ActorDisplayName,
        actor_id_s=OriginalUserId,
        actor_type_s=OriginalUserType,
        authenticationContext_authenticationProvider_s=AuthenticationContextAuthenticationProvider,
        authenticationContext_authenticationStep_d=toreal(AuthenticationContextAuthenticationStep),
        authenticationContext_credentialProvider_s=AuthenticationContextCredentialProvider,
        authenticationContext_credentialType_s=LogonMethod,
        authenticationContext_externalSessionId_s=ActorSessionId,
        authenticationContext_interface_s=AuthenticationContextInterface,
        authenticationContext_issuerId_s=AuthenticationContextIssuerId,
        authenticationContext_issuerType_s=AuthenticationContextIssuerType,
        client_device_s=OriginalClientDevice,
        client_geographicalContext_city_s=SrcGeoCity,
        client_geographicalContext_country_s=SrcGeoCountry,
        client_geographicalContext_geolocation_lat_d=SrcGeoLatitude,
        client_geographicalContext_geolocation_lon_d=SrcGeoLongtitude,
        client_geographicalContext_postalCode_s=SrcGeoPostalCode,
        client_geographicalContext_state_s=SrcGeoRegion,
        client_id_s=SrcDvcId,
        client_ipAddress_s=SrcIpAddr,
        client_userAgent_browser_s=ActingAppName,
        client_userAgent_os_s=SrcDvcOs,
        client_userAgent_rawUserAgent_s=HttpUserAgent,
        client_zone_s=SrcZone,
        debugContext_debugData_s=tostring(DebugData),
        displayMessage_s=EventMessage,
        eventType_s=EventOriginalType,
        legacyEventType_s=LegacyEventType,
        uuid_g=EventOriginalUid,
        outcome_reason_s=EventOriginalResultDetails,
        outcome_result_s=OriginalOutcomeResult,
        request_ipChain_s=tostring(Request),
        securityContext_asNumber_d=toreal(SecurityContextAsNumber),
        securityContext_asOrg_s=SecurityContextAsOrg,
        securityContext_domain_s=SecurityContextDomain,
        securityContext_isp_s=SrcIsp,
        securityContext_isProxy_b=SecurityContextIsProxy,
        severity_s=OriginalSeverity,
        target_s=tostring(OriginalTarget),
        transaction_details_s=tostring(TransactionDetail),
        transaction_id_s=TransactionId,
        transaction_type_s=TransactionType,
        version_s = Version;
        union isfuzzy=true Oktav1_empty, Oktav2, Okta_CL
      };
      Okta_SSO()