{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Contrast Security",
    "comments": "Solution template for ContrastADR"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Command Injection Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook2-name": {
      "type": "string",
      "defaultValue": "Cross-site scripting (XSS) Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook3-name": {
      "type": "string",
      "defaultValue": "Expression Language Injection Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook4-name": {
      "type": "string",
      "defaultValue": "HTTP Method Tampering Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook5-name": {
      "type": "string",
      "defaultValue": "JNDI Injection Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook6-name": {
      "type": "string",
      "defaultValue": "Path Traversal Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook7-name": {
      "type": "string",
      "defaultValue": "SQL Injection Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook8-name": {
      "type": "string",
      "defaultValue": "Untrusted Deserialization Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook9-name": {
      "type": "string",
      "defaultValue": "XML External Entity Injection Runbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "ContrastADR",
    "_solutionVersion": "3.0.0",
    "solutionId": "contrast_security.contrast_adr_azure_sentinel_solution",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "ContrastADR",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "ContrastADR",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "parserObject1": {
      "_parserName1": "[concat(parameters('workspace'),'/','ContrastADR')]",
      "_parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'ContrastADR')]",
      "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('ContrastADR-Parser')))]",
      "parserVersion1": "1.0.0",
      "parserContentId1": "ContrastADR-Parser"
    },
    "parserObject2": {
      "_parserName2": "[concat(parameters('workspace'),'/','ContrastADR_Incident')]",
      "_parserId2": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'ContrastADR_Incident')]",
      "parserTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring('ContrastADR_Incident-Parser')))]",
      "parserVersion2": "1.0.0",
      "parserContentId2": "ContrastADR_Incident-Parser"
    },
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "93641436-afb3-4921-8828-ceab0d15aaab",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '93641436-afb3-4921-8828-ceab0d15aaab')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('93641436-afb3-4921-8828-ceab0d15aaab')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','93641436-afb3-4921-8828-ceab0d15aaab','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "c1c6ba64-134e-403b-b9a6-1bebc90809a4",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c1c6ba64-134e-403b-b9a6-1bebc90809a4')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c1c6ba64-134e-403b-b9a6-1bebc90809a4')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c1c6ba64-134e-403b-b9a6-1bebc90809a4','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "31417149-f3a2-4db4-9e5f-85e0a464f6a1",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '31417149-f3a2-4db4-9e5f-85e0a464f6a1')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('31417149-f3a2-4db4-9e5f-85e0a464f6a1')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','31417149-f3a2-4db4-9e5f-85e0a464f6a1','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "ae4f67a6-0713-4a26-ae61-284e67b408c1",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'ae4f67a6-0713-4a26-ae61-284e67b408c1')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('ae4f67a6-0713-4a26-ae61-284e67b408c1')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','ae4f67a6-0713-4a26-ae61-284e67b408c1','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "1aac7737-d52f-483d-b225-6a27c1b29a9e",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '1aac7737-d52f-483d-b225-6a27c1b29a9e')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('1aac7737-d52f-483d-b225-6a27c1b29a9e')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','1aac7737-d52f-483d-b225-6a27c1b29a9e','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "7ce5956f-48f2-42f5-8e2e-c254e7643c11",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '7ce5956f-48f2-42f5-8e2e-c254e7643c11')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('7ce5956f-48f2-42f5-8e2e-c254e7643c11')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','7ce5956f-48f2-42f5-8e2e-c254e7643c11','-', '1.0.0')))]"
    },
    "workbookVersion1": "1.0",
    "workbookContentId1": "ContrastADRCmdInjectionWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "workbookVersion2": "1.0",
    "workbookContentId2": "ContrastADRXSSWorkbook",
    "workbookId2": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId2'))]",
    "workbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId2'))))]",
    "_workbookContentId2": "[variables('workbookContentId2')]",
    "_workbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId2'),'-', variables('workbookVersion2'))))]",
    "workbookVersion3": "1.0",
    "workbookContentId3": "ContrastADRExpressionLanguageInjectionWorkbook",
    "workbookId3": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId3'))]",
    "workbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId3'))))]",
    "_workbookContentId3": "[variables('workbookContentId3')]",
    "_workbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId3'),'-', variables('workbookVersion3'))))]",
    "workbookVersion4": "1.0",
    "workbookContentId4": "ContrastADRHTTPMethodTamperingWorkbook",
    "workbookId4": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId4'))]",
    "workbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId4'))))]",
    "_workbookContentId4": "[variables('workbookContentId4')]",
    "_workbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId4'),'-', variables('workbookVersion4'))))]",
    "workbookVersion5": "1.0",
    "workbookContentId5": "ContrastADRJNDIInjectionWorkbook",
    "workbookId5": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId5'))]",
    "workbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId5'))))]",
    "_workbookContentId5": "[variables('workbookContentId5')]",
    "_workbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId5'),'-', variables('workbookVersion5'))))]",
    "workbookVersion6": "1.0",
    "workbookContentId6": "ContrastADRPathTraversalWorkbook",
    "workbookId6": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId6'))]",
    "workbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId6'))))]",
    "_workbookContentId6": "[variables('workbookContentId6')]",
    "_workbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId6'),'-', variables('workbookVersion6'))))]",
    "workbookVersion7": "1.0",
    "workbookContentId7": "ContrastADRSQLInjectionWorkbook",
    "workbookId7": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId7'))]",
    "workbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId7'))))]",
    "_workbookContentId7": "[variables('workbookContentId7')]",
    "_workbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId7'),'-', variables('workbookVersion7'))))]",
    "workbookVersion8": "1.0",
    "workbookContentId8": "ContrastADRUntrustedDeserializationWorkbook",
    "workbookId8": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId8'))]",
    "workbookTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId8'))))]",
    "_workbookContentId8": "[variables('workbookContentId8')]",
    "_workbookcontentProductId8": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId8'),'-', variables('workbookVersion8'))))]",
    "workbookVersion9": "1.0",
    "workbookContentId9": "ContrastADRXMLExternalEntityInjectionWorkbook",
    "workbookId9": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId9'))]",
    "workbookTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId9'))))]",
    "_workbookContentId9": "[variables('workbookContentId9')]",
    "_workbookcontentProductId9": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId9'),'-', variables('workbookVersion9'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "ContrastADR",
                  "publisher": "Contrast Security",
                  "descriptionMarkdown": "The ContrastADR data connector provides the capability to ingest Contrast ADR attack events into Microsoft Sentinel using the ContrastADR Webhook. ContrastADR data connector can enrich the incoming webhook data with ContrastADR API enrichment calls.",
                  "graphQueries": [
                    {
                      "metricName": "Attack event Data",
                      "legend": "ContrastADR_CL",
                      "baseQuery": "ContrastADR_CL"
                    },
                    {
                      "metricName": "Incident event data",
                      "legend": "ContrastADRIncident_CL",
                      "baseQuery": "ContrastADRIncident_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All ContrastADR Attack event logs",
                      "query": "ContrastADR_CL\n| sort by TimeGenerated desc"
                    },
                    {
                      "description": "All ContrastADR incident logs",
                      "query": "ContrastADRIncident_CL\n| sort by TimeGenerated desc"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "ContrastADR_CL",
                      "lastDataReceivedQuery": "ContrastADR_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    },
                    {
                      "name": "ContrastADRIncident_CL",
                      "lastDataReceivedQuery": "ContrastADRIncident_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "ContrastADR_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                        "ContrastADRIncident_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "Use these Workspace id and primakey key as shared key in azure function app",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Workspace ID"
                          },
                          "type": "CopyableLabel"
                        },
                        {
                          "parameters": {
                            "fillWith": [
                              "PrimaryKey"
                            ],
                            "label": "Primary Key"
                          },
                          "type": "CopyableLabel"
                        }
                      ]
                    },
                    {
                      "description": "Use this method to automate deployment of the ContrastADR Data Connector using ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-ContrastADR-azuredeploy)\n2. Provide the following parameters: Region, Function Name, LOG_ANALYTICS_SHARED_KEY, LOG_ANALYTICS_WORKSPACE_ID ",
                      "title": "Azure Resource Manager (ARM) Template"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "ContrastADR",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "ContrastADR",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Contrast Security"
        },
        "support": {
          "name": "Contrast Security",
          "tier": "Partner",
          "link": "https://support.contrastsecurity.com/hc/en-us"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "ContrastADR",
          "publisher": "Contrast Security",
          "descriptionMarkdown": "The ContrastADR data connector provides the capability to ingest Contrast ADR attack events into Microsoft Sentinel using the ContrastADR Webhook. ContrastADR data connector can enrich the incoming webhook data with ContrastADR API enrichment calls.",
          "graphQueries": [
            {
              "metricName": "Attack event Data",
              "legend": "ContrastADR_CL",
              "baseQuery": "ContrastADR_CL"
            },
            {
              "metricName": "Incident event data",
              "legend": "ContrastADRIncident_CL",
              "baseQuery": "ContrastADRIncident_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "ContrastADR_CL",
              "lastDataReceivedQuery": "ContrastADR_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            },
            {
              "name": "ContrastADRIncident_CL",
              "lastDataReceivedQuery": "ContrastADRIncident_CL\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "ContrastADR_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)",
                "ContrastADRIncident_CL\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "All ContrastADR Attack event logs",
              "query": "ContrastADR_CL\n| sort by TimeGenerated desc"
            },
            {
              "description": "All ContrastADR incident logs",
              "query": "ContrastADRIncident_CL\n| sort by TimeGenerated desc"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "Use these Workspace id and primakey key as shared key in azure function app",
              "instructions": [
                {
                  "parameters": {
                    "fillWith": [
                      "WorkspaceId"
                    ],
                    "label": "Workspace ID"
                  },
                  "type": "CopyableLabel"
                },
                {
                  "parameters": {
                    "fillWith": [
                      "PrimaryKey"
                    ],
                    "label": "Primary Key"
                  },
                  "type": "CopyableLabel"
                }
              ]
            },
            {
              "description": "Use this method to automate deployment of the ContrastADR Data Connector using ARM Template.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://aka.ms/sentinel-ContrastADR-azuredeploy)\n2. Provide the following parameters: Region, Function Name, LOG_ANALYTICS_SHARED_KEY, LOG_ANALYTICS_WORKSPACE_ID ",
              "title": "Azure Resource Manager (ARM) Template"
            }
          ],
          "id": "[variables('_uiConfigId1')]"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject1').parserTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_alert_event_parser Data Parser with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject1').parserVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject1')._parserName1]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for ContrastADR",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "ContrastADR",
                "query": "ContrastADR_CL | project EventUid = eventUuid_g, IpAddr = SourceIP, SrcIpAddr = SourceIP, EventSeverity = severity_s, AlertSeverity = severity_s, EventResult = result_s, Rule = rule_s, ThreatId = rule_s, DvcId = application_id_g, Dvc = application_name_s, DvcInterface = server_id_s, DvcHostname = server_name_s, DvcDescription = environment_s, ThreatFirstReportedTime = detectedTime_s, Url = attackPayload_url_s, HttpRequestMethod = request_method_s, DvcAction = request_method_s, AlertName = attackPayload_attackerInput_name_s, AlertVerdict = attackPayload_attackerInput_confirmedAttack_b, FilePath = attackPayload_attackerInput_documentPath_s, Query = vectorAnalysis_vectorFields_query_s, ProcessName = codeLocation_method_s, CloudProvider = cloudProvider_s, CloudResourceId = cloudResourceId_s",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This file is to parse the data from Contrast ADR platform"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
              "dependsOn": [
                "[variables('parserObject1')._parserId1]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'ContrastADR')]",
                "contentId": "[variables('parserObject1').parserContentId1]",
                "kind": "Parser",
                "version": "[variables('parserObject1').parserVersion1]",
                "source": {
                  "name": "ContrastADR",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "contentKind": "Parser",
        "displayName": "Parser for ContrastADR",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject1').parserContentId1,'-', '1.0.0')))]",
        "version": "[variables('parserObject1').parserVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject1')._parserName1]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for ContrastADR",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "ContrastADR",
        "query": "ContrastADR_CL | project EventUid = eventUuid_g, IpAddr = SourceIP, SrcIpAddr = SourceIP, EventSeverity = severity_s, AlertSeverity = severity_s, EventResult = result_s, Rule = rule_s, ThreatId = rule_s, DvcId = application_id_g, Dvc = application_name_s, DvcInterface = server_id_s, DvcHostname = server_name_s, DvcDescription = environment_s, ThreatFirstReportedTime = detectedTime_s, Url = attackPayload_url_s, HttpRequestMethod = request_method_s, DvcAction = request_method_s, AlertName = attackPayload_attackerInput_name_s, AlertVerdict = attackPayload_attackerInput_confirmedAttack_b, FilePath = attackPayload_attackerInput_documentPath_s, Query = vectorAnalysis_vectorFields_query_s, ProcessName = codeLocation_method_s, CloudProvider = cloudProvider_s, CloudResourceId = cloudResourceId_s",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": "This file is to parse the data from Contrast ADR platform"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject1')._parserId1,'/'))))]",
      "dependsOn": [
        "[variables('parserObject1')._parserId1]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'ContrastADR')]",
        "contentId": "[variables('parserObject1').parserContentId1]",
        "kind": "Parser",
        "version": "[variables('parserObject1').parserVersion1]",
        "source": {
          "kind": "Solution",
          "name": "ContrastADR",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Contrast Security"
        },
        "support": {
          "name": "Contrast Security",
          "tier": "Partner",
          "link": "https://support.contrastsecurity.com/hc/en-us"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserObject2').parserTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_incident_parser Data Parser with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserObject2').parserVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('parserObject2')._parserName2]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "Parser for ContrastADR Incident Schema",
                "category": "Microsoft Sentinel Parser",
                "functionAlias": "ContrastADR_Incident",
                "query": "ContrastADRIncident_CL | project EventUid = incidentId_s, AlertName = incidentName_s, ThreatFirstReportedTime= createdTime_t, EventSeverity = severity_s, Url = url_s, RuleDescription = summary_s, AlertStatus = status_s, Rule = relatedRules_s, AttackRemediationSteps = recommendedActions_s",
                "functionParameters": "",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "This file is to parse the data from Contrast ADR platform"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject2')._parserId2,'/'))))]",
              "dependsOn": [
                "[variables('parserObject2')._parserId2]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'ContrastADR_Incident')]",
                "contentId": "[variables('parserObject2').parserContentId2]",
                "kind": "Parser",
                "version": "[variables('parserObject2').parserVersion2]",
                "source": {
                  "name": "ContrastADR",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('parserObject2').parserContentId2]",
        "contentKind": "Parser",
        "displayName": "Parser for ContrastADR Incident Schema",
        "contentProductId": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject2').parserContentId2,'-', '1.0.0')))]",
        "id": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('parserObject2').parserContentId2,'-', '1.0.0')))]",
        "version": "[variables('parserObject2').parserVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('parserObject2')._parserName2]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Parser for ContrastADR Incident Schema",
        "category": "Microsoft Sentinel Parser",
        "functionAlias": "ContrastADR_Incident",
        "query": "ContrastADRIncident_CL | project EventUid = incidentId_s, AlertName = incidentName_s, ThreatFirstReportedTime= createdTime_t, EventSeverity = severity_s, Url = url_s, RuleDescription = summary_s, AlertStatus = status_s, Rule = relatedRules_s, AttackRemediationSteps = recommendedActions_s",
        "functionParameters": "",
        "version": 2,
        "tags": [
          {
            "name": "description",
            "value": "This file is to parse the data from Contrast ADR platform"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('parserObject2')._parserId2,'/'))))]",
      "dependsOn": [
        "[variables('parserObject2')._parserId2]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), 'ContrastADR_Incident')]",
        "contentId": "[variables('parserObject2').parserContentId2]",
        "kind": "Parser",
        "version": "[variables('parserObject2').parserVersion2]",
        "source": {
          "kind": "Solution",
          "name": "ContrastADR",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Contrast Security"
        },
        "support": {
          "name": "Contrast Security",
          "tier": "Partner",
          "link": "https://support.contrastsecurity.com/hc/en-us"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_ADR_Confirmed_WAF_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Correlates Contrast ADR security alerts with WAF logs to identify confirmed attack attempts that were either exploited or blocked. This rule helps security teams prioritize incidents by focusing on attacks that have been validated by application security monitoring.",
                "displayName": "Contrast ADR - WAF Alert Correlation",
                "enabled": false,
                "query": "ContrastADR_CL\n| where result_s =~ \"exploited\" or result_s =~ \"blocked\"\n| project-rename ip_s=SourceIP\n//please add you WAF table in place of ContrastWAFLogs_CL and WAF tables source IP or target IP column's inplace of ip_s and uncomment the queries below\n//| join kind=inner (ContrastWAFLogs_CL | where TimeGenerated >= ago(5m)) on ip_s\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "ContrastADR",
                    "dataTypes": [
                      "ContrastADR_CL"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "DefenseEvasion",
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1190",
                  "T1211",
                  "T1008"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SourceIP"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "WAF Alert Confirmed {{result_s}}  by Contrast ADR on {{request_headers_referer_s}}  endpoint of {{application_name_s}} ",
                  "alertDescriptionFormat": "WAF Alert Confirmed {{result_s}}  by Contrast ADR on {{request_headers_referer_s}}  endpoint of {{application_name_s}} "
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "enabled": true,
                    "lookbackDuration": "PT1H",
                    "reopenClosedIncident": false,
                    "matchingMethod": "Selected"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "ContrastADR Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "Contrast ADR - WAF Alert Correlation",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_ADR_Confirmed_EDR_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Correlates Contrast ADR incidents with specific high-risk attack patterns including command injection, deserialization attacks, and file upload vulnerabilities. This rule identifies confirmed security events that require immediate attention from security teams.",
                "displayName": "Contrast ADR - EDR Alert Correlation",
                "enabled": false,
                "query": "ContrastADRIncident_CL\n| project-rename  incident_id_s = incidentId_s\n| join kind=inner (ContrastADR_CL | where rule_s in~(\"class-loader-manipulation\", \"cmd-injection-semantic-chained-commands\", \"cmd-injection-semantic-dangerous-paths\", \"cmd-injection-command-backdoors\", \"cmd-injection-process-hardening\", \"cmd-injection\", \"expression-language-injection\", \"jndi-injection\", \"ssjs-injection\", \"unsafe-file-upload\", \"untrusted-deserialization\",\"xxe\")) on incident_id_s\n| project-rename hostname_s = host_hostname_s\n//Please add your EDR table name in place of ContrastWAFLogs_CL and hostname's column name in place of hostname_s below and uncomment the queries below\n//| join kind = inner ( ContrastWAFLogs_CL\n//| where TimeGenerated >= ago(5m)) on hostname_s\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "ContrastADR",
                    "dataTypes": [
                      "ContrastADRIncident_CL",
                      "ContrastADR_CL"
                    ]
                  }
                ],
                "tactics": [
                  "Execution",
                  "DefenseEvasion",
                  "InitialAccess",
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1059",
                  "T1055",
                  "T1190",
                  "T1008"
                ],
                "entityMappings": [
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "host_hostname_s"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "EDR Alert Confirmed {{result_s}} by Contrast ADR on {{application_name_s}}",
                  "alertDescriptionFormat": "EDR Alert Confirmed {{result_s}} by Contrast ADR on {{application_name_s}}"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "enabled": true,
                    "lookbackDuration": "PT1H",
                    "reopenClosedIncident": false,
                    "groupByEntities": [
                      "Host"
                    ],
                    "matchingMethod": "Selected"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "ContrastADR Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "Contrast ADR - EDR Alert Correlation",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_ADR_Exploited_Attack_Event_in_Production_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects successful exploitation of security vulnerabilities in production environments as identified by Contrast ADR. This rule triggers on confirmed exploited attacks in production systems, requiring immediate incident response and remediation.",
                "displayName": "Contrast ADR - Exploited Attack in Production",
                "enabled": false,
                "query": "ContrastADR_CL\n| where result_s =~ \"exploited\" and environment_s =~ \"production\"\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "ContrastADR",
                    "dataTypes": [
                      "ContrastADR_CL"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "DefenseEvasion",
                  "LateralMovement",
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1190",
                  "T1059",
                  "T1055",
                  "T1210",
                  "T1008"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SourceIP"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "host_hostname_s"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{result_s}} {{rule_s}} from {{SourceIP}} in Production",
                  "alertDescriptionFormat": "{{result_s}}  on {{request_headers_referer_s}}  endpoint of {{application_name_s}} "
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "enabled": true,
                    "lookbackDuration": "PT30M",
                    "reopenClosedIncident": false,
                    "groupByEntities": [
                      "IP",
                      "Host"
                    ],
                    "matchingMethod": "Selected"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "ContrastADR Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "Contrast ADR - Exploited Attack in Production",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_ADR_Exploited_Attack_Event_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects successful exploitation of security vulnerabilities across all environments as identified by Contrast ADR. This rule captures confirmed exploited attacks that bypassed application security controls and require security team investigation.",
                "displayName": "Contrast ADR - Exploited Attack Event",
                "enabled": false,
                "query": "ContrastADR_CL\n| where result_s =~ \"exploited\"\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "ContrastADR",
                    "dataTypes": [
                      "ContrastADR_CL"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "Execution",
                  "DefenseEvasion",
                  "LateralMovement",
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1190",
                  "T1059",
                  "T1055",
                  "T1210",
                  "T1008"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SourceIP"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "host_hostname_s"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "customDetails": {
                  "AttackedEndpoint": "request_headers_referer_s",
                  "ApplicationName": "application_name_s",
                  "AttackRule": "rule_s",
                  "TargetHost": "host_hostname_s",
                  "Environment": "environment_s",
                  "AttackResult": "result_s"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{result_s}} {{rule_s}} from {{SourceIP}} ",
                  "alertDescriptionFormat": "{{result_s}}  on {{request_headers_referer_s}}  endpoint of {{application_name_s}} "
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "enabled": true,
                    "lookbackDuration": "PT1H",
                    "reopenClosedIncident": false,
                    "groupByEntities": [
                      "IP",
                      "Host"
                    ],
                    "matchingMethod": "Selected"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "ContrastADR Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "Contrast ADR - Exploited Attack Event",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_ADR_SQL_Injection_Alert_with_DLP_alerts_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Detects successful SQL injection attacks identified by Contrast ADR and correlates them with WAF/DLP logs. This rule identifies critical database security breaches that have bypassed initial defenses and may result in data exfiltration or unauthorized database access.",
                "displayName": "Contrast ADR - DLP SQL Injection Correlation",
                "enabled": false,
                "query": "ContrastADR_CL\n| where result_s =~ \"EXPLOITED\" and rule_s =~ \"SQL-INJECTION\"\n| project-rename hostname_s = host_hostname_s\n//please add your DLP logs table in place of ContrastWAFLogs_CL and hostname colomun in place of hostname_s below and uncomment the queries below\n//| join kind= inner (ContrastWAFLogs_CL | where TimeGenerated >= ago(5m)) on hostname_s\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "ContrastADR",
                    "dataTypes": [
                      "ContrastADR_CL"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "CredentialAccess",
                  "Collection",
                  "Exfiltration",
                  "CommandAndControl",
                  "Reconnaissance",
                  "CredentialAccess",
                  "LateralMovement",
                  "Discovery"
                ],
                "techniques": [
                  "T1190",
                  "T1552",
                  "T1005",
                  "T1041",
                  "T1008",
                  "T1590",
                  "T1571",
                  "T1528",
                  "T1021",
                  "T1046"
                ],
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SourceIP"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "identifier": "HostName",
                        "columnName": "host_hostname_s"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "Confirmed active SQL Injection by Contrast ADR on {{request_headers_referer_s}}  endpoint of {{application_name_s}} ",
                  "alertDescriptionFormat": "Confirmed active SQL Injection by Contrast ADR on {{request_headers_referer_s}}  endpoint of {{application_name_s}} "
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "enabled": true,
                    "lookbackDuration": "PT30M",
                    "reopenClosedIncident": false,
                    "groupByEntities": [
                      "Host",
                      "IP"
                    ],
                    "matchingMethod": "Selected"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "ContrastADR Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "Contrast ADR - DLP SQL Injection Correlation",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "Contrast_Security_ADR_incident_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Monitors Contrast ADR security incidents across all applications and environments. This rule creates alerts for all security incidents detected by Contrast Security ADR, providing comprehensive visibility into application security events requiring investigation.",
                "displayName": "Contrast ADR - Security Incident Alert",
                "enabled": false,
                "query": "ContrastADRIncident_CL\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "connectorId": "ContrastADR",
                    "dataTypes": [
                      "ContrastADRIncident_CL"
                    ]
                  }
                ],
                "tactics": [
                  "InitialAccess",
                  "DefenseEvasion",
                  "Discovery",
                  "CommandAndControl"
                ],
                "techniques": [
                  "T1190",
                  "T1055",
                  "T1018",
                  "T1008"
                ],
                "entityMappings": [
                  {
                    "entityType": "SecurityGroup",
                    "fieldMappings": [
                      {
                        "identifier": "ObjectGuid",
                        "columnName": "incidentId_s"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "AlertPerResult"
                },
                "alertDetailsOverride": {
                  "alertDisplayNameFormat": "{{incidentName_s}}",
                  "alertDescriptionFormat": "{{summary_s}}"
                },
                "incidentConfiguration": {
                  "createIncident": true,
                  "groupingConfiguration": {
                    "enabled": true,
                    "lookbackDuration": "PT1H",
                    "reopenClosedIncident": false,
                    "groupByCustomDetails": [
                      "IncidentId",
                      "ApplicationName"
                    ],
                    "matchingMethod": "Selected"
                  }
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "ContrastADR Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "Contrast ADR - Security Incident Alert",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_Command_Injection_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Command injection is a malicious technique where attackers exploit vulnerabilities in web applications to inject and execute arbitrary operating system (OS) commands on the server. By manipulating input data, attackers can manipulate the application's execution flow, tricking it into running unintended system commands.This can result in data breaches, system compromise, etc. Contrast uses various detection capabilities for Command Injection. Some track malicious input into commands being run, some detect sensitive file paths being accessed, and so forth. "
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Command Injection Runbook\\n\\nCommand injection is a malicious technique where attackers exploit vulnerabilities in web applications to inject and execute arbitrary operating system (OS) commands on the server. By manipulating input data, attackers can manipulate the application's execution flow, tricking it into running unintended system commands.This can result in data breaches, system compromise, etc. Contrast uses various detection capabilities for Command Injection. Some track malicious input into commands being run, some detect sensitive file paths being accessed, and so forth. \\n\\n\\nExample Event - Exploited outcome Command Injection  \\n`Oct 25 11:02:31 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The parameter cmd had a value that successfully exploited cmd-injection - whoami|WARN|pri=cmd-injection src=0:0:0:0:0:0:0:1 spt=8080 request=/cmd requestMethod=GET app=webapplication outcome=EXPLOITED`  \\n  \\n  \\n\\nExample Event - Blocked outcome Command Injection  \\n`Oct 25 11:02:31 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The parameter cmd had a value that successfully exploited cmd-injection - whoami|WARN|pri=cmd-injection src=0:0:0:0:0:0:0:1 spt=8080 request=/cmd requestMethod=GET app=webapplication outcome=BLOCKED`\\n  \\n  \\n\\n\\n\\nIs the event a \\\"cmd-injection-process-hardening\\\" event?   [Yes](#handling-process-hardening)\\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n\\n- [Ineffective](#ineffective)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\n\\\"Exploited\\\" means Contrast detected an input coming into an application that looked like command injection and then confirmed the input performed a command injection during a call to the operating system by observing the execution of the injected command and its effects on the system.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Does a system command get run in the application as part of normal usage?\\n- Are there command chaining operators present? (&& || ; & |)\\n- Are there command substitution characters present? ($(), ``)\\n- Do the commands seem to be accessing suspicious files? (/etc/password/)\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there unusual os/system related messages around the same timestamp as the event?\\n- Are there application logs with OS error messages around the same timestamp as the event?\\n\\n\\n\\nExamples:\\n\\n- `original_cmd_by_server $(cat /etc/passwd)`\\n- `original_cmd_by_server; command2`\\n- `original_cmd_by_server && command2`\\n- `original_cmd_by_server || command2`  \\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" means Contrast detected an input coming into an application that looked like command injection and then confirmed the input performed a command injection during a call to the operating system and therefore blocked the execution of it.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Does a system command get run in the application as part of normal usage?\\n- Are there command chaining operators present? (&& || ; & |)\\n- Are there command substitution characters present? ($(), ``)\\n- Do the commands seem to be accessing suspicious files? (/etc/password/)\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there unusual os/system related messages around the same timestamp as the event?\\n- Are there application logs with OS error messages around the same timestamp as the event?\\n\\n\\nExamples:\\n\\n- `original_cmd_by_server $(cat /etc/passwd)`\\n- `original_cmd_by_server; command2`\\n- `original_cmd_by_server && command2`\\n- `original_cmd_by_server || command2`  \\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Ineffective\\n\\n\\\"Ineffective\\\" means Contrast detected an input coming into an application that looked like command injection, but did not confirm the input performed a command injection during execution. This is called a Probe within the Contrast UI. This event is an unsuccessful attempt at an exploit. They can indicate an attack fuzzing and looking for vulnerabilities.\\n\\n- Does the probe event appear to be caused by legitimate traffic and numerous similar probe events are being generated, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured to clean up Contrast data.  \\n- Is the probe originating from a specific ip[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?   Consider  \\n  - Block using network appliance\\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account  \\n  - Determine if the account is a legitimate account\\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \\n\\n\\n## Handling Process Hardening  \\n\\nProcess Hardening refers to a block that the agent applies to the application to be able to start external processes. Most web applications have no reason to launch external processes so this rule is intended to ensure that no attempts are made by an application to do so.\\n\\nWhen triaging this event type the key is in understanding if the web application starts external processes under normal conditions.\\n\\nChoose the Appropriate Action:  \\nIf the application should NOT start external processes:\\n- Enable Block Mode: This will prevent the application from launching any external processes, ensuring maximum security.  \\n\\nIf the application DOES need to start external processes:\\n\\n- Monitor Mode (Recommended): Start with monitor mode to observe the commands the application executes. This helps identify legitimate use cases and potential risks without disrupting normal functionality.\\n- Exclusions: If monitoring reveals legitimate needs, configure an exclusion to allow only specific, trusted external processes to run. Once all legitimate executions are accounted for, the rule can be placed into Block mode.\\n- Disable the Rule (Use with Caution): If the application requires external process execution and other options are not feasible consider disabling the rule.\"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRCmdInjectionWorkbook; logoFileName=ContrastADR.svg; description=Command injection is a malicious technique where attackers exploit vulnerabilities in web applications to inject and execute arbitrary operating system (OS) commands on the server. By manipulating input data, attackers can manipulate the application's execution flow, tricking it into running unintended system commands.This can result in data breaches, system compromise, etc. Contrast uses various detection capabilities for Command Injection. Some track malicious input into commands being run, some detect sensitive file paths being accessed, and so forth. ; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Command Injection Runbook; templateRelativePath=ContrastADR_Command_Injection_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_Cross_Site_Scripting_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId2')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Cross-site scripting (XSS) is a type of web security vulnerability that allows an attacker to inject malicious JavaScript code into websites viewed by other users. Instead of the website displaying trusted content, the attacker's code is executed, which can compromise user accounts, steal sensitive data, or even take control of the user's browser"
              },
              "properties": {
                "displayName": "[parameters('workbook2-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"---\\nlayout: runbook\\ntitle: \\\"Cross-Site Scripting (XSS)\\\"\\ndescription: \\\"Guide for handling cross-site scripting vulnerabilities where attackers inject malicious JavaScript code into websites viewed by other users\\\"\\n---\\n\\n<!-- \\\\ or two whitespaces used for line breaks -->\\n# Cross-Site Scripting (XSS) Runbook\\n\\nCross-site scripting (XSS) is a type of web security vulnerability that allows an attacker to inject malicious JavaScript code into websites viewed by other users. Instead of the website displaying trusted content, the attacker's code is executed, which can compromise user accounts, steal sensitive data, or even take control of the user's browser.\\n\\n  \\n  \\n\\nExample Event - Blocked outcome Cross-Site Scripting (XSS)  \\n`Oct 08 10:43:57 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The querystring QUERYSTRING had a value that successfully exploited reflected-xss - message=%3Cscript%3Ealert(document.domain(%3C/script%3E|WARN|pri=reflected-xss src=1.1.1.1 spt=8080 request=/error requestMethod=GET app=webapplication outcome=BLOCKED`\\n  \\n\\nExample Event 1 - Suspicious outcome Cross-Site Scripting (XSS)  \\n`Oct 08 08:28:20 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The parameter message had a value that that was marked suspicious reflected-xss - <script>alert(document.domain)</script>|WARN|pri=reflected-xss src=1.1.1.1 spt=8080 request=/xss requestMethod=GET app=webapplication outcome=SUSPICIOUS`  \\n  \\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n\\n- [Blocked](#blocked)\\n- [Suspicious](#suspicious)\\n- [Success](#success)\\n\\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" means Contrast detected an input coming into an application that looked like a cross-site scripting attack and subsequently blocked it.   \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Are HTML tags included in the payload? (<>,  </>)\\n- Are suspicious HTML attributes present in the payload? (onerror, onload, onfocus, etc)\\n- Look for any suspicious protocols within the payload, such as javascript: or data:.\\n- Are there application logs with relevant error messages?\\n\\n\\nExamples:\\n\\n- `<script>alert('XSS')</script>`\\n- `<img src=x onerror=alert('XSS')>`\\n- `<a href='javascript:alert(1)'>Click me</a>`\\n- `javascript:alert(1)`\\n- `data:text/html,<script>alert(1)</script>`  \\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n## Suspicious\\n\\n\\\"Suspicious\\\" means Contrast detected an input coming into an application that looked like a cross-site scripting payload. Contrast reports suspicious for non-input tracing rules where Contrast is unable to verify that an attack occurred, and the rule is in monitor mode.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Are HTML tags included in the payload? (<>,  </>)\\n- Are suspicious HTML attributes present in the payload? (onerror, onload, onfocus, etc)\\n- Look for any suspicious protocols within the payload, such as javascript: or data:.\\n- Are there application logs with relevant error messages?\\n\\n\\nExamples:\\n\\n- `<script>alert('XSS')</script>`\\n- `<img src=x onerror=alert('XSS')>`\\n- `<a href='javascript:alert(1)'>Click me</a>`\\n- `javascript:alert(1)`\\n- `data:text/html,<script>alert(1)</script>`  \\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#suspicious-false-positive)  \\n- [Yes, or unsure](#suspicious-true-positive) \\n\\n\\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n## Suspicious True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be switched to Block mode which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a Virtual Patch that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Suspicious False Positive\\n\\nIf the event seems to be a False Positive, consider the following options:\\n- Ignore\\n- Create Exclusion  \\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId2'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRXSSWorkbook; logoFileName=ContrastADR.svg; description=Cross-site scripting (XSS) is a type of web security vulnerability that allows an attacker to inject malicious JavaScript code into websites viewed by other users. Instead of the website displaying trusted content, the attacker's code is executed, which can compromise user accounts, steal sensitive data, or even take control of the user's browser; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Cross-site scripting (XSS) Runbook; templateRelativePath=ContrastADR_Cross_Site_Scripting_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId2')]",
                "contentId": "[variables('_workbookContentId2')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId2')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook2-name')]",
        "contentProductId": "[variables('_workbookcontentProductId2')]",
        "id": "[variables('_workbookcontentProductId2')]",
        "version": "[variables('workbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_Expression_Language_Injection_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId3')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Expression Language Injection works by taking advantage of server-side code injection vulnerabilities which occur whenever an application incorporates user-controllable data into a string that is dynamically evaluated by a code interpreter. This can lead to complete compromise of the application's data and functionality, as well as the server that is hosting the application."
              },
              "properties": {
                "displayName": "[parameters('workbook3-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Expression Language Injection Runbook\\n\\nExpression Language Injection works by taking advantage of server-side code injection vulnerabilities which occur whenever an application incorporates user-controllable data into a string that is dynamically evaluated by a code interpreter. This can lead to complete compromise of the application's data and functionality, as well as the server that is hosting the application.\\n\\n\\nExample Event - Exploited outcome Expression Language Injection  \\n`Oct 22 2024 12:09:18.532-0600 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.5.4|SECURITY|The parameter message had a value that successfully exploited expression-language-injection - T(java.lang.Runtime).getRuntime().exec(\\\"whoami\\\")|WARN|pri=expression-language-injection src=0:0:0:0:0:0:0:1 spt=8080 request=/hello requestMethod=GET app=webapplication outcome=EXPLOITED`  \\n  \\n  \\n\\nExample Event - Blocked outcome Expression Language Injection  \\n`Oct 22 2024 12:14:22.969-0600 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.5.4|SECURITY|The parameter message had a value that successfully exploited expression-language-injection - T(java.lang.Runtime).getRuntime().exec(\\\"whoami\\\")|WARN|pri=expression-language-injection src=0:0:0:0:0:0:0:1 spt=8080 request=/hello requestMethod=GET app=webapplication outcome=BLOCKED`\\n  \\n  \\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n\\n\\n\"},\"name\":\"text - 0\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"bullets\",\"links\":[{\"id\":\"13537818-d586-43a4-a87f-ad664f670754\",\"cellValue\":\"text - 1\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Exploited\",\"style\":\"link\"},{\"id\":\"a48af7b2-67f0-4397-94f4-2f2126477b44\",\"cellValue\":\"text - 4\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Blocked\",\"style\":\"link\"},{\"id\":\"6b58baab-561b-44f9-9dfb-759e8daa92a9\",\"cellValue\":\"text - 5\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Ineffective\",\"style\":\"link\"},{\"id\":\"7ff38bea-4a89-45f8-874c-af9d28c744f8\",\"cellValue\":\"text - 6\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Success\",\"style\":\"link\"}]},\"name\":\"links - 3\"},{\"type\":1,\"content\":{\"json\":\"## [Exploited](#Specific Section)\\n\\nAn \\\"Exploited\\\" outcome indicates that Contrast detected an input entering an application that resembled Expression Language Injection. It then confirmed that this input was utilized in the evaluation of the expression language.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Does the payload contain references to Java classes or methods?\\n- Does the payload contain os commands?\\n- Does the payload contain template engine expressions? (e.g. ${...}, #{...}, *{...})\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there application logs with template engine related error messages around the same timestamp as the event?\\n\\n\\n\\nExamples:\\n\\n- `T(java.lang.Runtime).getRuntime().exec(\\\"whoami\\\")`\\n- `${pageContext.request.getSession().setAttribute(\\\"admin\\\",true)}`\\n- `*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}`  \\n\\nDoes the event appear to be a true positive? (click to proceed)\"},\"name\":\"text - 1\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"bullets\",\"links\":[{\"id\":\"b81eafea-442c-440f-b906-8c24456f5a56\",\"cellValue\":\"Exploited True Positive\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"No\",\"style\":\"link\"},{\"id\":\"3ae6e50a-18e2-43c5-80a9-4426acd82f77\",\"cellValue\":\"Exploited False Positive\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Yes, or unsure\",\"style\":\"link\"}]},\"name\":\"links - 8\"},{\"type\":1,\"content\":{\"json\":\"## [Blocked](#Specific Section)\\n\\nA \\\"Blocked\\\" outcome indicates that Contrast detected an input entering an application that resembled Expression Language Injection. It then confirmed that this input was going to be evaluated by the expression language and therefore blocked it.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Does the payload contain references to Java classes or methods?\\n- Does the payload contain os commands?\\n- Does the payload contain template engine expressions? (e.g. ${...}, #{...}, *{...})\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there application logs with template engine related error messages around the same timestamp as the event?\\n\\n\\nExamples:\\n\\n- `T(java.lang.Runtime).getRuntime().exec(\\\"whoami\\\")`\\n- `${pageContext.request.getSession().setAttribute(\\\"admin\\\",true)}`\\n- `*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}`  \\n\\n\\nIs the event a true positive? (click to proceed)\\n\"},\"name\":\"text - 4\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"bullets\",\"links\":[{\"id\":\"db9b6c24-804e-4b55-a99f-174f4ac9eeb2\",\"cellValue\":\"Blocked False Positive\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"No\",\"style\":\"link\"},{\"id\":\"7331f254-ec3d-446e-ad1b-c2806829e8bc\",\"cellValue\":\"Blocked True Positive  \",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Yes, or unsure\",\"style\":\"link\"}]},\"name\":\"links - 10\"},{\"type\":1,\"content\":{\"json\":\"## [Ineffective](#specific section)\\n\\n\\\"Ineffective\\\" means Contrast detected an input coming into an application that looked like Expression Language injection, but did not confirm that the input was used evaluated by the expression template engine. This is called a Probe within the Contrast UI. This event is a real attack attempt to exploit your application, but it was ineffective. Probes can indicate an attacker scanning or exploring for vulnerabilities.\\n\\n- Does the probe event appear to be caused by legitimate traffic and numerous similar probe events are being generated, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured to clean up Contrast data.  \\n- Is the probe originating from a specific ip[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?   Consider  \\n  - Block using network appliance\\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account  \\n  - Determine if the account is a legitimate account\\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\"},\"name\":\"text - 5\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"paragraph\",\"links\":[{\"id\":\"51619ff1-9791-410f-8c0d-8d75379b5854\",\"cellValue\":\" Post-Incident Activities\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Proceed to Post-Incident Activities \",\"style\":\"link\"}]},\"name\":\"links - 17\"},{\"type\":1,\"content\":{\"json\":\"## [Exploited True Positive](#Specific)  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#Benign True Positive).  \\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n\"},\"name\":\"Exploited True Positive\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"paragraph\",\"links\":[{\"id\":\"5ded8c64-aabe-462b-a96f-0b5642790def\",\"cellValue\":\" Post-Incident Activities\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Proceed to Post-Incident Activities\",\"style\":\"link\"}]},\"name\":\"links - 14 - Copy - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"## [Exploited False Positive](#specific)  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\"},\"name\":\"Exploited False Positive\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"paragraph\",\"links\":[{\"id\":\"27278e32-0ca0-4062-872b-7d3c5fb40b11\",\"cellValue\":\" Post-Incident Activities\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Proceed to Post-Incident Activities\",\"style\":\"link\"}]},\"name\":\"links - 14 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"## [Blocked True Positive](#specific)  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n  \\n\"},\"name\":\"Blocked True Positive  \"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"paragraph\",\"links\":[{\"id\":\"5fdd5864-d9b1-47e1-bca7-1a036db959c1\",\"cellValue\":\" Post-Incident Activities\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Proceed to Post-Incident Activities\",\"style\":\"link\"}]},\"name\":\"links - 14 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## [Blocked False Positive](#specific)\\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\"},\"name\":\"Blocked False Positive\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"paragraph\",\"links\":[{\"id\":\"32415132-dc77-4859-980d-fb0a2b8b8c8e\",\"cellValue\":\" Post-Incident Activities\",\"linkTarget\":\"step\",\"linkLabel\":\"link\",\"preText\":\"Proceed to Post-Incident Activities\",\"style\":\"link\"}]},\"name\":\"links - 14\"},{\"type\":1,\"content\":{\"json\":\"## [Benign True Positive](#specific)\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\"},\"name\":\"Benign True Positive\"},{\"type\":1,\"content\":{\"json\":\"## [Post-Incident Activities](#specific)\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\" Post-Incident Activities\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId3'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRExpressionLanguageInjectionWorkbook; logoFileName=ContrastADR.svg; description=Expression Language Injection works by taking advantage of server-side code injection vulnerabilities which occur whenever an application incorporates user-controllable data into a string that is dynamically evaluated by a code interpreter. This can lead to complete compromise of the application's data and functionality, as well as the server that is hosting the application.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Expression Language Injection Runbook; templateRelativePath=ContrastADR_Expression_Language_Injection_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId3')]",
                "contentId": "[variables('_workbookContentId3')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId3')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook3-name')]",
        "contentProductId": "[variables('_workbookcontentProductId3')]",
        "id": "[variables('_workbookcontentProductId3')]",
        "version": "[variables('workbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_HTTP_Method_Tampering_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId4')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Method Tampering (aka verb tampering or HTTP method tampering) is an attack where an attacker manipulates the HTTP method used in a request to a web application. Providing unexpected HTTP methods can sometimes bypass authentication, authorization or other security mechanisms."
              },
              "properties": {
                "displayName": "[parameters('workbook4-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# HTTP Method Tampering Runbook\\n\\nMethod Tampering (aka verb tampering or HTTP method tampering) is an attack where an attacker manipulates the HTTP method used in a request to a web application. Providing unexpected HTTP methods can sometimes bypass authentication, authorization or other security mechanisms.\\n\\n\\nExample Event - Exploited outcome HTTP Method Tampering  \\n`Oct 21 08:58:55 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The input METHOD had a value that successfully exploited method-tampering - SOMEMETHOD|WARN|pri=method-tampering src=0:0:0:0:0:0:0:1 spt=8080 request=/error requestMethod=com.contrastsecurity.agent.contrastapi_v1_0.RequestMethod$1@1cf573b7 app=webapplication outcome=EXPLOITED`  \\n  \\n  \\n\\nExample Event - Blocked outcome HTTP Method Tampering  \\n`Oct 21 09:00:03 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The input METHOD had a value that successfully exploited method-tampering - SOMEMETHOD|WARN|pri=method-tampering src=0:0:0:0:0:0:0:1 spt=8080 request=/ requestMethod=com.contrastsecurity.agent.contrastapi_v1_0.RequestMethod$1@12076e97 app=webapplication outcome=BLOCKED`\\n  \\n  \\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\n\\\"Exploited\\\" means Contrast detected an abnormal HTTP method used in an incoming request, and the response code was not a 501 or 405 indicating the request was processed.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Does the request contain an abnormal HTTP method? (e.g one that is not defined in the HTTP RFC)\\n- Is the HTTP response code not a 501 or 405?\\n- Does the HTTP method make sense in the context of the application? (e.g a DELETE request to a static resource)\\n\\n\\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" means Contrast detected an abnormal HTTP method used in an incoming request, therefore blocked execution of the request.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Does the request contain an abnormal HTTP method? (e.g one that is not defined in the HTTP RFC)\\n- Is the HTTP response code not a 501 or 405?\\n- Does the HTTP method make sense in the context of the application? (e.g a DELETE request to a static resource)\\n\\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\"text - 2\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId4'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRHTTPMethodTamperingWorkbook; logoFileName=ContrastADR.svg; description=Method Tampering (aka verb tampering or HTTP method tampering) is an attack where an attacker manipulates the HTTP method used in a request to a web application. Providing unexpected HTTP methods can sometimes bypass authentication, authorization or other security mechanisms.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=HTTP Method Tampering Runbook; templateRelativePath=ContrastADR_HTTP_Method_Tampering_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId4')]",
                "contentId": "[variables('_workbookContentId4')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId4')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook4-name')]",
        "contentProductId": "[variables('_workbookcontentProductId4')]",
        "id": "[variables('_workbookcontentProductId4')]",
        "version": "[variables('workbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_JNDI_Injection_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId5')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "JNDI injection is a malicious technique where attackers exploit vulnerabilities in web applications to influence the server used in a JNDI lookup. Where an attacker can influence the server the JNDI Lookup is sent to, it is possible to get the server to connect to a malicious JNDI Server which returns a malicious class which when loaded will give the attacker Remote Code Execution on the impacted server. Also in the case of infamous log4shell vulnerability, as well as RCE, it is possible to exfiltrate data fro the impacted server."
              },
              "properties": {
                "displayName": "[parameters('workbook5-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# JNDI Injection Runbook\\n\\nJNDI injection is a malicious technique where attackers exploit vulnerabilities in web applications to influence the server used in a JNDI lookup. Where an attacker can influence the server the JNDI Lookup is sent to, it is possible to get the server to connect to a malicious JNDI Server which returns a malicious class which when loaded will give the attacker Remote Code Execution on the impacted server. Also in the case of infamous log4shell vulnerability, as well as RCE, it is possible to exfiltrate data fro the impacted server.\\n\\n\\nExample Event - Exploited outcome JNDI Injection  \\n`Oct 17 10:53:34 172.19.0.2 CEF:0|Contrast Security|Contrast Agent Java|6.7.0|SECURITY|The input UNKNOWN had a value that successfully exploited jndi-injection - null|WARN|pri=jndi-injection src=172.19.0.5 spt=8081 request=/registerEmail requestMethod=POST app=Petclinic-burp-demo-jb-2-Email-Service outcome=EXPLOITED`  \\n  \\n  \\n\\nExample Event - Blocked outcome JNDI Injection  \\n`Oct 17 12:04:07 172.19.0.2 CEF:0|Contrast Security|Contrast Agent Java|6.7.0|SECURITY|The input UNKNOWN had a value that successfully exploited jndi-injection - null|WARN|pri=jndi-injection src=172.19.0.5 spt=8081 request=/registerEmail requestMethod=POST app=Petclinic-burp-demo-jb-2-Email-Service outcome=BLOCKED`\\n  \\n  \\n\\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\nAn \\\"Exploited\\\" outcome means Contrast detected an input coming into an application that is then used to create a JNDI Query with the protocol RMI or LDAP.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- An unknown LDAP or RMI Server.\\n\\n\\n\\n\\nExamples:\\n\\n- `jndi:ldap://example.com:1389/jdk8`\\n- `jndi:rmi://example.com:1389/jdk8`\\n- `jndi:ldap://${env:USER}.${env:USERNAME}.example.com:1389/`  \\n\\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" outcome means Contrast detected an input coming into an application that is then used to create a JNDI Query with the protocol RMI or LDAP and Contrast stopped the Query from executing.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- An unknown LDAP or RMI Server.\\n\\n\\n\\nExamples:\\n\\n- `jndi:ldap://example.com:1389/jdk8`\\n- `jndi:rmi://example.com:1389/jdk8`\\n- `jndi:ldap://${env:USER}.${env:USERNAME}.example.com:1389/`  \\n\\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId5'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRJNDIInjectionWorkbook; logoFileName=ContrastADR.svg; description=JNDI injection is a malicious technique where attackers exploit vulnerabilities in web applications to influence the server used in a JNDI lookup. Where an attacker can influence the server the JNDI Lookup is sent to, it is possible to get the server to connect to a malicious JNDI Server which returns a malicious class which when loaded will give the attacker Remote Code Execution on the impacted server. Also in the case of infamous log4shell vulnerability, as well as RCE, it is possible to exfiltrate data fro the impacted server.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=JNDI Injection Runbook; templateRelativePath=ContrastADR_JNDI_Injection_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId5')]",
                "contentId": "[variables('_workbookContentId5')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId5')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook5-name')]",
        "contentProductId": "[variables('_workbookcontentProductId5')]",
        "id": "[variables('_workbookcontentProductId5')]",
        "version": "[variables('workbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_Path_Traversal_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId6')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Path traversal attacks use an affected application to gain unauthorized access to server file system folders that are higher in the directory hierarchy than the web root folder. A successful path traversal attack can fool a web application into reading and consequently exposing the contents of files outside of the document root directory of the application or the web server, including credentials for back-end systems, application code and data, and sensitive operating system files. If successful this can lead to unauthorized data access, data exfiltration, and remote code execution."
              },
              "properties": {
                "displayName": "[parameters('workbook6-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Path Traversal Runbook\\n\\nPath traversal attacks use an affected application to gain unauthorized access to server file system folders that are higher in the directory hierarchy than the web root folder. A successful path traversal attack can fool a web application into reading and consequently exposing the contents of files outside of the document root directory of the application or the web server, including credentials for back-end systems, application code and data, and sensitive operating system files. If successful this can lead to unauthorized data access, data exfiltration, and remote code execution.\\n\\n\\nExample Event - Exploited outcome Path Traversal  \\n`Oct 04 12:33:38 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The parameter file had a value that successfully exploited path-traversal - ../../../etc/passwd|WARN|pri=path-traversal src=1.1.1.1 spt=8080 request=/file requestMethod=GET app=Web Application outcome=EXPLOITED`  \\n  \\n\\nExample Event - Probed (or Ineffective) outcome Path Traversal  \\n`Oct 04 12:29:32 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The URI URI had a value that matched a signature for, but did not successfully exploit, path-traversal - /file=/etc/passwd|WARN|pri=path-traversal src=1.1.1.1 spt=8080 request=/file=/etc/passwd requestMethod=GET app=Web Application outcome=INEFFECTIVE` \\n  \\n  \\n  \\n\\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n- [Ineffective](#ineffective)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\nAn \\\"Exploited\\\" outcome means Contrast detected an input resembling a Path Traversal attack that reached a vulnerable file operation, and then successfully manipulated that operation to access a file outside the intended directory.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Are there plain or encoded path traversal sequences present? (../, %2e%2e%2f)\\n- Are suspicious files or paths being requested? (/etc/shadow, /etc/passwd, c:\\\\windows\\\\system32\\\\, etc)\\n- Are any known file security bypasses present in the file path? (::$DATA, ::$Index, (null byte))\\n- Are unexpected files present in the filesystem?\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there application logs with file operation related error messages around the same timestamp as the event?\\n\\n\\n\\n\\nExamples:\\n\\n- `../../../etc/passwd`\\n- `%2e%2e%2fetc%2fpasswd`\\n- `\\\\../\\\\../\\\\etc/\\\\password`\\n- `..0x2f..0x2fetc0x2fpasswd`  \\n\\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" means Contrast detected an input resembling a Path Traversal attack that reached a vulnerable file operation, and therefore blocked the application from performing the operation  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Are there plain or encoded path traversal sequences present? (../, %2e%2e%2f)\\n- Are suspicious files or paths being requested? (/etc/shadow, /etc/passwd, c:\\\\windows\\\\system32\\\\, etc)\\n- Are any known file security bypasses present in the file path? (::$DATA, ::$Index, (null byte))\\n- Are unexpected files present in the filesystem?\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there application logs with file operation related error messages around the same timestamp as the event?\\n\\n\\n\\nExamples:\\n\\n- `../../../etc/passwd`\\n- `%2e%2e%2fetc%2fpasswd`\\n- `\\\\../\\\\../\\\\etc/\\\\password`\\n- `..0x2f..0x2fetc0x2fpasswd`  \\n\\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Ineffective\\n\\n\\\"Ineffective\\\" means Contrast detected an input coming into an application that looked like Path Traversal, but did not confirm that the input was used in a file operation. This is called a Probe within the Contrast UI. This event is a real attack attempt to exploit your application, but it was ineffective. Probes can indicate an attacker scanning or exploring for vulnerabilities.\\n\\n- Does the probe event appear to be caused by legitimate traffic and numerous similar probe events are being generated, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured to clean up Contrast data.  \\n- Is the probe originating from a specific ip[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?   Consider  \\n  - Block using network appliance\\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account  \\n  - Determine if the account is a legitimate account\\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId6'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRPathTraversalWorkbook; logoFileName=ContrastADR.svg; description=Path traversal attacks use an affected application to gain unauthorized access to server file system folders that are higher in the directory hierarchy than the web root folder. A successful path traversal attack can fool a web application into reading and consequently exposing the contents of files outside of the document root directory of the application or the web server, including credentials for back-end systems, application code and data, and sensitive operating system files. If successful this can lead to unauthorized data access, data exfiltration, and remote code execution.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Path Traversal Runbook; templateRelativePath=ContrastADR_Path_Traversal_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId6')]",
                "contentId": "[variables('_workbookContentId6')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId6')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook6-name')]",
        "contentProductId": "[variables('_workbookcontentProductId6')]",
        "id": "[variables('_workbookcontentProductId6')]",
        "version": "[variables('workbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_SQL_Injection_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId7')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "SQL injection is a malicious technique where attackers exploit vulnerabilities in web applications to inject unauthorized SQL commands into the database. By carefully crafting input data, attackers can manipulate the SQL queries executed by the application, potentially leading to unauthorized data access, data modification, or even complete database compromise."
              },
              "properties": {
                "displayName": "[parameters('workbook7-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# SQL Injection Runbook\\n\\nSQL injection is a malicious technique where attackers exploit vulnerabilities in web applications to inject unauthorized SQL commands into the database. By carefully crafting input data, attackers can manipulate the SQL queries executed by the application, potentially leading to unauthorized data access, data modification, or even complete database compromise.\\n\\n\\nExample Event - Exploited outcome SQL Injection  \\n`Jul 18 2024 13:14:35.717-0400 192.168.0.158 CEF:0|Contrast Security|Contrast Agent Java|6.5.4|SECURITY|The parameter lastName had a value that successfully exploited sql-injection - doe' or 1=1 AND|WARN|pri=sql-injection src=0:0:0:0:0:0:0:1 spt=8080 request=/customers requestMethod=GET app=Web Application outcome=EXPLOITED`  \\n  \\n\\nExample Event - Probed (or Ineffective) outcome SQL Injection  \\n`Jul 18 2024 13:14:35.740-0400 192.168.0.158 CEF:0|Contrast Security|Contrast Agent Java|6.5.4|SECURITY|The parameter lastName had a value that matched a signature for, but did not successfully exploit, sql-injection - doe' or 1=1 AND|WARN|pri=sql-injection src=0:0:0:0:0:0:0:1 spt=8080 request=/error requestMethod=GET app=Web Application outcome=INEFFECTIVE` \\n  \\n  \\n  \\n\\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n- [Ineffective](#ineffective)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\nAn \\\"Exploited\\\" outcome means Contrast detected an input coming into an application that looked like SQL injection, and then confirmed the input was used in a SQL query that modified the meaning of that query.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Are there SQL Keywords (JOIN, UNION, DROP, SELECT, AND, OR, SLEEP, etc) that change the logic of the query?\\n- Are there SQL tautologies (1=1, test=test, and so on) that may change the boolean logic of an AND or OR statement?\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there SQL comments that comment-out parts of the query?\\n- Are there unusual query execution times or error messages related to SQL around the same timestamp as the event?\\n- Are there application logs with SQL error messages around the same timestamp as the event?\\n\\n\\n\\n\\nExamples:\\n\\n- `DROP sampletable;--`\\n- `' or 1=1--`\\n- `' UNION SELECT 1, 'anotheruser', 'doesnt matter', 1`\\n- `?id=1 AND (SELECT * FROM (SELECT NAME_CONST(database(),1),NAME_CONST(database(),1)) as x)--`\\n- `select load_file('\\\\\\\\error\\\\abc');`\\n- `?id=1 OR IF(MID(@@version,1,1)='5',sleep(1),1)='2'`  \\n\\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" means Contrast detected an input coming into an application that looked like SQL injection and then confirmed the input was used in a SQL query and modified the meaning of that query, and therefore blocked the application from performing the query.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Are there SQL Keywords (JOIN, UNION, DROP, SELECT, AND, OR, SLEEP, etc) that change the logic of the query?\\n- Are there SQL tautologies (1=1, test=test, and so on) that may change the boolean logic of an AND or OR statement?\\n- Is the IP address from a pentester or known vulnerability scanner IP?\\n- Are there SQL comments that comment-out parts of the query?\\n- Are there unusual query execution times or error messages related to SQL around the same timestamp as the event?\\n- Are there application logs with SQL error messages around the same timestamp as the event?\\n\\n\\n\\nExamples:\\n\\n- `DROP sampletable;--`\\n- `' or 1=1--`\\n- `' UNION SELECT 1, 'anotheruser', 'doesnt matter', 1`\\n- `?id=1 AND (SELECT * FROM (SELECT NAME_CONST(database(),1),NAME_CONST(database(),1)) as x)--`\\n- `select load_file('\\\\\\\\error\\\\abc');`\\n- `?id=1 OR IF(MID(@@version,1,1)='5',sleep(1),1)='2'`  \\n\\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Ineffective\\n\\n\\\"Ineffective\\\" means Contrast detected an input coming into an application that looked like SQL injection, but did not confirm that the input was used in a SQL query and modified the meaning of that query.. This is called a Probe within the Contrast UI. This event is a real attack attempt to exploit your application, but it was ineffective. Probes can indicate an attacker scanning or exploring for vulnerabilities.\\n\\n- Does the probe event appear to be caused by legitimate traffic and numerous similar probe events are being generated, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured to clean up Contrast data.  \\n- Is the probe originating from a specific ip[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?   Consider  \\n  - Block using network appliance\\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account  \\n  - Determine if the account is a legitimate account\\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\n\\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId7'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRSQLInjectionWorkbook; logoFileName=ContrastADR.svg; description=SQL injection is a malicious technique where attackers exploit vulnerabilities in web applications to inject unauthorized SQL commands into the database. By carefully crafting input data, attackers can manipulate the SQL queries executed by the application, potentially leading to unauthorized data access, data modification, or even complete database compromise.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=SQL Injection Runbook; templateRelativePath=ContrastADR_SQL_Injection_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId7')]",
                "contentId": "[variables('_workbookContentId7')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId7')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook7-name')]",
        "contentProductId": "[variables('_workbookcontentProductId7')]",
        "id": "[variables('_workbookcontentProductId7')]",
        "version": "[variables('workbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_Untrusted_Deserialization_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId8')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Serialization refers to the process of converting an object into a format which can be saved to a file or a datastore. Deserialization reverses this process, transforming serialized data coming from a file, stream, or network socket into an object.Untrusted Deserialization is a web application vulnerability that enables attackers to pass arbitrary objects or code to a deserializer. In this kind of attack, untrusted data abuses the logic of an application to inflict a denial of service (DoS) attack, achieve authentication bypass, enable remote code execution, and even execute arbitrary code as it is being deserialized."
              },
              "properties": {
                "displayName": "[parameters('workbook8-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Untrusted Deserialization Runbook\\n\\nSerialization refers to the process of converting an object into a format which can be saved to a file or a datastore. Deserialization reverses this process, transforming serialized data coming from a file, stream, or network socket into an object.Untrusted Deserialization is a web application vulnerability that enables attackers to pass arbitrary objects or code to a deserializer. In this kind of attack, untrusted data abuses the logic of an application to inflict a denial of service (DoS) attack, achieve authentication bypass, enable remote code execution, and even execute arbitrary code as it is being deserialized.\\n\\n\\nExample Event - Exploited outcome Untrusted Deserialization  \\n`Oct 18 12:36:11 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The input UNKNOWN had a value that successfully exploited untrusted-deserialization - java.net.URL|WARN|pri=untrusted-deserialization src=0:0:0:0:0:0:0:1 spt=8080 request=/deserialize requestMethod=GET app=webapplication outcome=EXPLOITED`  \\n  \\n  \\n\\nExample Event - Blocked outcome Untrusted Deserialization  \\n`Oct 18 12:39:34 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The input UNKNOWN had a value that successfully exploited untrusted-deserialization - java.net.URL|WARN|pri=untrusted-deserialization src=0:0:0:0:0:0:0:1 spt=8080 request=/deserialize requestMethod=GET app=webapplication outcome=BLOCKED`\\n  \\n  \\n\\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n- [Ineffective](#ineffective)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\n\\\"Exploited\\\" means Contrast detected serialized input coming into the application and then confirmed it was subsequently deserialized and contained a known vulnerable gadget token, or an operating system command was executed as part of the deserialization process.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Did the application deserialize data from user controllable input?\\n- Does the decoded payload look like a binary object?\\n- Does the payload represent a Java serialized object? (It should start with 'rO0AB')\\n- Does the payload represent a .NET serialized object? (It should start with 'AAEAAAD')\\n- Are there application logs with serialization error messages around the same timestamp as the event?\\n\\n\\n\\n\\nExamples:\\n\\n- `.Net - AAEAAAD/////AQAAAAAAAAAMAgAAAF9TeXN0ZW0u[...]0KPC9PYmpzPgs=`\\n- `Java - rO0ABXNyABFqYXZhL[...]D//////////3QACmdvb2GUuY29teA==`  \\n\\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" means Contrast detected serialized input coming into the application and then confirmed it was being deserialized with a known vulnerable gadget token and therefore blocked the execution of it.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Did the application deserialize data from user controllable input?\\n- Does the decoded payload look like a binary object?\\n- Does the payload represent a Java serialized object? (It should start with 'rO0AB')\\n- Does the payload represent a .NET serialized object? (It should start with 'AAEAAAD')\\n- Are there application logs with serialization error messages around the same timestamp as the event?\\n\\n\\n\\nExamples:\\n\\n- `.Net - AAEAAAD/////AQAAAAAAAAAMAgAAAF9TeXN0ZW0u[...]0KPC9PYmpzPgs=`\\n- `Java - rO0ABXNyABFqYXZhL[...]D//////////3QACmdvb2GUuY29teA==`  \\n\\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Ineffective\\n\\n\\\"Ineffective\\\" means that Contrast detected an input resembling a serialized string but did not confirm it was deserialized unsafely. This is called a Probe within the Contrast UI. This event is an unsuccessful attempt at an exploit. They can indicate an attack fuzzing and looking for vulnerabilities.\\n\\n- Does the probe event appear to be caused by legitimate traffic and numerous similar probe events are being generated, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured to clean up Contrast data.  \\n- Is the probe originating from a specific ip[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?   Consider  \\n  - Block using network appliance\\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account  \\n  - Determine if the account is a legitimate account\\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\n\\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.  \"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId8'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRUntrustedDeserializationWorkbook; logoFileName=ContrastADR.svg; description=Serialization refers to the process of converting an object into a format which can be saved to a file or a datastore. Deserialization reverses this process, transforming serialized data coming from a file, stream, or network socket into an object.Untrusted Deserialization is a web application vulnerability that enables attackers to pass arbitrary objects or code to a deserializer. In this kind of attack, untrusted data abuses the logic of an application to inflict a denial of service (DoS) attack, achieve authentication bypass, enable remote code execution, and even execute arbitrary code as it is being deserialized.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=Untrusted Deserialization Runbook; templateRelativePath=ContrastADR_Untrusted_Deserialization_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId8')]",
                "contentId": "[variables('_workbookContentId8')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId8')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook8-name')]",
        "contentProductId": "[variables('_workbookcontentProductId8')]",
        "id": "[variables('_workbookcontentProductId8')]",
        "version": "[variables('workbookVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "ContrastADR_XML External_Entity_Injection_Injection_Workbook Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion9')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId9')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "XXE is a flaw in XML parsers where attackers can cause the parser to read local or remote resources as part of the document. Attackers often abuse this functionality to access other sensitive system information."
              },
              "properties": {
                "displayName": "[parameters('workbook9-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# XML External Entity Injection Runbook\\n\\nXXE is a flaw in XML parsers where attackers can cause the parser to read local or remote resources as part of the document. Attackers often abuse this functionality to access other sensitive system information.\\n\\n\\nExample Event - Exploited outcome XML External Entity Injection  \\n`Oct 18 10:37:49 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The input XML Prolog had a value that successfully exploited xxe - <?xml version\\\\=\\\\1.0\\\" encoding\\\\=\\\"UTF-8\\\"?> <!DOCTYPE foo [<!ENTITY example SYSTEM \\\"/etc/passwd\\\"> ]> <data>&example;</data> |WARN|pri=xxe src=0:0:0:0:0:0:0:1 spt=8080 request=/parse-xml requestMethod=POST app=web-application outcome=EXPLOITED`  \\n  \\n  \\n\\nExample Event - Blocked outcome XML External Entity Injection  \\n`Oct 18 10:58:06 192.168.12.70 CEF:0|Contrast Security|Contrast Agent Java|6.9.0|SECURITY|The input XML Prolog had a value that successfully exploited xxe - <?xml version\\\\=\\\"1.0\\\" encoding\\\\=\\\"UTF-8\\\"?> <!DOCTYPE foo [<!ENTITY example SYSTEM \\\"/etc/passwd\\\"> ]> <data>&example;</data> |WARN|pri=xxe src=0:0:0:0:0:0:0:1 spt=8080 request=/parse-xml requestMethod=POST app=web-application outcome=BLOCKED`\\n  \\n  \\n\\n\\n\\nWhat is the outcome of the event you are triaging? (click to proceed)  \\n\\n- [Exploited](#exploited)\\n- [Blocked](#blocked)\\n- [Ineffective](#ineffective)\\n- [Success](#success)\\n\\n\\n## Exploited\\n\\n\\\"Exploited\\\" indicates that Contrast detected an incoming input resembling an XML string containing external entities and then confirmed the declared entities were resolved by the XML parser.  \\n\\nTo verify this is a true positive, review the following attributes of the event for common indicators:  \\n\\n- Are entity declaration keywords present in the payload? (<!ENTITY, SYSTEM, PUBLIC, etc)\\n- Are there references to external entities in the payload? (&example;)\\n- Are there references to local files in the payload? (file:///, /etc/passwd, etc)\\n- Are there references to remote files in the payload? (http://, https://, etc)\\n- Are there application logs with XML parsing error messages around the same timestamp as the event?\\n\\n\\n\\n\\nExamples:\\n\\n- `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><!DOCTYPE foo [<!ENTITY example SYSTEM \\\"/etc/passwd\\\"> ]><data>&example;</data>`\\n- `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><!DOCTYPE foo [<!ENTITY example SYSTEM \\\"http://localhost\\\"> ]><data>&example;</data>`  \\n\\n\\nDoes the event appear to be a true positive? (click to proceed)  \\n\\n- [No](#exploited-false-positive)  \\n- [Yes, or unsure](#exploited-true-positive)  \\n\\n\\n\\n## Blocked\\n\\n\\\"Blocked\\\" indicates that Contrast detected an incoming input resembling an XML string containing external entities and then confirmed the declared entities were being resolved by the XML parser and therefore blocked the application from performing the operation.  \\n\\nTo verify this is a true positive, review the following attributes of the event:\\n\\n- Are entity declaration keywords present in the payload? (<!ENTITY, SYSTEM, PUBLIC, etc)\\n- Are there references to external entities in the payload? (&example;)\\n- Are there references to local files in the payload? (file:///, /etc/passwd, etc)\\n- Are there references to remote files in the payload? (http://, https://, etc)\\n- Are there application logs with XML parsing error messages around the same timestamp as the event?\\n\\n\\n\\nExamples:\\n\\n- `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><!DOCTYPE foo [<!ENTITY example SYSTEM \\\"/etc/passwd\\\"> ]><data>&example;</data>`\\n- `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><!DOCTYPE foo [<!ENTITY example SYSTEM \\\"http://localhost\\\"> ]><data>&example;</data>`  \\n\\n\\n\\nIs the event a true positive? (click to proceed)\\n\\n- [No](#blocked-false-positive)  \\n- [Yes, or unsure](#blocked-true-positive)  \\n\\n\\n\\n\\n\\n\\n## Ineffective\\n\\n\\\"Ineffective\\\" means that Contrast detected an incoming input resembling an XML external entity injection, but it did not confirm that the entities were resolved. This is called a Probe within the Contrast UI. This event is a real attack attempt to exploit your application, but it was ineffective. Probes can indicate an attacker scanning or exploring for vulnerabilities.\\n\\n- Does the probe event appear to be caused by legitimate traffic and numerous similar probe events are being generated, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured to clean up Contrast data.  \\n- Is the probe originating from a specific ip[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?   Consider  \\n  - Block using network appliance\\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)\\n- Are all of the events originating from the same application user account  \\n  - Determine if the account is a legitimate account\\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Success\\n\\nSuccess\\\" means that Contrast's security measures functioned as intended, preventing unauthorized access or potentially malicious activity from reaching the application. This could be due to a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html), [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html), or [bot block rule](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.) being triggered.  \\n\\nGenerally, these events don't necessitate action because they signify the system is working correctly.  \\n\\nHowever, further investigation may be beneficial in specific scenarios to gain more insights or proactively enhance security:\\n\\n- Should the event have been blocked?:\\n  - If the event is from an [IP block](https://docs.contrastsecurity.com/en/block-or-allow-ips.html):\\n    - Correlate the IP address with other events to identify any attempted malicious actions.\\n    - Look up the IP address's reputation and origin to determine if it's known for malicious activity.\\n    - Check if the IP is listed on any other denylists across your systems.\\n  - If the event is from a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html):\\n    - Correlate the event with any exploited or probed events.\\n    - Confirm if the virtual patch is protecting a known vulnerability in the application.\\n  - If the event is from a [Bot Block](https://docs.contrastsecurity.com/en/server-configuration.html#:~:text=Bot%20blocking%20blocks%20traffic%20from,Events%2C%20use%20the%20filter%20options.):\\n    - Analyze the user-agent header of the HTTP request. Only requests originating from known scanning, fuzzing, or malicious user-agents should be blocked.\\n\\n\\nIf the event appears to be for legitimate traffic, an [exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html) can be configured.  \\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Exploited True Positive  \\n\\nIt is possible that the event is a True Positive, but is benign. A Benign True Positive is when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).  \\n\\n\\nIf it does not appear to be a Benign True Positive, the most immediate action to stop an \\\"active\\\" attack would be to block the current attacker of the exploited event, while further triage could result in a [virtual patch](https://docs.contrastsecurity.com/en/virtual-patches.html)/[enabling block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) for the rule:  \\n\\n- Is the attack originating from a specific IP[s] that is a real external IP address (not internal load balancer or network device) and not the public IP address for a large company network?\\n  - Block using network appliance  \\n  - [Block using Contrast](https://docs.contrastsecurity.com/en/ip-management.html)  \\n- Are all of the events originating from the same application user account?\\n  - Determine if the account is a legitimate account  \\n  - If so, attempt to help them recover the account by contacting and authenticating the legitimate user, arranging to change their credentials, and recover from any damage.\\n  - If not,  consider the following options:\\n    - Ban the account\\n    - Disable the account\\n    - Delete the account\\n\\n\\n\\nOnce the current attack has been stopped, consider taking additional steps to prevent future exploitation.  \\n\\n- If the only Exploited events for this rule are true positives, then the rule can be [switched to Block mode](https://docs.contrastsecurity.com/en/set-protect-rules.html) which will prevent future exploitation.  \\n- If there are other Exploited events that appear to be legitimate, benign traffic, then Block mode would block those events as well, which could have negative impact to the application.  \\n  - Before enabling Block mode for this situation, you must first exclude the legitimate, benign traffic being caught in the rule.  \\n  - Alternatively, you can set up a [Virtual Patch](https://docs.contrastsecurity.com/en/virtual-patches.html) that only allows the legitimate, benign traffic through and any non-matches will be blocked.\\n\\nIf none of the above options are satisfactory and it's perceived the application is at great risk, you can consider shutting down the application or removing network connectivity.  \\n\\n\\n\\nPost Containment\\n\\n- If confirmed this is a True Positive, it should be raised with the appsec/dev teams to get fixed. Useful information for those teams would be:  \\n\\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - Attack payload\\n  - Stack trace of the request\\n- To better understand the extent of the incident and to ensure the attack is no longer occurring, look for other IOCs:\\n  - Did the same IP Address Generate Other Alerts?\\n  - Is the vulnerability being exploited by other actors?\\n  - Spike in traffic or repeated access patterns to the vulnerable URL\\n  - Correlate exploited events with any \\\"probed\\\" or \\\"blocked\\\" events\\n  - If the attack was able to execute commands on the server, the server may need to be considered compromised and reviewed for persistence and other lateral movement.\\n\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Exploited False Positive  \\n\\nIf the event seems to be a False Positive, consider the following options:\\n\\n- Ignore\\n- [Create Exclusion](https://docs.contrastsecurity.com/en/application-exclusions.html)\\n\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n\\n\\n\\n\\n\\n## Blocked True Positive  \\n\\nIt is possible that the event is a True Positive, but benign. A Benign True Positive is when an applications design relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. This determination will often require the assistance of the development or application security teams.  \\n\\nIf the event appears to be a Benign True Positive, click [here](#benign-true-positive).\\n\\nIf it does not appear to be a Benign True Positive, consider the following options:\\n\\n- If one IP address is generating a lot of blocked events, it's probably worthwhile to block it.  \\n- Notify Dev/Appsec team of Vulnerability. Useful information for those teams would be:  \\n  - Application name\\n  - Is app in production, development, staging, etc\\n  - Affected URL\\n  - payload\\n  - Stack trace of the request  \\n- Look for IOCs of further attacks in other parts/inputs of the application\\n  - Other blocked or probed events?  \\n  - Did anything show up as \\\"exploited\\\" indicating a different rule did not have blocking enabled?\\n- Ignore\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n\\n## Blocked False Positive  \\n\\nIf the event seems to be a False Positive, then Contrast may be blocking legitimate usage of the application, therefore negatively impacting it.\\n\\n- Create an exclusion to allow the legitimate traffic through so that you can continue to be protected by Block mode without the negative impact.\\n- Alternatively, you can set up a Virtual Patch that only allows legitimate traffic through and any non-matches (attack traffic) will be blocked.  \\n- If neither of the above options are satisfactory and the negative impact of the application must be avoided, you can switch the rule to Monitor mode.\\n\\n[Proceed to Post-Incident Activities](#post-incident-activities)  \\n\\n\\n## Benign True Positive\\n\\nTo review, a Benign True Positive occurs when an application relies on vulnerable behavior that could potentially be exploited, but is currently necessary for operation. Consider the following options:\\n\\n- Ignore\\n- Create Exclusion  \\n- Work with the application developer on alternative implementations that do not pose such risk to the application, but meets the business needs.\\n\\n## Post-Incident Activities\\n\\n- **Documentation**\\n  - **Incident Report:** Document the incident, including findings, raw events and alerts, actions taken, assets impacted, and lessons learned.\\n  - **Update Documentation:** Keep security runbooks and documentation up to date.\\n- **Communication**\\n  - **Notify Stakeholders:** Inform relevant stakeholders about the incident and steps taken.\\n  - **User Notification:** Notify affected users if there was a data breach.\\n- **Review and Improve**\\n  - **Review Response:** Conduct a post-mortem to review the response and identify improvement areas.\\n  - **Enhance Security Posture:** Implement additional security measures and improve monitoring.\"},\"name\":\"text - 0\"}],\"fallbackResourceIds\":[\"/subscriptions/688d2b8c-8ea1-475f-b020-64528c9f5516/resourcegroups/contrastadr/providers/microsoft.operationalinsights/workspaces/devsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId9'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=ContrastADRXMLExternalEntityInjectionWorkbook; logoFileName=ContrastADR.svg; description=XXE is a flaw in XML parsers where attackers can cause the parser to read local or remote resources as part of the document. Attackers often abuse this functionality to access other sensitive system information.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0; title=XML External Entity Injection Runbook; templateRelativePath=ContrastADR_XML External_Entity_Injection_Injection_Workbook.json; subtitle=; provider=Contrast Security}.description",
                "parentId": "[variables('workbookId9')]",
                "contentId": "[variables('_workbookContentId9')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "ContrastADR",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Contrast Security"
                },
                "support": {
                  "name": "Contrast Security",
                  "tier": "Partner",
                  "link": "https://support.contrastsecurity.com/hc/en-us"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ContrastADR_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ContrastADR",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId9')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook9-name')]",
        "contentProductId": "[variables('_workbookcontentProductId9')]",
        "id": "[variables('_workbookcontentProductId9')]",
        "version": "[variables('workbookVersion9')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "ContrastADR",
        "publisherDisplayName": "Contrast Security",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/ContrastADR/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The <a href=\"https://www.contrastsecurity.com/contrast-adr\">Contrast Security</a> solution for Microsoft Sentinel enables you to ingest [Contrast Security events] generated using the Contrast Webhook ,</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Parsers:</strong> 2, <strong>Workbooks:</strong> 9, <strong>Analytic Rules:</strong> 6</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/ContrastADR.svg\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "ContrastADR",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Contrast Security"
        },
        "support": {
          "name": "Contrast Security",
          "tier": "Partner",
          "link": "https://support.contrastsecurity.com/hc/en-us"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject1').parserContentId1]",
              "version": "[variables('parserObject1').parserVersion1]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('parserObject2').parserContentId2]",
              "version": "[variables('parserObject2').parserVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId2')]",
              "version": "[variables('workbookVersion2')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId3')]",
              "version": "[variables('workbookVersion3')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId4')]",
              "version": "[variables('workbookVersion4')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId5')]",
              "version": "[variables('workbookVersion5')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId6')]",
              "version": "[variables('workbookVersion6')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId7')]",
              "version": "[variables('workbookVersion7')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId8')]",
              "version": "[variables('workbookVersion8')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId9')]",
              "version": "[variables('workbookVersion9')]"
            }
          ]
        },
        "firstPublishDate": "2025-01-18",
        "lastPublishDate": "2025-01-18",
        "providers": [
          "contrast Security"
        ],
        "categories": {
          "domains": [
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
