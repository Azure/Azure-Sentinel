{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "NordPass (systems squad)",
    "comments": "Solution template for NordPass"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "NordPass Workbook",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "NordPass",
    "_solutionVersion": "3.0.0",
    "solutionId": "nordsecurityinc.azure-sentinel-solution-nordpass",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "NordPass",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "NordPass",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "NordPassWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "283d7506-f3c6-419a-ae9c-d9afe6a15d6d",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '283d7506-f3c6-419a-ae9c-d9afe6a15d6d')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('283d7506-f3c6-419a-ae9c-d9afe6a15d6d')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','283d7506-f3c6-419a-ae9c-d9afe6a15d6d','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "f72f630f-c890-49fe-b747-80f4fb3b6348",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'f72f630f-c890-49fe-b747-80f4fb3b6348')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('f72f630f-c890-49fe-b747-80f4fb3b6348')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','f72f630f-c890-49fe-b747-80f4fb3b6348','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "0068dca4-dea0-46a3-a970-655e067a145f",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '0068dca4-dea0-46a3-a970-655e067a145f')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('0068dca4-dea0-46a3-a970-655e067a145f')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','0068dca4-dea0-46a3-a970-655e067a145f','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "693c5217-e840-427f-9661-3fa0ef266040",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '693c5217-e840-427f-9661-3fa0ef266040')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('693c5217-e840-427f-9661-3fa0ef266040')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','693c5217-e840-427f-9661-3fa0ef266040','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "800314a6-759a-4575-93e2-1e080b1d33f9",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '800314a6-759a-4575-93e2-1e080b1d33f9')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('800314a6-759a-4575-93e2-1e080b1d33f9')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','800314a6-759a-4575-93e2-1e080b1d33f9','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "27b261dc-68f3-489a-944f-bc252e0c1960",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '27b261dc-68f3-489a-944f-bc252e0c1960')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('27b261dc-68f3-489a-944f-bc252e0c1960')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','27b261dc-68f3-489a-944f-bc252e0c1960','-', '1.0.0')))]"
    },
    "analyticRuleObject7": {
      "analyticRuleVersion7": "1.0.0",
      "_analyticRulecontentId7": "c7f14b43-7625-4516-b137-30b7fda65bcf",
      "analyticRuleId7": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'c7f14b43-7625-4516-b137-30b7fda65bcf')]",
      "analyticRuleTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('c7f14b43-7625-4516-b137-30b7fda65bcf')))]",
      "_analyticRulecontentProductId7": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','c7f14b43-7625-4516-b137-30b7fda65bcf','-', '1.0.0')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "NordPass data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "NordPass (using Azure Functions)",
                  "publisher": "NordPass",
                  "descriptionMarkdown": "Integrating NordPass with Microsoft Sentinel SIEM via the API will allow you to automatically transfer Activity Log data from NordPass to Microsoft Sentinel and get real-time insights, such as item activity, all login attempts, and security notifications.",
                  "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "NordPass",
                      "baseQuery": "NordPassEventLogs_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Top 10 Users",
                      "query": "NordPassEventLogs_CL\n | summarize count() by user_email \n | top 10 by count_"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "NordPassEventLogs_CL",
                      "lastDataReceivedQuery": "NordPassEventLogs_CL\n | summarize Time = max(TimeGenerated)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "NordPassEventLogs_CL\n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(7d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "description": "Ensure that the [resource group](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal#create-resource-groups) and the [Log Analytics workspace](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/quick-create-workspace?tabs=azure-portal) are created and located in the same region so you can deploy the Azure Functions."
                      },
                      {
                        "description": "[Add Microsoft Sentinel](https://learn.microsoft.com/en-us/azure/sentinel/quickstart-onboard#enable-microsoft-sentinel-) to the created Log Analytics workspace."
                      },
                      {
                        "description": "Generate a [Microsoft Sentinel API URL and token](https://www.google.com/url?q=https://support.nordpass.com/hc/en-us/articles/31972037289873&sa=D&source=docs&ust=1743770997230005&usg=AOvVaw16p0hstJ6OeBBoFdBKZRfr) in the NordPass Admin Panel to finish the Azure Functions integration. Please note that you’ll need the NordPass Enterprise account for that."
                      },
                      {
                        "description": "**Important:** This connector uses Azure Functions to retrieve Activity Logs from NordPass into Microsoft Sentinel. This may result in additional data ingestion costs. For more information, refer to the Azure Functions pricing page."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "To proceed with the Microsoft Sentinel setup\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Frefs%2Fheads%2Fmaster%2FSolutions%2FNordPass%2FData%2520Connectors%2Fazuredeploy_NordPass_API_FunctionApp.json)\n2. **Please note that after the successful deployment, the system pulls Activity Log data every 1 minute by default.**"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "NordPass (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "NordPass",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "NordPass (systems squad)"
        },
        "support": {
          "name": "NordPass",
          "tier": "Partner",
          "link": "https://support.nordpass.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "NordPass (using Azure Functions)",
          "publisher": "NordPass",
          "descriptionMarkdown": "Integrating NordPass with Microsoft Sentinel SIEM via the API will allow you to automatically transfer Activity Log data from NordPass to Microsoft Sentinel and get real-time insights, such as item activity, all login attempts, and security notifications.",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "NordPass",
              "baseQuery": "NordPassEventLogs_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "NordPassEventLogs_CL",
              "lastDataReceivedQuery": "NordPassEventLogs_CL\n | summarize Time = max(TimeGenerated)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "NordPassEventLogs_CL\n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(7d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Top 10 Users",
              "query": "NordPassEventLogs_CL\n | summarize count() by user_email \n | top 10 by count_"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "description": "Ensure that the [resource group](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal#create-resource-groups) and the [Log Analytics workspace](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/quick-create-workspace?tabs=azure-portal) are created and located in the same region so you can deploy the Azure Functions."
              },
              {
                "description": "[Add Microsoft Sentinel](https://learn.microsoft.com/en-us/azure/sentinel/quickstart-onboard#enable-microsoft-sentinel-) to the created Log Analytics workspace."
              },
              {
                "description": "Generate a [Microsoft Sentinel API URL and token](https://www.google.com/url?q=https://support.nordpass.com/hc/en-us/articles/31972037289873&sa=D&source=docs&ust=1743770997230005&usg=AOvVaw16p0hstJ6OeBBoFdBKZRfr) in the NordPass Admin Panel to finish the Azure Functions integration. Please note that you’ll need the NordPass Enterprise account for that."
              },
              {
                "description": "**Important:** This connector uses Azure Functions to retrieve Activity Logs from NordPass into Microsoft Sentinel. This may result in additional data ingestion costs. For more information, refer to the Azure Functions pricing page."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "To proceed with the Microsoft Sentinel setup\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Frefs%2Fheads%2Fmaster%2FSolutions%2FNordPass%2FData%2520Connectors%2Fazuredeploy_NordPass_API_FunctionApp.json)\n2. **Please note that after the successful deployment, the system pulls Activity Log data every 1 minute by default.**"
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "NordPass Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Here, you can find a comprehensive overview of all activities performed by your organization members, detailed in three categories: the actions of NordPass organization Owners and Admins in the Admin Panel, each employee's actions in their business vault, and actions performed by organization employees to log in to NordPass and their vaults."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"8e13e573-459e-4b44-9ea5-11d5bd20f420\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NordPass Admin Panel Activity\",\"subTarget\":\"Admin\",\"style\":\"link\"},{\"id\":\"f2781409-9e42-42b8-84a2-5b54e2785cef\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NordPass Vault Activity\",\"subTarget\":\"Vault\",\"style\":\"link\"},{\"id\":\"9b03ae0c-1a15-4a24-962c-d41559dc55bf\",\"cellValue\":\"SelectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NordPass Logins & Vault Access\",\"subTarget\":\"Logins\",\"style\":\"link\"}]},\"name\":\"links - 1\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"3ac5bb66-88db-4682-be8e-ff1ae0bdfe3c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AdminActions\",\"type\":9,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"isHiddenWhenLocked\":true,\"jsonData\":\"[\\\"access.item_reassignment_transferred\\\",\\\"access.recovery_request_approved\\\",\\\"access.recovery_request_created\\\",\\\"access.recovery_request_declined\\\",\\\"access.user_email_updated\\\",\\\"access.user_status_updated\\\",\\\"billing.payment_method_change_started\\\",\\\"domain.domain_added\\\",\\\"domain.domain_deleted\\\",\\\"domain.domain_verified\\\",\\\"totp.global_settings_updated\\\",\\\"global_settings.global_settings_updated\\\",\\\"global_settings.mfa_reset\\\",\\\"global_settings.password_policy_toggled\\\",\\\"global_settings.password_policy_updated\\\",\\\"integrations.activities_token_created\\\",\\\"integrations.activities_token_revoked\\\",\\\"integrations.vanta_integration_disabled\\\",\\\"integrations.vanta_integration_enabled\\\",\\\"invites.invite_converted_to_provisioned\\\",\\\"invites.invite_link_generated\\\",\\\"invites.user_approved\\\",\\\"invites.user_converted_to_provisioned\\\",\\\"invites.user_invite_accepted\\\",\\\"invites.user_invite_declined\\\",\\\"invites.user_invite_removed\\\",\\\"invites.user_invite_resent\\\",\\\"invites.user_invited\\\",\\\"invites.whitelisted_domains_updated\\\",\\\"item_delete.item_reassignment_deleted\\\",\\\"oauth_credentials.oauth_credentials_created\\\",\\\"oauth_credentials.oauth_credentials_deleted\\\",\\\"oauth_credentials.oauth_credentials_updated\\\",\\\"oauth_domain.oauth_domain_created\\\",\\\"oauth_domain.oauth_domain_deleted\\\",\\\"oauth_domain.oauth_domain_verified\\\",\\\"roles.user_role_updated\\\",\\\"scim_credentials.scim_credentials_created\\\",\\\"scim_credentials.scim_credentials_deleted\\\",\\\"scim_credentials.scim_credentials_recreated\\\",\\\"totp.2fa_reset_in_ecp\\\",\\\"sharing_hub.item_viewed\\\",\\\"sharing_hub.viewed\\\",\\\"sharing_hub.item_access_revealed\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":[\"access.item_reassignment_transferred\",\"access.recovery_request_approved\",\"access.recovery_request_created\",\"access.recovery_request_declined\",\"access.user_email_updated\",\"access.user_status_updated\",\"billing.payment_method_change_started\",\"domain.domain_added\",\"domain.domain_deleted\",\"domain.domain_verified\",\"totp.global_settings_updated\",\"global_settings.global_settings_updated\",\"global_settings.mfa_reset\",\"global_settings.password_policy_toggled\",\"global_settings.password_policy_updated\",\"integrations.activities_token_created\",\"integrations.activities_token_revoked\",\"integrations.vanta_integration_disabled\",\"integrations.vanta_integration_enabled\",\"invites.invite_converted_to_provisioned\",\"invites.invite_link_generated\",\"invites.user_approved\",\"invites.user_converted_to_provisioned\",\"invites.user_invite_accepted\",\"invites.user_invite_declined\",\"invites.user_invite_removed\",\"invites.user_invite_resent\",\"invites.user_invited\",\"invites.whitelisted_domains_updated\",\"item_delete.item_reassignment_deleted\",\"oauth_credentials.oauth_credentials_created\",\"oauth_credentials.oauth_credentials_deleted\",\"oauth_credentials.oauth_credentials_updated\",\"oauth_domain.oauth_domain_created\",\"oauth_domain.oauth_domain_deleted\",\"oauth_domain.oauth_domain_verified\",\"roles.user_role_updated\",\"scim_credentials.scim_credentials_created\",\"scim_credentials.scim_credentials_deleted\",\"scim_credentials.scim_credentials_recreated\",\"totp.2fa_reset_in_ecp\",\"sharing_hub.item_viewed\",\"sharing_hub.viewed\",\"sharing_hub.item_access_revealed\",\"access.extend_trial_organization\",\"checkout.change_credit_card_failure\",\"checkout.change_credit_card_failure\",\"checkout.change_credit_card_success\",\"checkout.renewal_success\",\"checkout.trial_to_subscription\",\"checkout.upgrade\",\"checkout.upsell\",\"domain.domain_reverification_failed\",\"domain.domain_reverified\",\"domain.domain_verification_failed\",\"domain.domain_verification_restarted\",\"global_settings.global_settings_customization_deleted\",\"group_provisioning.group_provisioning_disabled\",\"group_provisioning.group_provisioning_enabled\",\"groups.group_created\",\"groups.group_updated\",\"groups.group_users_added\",\"groups.group_users_removed\",\"groups.groups_deleted\",\"role_settings.password_policy_toggled\",\"role_settings.password_policy_updated\",\"role_settings.role_settings_cleared\",\"role_settings.role_settings_cleared\",\"role_settings.role_settings_updated\",\"user_settings.user_settings_cleared\",\"user_settings.user_settings_updated\"]},{\"id\":\"2659b909-a29c-482b-9226-b82150e8a543\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AdminTimeFilter\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"d6827134-bd11-46b8-9b96-3c0e39a7ef90\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AdminActionFilter\",\"label\":\"Actions\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"NordPassEventLogs_CL \\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {AdminTimeFilter:start} and EventTime <= {AdminTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({AdminActions})\\n| summarize Count = count() by action\\n| order by Count desc\\n| project action\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"\",\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"c6e7299f-c921-4a9a-ade1-846f58fe5821\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"AdminUserFilter\",\"label\":\"Users\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"NordPassEventLogs_CL \\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {AdminTimeFilter:start} and EventTime <= {AdminTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({AdminActions})\\n| extend user = coalesce(user_email, initiator)\\n| summarize Count = count() by user\\n| order by Count desc\\n| project user\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"\",\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"azure_ad\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let adminActionsSelected = dynamic([{AdminActionFilter}]);\\nlet adminUsersSelected = dynamic([{AdminUserFilter}]);\\n\\nNordPassEventLogs_CL \\n| extend user = coalesce(user_email, initiator)\\n| extend Action = action\\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where strcat(event_type, \\\".\\\", action) in ({AdminActions})\\n| where action in (adminActionsSelected)\\n| where user in (adminUsersSelected)\\n| where EventTime >= {AdminTimeFilter:start} and EventTime <= {AdminTimeFilter:end}\\n| summarize Count = count() by action\\n| project-rename Action = action\\n| order by Count desc\\n\",\"size\":0,\"title\":\"Actions\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"categorical\"}}]},\"chartSettings\":{\"xAxis\":\"action\",\"yAxis\":[\"Count\"],\"showMetrics\":false}},\"customWidth\":\"50\",\"name\":\"query - 2\",\"styleSettings\":{\"margin\":\"5px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let adminActionsSelected = dynamic([{AdminActionFilter}]);\\nlet adminUsersSelected = dynamic([{AdminUserFilter}]);\\nNordPassEventLogs_CL \\n| extend user = coalesce(user_email, initiator)\\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {AdminTimeFilter:start} and EventTime <= {AdminTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({AdminActions})\\n| where action in (adminActionsSelected)\\n| where user in (adminUsersSelected)\\n| summarize Count = count() by user\\n| order by Count desc\\n| project-rename User = user\\n\",\"size\":0,\"title\":\"Actions count by user\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"categorical\"}}]},\"chartSettings\":{\"xAxis\":\"user_email\",\"yAxis\":[\"Count\"],\"showMetrics\":false}},\"customWidth\":\"50\",\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"5px\",\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Admin\"},\"name\":\"AdminTab\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9b70034a-caea-46c8-b095-3b394a11155d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"VaultActions\",\"type\":9,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"isHiddenWhenLocked\":true,\"jsonData\":\"[\\\"item_access.item_viewed\\\",\\\"item_access.2fa_item_accessed\\\",\\\"totp.2fa_item_accessed\\\",\\\"item_access.item_autofilled\\\",\\\"item_access.item_copied\\\",\\\"item_access.item_moved_to_shared_folder\\\",\\\"item_access.item_secret_viewed\\\",\\\"item_access.items_created\\\",\\\"item_access.items_imported\\\",\\\"item_access.items_updated\\\",\\\"item_access.vault_exported\\\",\\\"item_delete.items_deleted\\\",\\\"item_share.external_items_received\\\",\\\"item_share.item_acl_changed\\\",\\\"item_share.item_new_ttl_set\\\",\\\"item_share.item_owner_changed\\\",\\\"item_share.item_time_limited_share_expired\\\",\\\"item_share.items_shared\\\",\\\"item_share.items_unshared\\\",\\\"item_share.shared_folder_shared\\\",\\\"item_share.shared_folder_unshared\\\",\\\"password_health.item_created_reused\\\",\\\"password_health.item_created_weak\\\",\\\"password_health.item_updated_reused\\\",\\\"password_health.item_updated_weak\\\",\\\"password_health.items_imported_reused\\\",\\\"password_health.items_imported_weak\\\",\\\"totp.2fa_added_to_item\\\",\\\"totp.2fa_device_deleted\\\",\\\"totp.2fa_device_enrolled\\\",\\\"totp.2fa_item_created\\\",\\\"totp.2fa_removed_from_item\\\"]\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"VaultTimeFilter\",\"value\":[\"item_access.item_viewed\",\"item_access.2fa_item_accessed\",\"totp.2fa_item_accessed\",\"item_access.item_autofilled\",\"item_access.item_copied\",\"item_access.item_moved_to_shared_folder\",\"item_access.item_secret_viewed\",\"item_access.items_created\",\"item_access.items_imported\",\"item_access.items_updated\",\"item_access.vault_exported\",\"item_access.items_imported_v2\",\"item_delete.items_deleted\",\"item_share.external_items_received\",\"item_share.item_acl_changed\",\"item_share.item_new_ttl_set\",\"item_share.item_owner_changed\",\"item_share.item_time_limited_share_expired\",\"item_share.items_shared\",\"item_share.items_unshared\",\"item_share.shared_folder_shared\",\"item_share.shared_folder_unshared\",\"password_health.item_created_reused\",\"password_health.item_created_weak\",\"password_health.item_updated_reused\",\"password_health.item_updated_weak\",\"password_health.items_imported_reused\",\"password_health.items_imported_weak\",\"totp.2fa_added_to_item\",\"totp.2fa_device_deleted\",\"totp.2fa_device_enrolled\",\"totp.2fa_item_created\",\"totp.2fa_removed_from_item\"]},{\"id\":\"341446e6-d6d0-45b0-a85d-bd18974012c6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"VaultTimeFilter\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"VaultTimeFilter\",\"label\":\"Time Range\"},{\"id\":\"34c229d8-282e-4dbf-a11c-530596b9367c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"VaultActionFilter\",\"label\":\"Actions\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"NordPassEventLogs_CL \\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {VaultTimeFilter:start} and EventTime <= {VaultTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({VaultActions})\\n| summarize Count = count() by action\\n| order by Count desc\\n| project action\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"95c8917b-dbe1-4119-823e-69f46e9c7e8e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"VaultUserFilter\",\"label\":\"Users\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"NordPassEventLogs_CL \\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {VaultTimeFilter:start} and EventTime <= {VaultTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({VaultActions})\\n| extend user = coalesce(user_email, initiator)\\n| summarize Count = count() by user\\n| order by Count desc\\n| project user\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let vaultActionsSelected = dynamic([{VaultActionFilter}]);\\nlet vaultUsersSelected = dynamic([{VaultUserFilter}]);\\nNordPassEventLogs_CL \\n| extend user = coalesce(user_email, initiator)\\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {VaultTimeFilter:start} and EventTime <= {VaultTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({VaultActions})\\n| where action in (vaultActionsSelected)\\n| where user in (vaultUsersSelected)\\n| summarize Count = count() by action\\n| project-rename Action = action\\n| order by Count desc\\n\",\"size\":0,\"title\":\"Item actions\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"categorical\"}}]},\"chartSettings\":{\"yAxis\":[\"Count\"]}},\"customWidth\":\"50\",\"name\":\"query - 2\",\"styleSettings\":{\"margin\":\"5px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let vaultActionsSelected = dynamic([{VaultActionFilter}]);\\nlet vaultUsersSelected = dynamic([{VaultUserFilter}]);\\nNordPassEventLogs_CL \\n| extend user = coalesce(user_email, initiator)\\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {VaultTimeFilter:start} and EventTime <= {VaultTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({VaultActions})\\n| where action in (vaultActionsSelected)\\n| where user in (vaultUsersSelected)\\n| extend platform = tostring(parse_json(metadata).platform)\\n| summarize Count = count() by platform\\n| project-rename Platform = platform\\n| order by Count desc\",\"size\":0,\"title\":\"Item actions by platform\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"categorical\"}}]},\"chartSettings\":{\"yAxis\":[\"Count\"]}},\"customWidth\":\"50\",\"name\":\"query - 3\",\"styleSettings\":{\"margin\":\"5px\",\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Vault\"},\"name\":\"VaultTab\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"49c0e02b-eeb3-4c5e-8d37-3c5969f141ea\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LoginActions\",\"type\":9,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"isHiddenWhenLocked\":true,\"jsonData\":\"[\\\"lock.master_validated\\\",\\\"login.user_login_failed\\\",\\\"login.user_login_successful\\\"]\",\"timeContext\":{\"durationMs\":86400000},\"value\":[\"lock.master_validated\",\"login.user_login_failed\",\"login.user_login_successful\",\"biometric.biometric_disabled\",\"biometric.biometric_enabled\",\"lock.master_changed\",\"lock.master_failed\",\"password.business_account_password_change_failed\",\"password.business_account_password_change_successful\",\"password.password_reset_requested\",\"password.password_reset_successful\",\"recovery_code.recovery_copied\",\"recovery_code.recovery_created\",\"recovery_code.recovery_downloaded\",\"recovery_code.recovery_reset\",\"recovery_code.recovery_used\"]},{\"id\":\"2ad69ff4-ac95-45e8-a6ed-35a044ada95b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LoginTimeFilter\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":86400000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"42229fe6-c3fd-47a7-941c-077ed71805e3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LoginActionFilter\",\"label\":\"Actions\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"NordPassEventLogs_CL \\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {LoginTimeFilter:start} and EventTime <= {LoginTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({LoginActions})\\n| summarize Count = count() by action\\n| order by Count desc\\n| project action\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"96a06759-9b2e-44d4-8b62-e2ad0624dd07\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LoginUserFilter\",\"label\":\"Users\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"NordPassEventLogs_CL \\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {LoginTimeFilter:start} and EventTime <= {LoginTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({LoginActions})\\n| extend user = coalesce(user_email, initiator)\\n| summarize Count = count() by user\\n| order by Count desc\\n| project user\\n\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let loginActionsSelected = dynamic([{LoginActionFilter}]);\\nlet loginUsersSelected = dynamic([{LoginUserFilter}]);\\nNordPassEventLogs_CL \\n| extend user = coalesce(user_email, initiator)\\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {LoginTimeFilter:start} and EventTime <= {LoginTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({LoginActions})\\n| where action in (loginActionsSelected)\\n| where user in (loginUsersSelected)\\n| summarize Count = count() by action\\n| project-rename Action = action\\n| order by Count desc\",\"size\":0,\"title\":\"Login access \",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"categorical\"}}]},\"chartSettings\":{\"yAxis\":[\"Count\"]}},\"customWidth\":\"50\",\"name\":\"query - 1\",\"styleSettings\":{\"margin\":\"5px\",\"showBorder\":true}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let loginActionsSelected = dynamic([{LoginActionFilter}]);\\nlet loginUsersSelected = dynamic([{LoginUserFilter}]);\\nNordPassEventLogs_CL \\n| extend user = coalesce(user_email, initiator)\\n| extend EventTime = unixtime_seconds_todatetime(timestamp)\\n| where EventTime >= {LoginTimeFilter:start} and EventTime <= {LoginTimeFilter:end}\\n| where strcat(event_type, \\\".\\\", action) in ({LoginActions})\\n| where action in (loginActionsSelected)\\n| where user in (loginUsersSelected)\\n| extend platform = tostring(parse_json(metadata).platform)\\n| summarize Count = count() by platform\\n| project-rename Platform = platform\\n| order by Count desc\",\"size\":0,\"title\":\"By platform\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"categorical\"}}]},\"chartSettings\":{\"yAxis\":[\"Count\"]}},\"customWidth\":\"50\",\"name\":\"query - 2\",\"styleSettings\":{\"margin\":\"5px\",\"showBorder\":true}}]},\"conditionalVisibility\":{\"parameterName\":\"SelectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"LoginsTab\"}],\"fromTemplateId\":\"NordPass\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=NordPassWorkbook; logoFileName=NordPass.svg; description=Here, you can find a comprehensive overview of all activities performed by your organization members, detailed in three categories: the actions of NordPass organization Owners and Admins in the Admin Panel, each employee's actions in their business vault, and actions performed by organization employees to log in to NordPass and their vaults.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=NordPass Workbook; templateRelativePath=NordPass.json; subtitle=; provider=NordPass}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "NordPassEventLogs_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "NordPass",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_Invite_declined_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you when the user declines the invite to the NordPass organization.",
                "displayName": "NordPass - Declined invitation",
                "enabled": false,
                "query": "NordPassEventLogs_CL\n| where event_type == \"invites\"\n| where action == \"user_invite_declined\"\n| extend TargetEmail = user_email\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "TargetEmail"
                      }
                    ]
                  }
                ],
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - Declined invitation",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_items_bulk_delete_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you if a user deletes items in bulk, namely, more than 10 items or in the span of 10 minutes. \nIf a mix of bulk and one-off deletions were performed, this will group all actions and report the total number of items deleted.",
                "displayName": "NordPass - User deletes items in bulk",
                "enabled": false,
                "query": "NordPassEventLogs_CL\n| where action == \"items_deleted\" and event_type == \"item_delete\"\n| extend item_count = array_length(todynamic(metadata).items)\n| summarize total_items = sum(item_count) by user_email\n| where total_items >= 10\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT10M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "Impact",
                  "Collection"
                ],
                "techniques": [
                  "T1485",
                  "T1074"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "user_email"
                      }
                    ]
                  }
                ],
                "customDetails": {
                  "ItemCount": "total_items",
                  "User": "user_email"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - User deletes items in bulk",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_items_reassignment_deletion_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you if the deleted user's items have been removed without being transferred to another active user, as this could result in the loss of access to critical tools or information.",
                "displayName": "NordPass - Deleting items of deleted member",
                "enabled": false,
                "query": "NordPassEventLogs_CL\n| where event_type == \"item_delete\"\n| where action == \"item_reassignment_deleted\"\n| extend TargetEmail = user_email\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "techniques": [
                  "T1485"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "TargetEmail"
                      }
                    ]
                  }
                ],
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - Deleting items of deleted member",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_manual_user_manipulation_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you when the user is manually invited, suspended, or deleted.\n\n!This rule should be enabled only by organizations that have User and Group Provisioning enabled.",
                "displayName": "NordPass - Manual invitation, suspension, or deletion",
                "enabled": false,
                "query": "NordPassEventLogs_CL  \n| extend metadataParsed = parse_json(metadata)  \n| where (event_type == \"invites\" and action == \"user_invited\") or (event_type == \"access\" and action == \"user_status_updated\" and (metadataParsed.status == \"suspended\" or metadataParsed.status == \"deleted\"))  \n| extend TargetEmail = user_email\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "Persistence"
                ],
                "techniques": [
                  "T1098"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "TargetEmail"
                      }
                    ]
                  }
                ],
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - Manual invitation, suspension, or deletion",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_token_revoked_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you when the event reporting token is revoked, posing the risk of active integration being blocked.",
                "displayName": "NordPass - Activity token revocation",
                "enabled": false,
                "query": "NordPassEventLogs_CL\n| where event_type == \"integrations\"\n| where action == \"activities_token_revoked\"\n| extend TargetEmail = user_email\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "DefenseEvasion"
                ],
                "techniques": [
                  "T1134"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "TargetEmail"
                      }
                    ]
                  }
                ],
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - Activity token revocation",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_user_login_failed_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you if a user fails to log in to their NordPass account or SSO authentication three or more times in the last 24 hours.",
                "displayName": "NordPass - User fails authentication",
                "enabled": false,
                "query": "let threshold = 2;\nlet filteredData = materialize(\n    NordPassEventLogs_CL\n    | where event_type == \"login\" and action == \"user_login_failed\"\n);\nlet users = filteredData\n    | summarize Count = count() by user_email\n    | where Count > threshold\n    | project user_email;\nfilteredData  \n| where user_email in (users)\n| extend TargetEmail = user_email, IPAddress = metadata.ip_address, Provider = metadata.provider\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "P1D",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 2,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "CredentialAccess"
                ],
                "subTechniques": [
                  "T1556.003"
                ],
                "techniques": [
                  "T1110",
                  "T1556"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "TargetEmail"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "IPAddress"
                      }
                    ]
                  }
                ],
                "customDetails": {
                  "Provider": "Provider"
                },
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - User fails authentication",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject7').analyticRuleTemplateSpecName7]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "nordpass_vault_exported_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject7').analyticRuleVersion7]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "apiVersion": "2023-02-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert you if the vault has been exported, allowing you to review and evaluate the incident to mitigate potential risks.\nNOTE: The organization can control whether it allows its members to export the vault, although we recommend that it always be disabled.",
                "displayName": "NordPass - Vault export",
                "enabled": false,
                "query": "NordPassEventLogs_CL\n| where event_type == \"item_access\"\n| where action == \"vault_exported\"\n| extend TargetEmail = user_email\n",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "NordPassEventLogs_CL"
                    ],
                    "connectorId": "NordPass"
                  }
                ],
                "tactics": [
                  "Exfiltration"
                ],
                "techniques": [
                  "T1020"
                ],
                "entityMappings": [
                  {
                    "entityType": "Mailbox",
                    "fieldMappings": [
                      {
                        "identifier": "MailboxPrimaryAddress",
                        "columnName": "TargetEmail"
                      }
                    ]
                  }
                ],
                "incidentConfiguration": {
                  "createIncident": false
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject7').analyticRuleId7,'/'))))]",
              "properties": {
                "description": "NordPass Analytics Rule 7",
                "parentId": "[variables('analyticRuleObject7').analyticRuleId7]",
                "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject7').analyticRuleVersion7]",
                "source": {
                  "kind": "Solution",
                  "name": "NordPass",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "NordPass (systems squad)"
                },
                "support": {
                  "name": "NordPass",
                  "tier": "Partner",
                  "link": "https://support.nordpass.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
        "contentKind": "AnalyticsRule",
        "displayName": "NordPass - Vault export",
        "contentProductId": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "id": "[variables('analyticRuleObject7')._analyticRulecontentProductId7]",
        "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "NordPass",
        "publisherDisplayName": "NordPass",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p>• Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/NordPass/ReleaseNotes.md\">Release Notes</a></p>\n<p>• There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>NordPass for Microsoft Sentinel enables you to automatically transfer Activity Log data from NordPass to Microsoft Sentinel and get real-time insights such as item activity, all login attempts, and security notifications. This allows you to stay informed by setting any needed alerts by your organization to monitor these security events.</p>\n<p><strong>Data Connectors:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 7</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"dummy.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "NordPass",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "NordPass (systems squad)"
        },
        "support": {
          "name": "NordPass",
          "tier": "Partner",
          "link": "https://support.nordpass.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject7')._analyticRulecontentId7]",
              "version": "[variables('analyticRuleObject7').analyticRuleVersion7]"
            }
          ]
        },
        "firstPublishDate": "2025-04-22",
        "providers": [
          "NordPass"
        ],
        "categories": {
          "domains": [
            "Security - Others",
            "Identity"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
