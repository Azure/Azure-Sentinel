{
    "name": "[concat(workspaceRef(), '/Microsoft.SecurityInsights/', variables('connectorName'))]",
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "apiVersion": "2022-09-01-preview",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "VersasecCmsCCP",
            "title": "VersasecCms",
            "publisher": "Versasec AB",
            "descriptionMarkdown": "The VersasecCms data connector allows ingesting logs into Microsoft Sentinel.",
            "graphQueries": [{
                    "metricName": "Total System Logs",
                    "legend": "Versasec Cms SysLog",
                    "baseQuery": "VersasecCmsSysLogs_CL"
                }, {
                    "metricName": "Total Error Logs",
                    "legend": "Versasec Cms ErrorLog",
                    "baseQuery": "VersasecCmsErrorLogs_CL"
                }
            ],
            "sampleQueries": [{
                    "description": "View last 50 System Logs",
                    "query": "VersasecCmsSysLogs_CL | take 50"
                }, {
                    "description": "View last 50 Error Logs",
                    "query": "VersasecCmsErrorLogs_CL | take 50"
                }
            ],
            "dataTypes": [{
                    "name": "VersasecCmsSysLogs_CL",
                    "lastDataReceivedQuery": "VersasecCmsSysLogs_CL | summarize Time = max(TimeGenerated)"
                }, {
                    "name": "VersasecCmsErrorLogs_CL",
                    "lastDataReceivedQuery": "VersasecCmsErrorLogs_CL | summarize Time = max(TimeGenerated)"
                }
            ],
            "connectivityCriteria": [{
                    "type": "IsConnectedQuery",
                    "value": [
                        "VersasecCmsSysLogs_CL | summarize count() by TimeGenerated"
                    ]
                }
            ],
            "permissions": {
                "resourceProvider": [{
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "read": true,
                            "write": true,
                            "delete": true
                        }
                    }
                ]
            },
            "instructionSteps": [{
                    "title": "Configuration",
                    "description": "Enter credentials for VersasecCms.",
                    "instructions": [{
                            "parameters": {
                                "label": "Management URL",
                                "type": "text",
                                "name": "managementUrl"
                            },
                            "type": "Textbox"
                        }, {
                            "parameters": {
                                "label": "API Base Path",
                                "type": "text",
                                "name": "apiBasePath"
                            },
                            "type": "Textbox"
                        }, {
                            "parameters": {
                                "label": "API Token",
                                "type": "securestring",
                                "name": "apiToken"
                            },
                            "type": "Textbox"
                        }, {
                            "parameters": {
                                "label": "Polling Interval (Minutes)",
                                "type": "int",
                                "name": "pollingInterval",
                                "defaultValue": 5
                            },
                            "type": "Textbox"
                        }, {
                            "parameters": {
                                "label": "connect",
                                "name": "connectButton"
                            },
                            "type": "ConnectionToggleButton"
                        }
                    ]
                }
            ]
        }
    }
}
