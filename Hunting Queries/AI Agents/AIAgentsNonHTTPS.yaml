id: 7a2b6c8d-9e0f-1a2b-3c4d-5e6f7a8b9c0d
name: AI Agents - HTTP Requests to Non-HTTPS Endpoints
description: |
 'Identifies AI agents that use HTTP actions to non-HTTPS endpoints. Communication over unencrypted HTTP may expose
  sensitive data in transit and poses security risks. Organizations should confirm with the agent owner whether this
  is necessary and inquire about the specific business use case for non-secure communications.'
requiredDataConnectors: []
tactics:
  - CommandAndControl
  - CredentialAccess
relevantTechniques:
  - T1071
  - T1040
query: |
  AIAgentsInfo 
  // Find agents with topic that contains Http request action to non https scheme endpoint. 
  | summarize arg_max(Timestamp, *) by AIAgentId 
  | where AgentStatus != "Deleted" 
  | mvexpand Topic = AgentTopicsDetails 
  | where Topic has "HttpRequestAction" 
  | extend TopicActions = Topic.beginDialog.actions 
  | mvexpand action = TopicActions 
  | where action['$kind'] == "HttpRequestAction" 
  | extend Url = tostring(action.url.literalValue) 
  | extend ParsedUrl = parse_url(Url) 
  | extend Scheme = tostring(ParsedUrl["Scheme"]) 
  | where isnotempty(Scheme) and Scheme != "https" 
  | project-reorder AgentCreationTime, AIAgentId, AIAgentName, ParsedUrl, Url, AgentStatus, CreatorAccountUpn, OwnerAccountUpns, Topic
  | extend AccountCustomEntity = CreatorAccountUpn
  | extend HostCustomEntity = AIAgentName
  | extend URLCustomEntity = Url
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
  - entityType: URL
    fieldMappings:
      - identifier: Url
        columnName: Url
version: 1.0.0
