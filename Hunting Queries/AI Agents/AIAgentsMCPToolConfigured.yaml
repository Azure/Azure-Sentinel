id: 6d8e5f9a-0b1c-2d3e-4f5a-6b7c8d9e0f1a
name: AI Agents - MCP Tool Configured
description: |
  'Identifies AI agents with Model Context Protocol (MCP) tools configured. MCP tools provide extended capabilities
  but may introduce additional security considerations. Organizations should confirm with the agent owner if the MCP
  tool is still needed and review its configuration for security compliance.'
requiredDataConnectors: []
tactics:
  - Execution
relevantTechniques:
  - T1059
query: |
  // Find agents with MCP tool configured 
  AIAgentsInfo 
  | summarize arg_max(Timestamp, *) by AIAgentId 
  | where AgentStatus != "Deleted" 
  | mvexpand Action = AgentToolsDetails 
  | where  Action.action.operationDetails["$kind"] == "ModelContextProtocolMetadata" 
  | extend MCPName = tostring(Action.modelDisplayName)
  | summarize MCPTools = make_set(MCPName) by AIAgentName, AIAgentId, EnvironmentId, CreatorAccountUpn
  | extend AccountCustomEntity = CreatorAccountUpn
  | extend HostCustomEntity = AIAgentName
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
version: 1.0.0
