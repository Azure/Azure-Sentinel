id: 7f8e3c42-9d2a-4b5c-8e1f-3a7b9c4d5e6f
name: Unauthenticated AI Agents
description: |
  This query identifies Copilot Studio AI agents without authentication mechanisms. Authentication is an agent-level configuration that the maker (owner/creator) can modify. 
  //Such misconfiguration poses significant security risks because when the agent accesses resources requiring authentication, it authenticates as the agent’s creator—not the user interacting with it. 
  //If the agent has access to sensitive information, this could allow users to access resources they shouldn’t. Additionally, it expands the attack surface: if an attacker compromises a user who can access such an agent, the attacker can also authenticate as the maker.
  //*You can add the following line to this query to scope this misconfiguration to published agents only: 
  //| where AgentStatus != "Deleted"  
requiredDataConnectors: []
tactics:
  - InitialAccess
  - PrivilegeEscalation
relevantTechniques:
  - T1078
  - T1190
query: |
  // It is critical to identify agents that lack authentication mechanisms, as these may pose significant risks to the organization   
  // due to their public availability. Organizations should know about these agents so they can acknowledge any issues.  
  AIAgentsInfo 
  | summarize arg_max(Timestamp, *) by AIAgentId 
  | where AgentStatus != "Deleted"  
  | where UserAuthenticationType == "None" 
  | project-reorder AgentCreationTime, AIAgentId, AIAgentName, AgentStatus, CreatorAccountUpn, OwnerAccountUpns
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
version: 1.0.0
