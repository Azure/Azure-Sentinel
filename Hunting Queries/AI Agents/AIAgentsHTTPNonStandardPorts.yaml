id: 6f1h5b7c-8d9e-0f1a-2b3c-4d5e6f7a8b9c
name: AI Agents - HTTP Requests to Non-standard Ports
description: |
  'Identifies AI agents that use HTTP actions on ports other than 443 or 80. Communication on non-standard ports may
  indicate suspicious activity or unauthorized network communication. Organizations should confirm with the agent owner
  whether this is necessary and inquire about the specific business use case.'
requiredDataConnectors: []
tactics:
  - CommandAndControl
  - Exfiltration
relevantTechniques:
  - T1071
  - T1041
query: |
  AIAgentsInfo 
  // Find agents with topic that contains Http request action to non 443/80 port 
  | summarize arg_max(Timestamp, *) by AIAgentId 
  | where AgentStatus != "Deleted" 
  | mvexpand Topic = AgentTopicsDetails 
  | where Topic has "HttpRequestAction" 
  | extend TopicActions = Topic.beginDialog.actions 
  | mvexpand action = TopicActions 
  | where action['$kind'] == "HttpRequestAction" 
  | extend Url = tostring(action.url.literalValue) 
  | extend ParsedUrl = parse_url(Url) 
  | extend Port = tostring(ParsedUrl["Port"]) 
  | where isnotempty(Port) and Port != "443" and Port != "80"
  | project-reorder AgentCreationTime, AIAgentId, AIAgentName, ParsedUrl, Url, Port, AgentStatus, CreatorAccountUpn, OwnerAccountUpns, Topic
  | extend AccountCustomEntity = CreatorAccountUpn
  | extend HostCustomEntity = AIAgentName
  | extend URLCustomEntity = Url
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
  - entityType: URL
    fieldMappings:
      - identifier: Url
        columnName: Url
version: 1.0.0
