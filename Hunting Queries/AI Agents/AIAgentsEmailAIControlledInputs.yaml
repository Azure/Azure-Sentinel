id: 9e4f8a1b-2c3d-4e5f-6a7b-8c9d0e1f2a3b
name: AI Agents - Email AI-Controlled Inputs
description: |
  'Identifies AI agents configured to send emails with AI-controlled inputs that may contain sensitive or inappropriate content.
  This configuration poses security risks as AI-generated content may include unintended information disclosure, hallucinations,
  or other content that should be reviewed before external transmission.'
requiredDataConnectors: []
tactics:
  - Exfiltration
  - Impact
relevantTechniques:
  - T1041
  - T1565
query: |
 //Find agents with email sending tool via microsoft 365 connector, where the input parameters of the inputs are populated by generative orchestrator 
 AIAgentsInfo 
  | summarize arg_max(Timestamp, *) by AIAgentId 
  | where AgentStatus != "Deleted" 
  | extend Config = tostring(todynamic(RawAgentInfo).Bot.Attributes.configuration)
  | parse Config with * "\"GenerativeActionsEnabled\":" GenerativeActionsEnabled:boolean * 
  | where GenerativeActionsEnabled 
  | mvexpand Action = AgentToolsDetails 
  | extend  OperationId = tostring(Action.action.operationId), ActionName = tostring(Action.modelDisplayName), Action 
  | where OperationId == "SendEmailV2"  
  | where isempty(Action.inputs) //All inputs are populated by Orchestrator 
  | project-reorder AgentCreationTime ,AIAgentId, AIAgentName, AgentStatus, CreatorAccountUpn, OwnerAccountUpns, ActionName 
  | extend AccountCustomEntity = CreatorAccountUpn
  | extend HostCustomEntity = AIAgentName
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
version: 1.0.0
