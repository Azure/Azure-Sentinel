id: 7e9f6a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b
name: AI Agents - MCP Tool with Maker Credentials
description: |
  Identifies AI agents with Model Context Protocol (MCP) tools configured using maker credentials.
  This configuration can create security risks because the tool runs with the maker`s personal permissions.
  Any user interacting with the agent could indirectly gain access to resources the maker can access.
  I compromised, the agent could be used to perform actions with the maker`s privileges.
  Recommended Action: Replace maker credentials with secure alternatives like managed identities or service principals.
requiredDataConnectors: []
tactics:
  - CredentialAccess
  - PrivilegeEscalation
relevantTechniques:
  - T1078
  - T1552
query: |
  AIAgentsInfo  
  | summarize arg_max(Timestamp, *) by AIAgentId  
  | where AgentStatus != "Deleted"  
  | mvexpand Action = AgentToolsDetails  
  | where Action.action.operationDetails["$kind"] == "ModelContextProtocolMetadata"  
  | where Action.action.connectionProperties.mode == "Maker" 
  | extend MCPName = tostring(Action.modelDisplayName) 
  | project-reorder AgentCreationTime ,AIAgentId, AIAgentName, AgentStatus, CreatorAccountUpn, OwnerAccountUpns,MCPName 
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
version: 1.0.0