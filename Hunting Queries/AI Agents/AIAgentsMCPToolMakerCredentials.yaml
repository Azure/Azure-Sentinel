id: 7e9f6a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b
name: AI Agents - MCP Tool with Maker Credentials
description: |
  'Identifies AI agents with Model Context Protocol (MCP) tools configured using maker credentials. This configuration
  may pose additional security risks as the tool operates with the maker''s personal credentials, potentially leading
  to privilege escalation or credential exposure. Organizations should review the necessity of this configuration.'
requiredDataConnectors: []
tactics:
  - CredentialAccess
  - PrivilegeEscalation
relevantTechniques:
  - T1078
  - T1552
query: |
  AIAgentsInfo  
  | summarize arg_max(Timestamp, *) by AIAgentId  
  | where AgentStatus != "Deleted"  
  | mvexpand Action = AgentToolsDetails  
  | where  Action.action.operationDetails["$kind"] == "ModelContextProtocolMetadata"  
  | where Action.action.connectionProperties.mode == "Maker" 
  | extend MCPName = tostring(Action.modelDisplayName)
  | project-reorder AgentCreationTime, AIAgentId, AIAgentName, AgentStatus, CreatorAccountUpn, OwnerAccountUpns, MCPName
  | extend AccountCustomEntity = CreatorAccountUpn
  | extend HostCustomEntity = AIAgentName
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: CreatorAccountUpn
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: AIAgentName
version: 1.0.0
