# Enrich-MalwareBazaar

Add information from [MalwareBazaar](https://bazaar.abuse.ch/api/) aka abuse.ch to a Sentinel Incident

## Quick Deployment
**Deploy with incident trigger** (recommended)

After deployment, attach this playbook to an **automation rule** so it runs when the incident is created.

[Learn more about automation rules](https://docs.microsoft.com/azure/sentinel/automate-incident-handling-with-automation-rules#creating-and-managing-automation-rules)

[![Deploy to Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Fmaster%2FPlaybooks%2FEnrich-MalwareBazaar%2FPlaybook%2Fazuredeploy.json)
[![Deploy to Azure Gov](https://aka.ms/deploytoazuregovbutton)](https://portal.azure.us/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2FAzure-Sentinel%2Fmaster%2FPlaybooks%2FEnrich-MalwareBazaar%2FPlaybook%2Fazuredeploy.json)

## Prerequisites

* API key is not required for malwarebazaar
* Logic Apps Custom Connector for MalwareBazaar
* Logic App managed identity should be given Sentinel Responder role to read incident trigger and write comment/tag to incident


## Screenshots
![Enrich-MalwareBazaar](./images/Enrich-MalwareBazaar.png)

## Workflow explained
(step by step pseudo-code)

1. Sentinel incident trigger
2. Get FileHashes entities
3. Validate that entities list is not empty or terminate
4. For each FileHashes, do a malwarebazaar query and append output to comment
5. Update sentinel incident with comment and appropriate tag Found/NotFound
