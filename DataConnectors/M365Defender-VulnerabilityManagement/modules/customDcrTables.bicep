@description('Name for Data Collection Endpoint used to ingest data into Log Analytics workspace.')
param DataCollectionEndpointName string = 'dce-mdvm-${uniqueString(resourceGroup().id)}'
@description('Name for Data Collection Rule used to ingest data into Log Analytics workspace.')
param DataCollectionRuleName string = 'dcr-mdmv-${uniqueString(resourceGroup().id)}'
@description('Azure Resource Id of the Log Analytics Workspace where you like the MDVM and optional Function App Application Insights data to reside. The format is: "/subscriptions/xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx/resourcegroups/xxxxxxxx/providers/microsoft.operationalinsights/workspaces/xxxxxxxx"')
param LogAnalyticsWorkspaceResourceId string
@description('Azure location/region of the Log Analytics Workspace referenced in the LogAnalyticsWorkspaceResourceId parameter.')
@allowed(
  [
    'asia'
    'asiapacific'
    'australia'
    'australiacentral'
    'australiacentral2'
    'australiaeast'
    'australiasoutheast'
    'brazil'
    'brazilsouth'
    'brazilsoutheast'
    'canada'
    'canadacentral'
    'canadaeast'
    'centralindia'
    'centralus'
    'centraluseuap'
    'eastasia'
    'eastus'
    'eastus2'
    'eastus2euap'
    'europe'
    'france'
    'francecentral'
    'francesouth'
    'germany'
    'germanynorth'
    'germanywestcentral'
    'global'
    'india'
    'japan'
    'japaneast'
    'japanwest'
    'korea'
    'koreacentral'
    'koreasouth'
    'northcentralus'
    'northeurope'
    'norway'
    'norwayeast'
    'norwaywest'
    'qatarcentral'
    'southafrica'
    'southafricanorth'
    'southafricawest'
    'southcentralus'
    'southeastasia'
    'southindia'
    'swedencentral'
    'switzerland'
    'switzerlandnorth'
    'switzerlandwest'
    'uaecentral'
    'uaenorth'
    'uksouth'
    'ukwest'
    'unitedstates'
    'westcentralus'
    'westeurope'
    'westindia'
    'westus'
    'westus2'
    'westus3'
  ]
)
param LogAnalyticsWorkspaceLocation string
@description('Optional: Managed Identity or Service Principal ID to be assigned the Metrics Publisher role on the data collection rule.')
param ServicePrincipalId string = ''

resource dce 'Microsoft.Insights/dataCollectionEndpoints@2021-09-01-preview' = {
  name: DataCollectionEndpointName
  location: LogAnalyticsWorkspaceLocation
  properties: {}
}

resource roleAssignmentDcr 'Microsoft.Authorization/roleAssignments@2020-10-01-preview' = if (ServicePrincipalId != '') {
  name: guid(dcr.id, '/providers/Microsoft.Authorization/roleDefinitions/3913510d-42f4-4e42-8a64-420c390055eb')
  scope: dcr
  properties: {
    roleDefinitionId: '/providers/Microsoft.Authorization/roleDefinitions/3913510d-42f4-4e42-8a64-420c390055eb'
    principalId: ServicePrincipalId
    principalType: 'ServicePrincipal'
  }
}

resource dcr 'Microsoft.Insights/dataCollectionRules@2021-09-01-preview' = {
  dependsOn: [
    tableMDVMCveKb
    tableMDVMRecommendations
    tableMDVMVulnerabilitiesByDevice
    tableMDVMNistCveKb
    tableMDVMSecureConfigurationsByDevice
  ]
  name: DataCollectionRuleName
  location: LogAnalyticsWorkspaceLocation
  properties: {
    dataCollectionEndpointId: dce.id
    streamDeclarations: {
      'Custom-MDVMVulnerabilitiesByDevice_CL': {
        columns: [
          {
            name: 'cveId'
            type: 'string'
          }
          {
            name: 'cvssScore'
            type: 'real'
          }
          {
            name: 'deviceId'
            type: 'string'
          }
          {
            name: 'deviceName'
            type: 'string'
          }
          {
            name: 'diskPaths'
            type: 'dynamic'
          }
          {
            name: 'endOfSupportDate'
            type: 'dynamic'
          }
          {
            name: 'endOfSupportStatus'
            type: 'dynamic'
          }
          {
            name: 'exploitabilityLevel'
            type: 'string'
          }
          {
            name: 'firstSeenTimestamp'
            type: 'datetime'
          }
          {
            name: 'vulnId'
            type: 'string'
          }
          {
            name: 'lastSeenTimestamp'
            type: 'datetime'
          }
          {
            name: 'osArchitecture'
            type: 'string'
          }
          {
            name: 'osPlatform'
            type: 'string'
          }
          {
            name: 'osVersion'
            type: 'string'
          }
          {
            name: 'rbacGroupId'
            type: 'int'
          }
          {
            name: 'rbacGroupName'
            type: 'string'
          }
          {
            name: 'recommendationReference'
            type: 'string'
          }
          {
            name: 'recommendedSecurityUpdate'
            type: 'dynamic'
          }
          {
            name: 'recommendedSecurityUpdateId'
            type: 'dynamic'
          }
          {
            name: 'recommendedSecurityUpdateUrl'
            type: 'dynamic'
          }
          {
            name: 'registryPaths'
            type: 'dynamic'
          }
          {
            name: 'securityUpdateAvailable'
            type: 'boolean'
          }
          {
            name: 'softwareName'
            type: 'string'
          }
          {
            name: 'softwareVendor'
            type: 'string'
          }
          {
            name: 'softwareVersion'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'vulnerabilitySeverityLevel'
            type: 'string'
          }
          {
            name: 'azResourceId'
            type: 'string'
          }
          {
            name: 'transactionId'
            type: 'string'
          }
          {
            name: 'eventTimeStamp'
            type: 'datetime'
          }
          {
            name: 'status'
            type: 'string'
          }
        ]
      }
      'Custom-MDVMRecommendations_CL': {
        columns: [
          {
            name: 'activeAlert'
            type: 'boolean'
          }
          {
            name: 'associatedThreats'
            type: 'dynamic'
          }
          {
            name: 'configScoreImpact'
            type: 'string'
          }
          {
            name: 'exposedMachinesCount'
            type: 'int'
          }
          {
            name: 'exposureImpact'
            type: 'real'
          }
          {
            name: 'hasUnpatchableCve'
            type: 'boolean'
          }
          {
            name: 'recId'
            type: 'string'
          }
          {
            name: 'nonProductivityImpactedAssets'
            type: 'int'
          }
          {
            name: 'productName'
            type: 'string'
          }
          {
            name: 'publicExploit'
            type: 'boolean'
          }
          {
            name: 'recommendationCategory'
            type: 'string'
          }
          {
            name: 'recommendationName'
            type: 'string'
          }
          {
            name: 'recommendedProgram'
            type: 'string'
          }
          {
            name: 'recommendedVendor'
            type: 'string'
          }
          {
            name: 'recommendedVersion'
            type: 'string'
          }
          {
            name: 'relatedComponent'
            type: 'string'
          }
          {
            name: 'remediationType'
            type: 'string'
          }
          {
            name: 'severityScore'
            type: 'int'
          }
          {
            name: 'status'
            type: 'string'
          }
          {
            name: 'subCategory'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'totalMachineCount'
            type: 'int'
          }
          {
            name: 'vendor'
            type: 'string'
          }
          {
            name: 'weaknesses'
            type: 'int'
          }
          {
            name: 'transactionId'
            type: 'string'
          }
        ]
      }
      'Custom-MDVMSecureConfigurationsByDevice_CL': {
        columns: [
          {
            name: 'deviceId'
            type: 'string'
          }
          {
            name: 'rbacGroupId'
            type: 'int'
          }
          {
            name: 'rbacGroupName'
            type: 'string'
          }
          {
            name: 'deviceName'
            type: 'string'
          }
          {
            name: 'osPlatform'
            type: 'string'
          }
          {
            name: 'osVersion'
            type: 'string'
          }
          {
            name: 'timestamp'
            type: 'datetime'
          }
          {
            name: 'configurationId'
            type: 'string'
          }
          {
            name: 'configurationCategory'
            type: 'string'
          }
          {
            name: 'configurationSubcategory'
            type: 'string'
          }
          {
            name: 'configurationImpact'
            type: 'int'
          }
          {
            name: 'isCompliant'
            type: 'boolean'
          }
          {
            name: 'isApplicable'
            type: 'boolean'
          }
          {
            name: 'isExpectedUserImpact'
            type: 'boolean'
          }
          {
            name: 'configurationName'
            type: 'string'
          }
          {
            name: 'recommendationReference'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'transactionId'
            type: 'string'
          }
          {
            name: 'azResourceId'
            type: 'string'
          }
        ]        
      }
      'Custom-MDVMCVEKB_CL': {
        columns: [
          {
            name: 'cvssV3'
            type: 'string'
          }
          {
            name: 'description'
            type: 'string'
          }
          {
            name: 'exploitInKit'
            type: 'boolean'
          }
          {
            name: 'exploitTypes'
            type: 'dynamic'
          }
          {
            name: 'exploitUris'
            type: 'string'
          }
          {
            name: 'exploitVerified'
            type: 'boolean'
          }
          {
            name: 'cveId'
            type: 'string'
          }
          {
            name: 'name'
            type: 'string'
          }
          {
            name: 'publicExploit'
            type: 'boolean'
          }
          {
            name: 'publishedOn'
            type: 'datetime'
          }
          {
            name: 'severity'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'updatedOn'
            type: 'datetime'
          }
          {
            name: 'transactionId'
            type: 'string'
          }
        ]
      }
      'Custom-MDVMNISTCVEKB_CL': {
        columns: [
          {
            name: 'cveId'
            type: 'string'
          }
          {
            name: 'sourceIdentifier'
            type: 'string'
          }
          {
            name: 'published'
            type: 'datetime'
          }
          {
            name: 'lastModified'
            type: 'datetime'
          }
          {
            name: 'evaluatorComment'
            type: 'string'
          }
          {
            name: 'evaluatorSolution'
            type: 'string'
          }
          {
            name: 'evaluatorImpact'
            type: 'string'
          }
          {
            name: 'vulnStatus'
            type: 'string'
          }
          {
            name: 'cisaExploitAdd'
            type: 'datetime'
          }
          {
            name: 'cisaActionDue'
            type: 'datetime'
          }
          {
            name: 'cisaRequiredAction'
            type: 'string'
          }
          {
            name: 'cisaVulnerabilityName'
            type: 'string'
          }
          {
            name: 'descriptions'
            type: 'dynamic'
          }
          {
            name: 'metrics'
            type: 'dynamic'
          }
          {
            name: 'weaknesses'
            type: 'dynamic'
          }
          {
            name: 'references'
            type: 'dynamic'
          }
          {
            name: 'vendorComments'
            type: 'dynamic'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'transactionId'
            type: 'string'
          }
        ]
      }
      'Custom-MDVMNISTConfigurations_CL': {
        columns: [
          {
            name: 'configurationNumber'
            type: 'int'
          }
          {
            name: 'configurationOperator'
            type: 'string'
          }
          {
            name: 'configurationNegate'
            type: 'string'
          }
          {
            name: 'nodeOperator'
            type: 'string'
          }
          {
            name: 'nodeNegate'
            type: 'boolean'
          }
          {
            name: 'criteria'
            type: 'string'
          }
          {
            name: 'matchCriteriaId'
            type: 'string'
          }
          {
            name: 'versionEndExcluding'
            type: 'string'
          }
          {
            name: 'versionEndIncluding'
            type: 'string'
          }
          {
            name: 'versionStartExcluding'
            type: 'string'
          }
          {
            name: 'versionStartIncluding'
            type: 'string'
          }
          {
            name: 'vulnerable'
            type: 'boolean'
          }
          {
            name: 'cveId'
            type: 'string'
          }
          {
            name: 'TimeGenerated'
            type: 'datetime'
          }
          {
            name: 'transactionId'
            type: 'string'
          }
        ]
      }
    }
    destinations: {
      logAnalytics: [
        {
          name: split(LogAnalyticsWorkspaceResourceId, '/')[8]
          workspaceResourceId: LogAnalyticsWorkspaceResourceId
        }
      ]
    }
    dataFlows: [
      {
        streams: [
          'Custom-MDVMVulnerabilitiesByDevice_CL'
        ]
        destinations: [
          split(LogAnalyticsWorkspaceResourceId, '/')[8]
        ]
        transformKql: 'source'
        outputStream: 'Custom-MDVMVulnerabilitiesByDevice_CL'
      }
      {
        streams: [
          'Custom-MDVMRecommendations_CL'
        ]
        destinations: [
          split(LogAnalyticsWorkspaceResourceId, '/')[8]
        ]
        transformKql: 'source'
        outputStream: 'Custom-MDVMRecommendations_CL'
      }
      {
        streams: [
          'Custom-MDVMSecureConfigurationsByDevice_CL'
        ]
        destinations: [
          split(LogAnalyticsWorkspaceResourceId, '/')[8]
        ]
        transformKql: 'source'
        outputStream: 'Custom-MDVMSecureConfigurationsByDevice_CL'
      }
      {
        streams: [
          'Custom-MDVMCVEKB_CL'
        ]
        destinations: [
          split(LogAnalyticsWorkspaceResourceId, '/')[8]
        ]
        transformKql: 'source'
        outputStream: 'Custom-MDVMCVEKB_CL'
      }
      {
        streams: [
          'Custom-MDVMNISTCVEKB_CL'
        ]
        destinations: [
          split(LogAnalyticsWorkspaceResourceId, '/')[8]
        ]
        transformKql: 'source'
        outputStream: 'Custom-MDVMNISTCVEKB_CL'
      }
      {
        streams: [
          'Custom-MDVMNISTConfigurations_CL'
        ]
        destinations: [
          split(LogAnalyticsWorkspaceResourceId, '/')[8]
        ]
        transformKql: 'source'
        outputStream: 'Custom-MDVMNISTConfigurations_CL'
      }
    ]
  }
}

module tableMDVMCveKb 'lawCustomTable.bicep' = {
  name: 'tableMDVMCveKb'
  scope: resourceGroup(split(LogAnalyticsWorkspaceResourceId, '/')[2], split(LogAnalyticsWorkspaceResourceId, '/')[4])
  params: {
    lawName: split(LogAnalyticsWorkspaceResourceId, '/')[8]
    tableName: 'MDVMCVEKB_CL'
    plan: 'Analytics'
    retention: 730
    columns: [
      {
        name: 'cvssV3'
        type: 'string'
      }
      {
        name: 'description'
        type: 'string'
      }
      {
        name: 'exploitInKit'
        type: 'boolean'
      }
      {
        name: 'exploitTypes'
        type: 'dynamic'
      }
      {
        name: 'exploitUris'
        type: 'string'
      }
      {
        name: 'exploitVerified'
        type: 'boolean'
      }
      {
        name: 'cveId'
        type: 'string'
      }
      {
        name: 'name'
        type: 'string'
      }
      {
        name: 'publicExploit'
        type: 'boolean'
      }
      {
        name: 'publishedOn'
        type: 'datetime'
      }
      {
        name: 'severity'
        type: 'string'
      }
      {
        name: 'TimeGenerated'
        type: 'datetime'
      }
      {
        name: 'updatedOn'
        type: 'datetime'
      }
      {
        name: 'transactionId'
        type: 'string'
      }
    ]
  }
}

module tableMDVMNistCveKb 'lawCustomTable.bicep' = {
  name: 'tableMDVMNistCveKb'
  scope: resourceGroup(split(LogAnalyticsWorkspaceResourceId, '/')[2], split(LogAnalyticsWorkspaceResourceId, '/')[4])
  params: {
    lawName: split(LogAnalyticsWorkspaceResourceId, '/')[8]
    tableName: 'MDVMNISTCVEKB_CL'
    plan: 'Analytics'
    retention: 730
    columns: [
      {
        name: 'cveId'
        type: 'string'
      }
      {
        name: 'sourceIdentifier'
        type: 'string'
      }
      {
        name: 'published'
        type: 'datetime'
      }
      {
        name: 'lastModified'
        type: 'datetime'
      }
      {
        name: 'evaluatorComment'
        type: 'string'
      }
      {
        name: 'evaluatorSolution'
        type: 'string'
      }
      {
        name: 'evaluatorImpact'
        type: 'string'
      }
      {
        name: 'vulnStatus'
        type: 'string'
      }
      {
        name: 'cisaExploitAdd'
        type: 'datetime'
      }
      {
        name: 'cisaActionDue'
        type: 'datetime'
      }
      {
        name: 'cisaRequiredAction'
        type: 'string'
      }
      {
        name: 'cisaVulnerabilityName'
        type: 'string'
      }
      {
        name: 'descriptions'
        type: 'dynamic'
      }
      {
        name: 'metrics'
        type: 'dynamic'
      }
      {
        name: 'weaknesses'
        type: 'dynamic'
      }
      {
        name: 'references'
        type: 'dynamic'
      }
      {
        name: 'vendorComments'
        type: 'dynamic'
      }
      {
        name: 'TimeGenerated'
        type: 'datetime'
      }
      {
        name: 'transactionId'
        type: 'string'
      }
    ]
  }
}

module tableMDVMNistConfigurations 'lawCustomTable.bicep' = {
  name: 'tableMDVMNistConfigurations'
  scope: resourceGroup(split(LogAnalyticsWorkspaceResourceId, '/')[2], split(LogAnalyticsWorkspaceResourceId, '/')[4])
  params: {
    lawName: split(LogAnalyticsWorkspaceResourceId, '/')[8]
    tableName: 'MDVMNISTConfigurations_CL'
    plan: 'Analytics'
    retention: 730
    columns: [
      {
        name: 'configurationNumber'
        type: 'int'
      }
      {
        name: 'configurationOperator'
        type: 'string'
      }
      {
        name: 'configurationNegate'
        type: 'string'
      }
      {
        name: 'nodeOperator'
        type: 'string'
      }
      {
        name: 'nodeNegate'
        type: 'boolean'
      }
      {
        name: 'criteria'
        type: 'string'
      }
      {
        name: 'matchCriteriaId'
        type: 'string'
      }
      {
        name: 'versionEndExcluding'
        type: 'string'
      }
      {
        name: 'versionEndIncluding'
        type: 'string'
      }
      {
        name: 'versionStartExcluding'
        type: 'string'
      }
      {
        name: 'versionStartIncluding'
        type: 'string'
      }
      {
        name: 'vulnerable'
        type: 'boolean'
      }
      {
        name: 'cveId'
        type: 'string'
      }
      {
        name: 'TimeGenerated'
        type: 'datetime'
      }
      {
        name: 'transactionId'
        type: 'string'
      }
    ]
  }
}

module tableMDVMRecommendations 'lawCustomTable.bicep' = {
  name: 'tableMDVMRecommendations'
  scope: resourceGroup(split(LogAnalyticsWorkspaceResourceId, '/')[2], split(LogAnalyticsWorkspaceResourceId, '/')[4])
  params: {
    lawName: split(LogAnalyticsWorkspaceResourceId, '/')[8]
    tableName: 'MDVMRecommendations_CL'
    plan: 'Analytics'
    columns: [
      {
        name: 'activeAlert'
        type: 'boolean'
      }
      {
        name: 'associatedThreats'
        type: 'dynamic'
      }
      {
        name: 'configScoreImpact'
        type: 'string'
      }
      {
        name: 'exposedMachinesCount'
        type: 'int'
      }
      {
        name: 'exposureImpact'
        type: 'real'
      }
      {
        name: 'hasUnpatchableCve'
        type: 'boolean'
      }
      {
        name: 'recId'
        type: 'string'
      }
      {
        name: 'nonProductivityImpactedAssets'
        type: 'int'
      }
      {
        name: 'productName'
        type: 'string'
      }
      {
        name: 'publicExploit'
        type: 'boolean'
      }
      {
        name: 'recommendationCategory'
        type: 'string'
      }
      {
        name: 'recommendationName'
        type: 'string'
      }
      {
        name: 'recommendedProgram'
        type: 'string'
      }
      {
        name: 'recommendedVendor'
        type: 'string'
      }
      {
        name: 'recommendedVersion'
        type: 'string'
      }
      {
        name: 'relatedComponent'
        type: 'string'
      }
      {
        name: 'remediationType'
        type: 'string'
      }
      {
        name: 'severityScore'
        type: 'int'
      }
      {
        name: 'status'
        type: 'string'
      }
      {
        name: 'subCategory'
        type: 'string'
      }
      {
        name: 'TimeGenerated'
        type: 'datetime'
      }
      {
        name: 'totalMachineCount'
        type: 'int'
      }
      {
        name: 'vendor'
        type: 'string'
      }
      {
        name: 'weaknesses'
        type: 'int'
      }
      {
        name: 'transactionId'
        type: 'string'
      }
    ]
  }
}

module tableMDVMSecureConfigurationsByDevice 'lawCustomTable.bicep' = {
  name: 'tableMDVMSecureConfigurationsByDevice'
  scope: resourceGroup(split(LogAnalyticsWorkspaceResourceId, '/')[2], split(LogAnalyticsWorkspaceResourceId, '/')[4])
  params: {
    lawName: split(LogAnalyticsWorkspaceResourceId, '/')[8]
    tableName: 'MDVMSecureConfigurationsByDevice_CL'
    plan: 'Analytics'
    columns: [
      {
        name: 'deviceId'
        type: 'string'
      }
      {
        name: 'rbacGroupId'
        type: 'int'
      }
      {
        name: 'rbacGroupName'
        type: 'string'
      }
      {
        name: 'deviceName'
        type: 'string'
      }
      {
        name: 'osPlatform'
        type: 'string'
      }
      {
        name: 'osVersion'
        type: 'string'
      }
      {
        name: 'timestamp'
        type: 'datetime'
      }
      {
        name: 'configurationId'
        type: 'string'
      }
      {
        name: 'configurationCategory'
        type: 'string'
      }
      {
        name: 'configurationSubcategory'
        type: 'string'
      }
      {
        name: 'configurationImpact'
        type: 'int'
      }
      {
        name: 'isCompliant'
        type: 'boolean'
      }
      {
        name: 'isApplicable'
        type: 'boolean'
      }
      {
        name: 'isExpectedUserImpact'
        type: 'boolean'
      }
      {
        name: 'configurationName'
        type: 'string'
      }
      {
        name: 'recommendationReference'
        type: 'string'
      }
      {
        name: 'TimeGenerated'
        type: 'datetime'
      }
      {
        name: 'transactionId'
        type: 'string'
      }
      {
        name: 'azResourceId'
        type: 'string'
      }
    ]    
  }
}

module tableMDVMVulnerabilitiesByDevice 'lawCustomTable.bicep' = {
  name: 'tableMDVMVulnerabilitiesByDevice'
  scope: resourceGroup(split(LogAnalyticsWorkspaceResourceId, '/')[2], split(LogAnalyticsWorkspaceResourceId, '/')[4])
  params: {
    lawName: split(LogAnalyticsWorkspaceResourceId, '/')[8]
    tableName: 'MDVMVulnerabilitiesByDevice_CL'
    plan: 'Analytics'
    columns: [
      {
        name: 'cveId'
        type: 'string'
      }
      {
        name: 'cvssScore'
        type: 'real'
      }
      {
        name: 'deviceId'
        type: 'string'
      }
      {
        name: 'deviceName'
        type: 'string'
      }
      {
        name: 'diskPaths'
        type: 'dynamic'
      }
      {
        name: 'endOfSupportDate'
        type: 'dynamic'
      }
      {
        name: 'endOfSupportStatus'
        type: 'dynamic'
      }
      {
        name: 'exploitabilityLevel'
        type: 'string'
      }
      {
        name: 'firstSeenTimestamp'
        type: 'datetime'
      }
      {
        name: 'vulnId'
        type: 'string'
      }
      {
        name: 'lastSeenTimestamp'
        type: 'datetime'
      }
      {
        name: 'osArchitecture'
        type: 'string'
      }
      {
        name: 'osPlatform'
        type: 'string'
      }
      {
        name: 'osVersion'
        type: 'string'
      }
      {
        name: 'rbacGroupId'
        type: 'int'
      }
      {
        name: 'rbacGroupName'
        type: 'string'
      }
      {
        name: 'recommendationReference'
        type: 'string'
      }
      {
        name: 'recommendedSecurityUpdate'
        type: 'dynamic'
      }
      {
        name: 'recommendedSecurityUpdateId'
        type: 'dynamic'
      }
      {
        name: 'recommendedSecurityUpdateUrl'
        type: 'dynamic'
      }
      {
        name: 'registryPaths'
        type: 'dynamic'
      }
      {
        name: 'securityUpdateAvailable'
        type: 'boolean'
      }
      {
        name: 'softwareName'
        type: 'string'
      }
      {
        name: 'softwareVendor'
        type: 'string'
      }
      {
        name: 'softwareVersion'
        type: 'string'
      }
      {
        name: 'TimeGenerated'
        type: 'datetime'
      }
      {
        name: 'vulnerabilitySeverityLevel'
        type: 'string'
      }
      {
        name: 'azResourceId'
        type: 'string'
      }
      {
        name: 'transactionId'
        type: 'string'
      }
      {
        name: 'eventTimeStamp'
        type: 'datetime'
      }
      {
        name: 'status'
        type: 'string'
      }
    ]
  }
}

output DcrImmutableId string = dcr.properties.immutableId
output DceUri string = dce.properties.logsIngestion.endpoint
output DcrName string = dcr.name
