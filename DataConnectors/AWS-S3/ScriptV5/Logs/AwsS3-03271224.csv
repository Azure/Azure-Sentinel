"Time","Message","Severity"
"27-03-2025 12:24","Starting ConfigAwsConnector at: 03/27/2025 12:24:31","Information"
"27-03-2025 12:24","Log created: C:\GitHub\Azure-Sentinel\DataConnectors\AWS-S3\ScriptV55\Logs\AwsS3-03271224.csv","Information"
"27-03-2025 12:24","To begin you will choose the AWS logs to configure.","Information"
"27-03-2025 12:24","Checking AWS CLI configuration...","Information"
"27-03-2025 12:24","Starting Vpc flow data connector configuration script","Verbose"
"27-03-2025 12:24","This script creates an Assume Role with minimal permissions to grant Azure Sentinel access to your logs in a designated S3 bucket & SQS of your choice, enable VPCFlow Logs, S3 bucket, SQS Queue, and S3 notifications.","Information"
"27-03-2025 12:24","Notes:","Information"
"27-03-2025 12:24","* You can find more information about the script in https://github.com/Azure/Azure-Sentinel/blob/master/DataConnectors/AWS-S3/README.md","Information"
"27-03-2025 12:24","* If a resource name(like: S3, Sqs, Kms) already exists, the script will use the available one and not create a new resource","Information"
"27-03-2025 12:24","Checking existing OIDC provider","Information"
"27-03-2025 12:24","Executing Set-RetryAction","Verbose"
"27-03-2025 12:24","Executing: aws sts get-caller-identity --query 'Account' --output text","Verbose"
"27-03-2025 12:24","072643944673","Verbose"
"27-03-2025 12:24","Executing: aws iam get-open-id-connect-provider --open-id-connect-provider-arn 'arn:aws:iam::072643944673:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/' 2>&1","Verbose"
"27-03-2025 12:24","{     ""Url"": ""sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/"",     ""ClientIDList"": [         ""api://1462b192-27f7-4cb9-8523-0f4ecb54b47e"",         ""api://21f935c0-8092-4b62-a772-5a2afd714569"",         ""api://817e12c0-a285-4088-a494-452a575d1f0a"",         ""api://8204ddf5-83dd-471d-9db8-4b3b00aaa192""     ],     ""ThumbprintList"": [         ""626d44e704d1ceabe3bf0d53397464ac8080142c""     ],     ""CreateDate"": ""2024-07-04T11:59:52.105000+00:00"",     ""Tags"": [] }","Verbose"
"27-03-2025 12:24","OIDC provider already exists","Information"
"27-03-2025 12:24","Approved client IDs: api://1462b192-27f7-4cb9-8523-0f4ecb54b47e api://21f935c0-8092-4b62-a772-5a2afd714569 api://817e12c0-a285-4088-a494-452a575d1f0a api://8204ddf5-83dd-471d-9db8-4b3b00aaa192","Information"
"27-03-2025 12:24","Client ID api://1462b192-27f7-4cb9-8523-0f4ecb54b47e is already approved","Information"
"27-03-2025 12:24","Assume role definition","Information"
"27-03-2025 12:24","Executing Set-RetryAction","Verbose"
"27-03-2025 12:24","Executing: aws iam get-role --role-name testtte 2>&1| Out-Null","Verbose"
"27-03-2025 12:24","Using role name: OIDC_testtte with OIDC prefix because OpenID Connect authentication is being used.","Information"
"27-03-2025 12:24","You must specify the the Azure Sentinel Workspace ID. This is found in the Azure Sentinel portal.","Information"
"27-03-2025 12:24","Using Azure Sentinel Workspace ID: 52933e98-e08a-462c-a9fb-90b44a7bf10a","Information"
"27-03-2025 12:25","Executing: aws iam create-role --role-name OIDC_testtte --assume-role-policy-document {
            \""Version\"": \""2012-10-17\"",
            \""Statement\"": [
                {
                    \""Effect\"": \""Allow\"",
					\""Principal\"": {
						\""Federated\"": \""arn:aws:iam::072643944673:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/\""
					},
                    \""Action\"": \""sts:AssumeRoleWithWebIdentity\"",
					\""Condition\"": {
						\""StringEquals\"": {
							\""sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/:aud\"": \""api://1462b192-27f7-4cb9-8523-0f4ecb54b47e\"",
							\""sts:RoleSessionName\"": \""MicrosoftSentinel_52933e98-e08a-462c-a9fb-90b44a7bf10a\""
						}
					}
                }
            ]
        } --tags {\""Key\"": \""Operator\"", \""Value\"": \""Microsoft_Sentinel_Automation_Script\""} 2>&1","Verbose"
"27-03-2025 12:25","{     ""Role"": {         ""Path"": ""/"",         ""RoleName"": ""OIDC_testtte"",         ""RoleId"": ""AROARB2PKUDQ5KT4FDDT7"",         ""Arn"": ""arn:aws:iam::072643944673:role/OIDC_testtte"",         ""CreateDate"": ""2025-03-27T06:55:05+00:00"",         ""AssumeRolePolicyDocument"": {             ""Version"": ""2012-10-17"",             ""Statement"": [                 {                     ""Effect"": ""Allow"",                     ""Principal"": {                         ""Federated"": ""arn:aws:iam::072643944673:oidc-provider/sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/""                     },                     ""Action"": ""sts:AssumeRoleWithWebIdentity"",                     ""Condition"": {                         ""StringEquals"": {                             ""sts.windows.net/33e01921-4d64-4f8c-a055-5bdaffd5e33d/:aud"": ""api://1462b192-27f7-4cb9-8523-0f4ecb54b47e"",                             ""sts:RoleSessionName"": ""MicrosoftSentinel_52933e98-e08a-462c-a9fb-90b44a7bf10a""                         }                     }                 }             ]         },         ""Tags"": [             {                 ""Key"": ""Operator"",                 ""Value"": ""Microsoft_Sentinel_Automation_Script""             }         ]     } }","Verbose"
"27-03-2025 12:25","OIDC_testtte role created successfully","Information"
"27-03-2025 12:25","Executing: aws iam get-role --role-name OIDC_testtte","Verbose"
"27-03-2025 12:25","arn:aws:iam::072643944673:role/OIDC_testtte","Verbose"
