{
  "name": "{workbook_name}",
  "location": "{workbook_location}",
  "tags": null,
  "type": "microsoft.insights/workbooks",
  "kind": "shared",
  "properties": {
    "displayName": "{workbook_displayName}",
    "version": "1.0",
    "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":\"{\\\"json\\\":\\\"## Insecure Protocols\\\\n\\\"}\",\"name\":\"text - 2\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[],\\\"parameters\\\":[{\\\"id\\\":\\\"020de58b-73ca-47fe-838e-bc3ac7afaef6\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"TimeRange\\\",\\\"type\\\":4,\\\"isRequired\\\":true,\\\"value\\\":{\\\"durationMs\\\":86400000},\\\"typeSettings\\\":{\\\"selectableValues\\\":[{\\\"durationMs\\\":300000},{\\\"durationMs\\\":900000},{\\\"durationMs\\\":1800000},{\\\"durationMs\\\":3600000},{\\\"durationMs\\\":14400000},{\\\"durationMs\\\":43200000},{\\\"durationMs\\\":86400000},{\\\"durationMs\\\":172800000},{\\\"durationMs\\\":259200000},{\\\"durationMs\\\":604800000},{\\\"durationMs\\\":1209600000},{\\\"durationMs\\\":2419200000},{\\\"durationMs\\\":2592000000},{\\\"durationMs\\\":5184000000},{\\\"durationMs\\\":7776000000}],\\\"allowCustom\\\":true}}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"name\":\"parameters - 7\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SecurityEvent\\\\r\\\\n| union Event\\\\r\\\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest')\\\\r\\\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\\\\r\\\\n| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))\\\\r\\\\n| project Protocol, Count, TimeGenerated \\\\r\\\\n| sort by Count desc\\\",\\\"size\\\":0,\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"barchart\\\"}\",\"name\":\"query - 14\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"---\\\\r\\\\n#### Unsigned LDAP\\\"}\",\"name\":\"text - 13\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | extend Title = \\\\\\\"Number of events\\\\\\\"\\\\r\\\\n | summarize QueryCount = count(EventID) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\\\",\\\"size\\\":4,\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Title\\\",\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"QueryCount\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"orange\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false},\\\"graphSettings\\\":{\\\"type\\\":0}}\",\"customWidth\":\"20\",\"name\":\"query - 8\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | extend Title = \\\\\\\"Number of IP Addresses\\\\\\\"\\\\r\\\\n | summarize QueryCount =  dcount(IPAddress) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\\\",\\\"size\\\":4,\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Title\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"QueryCount\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"auto\\\",\\\"showIcon\\\":true},\\\"numberFormat\\\":{\\\"unit\\\":17,\\\"options\\\":{\\\"maximumSignificantDigits\\\":3,\\\"maximumFractionDigits\\\":2}}},\\\"showBorder\\\":false}}\",\"customWidth\":\"20\",\"name\":\"query - 9\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | extend Title = \\\\\\\"Number of Accounts\\\\\\\"\\\\r\\\\n | summarize QueryCount = dcount(Account) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\\\",\\\"size\\\":4,\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Title\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"QueryCount\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"purple\\\",\\\"showIcon\\\":true},\\\"numberFormat\\\":{\\\"unit\\\":17,\\\"options\\\":{\\\"style\\\":\\\"decimal\\\",\\\"maximumFractionDigits\\\":2,\\\"maximumSignificantDigits\\\":3}}},\\\"showBorder\\\":false}}\",\"customWidth\":\"20\",\"name\":\"query - 10\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n //| project ParameterXml, DomainController=Computer , TimeGenerated, EventID  \\\\r\\\\n //| parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | summarize QueryCount = count(EventID) by Account, IPAddress\\\\r\\\\n | order by QueryCount\\\\r\\\\n \\\\r\\\\n \\\\r\\\\n //| summarize querycount = count (EventID) by TimeGenerated bin(day)\\\\r\\\\n //| summarize Count = count(EventID) by Account, bin (TimeGenerated, 1d)\\\\r\\\\n //| top 10 by QueryCount\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n//let string_to_trim = @\\\\\\\"--https://bing.com--\\\\\\\";\\\\r\\\\n//let substring = \\\\\\\"--\\\\\\\";\\\\r\\\\n//print string_to_trim = string_to_trim, trimmed_string = trim(substring,string_to_trim)\\\",\\\"size\\\":0,\\\"exportFieldName\\\":\\\"Account\\\",\\\"exportParameterName\\\":\\\"Account\\\",\\\"exportDefaultValue\\\":\\\"All\\\",\\\"title\\\":\\\"By Account - click to filter\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Account\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IPAddress\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"QueryCount\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":1,\\\"palette\\\":\\\"orange\\\",\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Source IP\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"LDAPClient\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"TimeGenerated\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"sortBy\\\":[{\\\"itemKey\\\":\\\"$gen_bar_QueryCount_2\\\",\\\"sortOrder\\\":2}],\\\"labelSettings\\\":[{\\\"columnId\\\":\\\"Account\\\"},{\\\"columnId\\\":\\\"Computer\\\",\\\"label\\\":\\\"Domain Controller\\\"},{\\\"columnId\\\":\\\"IPAddress\\\",\\\"label\\\":\\\"Source IP\\\"},{\\\"columnId\\\":\\\"QueryCount\\\",\\\"label\\\":\\\"Number of Insecure Binds\\\"}]}}\",\"customWidth\":\"50\",\"name\":\"LDAP by Account\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n// | project ParameterXml, DomainController=Computer , TimeGenerated, EventID  \\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n //| summarize QueryCount = count(EventID) by Account, bin(TimeGenerated, 1h)\\\\r\\\\n //| summarize QueryCount = count(EventID) by Account, bin (HourGenerated=TimeGenerated, 1h), SourceIP=IPAddress\\\\r\\\\n | extend TimeFromNow = now() - TimeGenerated\\\\r\\\\n | extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\\\r\\\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\\\\\"All\\\\\\\"\\\\r\\\\n //| project '{Account:escape}'\\\\r\\\\n | project Account, IPAddress, Computer, RenderedDescription, UserName, EventID, Time_of_Bind=TimeAgo\\\\r\\\\n// T | summarize Hits=count() by bin(Duration, 1s)\\\",\\\"size\\\":0,\\\"title\\\":\\\"Account Details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Account\\\",\\\"formatter\\\":7,\\\"formatOptions\\\":{\\\"linkTarget\\\":\\\"GenericDetails\\\",\\\"linkIsContextBlade\\\":true,\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IPAddress\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"RenderedDescription\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"UserName\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"EventID\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Time_of_Bind\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Domain Controller\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"DC\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"filter\\\":true,\\\"labelSettings\\\":[{\\\"columnId\\\":\\\"Account\\\"},{\\\"columnId\\\":\\\"IPAddress\\\",\\\"label\\\":\\\"Source IP\\\"},{\\\"columnId\\\":\\\"Computer\\\",\\\"label\\\":\\\"Domain Controller\\\"},{\\\"columnId\\\":\\\"Time_of_Bind\\\",\\\"label\\\":\\\"Binding Time\\\"}]}}\",\"customWidth\":\"50\",\"name\":\"query - 7\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n// | project ParameterXml, DomainController=Computer , TimeGenerated, EventID  \\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n //| summarize QueryCount = count(EventID) by Account, bin(TimeGenerated, 1h)\\\\r\\\\n //| summarize QueryCount = count(EventID) by Account, bin (HourGenerated=TimeGenerated, 1h), SourceIP=IPAddress\\\\r\\\\n | extend TimeFromNow = now() - TimeGenerated\\\\r\\\\n | extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\\\r\\\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\\\\\"All\\\\\\\"\\\\r\\\\n //| project '{Account:escape}'\\\\r\\\\n | summarize count() by Account, bin(TimeGenerated, {TimeRange:grain})\\\\r\\\\n// T | summarize Hits=count() by bin(Duration, 1s)\\\",\\\"size\\\":0,\\\"title\\\":\\\"Acount events over time\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"linechart\\\"}\",\"name\":\"query - 11\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n //| project ParameterXml, DomainController=Computer , TimeGenerated, EventID  \\\\r\\\\n //| parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '><Param>' Account '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | summarize QueryCount = count(EventID) by IPAddress, Account\\\\r\\\\n\\\",\\\"size\\\":0,\\\"exportFieldName\\\":\\\"IPAddress\\\",\\\"exportParameterName\\\":\\\"IPAddress\\\",\\\"exportDefaultValue\\\":\\\"All\\\",\\\"title\\\":\\\"By Source IP - click to filter\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"IPAddress\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Account\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"QueryCount\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":1,\\\"palette\\\":\\\"blueDark\\\",\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Sum\\\"}},{\\\"columnMatch\\\":\\\"Account Count\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"Trend\\\",\\\"formatter\\\":9,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"magenta\\\",\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"ParentId\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"LDAPClient\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}}],\\\"sortBy\\\":[{\\\"itemKey\\\":\\\"$gen_bar_QueryCount_2\\\",\\\"sortOrder\\\":2}],\\\"labelSettings\\\":[{\\\"columnId\\\":\\\"IPAddress\\\",\\\"label\\\":\\\"Source IP\\\"},{\\\"columnId\\\":\\\"Account\\\"},{\\\"columnId\\\":\\\"QueryCount\\\",\\\"label\\\":\\\"Number of Insedcure Binds\\\"}]}}\",\"customWidth\":\"50\",\"name\":\"query - 3\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n// | project ParameterXml, DomainController=Computer , TimeGenerated, EventID  \\\\r\\\\n | parse ParameterXml with * '><Param>' Accounts '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | extend TimeFromNow = now() - TimeGenerated\\\\r\\\\n | extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\\\r\\\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\\\\\"All\\\\\\\"\\\\r\\\\n | project IPAddress, Accounts, Computer, RenderedDescription, UserName, EventID, Time_of_Bind=TimeAgo\\\",\\\"size\\\":0,\\\"title\\\":\\\"Source IP Details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"IPAddress\\\",\\\"formatter\\\":7,\\\"formatOptions\\\":{\\\"linkTarget\\\":\\\"GenericDetails\\\",\\\"linkIsContextBlade\\\":true,\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Accounts\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"RenderedDescription\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"UserName\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"EventID\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Time_of_Bind\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"filter\\\":true,\\\"labelSettings\\\":[]}}\",\"customWidth\":\"50\",\"name\":\"query - 8\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n | where EventID == 2889 \\\\r\\\\n// | project ParameterXml, DomainController=Computer , TimeGenerated, EventID  \\\\r\\\\n | parse ParameterXml with * '><Param>' Accounts '</' *\\\\r\\\\n | parse ParameterXml with * '<Param>' IPAddress ':' * \\\\r\\\\n | parse kind = regex ParameterXml with * '</Param><Param>' * '</Param><Param>' BindingType '</Param>'\\\\r\\\\n | extend TimeFromNow = now() - TimeGenerated\\\\r\\\\n | extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\\\r\\\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\\\\\"All\\\\\\\"\\\\r\\\\n | summarize count() by IPAddress, bin(TimeGenerated, {TimeRange:grain})\\\",\\\"size\\\":0,\\\"title\\\":\\\"IP addresses events over time\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"linechart\\\"}\",\"name\":\"query - 12\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"---\\\\r\\\\n### NTLM v1\\\"}\",\"name\":\"text - 14\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SecurityEvent \\\\r\\\\n| where EventID == 4624 \\\\r\\\\n| where AuthenticationPackageName == 'NTLM' \\\\r\\\\n| where LmPackageName == 'NTLM V1'  \\\\r\\\\n| where Account !contains 'ANONYMOUS LOGON' \\\\r\\\\n| summarize Count = count() by WorkstationName, Computer \\\\r\\\\n| project WorkstationName, Computer, Count\\\\r\\\\n| order by Count desc\\\\r\\\\n\\\",\\\"size\\\":0,\\\"exportFieldName\\\":\\\"\\\",\\\"exportParameterName\\\":\\\"WorkstationName\\\",\\\"exportDefaultValue\\\":\\\"{\\\\\\\"WorkstationName\\\\\\\":\\\\\\\"All\\\\\\\"}\\\",\\\"title\\\":\\\"NTLM v1 events, by Source and server - click to filter\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"WorkstationName\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Sum\\\"}},{\\\"columnMatch\\\":\\\"$gen_group\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"hierarchySettings\\\":{\\\"treeType\\\":1,\\\"groupBy\\\":[\\\"WorkstationName\\\"]},\\\"sortBy\\\":[{\\\"itemKey\\\":\\\"Computer\\\",\\\"sortOrder\\\":2}],\\\"labelSettings\\\":[]},\\\"tileSettings\\\":{\\\"showBorder\\\":false,\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"WorkstationName\\\",\\\"formatter\\\":1},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"auto\\\"},\\\"numberFormat\\\":{\\\"unit\\\":17,\\\"options\\\":{\\\"maximumSignificantDigits\\\":3,\\\"maximumFractionDigits\\\":2}}}}}\",\"customWidth\":\"50\",\"name\":\"query - 6\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SecurityEvent \\\\r\\\\n| where EventID == 4624 \\\\r\\\\n| where AuthenticationPackageName == 'NTLM' \\\\r\\\\n| where LmPackageName == 'NTLM V1'  \\\\r\\\\n| where Account !contains 'ANONYMOUS LOGON' \\\\r\\\\n| where '{WorkstationName:escape}' contains \\\\\\\"All\\\\\\\" or '{WorkstationName:escape}' contains WorkstationName\\\\r\\\\n| summarize Count=count() by WorkstationName, Day=bin(TimeGenerated, {TimeRange:grain}) \\\",\\\"size\\\":0,\\\"title\\\":\\\"NTLM v1 events, by time\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"areachart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 15\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SecurityEvent \\\\r\\\\n| where EventID == 4624 \\\\r\\\\n| where AuthenticationPackageName == 'NTLM' \\\\r\\\\n| where LmPackageName == 'NTLM V1'  \\\\r\\\\n| where Account !contains 'ANONYMOUS LOGON' \\\\r\\\\n| where '{WorkstationName:escape}' contains \\\\\\\"All\\\\\\\" or ('{WorkstationName:escape}' contains WorkstationName and '{WorkstationName:escape}' contains Computer)\\\\r\\\\n| summarize Count = count() by Account, WorkstationName, DC=Computer, LogonProcessName, TargetDomainName, TargetAccount, IpAddress\\\\r\\\\n| sort by Count desc  \\\",\\\"size\\\":0,\\\"title\\\":\\\"NTLM v1 events details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Account\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"WorkstationName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"DC\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Activity\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"LogonProcessName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"TargetDomainName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"TargetAccount\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IpAddress\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":8,\\\"formatOptions\\\":{\\\"palette\\\":\\\"greenRed\\\",\\\"showIcon\\\":true}}],\\\"filter\\\":true,\\\"labelSettings\\\":[]}}\",\"name\":\"query - 16\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"---\\\\r\\\\n### SMB v1\\\"}\",\"name\":\"text - 18\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let data = Event\\\\r\\\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit' \\\\r\\\\n| parse ParameterXml with * '<Param>' ClientAddress '</' * \\\\r\\\\n| extend Client = replace(@'>', @'', replace(@'\\\\\\\\]', @'', replace(@'\\\\\\\\[', @'', replace(@'<!\\\\\\\\[CDATA', @'', ClientAddress))));\\\\r\\\\ndata\\\\r\\\\n| summarize Count = count() by Client\\\\r\\\\n| join kind = fullouter (datatable(Client:string)['Medium', 'high', 'low']) on Client\\\\r\\\\n| project Client = iff(Client == '', Client1, Client), Count = iff(Client == '', 0, Count)\\\\r\\\\n| join kind = inner (data\\\\r\\\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Client)\\\\r\\\\n on Client\\\\r\\\\n| project-away Client1, TimeGenerated\\\\r\\\\n| extend Clients = Client\\\\r\\\\n| union (\\\\r\\\\n data \\\\r\\\\n | summarize Count = count() \\\\r\\\\n | extend jkey = 1\\\\r\\\\n | join kind=inner (data\\\\r\\\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\\\r\\\\n | extend jkey = 1) on jkey\\\\r\\\\n | extend Client = 'All', Clients = '*' \\\\r\\\\n)\\\\r\\\\n| order by Count desc\\\\r\\\\n| take 10\\\\r\\\\n\\\",\\\"size\\\":4,\\\"exportFieldName\\\":\\\"Client\\\",\\\"exportParameterName\\\":\\\"ClientFilter\\\",\\\"exportDefaultValue\\\":\\\"All\\\",\\\"title\\\":\\\"SMB v1 events, by client - click to filter\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"tiles\\\",\\\"tileSettings\\\":{\\\"titleContent\\\":{\\\"columnMatch\\\":\\\"Client\\\",\\\"formatter\\\":1,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},\\\"leftContent\\\":{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":12,\\\"formatOptions\\\":{\\\"palette\\\":\\\"auto\\\",\\\"showIcon\\\":true},\\\"numberFormat\\\":{\\\"unit\\\":17,\\\"options\\\":{\\\"maximumSignificantDigits\\\":3,\\\"maximumFractionDigits\\\":2}}},\\\"secondaryContent\\\":{\\\"columnMatch\\\":\\\"Trend\\\",\\\"formatter\\\":9,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"purple\\\",\\\"showIcon\\\":true}},\\\"showBorder\\\":false}}\",\"name\":\"query - 18\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event \\\\r\\\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit' \\\\r\\\\n| parse ParameterXml with * '<Param>' ClientAddress '</' * \\\\r\\\\n| extend Client = replace(@'>', @'', replace(@'\\\\\\\\]', @'', replace(@'\\\\\\\\[', @'', replace(@'<!\\\\\\\\[CDATA', @'', ClientAddress)))) \\\\r\\\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\\\\\"All\\\\\\\"\\\\r\\\\n| summarize Count=count() by bin(TimeGenerated, 1h) , SMBServer=Computer \\\\r\\\\n\\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"SMB v1 events, by SMB Server over time\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"areachart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 19\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Event\\\\r\\\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit'\\\\r\\\\n| parse ParameterXml with * '<Param>' ClientAddress '</' *\\\\r\\\\n| extend Client = replace(@'>', @'', replace(@'\\\\\\\\]', @'', replace(@'\\\\\\\\[', @'', replace(@'<!\\\\\\\\[CDATA', @'', ClientAddress))))\\\\r\\\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\\\\\"All\\\\\\\"\\\\r\\\\n| summarize Count=count() by Client, SMBServer=Computer, ParameterXml, RenderedDescription, EventData\\\\r\\\\n| sort by Count desc\\\",\\\"size\\\":0,\\\"title\\\":\\\"SMB v1 event details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Client\\\",\\\"formatter\\\":7,\\\"formatOptions\\\":{\\\"linkTarget\\\":\\\"GenericDetails\\\",\\\"linkIsContextBlade\\\":true,\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"SMBServer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"ParameterXml\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"RenderedDescription\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"EventData\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":8,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"greenBlue\\\",\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Sum\\\"}},{\\\"columnMatch\\\":\\\"$gen_group\\\",\\\"formatter\\\":7,\\\"formatOptions\\\":{\\\"linkTarget\\\":\\\"GenericDetails\\\",\\\"linkIsContextBlade\\\":true,\\\"showIcon\\\":true}}],\\\"filter\\\":true,\\\"hierarchySettings\\\":{\\\"treeType\\\":1,\\\"groupBy\\\":[\\\"Client\\\"]},\\\"labelSettings\\\":[]}}\",\"customWidth\":\"50\",\"name\":\"query - 20\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"---\\\\r\\\\n### Kerberos weak ciphers\\\"}\",\"name\":\"text - 21\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SecurityEvent\\\\r\\\\n| where EventID == 4768 or EventID == 4769\\\\r\\\\n| where Level == 8\\\\r\\\\n| parse EventData with * '\\\\\\\"TicketEncryptionType\\\\\\\">' TicketEncryptionType '<' *\\\\r\\\\n| where TicketEncryptionType != \\\\\\\"0x12\\\\\\\" and TicketEncryptionType != \\\\\\\"0x11\\\\\\\" //AES128/256, this filter needs to be activated\\\\r\\\\n//| where TicketEncryptionType != \\\\\\\"0x17\\\\\\\" //RC4\\\\r\\\\n| parse EventData with * '\\\\\\\"IpAddress\\\\\\\">' IpAddress '<' *\\\\r\\\\n| parse EventData with * '\\\\\\\"TargetUserName\\\\\\\">' TargetUserName '<' *\\\\r\\\\n| parse EventData with * '\\\\\\\"ServiceName\\\\\\\">' ServiceName '<' *\\\\r\\\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\\\r\\\\n| summarize Count=count() by Cipher, bin(TimeGenerated, 1h)\\\\r\\\\n\\\",\\\"size\\\":0,\\\"exportDefaultValue\\\":\\\"All\\\",\\\"title\\\":\\\"Kerberos weak ciphers, by time and cipher\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"areachart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 22\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SecurityEvent\\\\r\\\\n| where EventID == 4768 or EventID == 4769\\\\r\\\\n| where Level == 8\\\\r\\\\n| parse EventData with * '\\\\\\\"TicketEncryptionType\\\\\\\">' TicketEncryptionType '<' *\\\\r\\\\n| where TicketEncryptionType != \\\\\\\"0x12\\\\\\\" and TicketEncryptionType != \\\\\\\"0x11\\\\\\\" //AES128/256, this filter needs to be activated\\\\r\\\\n//| where TicketEncryptionType != \\\\\\\"0x17\\\\\\\" //RC4\\\\r\\\\n| parse EventData with * '\\\\\\\"IpAddress\\\\\\\">' IpAddress '<' *\\\\r\\\\n| parse EventData with * '\\\\\\\"TargetUserName\\\\\\\">' TargetUserName '<' *\\\\r\\\\n| parse EventData with * '\\\\\\\"ServiceName\\\\\\\">' ServiceName '<' *\\\\r\\\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\\\r\\\\n| summarize Count=count() by Cipher, IpAddress, TargetUserName , ServiceName, Computer, Activity\\\\r\\\\n| sort by Count desc\\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Kerberos weak ciphers event details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Cipher\\\",\\\"formatter\\\":7,\\\"formatOptions\\\":{\\\"linkTarget\\\":\\\"GenericDetails\\\",\\\"linkIsContextBlade\\\":true,\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"IpAddress\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"TargetUserName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"ServiceName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Activity\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":8,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"greenRed\\\",\\\"showIcon\\\":true}}],\\\"filter\\\":true,\\\"labelSettings\\\":[]}}\",\"customWidth\":\"50\",\"name\":\"query - 23\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"---\\\\r\\\\n### WDigest\\\"}\",\"name\":\"text - 24\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let data = SecurityEvent \\\\r\\\\n| where EventID == 4624 or EventID == 4776 \\\\r\\\\n| where Level == 8 \\\\r\\\\n| where PackageName contains 'WDigest';\\\\r\\\\nlet appData = data\\\\r\\\\n| summarize TotalCount = count() by TargetAccount\\\\r\\\\n| join kind=inner (data\\\\r\\\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by TargetAccount\\\\r\\\\n    | project-away TimeGenerated) on TargetAccount\\\\r\\\\n| order by TotalCount desc, TargetAccount asc\\\\r\\\\n| project TargetAccount, TotalCount, Trend\\\\r\\\\n| serialize Id = row_number();\\\\r\\\\ndata\\\\r\\\\n| summarize TotalCount = count() by Workstation , TargetAccount\\\\r\\\\n| join kind=inner (data\\\\r\\\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by TargetAccount, Workstation\\\\r\\\\n    | project-away TimeGenerated) on TargetAccount, Workstation\\\\r\\\\n| order by TotalCount desc, TargetAccount asc\\\\r\\\\n| project TargetAccount, Workstation, TotalCount, Trend\\\\r\\\\n| serialize Id = row_number(1000000)\\\\r\\\\n| join kind=inner (appData) on TargetAccount\\\\r\\\\n| project Id, Name = Workstation, Type = 'Workstation', ['TargetAccounts Count'] = TotalCount, Trend,  ParentId = Id1\\\\r\\\\n| union (appData \\\\r\\\\n    | project Id, Name = TargetAccount, Type = 'TargetAccount', ['TargetAccounts Count'] = TotalCount,  Trend)\\\\r\\\\n| order by ['TargetAccounts Count'] desc, Name asc\\\\r\\\\n\\\",\\\"size\\\":0,\\\"exportParameterName\\\":\\\"WDigest\\\",\\\"exportDefaultValue\\\":\\\"{ \\\\\\\"Name\\\\\\\":\\\\\\\"\\\\\\\", \\\\\\\"Type\\\\\\\":\\\\\\\"*\\\\\\\"}\\\",\\\"title\\\":\\\"WDigest, by account workstation - click to filter\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Id\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Name\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Type\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"TargetAccounts Count\\\",\\\"formatter\\\":8,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"blue\\\",\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Trend\\\",\\\"formatter\\\":10,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"orange\\\",\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"ParentId\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"hierarchySettings\\\":{\\\"idColumn\\\":\\\"Id\\\",\\\"parentColumn\\\":\\\"ParentId\\\",\\\"treeType\\\":0,\\\"expanderColumn\\\":\\\"Name\\\"},\\\"labelSettings\\\":[]}}\",\"customWidth\":\"50\",\"name\":\"query - 25\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let details = dynamic({WDigest});\\\\r\\\\nSecurityEvent \\\\r\\\\n| where EventID == 4624 or EventID == 4776 \\\\r\\\\n| where Level == 8 \\\\r\\\\n| where PackageName contains 'WDigest' \\\\r\\\\n| where (details.Type == 'Workstation' and details.Name == Workstation) or (details.Type == 'TargetAccount' and details.Name == TargetAccount) or (details.Type == '*')\\\\r\\\\n| summarize Count=count() by bin(TimeGenerated, 1h), Workstation\\\",\\\"size\\\":0,\\\"title\\\":\\\"WDigest, by time and workstation\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"areachart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 26\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let details = dynamic({WDigest});\\\\r\\\\nSecurityEvent\\\\r\\\\n| where EventID == 4624 or EventID == 4776\\\\r\\\\n| where Level == 8\\\\r\\\\n| where PackageName contains 'WDigest'\\\\r\\\\n| where (details.Type == 'Workstation' and details.Name == Workstation) or (details.Type == 'TargetAccount' and details.Name == TargetAccount) or (details.Type == '*')\\\\r\\\\n| summarize Count=count() by TargetAccount, Workstation, WDigestServer=Computer , Activity\\\\r\\\\n| sort by Count desc\\\",\\\"size\\\":0,\\\"title\\\":\\\"WDigest event details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"TargetAccount\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Workstation\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"WDigestServer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Activity\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Count\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"coldHot\\\",\\\"showIcon\\\":true}}],\\\"filter\\\":true,\\\"labelSettings\\\":[]}}\",\"name\":\"query - 27\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"---\\\\r\\\\n### Azure AD Legacy Auth\\\"}\",\"name\":\"text - 28\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SigninLogs\\\\r\\\\n| where ClientAppUsed in ('Other clients; Older Office clients', 'Other clients', 'Other clients; IMAP', 'Other clients; POP', 'Other clients; SMTP')\\\\r\\\\n| summarize count() by UserPrincipalName, ClientAppUsed //doughnut\\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Legacy authentications, by account\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"piechart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 29\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SigninLogs\\\\r\\\\n| where ClientAppUsed in ('Other clients; Older Office clients', 'Other clients', 'Other clients; IMAP', 'Other clients; POP', 'Other clients; SMTP')\\\\r\\\\n| summarize count() by IPAddress,ClientAppUsed //doughnut\\\",\\\"size\\\":0,\\\"title\\\":\\\"Legacy authentications, by IP address\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"piechart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 30\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SigninLogs\\\\r\\\\n| where ClientAppUsed in ('Other clients; Older Office clients', 'Other clients', 'Other clients; IMAP', 'Other clients; POP', 'Other clients; SMTP')\\\\r\\\\n| summarize count() by tostring(CountryOrRegion=LocationDetails.countryOrRegion), ClientAppUsed //bar\\\\r\\\\n| order by count_\\\\r\\\\n\\\",\\\"size\\\":0,\\\"title\\\":\\\"Legacy authentications, by country/region\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"CountryOrRegion\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"ClientAppUsed\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"count_\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"purple\\\",\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Sum\\\"}},{\\\"columnMatch\\\":\\\"$gen_group\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"hierarchySettings\\\":{\\\"treeType\\\":1,\\\"groupBy\\\":[\\\"CountryOrRegion\\\"]},\\\"labelSettings\\\":[{\\\"columnId\\\":\\\"CountryOrRegion\\\"},{\\\"columnId\\\":\\\"ClientAppUsed\\\"},{\\\"columnId\\\":\\\"count_\\\",\\\"label\\\":\\\"Count\\\"}]}}\",\"customWidth\":\"50\",\"name\":\"query - 31\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SigninLogs\\\\r\\\\n| where ClientAppUsed in ('Other clients; Older Office clients', 'Other clients', 'Other clients; IMAP', 'Other clients; POP', 'Other clients; SMTP')\\\\r\\\\n| summarize count() by ClientAppUsed, UserPrincipalName //bar\\\",\\\"size\\\":0,\\\"title\\\":\\\"Legacy authentications, by authentication type\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"ClientAppUsed\\\",\\\"formatter\\\":5,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"UserPrincipalName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Unique\\\"}},{\\\"columnMatch\\\":\\\"count_\\\",\\\"formatter\\\":4,\\\"formatOptions\\\":{\\\"min\\\":0,\\\"palette\\\":\\\"gray\\\",\\\"showIcon\\\":true,\\\"aggregation\\\":\\\"Sum\\\"}},{\\\"columnMatch\\\":\\\"$gen_group\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}}],\\\"hierarchySettings\\\":{\\\"treeType\\\":1,\\\"groupBy\\\":[\\\"ClientAppUsed\\\"]},\\\"labelSettings\\\":[{\\\"columnId\\\":\\\"ClientAppUsed\\\"},{\\\"columnId\\\":\\\"UserPrincipalName\\\"},{\\\"columnId\\\":\\\"count_\\\",\\\"label\\\":\\\"Count\\\"}]}}\",\"customWidth\":\"50\",\"name\":\"query - 32\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"SigninLogs\\\\r\\\\n| where ClientAppUsed in ('Other clients; Older Office clients', 'Other clients', 'Other clients; IMAP', 'Other clients; POP', 'Other clients; SMTP')\\\\r\\\\n| summarize count() by UserPrincipalName, IPAddress, ClientAppUsed, tostring(CountryOrRegion=LocationDetails.countryOrRegion) //table\\\",\\\"size\\\":0,\\\"title\\\":\\\"Legacy authentications details\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeRange\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"name\":\"query - 33\"}],\"isLocked\":false,\"styleSettings\":{},\"fromTemplateId\":\"sentinel-InsecureProtocols\"}",
    "category": "sentinel",
    "isPersisted": true,
    "tags": [ "InsecureProtocolsWorkbook", "1.0" ]
  }
}