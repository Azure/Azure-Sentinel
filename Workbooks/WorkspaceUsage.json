{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "ccd5adcd-8d59-4cfe-99ec-98075de2e253",
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "1ca69445-60fc-4806-b43d-ac7e6aad630a",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\r\n",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "label": "â˜ï¸ Subscription"
          },
          {
            "id": "e94aafa3-c5d9-4523-89f0-4e87aa754511",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "ðŸ—‚ï¸ Workspace",
            "type": 5,
            "isRequired": true,
            "query": "resources\n| where type =~ 'microsoft.operationalinsights/workspaces' \n//| where subscriptionId == '{Subscription:id}'\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "value": "",
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "eafaa0ec-7c3a-4ee5-babe-9850080c909d",
            "version": "KqlParameterItem/1.0",
            "name": "resourceGroup",
            "type": 1,
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| where id == \"{Workspace}\"\r\n| project resourceGroup",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "c4b69c01-2263-4ada-8d9c-43433b739ff3",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "label": "â±ï¸ Time Range"
          },
          {
            "id": "27308a9d-46a2-4fca-8035-e813201fb4f8",
            "version": "KqlParameterItem/1.0",
            "name": "GBperday",
            "type": 1,
            "description": "Shows Average per Day over selected Duration (GB)",
            "query": "Usage\r\n| where TimeGenerated > startofday({TimeRange:start}) and TimeGenerated < startofday({TimeRange:end})\r\n// Only look at chargeable Tables\r\n| where IsBillable == True\r\n| summarize\r\nTotalBytes =round(sum(Quantity))\r\nby bin(TimeGenerated, 1d)\r\n| summarize GBperday = round(avg(TotalBytes)/1000,2)\r\n",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "22ed8771-4f7a-4ed1-bb14-882b863be85e",
            "version": "KqlParameterItem/1.0",
            "name": "selectDepthLevel",
            "label": "Select the detail level",
            "type": 10,
            "description": "Basic data (default) will load much faster than Advanced insight into the data",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Basic\", \"label\": \"Basic\", \"selected\":true },\r\n { \"value\": \"Advanced\", \"label\": \"Advanced\" }\r\n ]"
          },
          {
            "id": "c71f3009-a3f4-4aa5-aaf0-d0f667100e56",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "ðŸ“– Help",
            "type": 10,
            "description": "This will show some help information to help you understand the page you are on",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"Yes\", \"label\": \"Yes\"},\r\n { \"value\": \"No\", \"label\": \"No\", \"selected\":true },\r\n { \"value\": \"Change Log\", \"label\": \"Change Log\"}\r\n]"
          },
          {
            "id": "bd9b6f2d-3e7b-4d2c-83b4-f77154f6af42",
            "version": "KqlParameterItem/1.0",
            "name": "GBtotal",
            "type": 1,
            "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == True\r\n| parse ResourceUri with *'/subscriptions/' SubscriptionId '/resourcegroups/'*\r\n| where SubscriptionId == '{Subscription:id}'\r\n| summarize Gbytes = sum(Quantity)/1000  by SubscriptionId\r\n| project TotalGBytes = round(Gbytes,2)",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - 1"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "4df9243a-749d-4698-98f6-188e0b687e13",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ” Workspace Info",
            "subTarget": "WorkspaceInfo",
            "style": "link"
          },
          {
            "id": "4c0faa80-5c85-4d02-989d-37921b12ae87",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ“ˆ Latency",
            "subTarget": "Latency",
            "style": "link"
          },
          {
            "id": "ffceb6e6-3756-466e-860b-c017f0421e9f",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ’° Cost Analysis",
            "subTarget": "Cost",
            "style": "link"
          },
          {
            "id": "25b0dfdf-9de1-4a16-b66f-c5b3822c8018",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”’ Microsoft Sentinel",
            "subTarget": "Sentinel",
            "style": "link"
          },
          {
            "id": "1e15a92e-c236-4e93-833e-fe95f5b1d6e6",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ“… Regular Checks (D/W/M)",
            "subTarget": "Checks",
            "style": "link"
          },
          {
            "id": "82bcdf4d-0e66-4f27-a958-41dd2b96d266",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ’½ Azure Data Explorer (ADX)",
            "subTarget": "ADX",
            "style": "link"
          },
          {
            "id": "b509ee87-2901-416f-bc7d-043fc676ae1d",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ“ Data Collection Rules",
            "subTarget": "dcr",
            "style": "link"
          },
          {
            "id": "0e10a678-63c6-46bf-8cab-fb416df17ecc",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”— Function or Parsers",
            "subTarget": "function",
            "style": "link"
          }
        ]
      },
      "name": "links - 19"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Log Analytics Workspace Name']=id, ['Resource Group']=resourceGroup, location, ['Data Retention(days)']=retentionDays, ['Last known SKU update']=skuUpdate, ['Daily Data Cap']=dailyquotaGB, ['Licence']=sku,  ['Commitment Tier']=properties.sku.capacityReservationLevel, ['Notes'] = sentinel",
        "size": 4,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Data Retention(days)",
              "formatter": 0,
              "formatOptions": {
                "showIcon": true
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": false
                }
              }
            },
            {
              "columnMatch": "Last known SKU update",
              "formatter": 18,
              "formatOptions": {
                "showIcon": true,
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "is Empty",
                    "thresholdValue": "\" \"",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Daily Data Cap",
              "formatter": 18,
              "formatOptions": {
                "showIcon": true,
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "not set",
                    "representation": "Unavailable",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "1",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Data Retention",
              "formatter": 0,
              "formatOptions": {
                "showIcon": true
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": false
                }
              }
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "WorkspaceInfo"
      },
      "name": "query - 18"
    },
    {
      "type": 1,
      "content": {
        "json": "## Workspace Usage Report \r\n### Change Log\r\nUse this report to analyze the the sizes of the different tables and Latency in your workspace and agents.  This report checks the overall workspace health.\r\n\r\n|Version|Description|\r\n|---|---|\r\n|v1.1|Added Events Per Second (EPS) to Workspace Info Tab.| \r\n|v1.2|Added EPS with a breakdown for Device Vendor in CommonSecurityLog\r\n|v1.3|Added EPS Tab and Min, Max values\r\n|v1.4 | Added Checks Tab for Daily, Weekly and Monthly suggested checking routines.  Also Defender for Cloud info in Costs Tab.\r\n|v1.4.2 | Added Groups to all Tabs. Added Price info and Help button.\r\n|v1.4.3 | Added to [COST] tab and report of \"GBytes used per Computer\" \r\n|v1.4.4 | Quick fix to get the TableName duplicate removed.  Added value to Y axis of [Cost] trend graph, Remove content (EPS) that is planned for the Sentinel Health workbook.  \r\n|v1.4.5 | Added extra Cost info, improve Weekly reports and other grids , testing release ONLY\r\n|v1.4.6 | Moved Price to Costs Analysis Tab (all pricing is now in the same place). Added some table data, description and links to Latency grid.  Filter on Queries in Weekly report and Workspace audit filters |\r\n|v1.4.7 | Add Pie chart of % billable vs. free to Cost Analysis.  Add count of Rules, Rule Templates and Hunting Queries (just unique ones).  Extra Defender for Cloud  report for \"minimal\",\"common\" and \"all\". Additional troubleshooting displays, when Help toggle is on. % used for Tables. User filter for LAqueries.|\r\n|v1.4.8 | [Cost Analysis] is now a Tab with Sub Menus to aid load times and readability.  New features:Syslog Cost Analysis, CEF Cost Analysis, in the [OverView] sub menu, there are now reports on capacity / price per Subscription, Resource Group and Tags.  The Sentinel tab, has reports for Usage vs. Capacity Reservation and recommendtions for the settings you are on, for Log Analytics and Sentinel. |\r\n|v1.4.9 | Add extra filtering within 'Advanced Workspace Details', so you can select other Workspaces to audit, and provide a link to the related Workbook (if its installed).  Add a filter for a basic level of data in the complex reports (default) or selected Advanced for the original longer running query.  Added Automation rules to Alert Rules in Weekly reporting.  Removed Tags section for now in Overview report.  Added Sentinel cost estimate for retention.|\r\n|v1.5.0 | Added an ADX Tab (more to add here, maybe just a placeholder for now). Added some reports on Template rules vs Active Rule by *Type* (so you can see what is deployed vs. available by each rule type/category) in the Weekly reports.  Fix for Chart bug that can cause a â€œout of memoryâ€ error. Wording swapped to \"Commitment Tiers\" rather than Capacity Reservation. | \r\n|v1.5.1 | Performance tweaks. GB to GB correction.  Drill down on Computer costs. Add link to ADX insights |\r\n|v1.6 | Change to new product names + fix subscription issue | \r\n|v1.6.1 | Improve Weekly view and Rules. Add Funcytion Alias view, add DCR view  | \r\n\r\n insights |To do Next: n/a\r\n\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Change Log"
      },
      "customWidth": "50",
      "name": "text - 0"
    },
    {
      "type": 1,
      "content": {
        "json": "## Help File\r\n\r\nMore details in the Wiki: https://github.com/clivewatson/KQLpublic/wiki/Workbook-Usage\r\n\r\n## Usage\r\n\t- Please select your **Subscription** and **Workspace**\r\n\t- Time Range: is the time you wish to query back to. i.e 7days from now, into the past.\r\n\t- Help is available in various parts of this Workbook.\r\n\t- Select the Detail Level - is a toggle to reduce the page load time of certain queries.\r\n## Categories\r\n\t- Azure Monitor Logs (Workspace)\r\n\t- Sentinel\r\n\t- Defender for Cloud\r\n## Solutions\r\n|Solution|Description|\r\n|---|---|\r\n| Workspace Infomation | info about the workspace, usage and statistics|\r\n|Latency | Which Tables or machines have latency issues, average, minimun and maximum values|\r\n|Costs Analysis| Looking again at the tables in the [Workspace Info] tab, but also you can select a Price of your choosing (Â£,$).  Sub menus have been added to aid drill-down to specific products or data|\r\n|Sentinel | specifc data about Sentinel|\r\n| Regular Checks | Daily, Weekly and Monthly suggested checks you can look at.|\r\n\r\n## Data Sources\r\n\t- Azure Resource Graph (ARG) and Various tables within Azure Monitor Logs (Workspace).\r\n\r\n## Anomoly Detection\r\nSome reports now show anomoly detection, this explains the Score: https://docs.microsoft.com/azure/data-explorer/anomaly-detection#time-series-anomaly-detection\r\n\r\nAnomaly scores above 1.5 or below -1.5 indicate a mild anomaly rise or decline respectively. Anomaly scores above 3.0 or below -3.0 indicate a strong anomaly."
      },
      "conditionalVisibilities": [
        {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "WorkspaceInfo"
        },
        {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "Yes"
        }
      ],
      "customWidth": "50",
      "name": "text - 0 - Copy"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Troubleshoot",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"b388e944-5509-49c9-84d7-f38bffa995b2\" width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><defs><linearGradient id=\"a997e203-1d7d-4cb9-b131-5dc44e029b46\" x1=\"5.23\" y1=\"17.45\" x2=\"5.23\" y2=\"8.09\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#1988d9\"/><stop offset=\"0.9\" stop-color=\"#54aef0\"/></linearGradient><linearGradient id=\"e122e9d8-aee5-4f1a-a60e-b1eae355daa5\" x1=\"11.5\" y1=\"12.45\" x2=\"11.5\" y2=\"0.55\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#198ab3\"/><stop offset=\"0.01\" stop-color=\"#198bb4\"/><stop offset=\"0.44\" stop-color=\"#27b2d7\"/><stop offset=\"0.79\" stop-color=\"#2fcbed\"/><stop offset=\"1\" stop-color=\"#32d4f5\"/></linearGradient></defs><title>Icon-manage-307</title><path d=\"M5.59,13.13H9.91v4.32H5.59ZM1.15,17.45H4.87V13.13H.55v3.72A.6.6,0,0,0,1.15,17.45Zm-.6-5H4.87V8.09H.55Z\" fill=\"url(#a997e203-1d7d-4cb9-b131-5dc44e029b46)\"/><path d=\"M11.5.55a5.89,5.89,0,0,1,5.95,6,5.89,5.89,0,0,1-5.95,5.95H5.55V6.5A5.89,5.89,0,0,1,11.5.55Z\" fill-rule=\"evenodd\" fill=\"url(#e122e9d8-aee5-4f1a-a60e-b1eae355daa5)\"/><rect x=\"7.59\" y=\"5.65\" width=\"1.36\" height=\"4.08\" fill=\"#fff\"/><rect x=\"10.31\" y=\"7.01\" width=\"1.36\" height=\"2.72\" fill=\"#fff\"/><rect x=\"13.03\" y=\"4.29\" width=\"1.36\" height=\"5.44\" fill=\"#fff\"/></svg> Log Analytics Troubleshooting\r\n- These queries are often empty, unless you have a problem."
            },
            "name": "text - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Operation | where OperationCategory == 'Data Collection Status'\r\n\r\n// https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage#troubleshooting-why-log-analytics-is-no-longer-collecting-data",
              "size": 4,
              "title": "Troubleshoot Workspace: Data Collection Issue",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              }
            ],
            "name": "query - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage | where IsBillable | summarize DataGB = sum(Quantity / 1000.) //| where DataGB > 50\r\n\r\n// https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage#create-an-alert-when-data-collection-is-high",
              "size": 4,
              "title": "Troubleshoot Workspace: Data sent today",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              }
            ],
            "name": "query - 10 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// This isn't a frequest operation, so you may have to go back a long way in the logs (if you have them)\r\nOperation\r\n| where  OperationCategory == \"Workspace Configuration\"\r\n| extend msg = split(Detail,\".\").[0], reason = split(Detail,\".\").[1]",
              "size": 4,
              "title": "Troubleshoot Workspace: Configuration changes",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              }
            ],
            "name": "query - 10 - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "//https://docs.microsoft.com/azure/azure-monitor/platform/monitor-workspace\r\n_LogOperation \r\n| summarize count() by Level",
              "size": 4,
              "title": "Troubleshoot Workspace: Ingestion Operations by type",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              }
            ],
            "name": "query - 10 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "//https://docs.microsoft.com/azure/azure-monitor/platform/monitor-workspace\r\n_LogOperation | where Category == \"Ingestion\" | where Operation == \"Ingestion rate\" | where Level == \"Warning\"",
              "size": 4,
              "title": "Troubleshoot Workspace: warning alert when the ingestion volume rate has reached 80% of the limit",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              }
            ],
            "name": "query - 10 - Copy - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "//https://docs.microsoft.com/azure/azure-monitor/platform/monitor-workspace\r\n_LogOperation | where Category == \"Ingestion\" | where Operation == \"Data Collection\" | where Level == \"Warning\"",
              "size": 4,
              "title": "Troubleshoot Workspace: warning alert when the data collection has reached the daily limit",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              }
            ],
            "name": "query - 10 - Copy - Copy - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "_LogOperation\r\n| where TimeGenerated > ago(30d)\r\n| where Level in ('Warning','Error')\r\n| summarize count() by Level, Detail, bin(TimeGenerated,1d)\r\n",
              "size": 0,
              "title": "Warning & Errors for the past 30days",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeBrushParameterName": "exportEW",
              "timeBrushExportOnlyWhenBrushed": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "barchart"
            },
            "name": "query - warn & errors"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "_LogOperation\r\n| where Level in ('Warning','Error')\r\n| summarize count() by Level, Detail, bin(TimeGenerated,1d)\r\n| order by count_ desc\r\n",
              "size": 0,
              "title": "Timebrush for: {exportEW:label}",
              "timeContextFromParameter": "exportEW",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Level",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Error",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Warning",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "exportEW",
              "comparison": "isNotEqualTo"
            },
            "name": "query - ew timebrush analysis"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Help",
          "comparison": "isEqualTo",
          "value": "Yes"
        },
        {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "WorkspaceInfo"
        }
      ],
      "name": "group - Troubleshoot",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "price setting",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "170a6d54-0503-41ac-b52b-b0e3db2f427d",
                  "version": "KqlParameterItem/1.0",
                  "name": "Price",
                  "label": "Price estimation",
                  "type": 1,
                  "description": "Enter your price (tip.  Use the Azure Pricing Calculator, enter  a value of 1GB and divide by 30days), or see Help toggle",
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "4.0"
                      }
                    }
                  ]
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 1 - Copy"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Cost"
      },
      "name": "group - Price"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Workspace info: {Workspace:name} ",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| summarize ['Table Size'] =sum(Quantity)/1000 by ['Table Name'] =DataType,['IsBillable'] =IsBillable\r\n| order by ['Table Size']  desc\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": " Status for {TimeRange:label}, Billable Tables have an  average use of: {GBperday} GB per day, Billable Tables have a Total size of {GBtotal} GB",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Table Name",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "green",
                          "text": "True"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed",
                      "customColumnWidthSetting": "300px"
                    },
                    "numberFormat": {
                      "unit": 39,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_bar_Table Size_2",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_bar_Table Size_2",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "selectDepthLevel",
              "comparison": "isEqualTo",
              "value": "Basic"
            },
            "name": "query -Usage Query Basic"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "//find where TimeGenerated {TimeRange:query} project _BilledSize, _IsBillable, Computer, DataType, TimeGenerated\r\nUsage\r\n| where StartTime {TimeRange:value}\r\n| make-series Trend=sum(Quantity)/1000 , count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} \r\n| extend (anomalies, score, baseline) = series_decompose_anomalies(Trend, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\r\n| project baseline, Trend //, count_\r\n",
              "size": 4,
              "title": "High level - Overview for {TimeRange:label}",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "baseline",
                    "formatter": 21,
                    "formatOptions": {
                      "palette": "purple"
                    }
                  },
                  {
                    "columnMatch": "Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "greenDarkDark"
                    }
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "anomalies",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "score",
                    "formatter": 5
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "baseline",
                    "label": "BilledSize Baseline"
                  },
                  {
                    "columnId": "Trend",
                    "label": "BilledSize"
                  }
                ]
              }
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "WorkspaceInfo"
            },
            "name": "query - 13",
            "styleSettings": {
              "maxWidth": "50"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "print strcat('{GBperday}',' GB'), display = \"average per day\", range = strcat('Ingestion For: ','{TimeRange:label}')",
              "size": 4,
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "print_0",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "subtitleContent": {
                  "columnMatch": "display"
                },
                "leftContent": {
                  "columnMatch": "range"
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "query - 12"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union withsource=TableName1 *\r\n| where TimeGenerated {TimeRange:query}\r\n| project _BilledSize, _IsBillable, TimeGenerated, TableName1\r\n| summarize Entries = count(), Size = sum(_BilledSize), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by TableName1, _IsBillable\r\n| project ['Table Name'] = TableName1, ['Table Size'] = Size, ['Table Entries'] = Entries,\r\n          ['Size per Entry'] = 1.0 * Size / Entries, ['IsBillable'] = _IsBillable, ['Latest Record Created'] =  last_log //, ['Latest Record Recieved'] =last_ingestion\r\n | order by ['Table Size']  desc\r\n\r\n ",
              "size": 0,
              "showAnalytics": true,
              "title": "{Workspace:name} Status for {TimeRange:label}, Billable Tables have an  average use of: {GBperday} GB per day, Billable Tables have a Total size of {GBtotal} GB",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Table Name",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 36,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Latest Record Created",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Time when record was created at data source"
                    }
                  },
                  {
                    "columnMatch": "Latest Record Recieved",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Time when Record stored in workspace and available for queries"
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_bar_Table Size_1",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_bar_Table Size_1",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "selectDepthLevel",
              "comparison": "isEqualTo",
              "value": "Advanced"
            },
            "name": "query - 2"
          },
          {
            "type": 1,
            "content": {
              "json": "### Columns explained\r\n- Table Name:The Log Analytics workspace Table\r\n- Table Size: The sum of data stored in the Table.   \r\n- Table Entries: The count of each row in the Table. \r\n- Size per Entry: Average capacity size of each row of data.\r\n- IsBillable: Shows if the Table is Billable or Free  (True/False).\r\n- Last Record Received: What was the time that the last record of data was received? \t \t ",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 8"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "find where TimeGenerated {TimeRange:query} project _BilledSize, _IsBillable, Computer, DataType, TimeGenerated\r\n| where '{Table}' == 'All Tables' or DataType == '{Table}'\r\n| make-series TableSize = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n//| mv-expand TableSize to typeof(real), TimeGenerated to typeof(datetime) limit 1000\r\n| project TimeGenerated, ['{Table}'] = TableSize",
              "size": 1,
              "showAnalytics": true,
              "title": "Table Entries, count over time: {TimeRange:label}",
              "color": "green",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Namespace",
              "exportParameterName": "Namespace",
              "exportDefaultValue": "All",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "areachart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green",
                      "showIcon": true
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue",
                      "showIcon": true
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue",
                      "showIcon": true
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "query - 6"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| make-series TableSize = sum(Quantity) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} \r\n//| mv-expand TableSize to typeof(real), TimeGenerated to typeof(datetime) limit 1000\r\n| project TimeGenerated, ['{Table}'] = TableSize",
              "size": 1,
              "showAnalytics": true,
              "title": "Table Size, sum over time of capacity: {TimeRange:label}",
              "color": "blue",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Namespace",
              "exportParameterName": "Namespace",
              "exportDefaultValue": "All",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "areachart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green",
                      "showIcon": true
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue",
                      "showIcon": true
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue",
                      "showIcon": true
                    }
                  }
                ],
                "filter": true
              },
              "chartSettings": {
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 2,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "query - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| summarize sum(Quantity) by bin(TimeGenerated, 1d), DataType\r\n\r\n\r\n\r\n",
              "size": 0,
              "showAnalytics": true,
              "title": "Weekly Average Table Usage ",
              "color": "blue",
              "timeContext": {
                "durationMs": 604800000
              },
              "exportFieldName": "Namespace",
              "exportParameterName": "Namespace",
              "exportDefaultValue": "All",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "barchart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Average Events per Second (eps)",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumSignificantDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Minimum eps",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Maximum eps",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumSignificantDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  }
                ],
                "filter": true
              },
              "sortBy": [],
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Other",
                    "color": "green"
                  }
                ]
              }
            },
            "customWidth": "100",
            "name": "query - 7 - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| summarize sum(Quantity) by bin(TimeGenerated, 1d), DataType\r\n\r\n\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Monthly Average Table Usage : Time Brush Enabled",
              "color": "blue",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeBrushParameterName": "tbMthlyUsage",
              "exportFieldName": "Namespace",
              "exportParameterName": "Namespace",
              "exportDefaultValue": "All",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "barchart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Average Events per Second (eps)",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumSignificantDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Minimum eps",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumSignificantDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Maximum eps",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumSignificantDigits": 3
                      }
                    }
                  },
                  {
                    "columnMatch": "Estimated Table Price",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Size Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  }
                ],
                "filter": true
              },
              "sortBy": [],
              "chartSettings": {
                "createOtherGroup": 30,
                "seriesLabelSettings": [
                  {
                    "seriesName": "Other",
                    "color": "green"
                  }
                ]
              }
            },
            "customWidth": "100",
            "name": "query - 7 - mthly table usage "
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union withsource=TableName1 *\r\n| summarize count() by TableName = TableName1, _ResourceId\r\n| order by count_ desc\r\n\r\n\r\n\r\n\r\n ",
              "size": 1,
              "showAnalytics": true,
              "title": "Details from Monthly Average Table Usage : Time brushed to: {tbMthlyUsage:label}",
              "color": "blue",
              "timeContextFromParameter": "tbMthlyUsage",
              "timeBrushParameterName": "tbMthlyUsage",
              "exportFieldName": "Namespace",
              "exportParameterName": "Namespace",
              "exportDefaultValue": "All",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    }
                  }
                ],
                "filter": true
              },
              "sortBy": [],
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Other",
                    "color": "green"
                  }
                ],
                "xSettings": {},
                "ySettings": {}
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "WorkspaceInfo"
            },
            "name": "query - 7 - mthly table usage  - Copy"
          },
          {
            "type": 1,
            "content": {
              "json": "Use the above four charts to check your Records, Size and Weekly/ Monthly averages.\r\nThe Weekly and Monthly charts are especially useful to see if one data type is growing or shrinking.",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "WorkspaceInfo"
              },
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 6"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "WorkspaceInfo"
      },
      "name": "group - workspaceInfo"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Basic Workspace Details",
        "expandable": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-08-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[]}}]}",
              "size": 0,
              "title": "Workspace Details",
              "queryType": 12,
              "sortBy": []
            },
            "customWidth": "50",
            "name": "query - 11 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/intelligencePacks\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-08-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"enabled\",\"columnid\":\"enabled\"},{\"path\":\"displayname\",\"columnid\":\"displayname\"}]}}]}",
              "size": 0,
              "title": "Intelligence Packs",
              "queryType": 12,
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "enabled",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "enabled",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "50",
            "name": "query - 11 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/usages\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-08-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[]}}]}",
              "size": 0,
              "title": "Workspace Usages",
              "queryType": 12,
              "sortBy": []
            },
            "customWidth": "50",
            "name": "query - 11 - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/availableServiceTiers\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-08-01\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "Workspace Service Tier",
              "queryType": 12,
              "sortBy": []
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "hide",
              "comparison": "isEqualTo",
              "value": "hide"
            },
            "name": "query - 11 - Copy - Copy - Copy - Copy"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "selectDepthLevel",
          "comparison": "isEqualTo",
          "value": "Basic"
        },
        {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "WorkspaceInfo"
        }
      ],
      "name": "group - Workspace Details"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Advanced Workspace details",
        "expandable": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "You need to enable this for Workspace Query auditing \r\nhttps://docs.microsoft.com/azure/azure-monitor/log-query/query-audit",
              "style": "warning"
            },
            "name": "text - 12"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "d23b4bfd-16c6-4aa1-a261-9d9e5a249ba9",
                  "version": "KqlParameterItem/1.0",
                  "name": "WorkspaceAudit",
                  "label": "Workspace to Audit",
                  "type": 5,
                  "description": "Audit any Workspace",
                  "isRequired": true,
                  "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| extend _selected = iif(id == '{Workspace}', true, false)\r\n| project id, val=id, _selected",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "customWidth": "50",
            "name": "parameters - 8"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| extend _found = iif (properties.displayName startswith \"Workspace audit\" , id ,tostring(False) )\r\n| where _found !=\"False\"\r\n| project Workbook =_found //, name = properties.displayName\r\n\r\n\r\n //| limit 1",
              "size": 4,
              "title": "Click to Open [Workspace Audit] Workbook if it exists?",
              "noDataMessage": "Info, no workbook was found, please enable [Workspace Audit] template, and save as \"Workspace audit\"",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Workbook",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "WorkbookTemplate",
                      "linkLabel": "Open dedicated Workbook for auditing",
                      "linkIsContextBlade": true
                    }
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "query - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// needs https://docs.microsoft.com/azure/azure-monitor/log-query/query-audit\r\nLAQueryLogs\r\n| extend code_ = case(ResponseCode == 200,\"200 OK\", ResponseCode == 400,\"400 Bad Request\",  ResponseCode == 401,\"401 Unauthorized\",ResponseCode == 503,\"503 Service Unavailable\",ResponseCode == 504,\"504 Gateway Timeout\",\r\n//else\r\nstrcat(\"Unknown or undefined code: \", ResponseCode))\r\n| summarize count() by ResponseCode, code_\r\n| order by count_ desc\r\n",
              "size": 1,
              "title": "LAQuery Diagnostics: count by Status",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "yAxis": [
                  "count_"
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// needs https://docs.microsoft.com/azure/azure-monitor/log-query/query-audit\r\nLAQueryLogs\r\n| summarize count() by RequestClientApp\r\n| order by count_ desc\r\n",
              "size": 1,
              "title": "LAQuery Diagnostics: count by product ",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "yAxis": [
                  "count_"
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 10 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// needs https://docs.microsoft.com/azure/azure-monitor/log-query/query-audit\r\nLAQueryLogs\r\n| summarize dcount(QueryText) by AADEmail\r\n| where isnotempty(AADEmail)\r\n| order by dcount_QueryText desc\r\n",
              "size": 1,
              "title": "LAQuery Diagnostics: count by User",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "yAxis": [
                  "dcount_QueryText"
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 10 - Copy - Copy"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "parameters": [
                {
                  "id": "d1f27b79-2133-475a-88de-37bcda5be757",
                  "version": "KqlParameterItem/1.0",
                  "name": "filterProduct",
                  "label": "Filter by product, order by highest count ",
                  "type": 10,
                  "isRequired": true,
                  "query": "LAQueryLogs\r\n| where isnotempty(RequestClientApp)\r\n| summarize count() by RequestClientApp\r\n| order by count_ desc\r\n| extend label = strcat(RequestClientApp,\" (\",count_,\")\")\r\n//| extend a = pack_array(label, \"Show All\")\r\n| project RequestClientApp, label",
                  "crossComponentResources": [
                    "{WorkspaceAudit}"
                  ],
                  "value": "ChangeTracking",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 14"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| where RequestClientApp ==\"{filterProduct}\" \r\n| extend code_ = case(ResponseCode == 200,\"200 OK\", ResponseCode == 400,\"400 Bad Request\",  ResponseCode == 401,\"401 Unauthorized\",ResponseCode == 503,\"503 Service Unavailable\",ResponseCode == 504,\"504 Gateway Timeout\",\r\n//else\r\nstrcat(\"Unknown or undefined code: \", ResponseCode))\r\n| project TimeGenerated, AADEmail, ResponseCode = code_, RequestClientApp, ResponseRowCount, ResponseDurationMs, StatsCPUTimeMs, StatsDataProcessedKB, StatsDataProcessedStart, StatsDataProcessedEnd, QueryText, AADClientId\r\n| order by TimeGenerated desc",
              "size": 1,
              "title": "LAQuery Diagnostics: Statistics for: {filterProduct:label}",
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResponseCode",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "startsWith",
                          "thresholdValue": "400",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "startsWith",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ResponseRowCount",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "ResponseDurationMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "StatsCPUTimeMs",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "StatsDataProcessedKB",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_heatmap_ResponseRowCount_4",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_heatmap_ResponseRowCount_4",
                  "sortOrder": 2
                }
              ]
            },
            "name": "query - 11"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "parameters": [
                {
                  "id": "807f8cec-8875-4156-91e6-2506b97e174d",
                  "version": "KqlParameterItem/1.0",
                  "name": "filterAADuser",
                  "label": "Show Queries by User",
                  "type": 2,
                  "query": "LAQueryLogs\r\n| summarize by  AADEmail\r\n| order by AADEmail asc",
                  "crossComponentResources": [
                    "{WorkspaceAudit}"
                  ],
                  "value": null,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 18"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "LAQueryLogs\r\n| where AADEmail == '{filterAADuser}'\r\n| project TimeGenerated, AADEmail, QueryText, ResponseDurationMs, StatsCPUTimeMs, StatsDataProcessedKB\r\n| order by TimeGenerated desc",
              "size": 1,
              "title": "LAQuery Diagnostics: Statistics for: {filterAADuser:label}",
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{WorkspaceAudit}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AADEmail",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "QueryText",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "ResponseDurationMs",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "StatsCPUTimeMs",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "StatsDataProcessedKB",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  }
                ],
                "filter": true
              },
              "sortBy": []
            },
            "name": "query - 11 - Copy"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "selectDepthLevel",
          "comparison": "isEqualTo",
          "value": "Advanced"
        },
        {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "WorkspaceInfo"
        }
      ],
      "name": "group - wsAdvanced"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Microsoft Sentinel",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n// Just show Workspaces - will use this to see Creation diff between Workspace and when Sentinel is added \r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| project Workspace=id, WorkspaceName=name, properties.sku.name, properties.sku.capacityReservationLevel, W_CreatedDate=properties.createdDate, W_modifedDate=properties.modifiedDate, properties.sku.lastSkuUpdate",
              "size": 4,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Days Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "<=",
                          "thresholdValue": "30",
                          "representation": "yellow",
                          "text": "Free {1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "green",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "Hide",
              "comparison": "isEqualTo",
              "value": "Hide"
            },
            "name": "query - ARG All workspaces"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n// Just show Workspaces that have Sentinel enabled\r\n| where type == \"microsoft.operationsmanagement/solutions\"\r\n| where name has \"SecurityInsights\"\r\n| parse name with * '(' s_workspace ')'*\r\n| project s_workspace, name, properties.creationTime, properties.lastModifiedTime , ['Days Enabled'] = datetime_diff('day',now(),todatetime(properties.creationTime)), ['SKU']=properties.sku.name, CapacityReservation=properties.sku.capacityReservationLevel",
              "size": 4,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Days Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "<=",
                          "thresholdValue": "30",
                          "representation": "yellow",
                          "text": "Free {1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "green",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "s_workspace",
                    "label": "Workspace Name"
                  },
                  {
                    "columnId": "name",
                    "label": "Solution Name",
                    "comment": "Sentinel is present"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "Hide",
              "comparison": "isEqualTo",
              "value": "Hide"
            },
            "name": "query - ARG Sentinel workspaces"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"14b104f4-4935-413b-943d-166bee783118\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - ARG All workspaces\",\"rightTable\":\"query - ARG Sentinel workspaces\",\"leftColumn\":\"WorkspaceName\",\"rightColumn\":\"s_workspace\"}],\"projectRename\":[{\"originalName\":\"[query - ARG All workspaces].Workspace\",\"mergedName\":\"Workspace\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG All workspaces].WorkspaceName\",\"mergedName\":\"WorkspaceName\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG All workspaces].W_CreatedDate\",\"mergedName\":\"W_CreatedDate\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG All workspaces].W_modifedDate\",\"mergedName\":\"W_modifedDate\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG Sentinel workspaces].s_workspace\",\"mergedName\":\"Workspace Name\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG Sentinel workspaces].name\",\"mergedName\":\"Solution Name\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG Sentinel workspaces].properties_creationTime\",\"mergedName\":\"FirstCreated\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG Sentinel workspaces].properties_lastModifiedTime\",\"mergedName\":\"LastModified\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG Sentinel workspaces].Days Enabled\",\"mergedName\":\"Days Enabled\",\"fromId\":\"14b104f4-4935-413b-943d-166bee783118\"},{\"originalName\":\"[query - ARG All workspaces].properties_sku_name\",\"mergedName\":\"properties_sku_name\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG All workspaces].properties_sku_lastSkuUpdate\",\"mergedName\":\"properties_sku_lastSkuUpdate\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].type\",\"mergedName\":\"type\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].tenantId\",\"mergedName\":\"tenantId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].kind\",\"mergedName\":\"kind\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].location\",\"mergedName\":\"location\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].managedBy\",\"mergedName\":\"managedBy\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].sku\",\"mergedName\":\"sku\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].plan\",\"mergedName\":\"plan\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].properties\",\"mergedName\":\"properties\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].tags\",\"mergedName\":\"tags\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].identity\",\"mergedName\":\"identity\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].zones\",\"mergedName\":\"zones\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].extendedLocation\",\"mergedName\":\"extendedLocation\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].Sentinel SKU\",\"mergedName\":\"Sentinel SKU\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].SKU\",\"mergedName\":\"SKU\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG All workspaces].properties_sku_capacityReservationLevel\",\"mergedName\":\"properties_sku_capacityReservationLevel\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].properties_sku_capacityReservationLevel\",\"mergedName\":\"properties_sku_capacityReservationLevel\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - Sentinel workspaces].CapacityReservation\",\"mergedName\":\"CapacityReservation\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].SKU\",\"mergedName\":\"SKU\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - ARG Sentinel workspaces].CapacityReservation\",\"mergedName\":\"CapacityReservation\",\"fromId\":\"unknown\"}]}",
              "size": 4,
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "WorkspaceName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Workspace Name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Solution Name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Days Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "<=",
                          "thresholdValue": "30",
                          "representation": "yellow",
                          "text": "{0} (Free Trial)"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "green",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Workspace",
                    "label": "Log Analytics Workspace Name"
                  },
                  {
                    "columnId": "W_CreatedDate",
                    "label": "Workspace Created"
                  },
                  {
                    "columnId": "W_modifedDate",
                    "label": "Workspace Modified"
                  },
                  {
                    "columnId": "properties_sku_name",
                    "label": "Workspace SKU name",
                    "comment": "Log Analyitcs licence SKU"
                  },
                  {
                    "columnId": "properties_sku_lastSkuUpdate",
                    "label": "Workspace SKU Last Update"
                  },
                  {
                    "columnId": "SKU",
                    "label": "Sentinel SKU name",
                    "comment": "Sentinel setting"
                  }
                ]
              }
            },
            "showPin": false,
            "name": "query - 7"
          },
          {
            "type": 1,
            "content": {
              "json": "If an Sentinel Workspace has been enabled for less than 30days is likely to be in the Free Trial period.  The report above shows when a Workspace was first created and when Sentinel was associated with it.\r\nAlso on this Page\r\n- Top 10 Operations actions from the AzureActicity log for Sentinel.  \r\n- Select a Table (only Sentinel ones are listed) to see more details. ",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "Sentinel"
              },
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 4"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "b796ccd5-7050-4ade-af82-64d3501dfee7",
                  "cellValue": "selectedSentinelTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Anomaly",
                  "subTarget": "anomaly",
                  "preText": "Anomaly",
                  "style": "link"
                },
                {
                  "id": "dab8b902-109a-446d-85b0-404678b5da60",
                  "cellValue": "selectedSentinelTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Activity",
                  "subTarget": "activity",
                  "style": "link"
                },
                {
                  "id": "eaf79655-0ce3-426b-bbea-00f4da3f74e9",
                  "cellValue": "selectedSentinelTab",
                  "linkTarget": "parameter",
                  "linkLabel": "WatchList",
                  "subTarget": "watchlist",
                  "style": "link"
                },
                {
                  "id": "ca8ed1db-d2c0-452e-ae1e-70c0372b373f",
                  "cellValue": "selectedSentinelTab",
                  "linkTarget": "parameter",
                  "linkLabel": "TI",
                  "subTarget": "ti",
                  "style": "link"
                },
                {
                  "id": "45af9060-02a2-4214-8e8d-06d633227f73",
                  "cellValue": "selectedSentinelTab",
                  "linkTarget": "parameter",
                  "linkLabel": "SolutionAndTables",
                  "subTarget": "solution",
                  "style": "link"
                },
                {
                  "id": "e99f0885-1285-40ab-b032-73462e5b99fc",
                  "cellValue": "selectedSentinelTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Repositories",
                  "subTarget": "repo",
                  "style": "link"
                }
              ]
            },
            "name": "links - 21"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "7c1f108f-d8ec-4cb8-a33f-12c942a444fe",
                        "version": "KqlParameterItem/1.0",
                        "name": "SelectPct",
                        "label": "Anomaly spikes %",
                        "type": 10,
                        "description": "anomaly spikes greater than this %",
                        "isRequired": true,
                        "query": "range value from 10 to 100 step 10\r\n| project value, display=value, selected=value",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "value": "70",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "30",
                  "name": "parameters - 18"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//source: https://techcommunity.microsoft.com/t5/azure-sentinel/ingestion-cost-spike-detection-playbook/ba-p/2591301\r\nlet UpperAnomalyThreshold = +3;\r\nlet ReportingQty = 0;\r\nlet PercentIncrease = {SelectPct};\r\nlet UpperThreshold = UpperAnomalyThreshold; //+3 is the suggested number and it indicates a strong anomaly though you can modify it : Outlier - Wikipedia\r\nUsage\r\n| where IsBillable == \"true\" //we are only interested in tables getting notified when a spike is detected in a billable table \r\n| where Quantity > ReportingQty //Allows you to report only on variations that are above a certain threshold that you deem significant enough to warrant an alert\r\n| make-series Qty=sum(Quantity) on TimeGenerated from {TimeRange:start} to now() step 1d by DataType //creates a time series to look at the ingestion pattern over the period defined in the LookBack variable\r\n| extend (anomalies, score, baseline) = series_decompose_anomalies(Qty, 1.5, 7, 'linefit', 1, 'ctukey', 0.01) //takes the time series of ingested data across the days specified in the â€˜LookBackâ€™ variable and extract anomalous points with scores based on predicted values using the linear regression concept. See https://docs.microsoft.com/azure/data-explorer/kusto/query/series-decompose-anomaliesfunction for a detailed explanation of each argument. For an explanation of 'ctukey' read: Outlier - Wikipedia.\r\n| where anomalies[-1] == 1 or anomalies[-1] == -1 //the output of series_decompose_anomalies function is three things: A ternary (as opposed to binary) series containing (+1, -1, 0) marking up/down/no anomaly respectively, the Anomaly score and the predicted value or baseline. \r\n| extend Score = score[-1] //this part picks up the anomaly state from the most recent run. -1 indicates a position in the array. \r\n| where Score >= UpperAnomalyThreshold  //compare with strong anomaly indicator values extracted from the time series data\r\n| extend PercentageQtyIncrease = ((round(todouble(Qty[-1]),0)-round(todouble(baseline[-1]),1))/round(todouble(Qty[-1]),0) * 100) //calculates percentage increase to present data in percent terms for easier appreciation of the anomaly\r\n| project DataType,ExpectedQty=round(todouble(baseline[-1]),0), ActualQty=round(todouble(Qty[-1]),0),round(PercentageQtyIncrease,0)  \r\n| order by  round(todouble(PercentageQtyIncrease),0) desc \r\n| where PercentageQtyIncrease >= PercentIncrease //only alert if the percentage increase exceeds the threshold beyond which you specified that you wish to be notified",
                    "size": 4,
                    "title": "Ingestion Spikes - anomaly detection > {SelectPct}% increase",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "PercentageQtyIncrease",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "70",
                  "name": "query - 17"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| make-series count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DataType\r\n| extend lastDay = toreal(trim(@\"[^\\w]+\",tostring(array_slice(count_,-1,-1)))), lastWeek = array_slice(count_,array_length(count_) -7,-1)\r\n| order by DataType asc",
                    "size": 1,
                    "title": "Data Ingestion trend: {TimeRange:label} for {$rowCount} Tables",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "red"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "lastDay",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "10",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "lastWeek",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "blueDark"
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 3
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Count per hour",
                          "comment": "Data received by Hour"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "name": "query - 15"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedSentinelTab",
              "comparison": "isEqualTo",
              "value": "anomaly"
            },
            "name": "group - anomaly"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity \r\n| where ResourceProvider == \"Microsoft.SecurityInsights\" \r\n| where OperationName !in (\"Microsoft.SecurityInsights/Incidents/investigations/write\", \"Microsoft.SecurityInsights/dataConnectorsCheckRequirements/action\" )\r\n| summarize count() by OperationName\r\n| top 10 by count_ desc \r\n",
                    "size": 1,
                    "title": "Sentinel ActivityLog Information - Top 10",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "filter": true
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "OperationName",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Sentinel"
                  },
                  "name": "query - 22"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity \r\n| where ResourceProviderValue == \"Microsoft.SecurityInsights\" \r\n//| where OperationName !in (\"Microsoft.SecurityInsights/Incidents/investigations/write\", \"Microsoft.SecurityInsights/dataConnectorsCheckRequirements/action\" )\r\n| summarize count() by OperationName, TimeGenerated\r\n| top 10 by count_ desc \r\n| make-series count() on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}  by OperationName\r\n",
                    "size": 1,
                    "title": "Sentinel ActivityLog Information - Top n trending, {TimeRange:label} ",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 9,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Daily Count",
                          "comment": "Trend for selected period"
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "OperationName",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Sentinel"
                  },
                  "name": "query - 22 - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedSentinelTab",
              "comparison": "isEqualTo",
              "value": "activity"
            },
            "name": "group -activity"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "_GetWatchlistAlias\r\n| order by WatchlistAlias asc",
                    "size": 0,
                    "title": "Watchlists, click for details. Count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "WatchlistAlias",
                    "exportParameterName": "exportWatchlistAlias",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "WatchlistAlias",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "WatchlistAlias",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "query - 10"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "_GetWatchlist('{exportWatchlistAlias}')",
                    "size": 4,
                    "title": "Watchlists details for: '{exportWatchlistAlias}'",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "WatchlistAlias",
                    "exportParameterName": "exportWatchlistAlias",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "exportWatchlistAlias",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - wlist"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedSentinelTab",
              "comparison": "isEqualTo",
              "value": "watchlist"
            },
            "name": "group - watchlist"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ThreatIntelligenceIndicator\r\n| extend IndicatorType = iif(isnotempty(EmailSourceIpAddress) or isnotempty(NetworkDestinationIP) or isnotempty(NetworkIP) or isnotempty(NetworkSourceIP) or isnotempty(NetworkCidrBlock), \"IP\",\r\n                        iff(isnotempty(Url), \"URL\",\r\n                        iff(isnotempty(EmailRecipient) or isnotempty(EmailSenderAddress), \"Email\",\r\n                        iff(isnotempty(FileHashValue), \"File\",\r\n                         iff(isnotempty(DomainName) or isnotempty(EmailSourceDomain), \"Domain\",\r\n                        \"Other\")))))\r\n| summarize CountOfIndicators = count() by IndicatorType, bin(TimeGenerated, {TimeRange:grain})\r\n| order by CountOfIndicators desc ",
                    "size": 1,
                    "title": "Threat Intelligence, Indicator Type {TimeRange:label}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "areachart"
                  },
                  "name": "query - 13"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ThreatIntelligenceIndicator\r\n| extend IndicatorType = iif(isnotempty(EmailSourceIpAddress) or isnotempty(NetworkDestinationIP) or isnotempty(NetworkIP) or isnotempty(NetworkSourceIP) or isnotempty(NetworkCidrBlock), \"IP\",\r\n                        iff(isnotempty(Url), \"URL\",\r\n                        iff(isnotempty(EmailRecipient) or isnotempty(EmailSenderAddress), \"Email\",\r\n                        iff(isnotempty(FileHashValue), \"File\",\r\n                         iff(isnotempty(DomainName) or isnotempty(EmailSourceDomain), \"Domain\",\r\n                        \"Other\")))))\r\n| summarize CountOfIndicators = count() by ThreatType , bin(TimeGenerated, {TimeRange:grain})\r\n| order by CountOfIndicators desc ",
                    "size": 1,
                    "title": "Threat Intelligence, Threat Type {TimeRange:label}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "areachart"
                  },
                  "name": "query - 13 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/resourceGroups/{resourceGroup:name}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/threatIntelligence/main/metrics?api-version=2021-10-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$..value\",\"columns\":[]}}]}",
                    "size": 1,
                    "title": "Threat Intelligence Indicator Metrics",
                    "queryType": 12
                  },
                  "name": "query - ti metrics"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/resourceGroups/{resourceGroup:name}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/threatIntelligence/main/indicators?api-version=2021-10-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[]}}]}",
                    "size": 1,
                    "title": "Threat Intelligence Indicators, count: {$rowCount}",
                    "showExportToExcel": true,
                    "queryType": 12,
                    "gridSettings": {
                      "rowLimit": 1000,
                      "filter": true
                    }
                  },
                  "name": "query -Threat Intelligence Indicators"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedSentinelTab",
              "comparison": "isEqualTo",
              "value": "ti"
            },
            "name": "group - TI"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/metadata\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2017-10-01\"},{\"key\":\"$orderby\",\"value\":\"name\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.tableGroups\",\"columns\":[]}}]}",
                    "size": 1,
                    "title": "Solutions and Table selector",
                    "exportedParameters": [
                      {
                        "fieldName": "name",
                        "parameterName": "exportDisplayName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "tables",
                        "parameterName": "exportTables",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 12,
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "source",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "tables",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "name"
                        ]
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "displayName",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "subtitleContent": {
                        "columnMatch": "name"
                      },
                      "showBorder": false,
                      "sortCriteriaField": "displayName",
                      "sortOrderField": 1,
                      "size": "auto"
                    }
                  },
                  "name": "query - 13"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| mv-expand tn = todynamic('{exportTables}')\r\n| extend TableName = split(tn,\"/\")[1]\r\n| summarize by tostring(TableName)\r\n| join \r\n(\r\nUsage\r\n| summarize GB=sum(Quantity) by DataType\r\n) on $left.TableName == $right.DataType\r\n| summarize sum(GB)",
                    "size": 0,
                    "title": "Cost by Solution: {exportDisplayName}",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "TableName",
                    "exportParameterName": "exportTableName",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "sum_GB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "query - 14 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n//| where  '{exportDisplayName}' startswith 'Sec'\r\n| project '{exportTables}' \r\n|limit 1\r\n| mv-expand tn = todynamic('{exportTables}')\r\n| extend TableName = split(tn,\"/\")[1]\r\n| order by tostring(TableName) asc\r\n| project TableName\r\n",
                    "size": 0,
                    "title": "Select a Table from: {exportDisplayName}",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "exportFieldName": "TableName",
                    "exportParameterName": "exportTableName",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "TableName",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TableName",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "33",
                  "name": "query - 14"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where '{exportTableName}' == DataType\r\n| summarize [\"last log received\"] = datetime_diff(\"second\",now(), max(TimeGenerated)), \r\n            BillableGB = sumif(Quantity,IsBillable==true)/1000, FreeGB = sumif(Quantity,IsBillable==false)/1000 by DataType, IsBillable\r\n| order by [\"last log received\"] desc",
                    "size": 1,
                    "title": "Table selected: {exportTableName}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "last log received",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "BillableGB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "FreeGB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "66",
                  "name": "query - 15"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/dataConnectors\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-01-01\"},{\"key\":\"$orderby\",\"value\":\"kind asc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"ConnectorName\"},{\"path\":\"properties.dataTypes[*].state\",\"columnid\":\"state\"},{\"path\":\"properties.dataTypes\",\"columnid\":\"Info\"}]}}]}",
                    "size": 1,
                    "title": "Enabled Microsoft connectors",
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "state",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "enabled",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "ConnectorName",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "ConnectorName",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - 11"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedSentinelTab",
              "comparison": "isEqualTo",
              "value": "solution"
            },
            "name": "group -solutions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/resourceGroups/{resourceGroup:name}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/sourcecontrols?api-version=2021-10-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$..value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.repoType\",\"columnid\":\"repoType\"},{\"path\":\"properties.repository.url\",\"columnid\":\"url\"},{\"path\":\"properties.contentTypes\",\"columnid\":\"contentTypes\"},{\"path\":\"type\",\"columnid\":\"type\"},{\"path\":\"id\",\"columnid\":\"id\"},{\"path\":\"systemData\",\"columnid\":\"systemData\"},{\"path\":\"properties\",\"columnid\":\"properties\"}]}}]}",
              "size": 0,
              "title": "Source Control / Repo, count: {$rowCount}",
              "queryType": 12
            },
            "conditionalVisibility": {
              "parameterName": "selectedSentinelTab",
              "comparison": "isEqualTo",
              "value": "repo"
            },
            "name": "query - Source Controls"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Sentinel"
      },
      "name": "group - Sentinel"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Latency",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### End to End Latency Report by Table"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "text - 9"
          },
          {
            "type": 1,
            "content": {
              "json": "In this report we measure the latency of a specific Table by comparing the result of the ingestion_time() function to the TimeGenerated property.  \r\n<br />\r\n\r\nSource: https://docs.microsoft.com/azure/azure-monitor/platform/data-ingestion-time",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "Latency"
              },
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "//\r\n// Add enrichment information about selected Tables\r\n//\r\nlet enrich = datatable (TableName:string,Information:string,link:string)\r\n    [\r\n    \"Usage\",\"This is common Usage data in all Workspaces\",\"https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage\",\r\n    \"Operation\",\"This is common Operations data in all Workspaces\",\"\",\r\n    \"OfficeActivity\",\"This is a PUSH data source, typically <30mins (max ~1day)\",\"https://docs.microsoft.com/office/office-365-management-api/troubleshooting-the-office-365-management-activity-api#what-is-the-maximum-time-i-will-have-to-wait-before-a-notification-is-sent-about-a-given-office-365-event\",\r\n    \"Perf\",\"Operational Data source, this can have limited value to Sentinel\",\"https://docs.microsoft.com/azure/azure-monitor/platform/agent-data-sources\",\r\n    \"Event\",\"Windows Server Event Logs\",\"https://docs.microsoft.com/azure/azure-monitor/platform/agent-data-sources\",\r\n    \"Syslog\", \"Syslog messages using Common Event Format (CEF) streamed from variety of security solutions.Learn more\",\"https://docs.microsoft.com/azure/sentinel/connect-data-sources\",\r\n    \"SecurityAlert\",\"Security Alerts from various sources\",\"https://docs.microsoft.com/azure/sentinel/connect-data-sources\",\r\n    \"Alert\",\"Alerts from Azure Monitor sources\",\"\",\r\n    \"AWSCloudTrail\",\"Sentinel: AWS Cloud trail connector\",\"\",\r\n    \"Anomalies\",\"Sentinel: This table contains anomalies generated by the active Anomaly analytics rules in Sentinel.\",\"\",\r\n    \"AADNonInteractiveUserSignInLogs\",\"Non-interactive Azure Active Directory sign-in logs from user\",\"\",\r\n      \"SecurityEvent\",\"Data from Defender for Cloud  or Sentinel\",\"https://docs.microsoft.com/azure/sentinel/connect-data-sources\",\r\n    \"CommonSecurityLog\",\"CEF data for Sentinel, from multiple vendors\",\"https://docs.microsoft.com/azure/sentinel/connect-data-sources\",\r\n    \"SecurityIncident\",\"Incident events from Sentinel, also see SecurityAlert\",\"\",\r\n    \"Heartbeat\", \"MMA info from Log Analytics agents\",\"\",\r\n    \"LAQueryLogs\",\"Auditing of the workspace has been set\",\"https://docs.microsoft.com/azure/azure-monitor/log-query/query-audit\",\r\n    \"VMConnection\",\"Azure Monitor for VMs or Service Map\",\"https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmconnection\",\r\n    \"KubeServices\",\"AKS data sources\",\"\",\r\n    \"Update\",\"Patching info\",\"\",    \r\n    \"ThreatIntelligenceIndicator\",\"Sentinel TI data\",\"\", \r\n    \"AuditLogs\",\"Azure AAD audit information\",\"\", \r\n    \"SigninLogs\",\"Azure AAD Signin information\",\"\", \r\n    \"AzureActivity\",\"Azure Activity Logs\",\"\",\r\n    \"HuntingBookmark\",\"Sentinel - Hunting book mark data\",\"\",  \r\n    \"UserPeerAnalytics\",\"Sentinel - UEBA\",\"\",  \r\n    \"UserAccessAnalytics\",\"Sentinel - UEBA\",\"\",  \r\n    \"IdentityInfo\",\"Sentinel - UEBA\",\"\",  \r\n    \"BehaviorAnalytics\",\"Sentinel - UEBA\",\"\", \r\n    \"DeviceEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Multiple event types, including events triggered by security controls such as Windows Defender Antivirus and exploit protection.\",\"\",\r\n    \"DeviceFileEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains File creation, modification, and other file system events.\",\"\",  \r\n    \"DeviceImageLoadEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains DLL loading events\",\"\",  \r\n    \"DeviceInfo\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Machine information, including OS information.\",\"\",  \r\n    \"DeviceLogonEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Sign-ins and other authentication events\",\"\",  \r\n    \"DeviceNetworkEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Network connection and related events.\",\"\",  \r\n    \"DeviceNetworkInfo\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Network properties of machines, including adapters, IP and MAC addresses, as well as connected networks and domains.\",\"\", \r\n    \"DeviceProcessEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Process creation and related events.\",\"\", \r\n    \"DeviceRegistryEvents\",\"Sentinel: This table is part of Microsoft Defender for Endpoints with Sentinel. This table contains Creation and modification of registry entries.\",\"\",             \r\n    \"DnsInventory\",\"DNS Analytics (Preview)\",\"\",     \r\n    \"W3CIISLog\",\"IIS log data from Azure Monitor Logs\",\"\"\r\n    ]\r\n; \r\n// Gather and calculate Latency information\r\nunion withsource = TableName1 *\r\n| summarize \r\n      ['average E2E IngestionLatency'] = round(avg(todouble(datetime_diff(\"Second\",ingestion_time(),TimeGenerated)) ),2)\r\n    , ['minimun E2E IngestionLatency'] = round(min(todouble(datetime_diff(\"Second\",ingestion_time(),TimeGenerated)) ),2) \r\n    , ['maximum E2E IngestionLatency'] = round(max(todouble(datetime_diff(\"Second\",ingestion_time(),TimeGenerated)) ),2)\r\n  by TableName = TableName1\r\n| sort by ['average E2E IngestionLatency'] desc\r\n// join to enrichment and remove unwanted columns \r\n| join kind= fullouter (enrich) on TableName\r\n| where isnotempty(TableName)\r\n| project-away TableName1\r\n",
              "size": 0,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "average E2E IngestionLatency",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "average E2E IngestionLatency",
                            "color": "blue"
                          },
                          {
                            "columnName": "minimun E2E IngestionLatency",
                            "color": "green"
                          },
                          {
                            "columnName": "maximum E2E IngestionLatency",
                            "color": "redBright"
                          }
                        ]
                      }
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "minimun E2E IngestionLatency",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "maximum E2E IngestionLatency",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "TotalGBytes",
                    "formatter": 3,
                    "formatOptions": {
                      "aggregation": "Count"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_bar_maximum E2E IngestionLatency_3",
                    "sortOrder": 2
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "average E2E IngestionLatency",
                    "label": "avg E2E Ingestion Latency"
                  },
                  {
                    "columnId": "minimun E2E IngestionLatency",
                    "label": "min E2E Ingestion Latency"
                  },
                  {
                    "columnId": "maximum E2E IngestionLatency",
                    "label": "max E2E Ingestion Latenc"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_bar_maximum E2E IngestionLatency_3",
                  "sortOrder": 2
                }
              ],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "SolutionName",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "TotalGBytes",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "SolutionName",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "TotalGBytes",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "query - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "## Computer Heartbeat and Latency : {TimeRange}"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "text - 11"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "759ca753-ed9f-4ca0-8bf1-d929d77e8128",
                  "version": "KqlParameterItem/1.0",
                  "name": "ComputerName",
                  "type": 5,
                  "isRequired": true,
                  "query": "resources\r\n| where type == \"microsoft.compute/virtualmachines\" or type == \"microsoft.hybridcompute/machines\"\r\n| project name",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "value": "QC-DNS",
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "e0fb3c9a-f42f-4dfb-a86c-f4dd36584904",
                  "version": "KqlParameterItem/1.0",
                  "name": "UnhealthyCriteria",
                  "label": "Unhealthy Criteria",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "jsonData": "[\r\n    { \"value\":\"1m\", \"label\":\"1 minute without heartbeat\", \"selected\":false },\r\n    { \"value\":\"5m\", \"label\":\"5 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"30m\", \"label\":\"30 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1h\", \"label\":\"1 hour without heartbeat\", \"selected\":true },\r\n    { \"value\":\"2h\", \"label\":\"2 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"8h\", \"label\":\"8 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1d\", \"label\":\"1 day without heartbeat\", \"selected\":false },\r\n    { \"value\":\"2d\", \"label\":\"2 days without heartbeat\", \"selected\":false },\r\n    { \"value\":\"7d\", \"label\":\"7 days without heartbeat\", \"selected\":false }\r\n]",
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "parameters - 13"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Heartbeat  \r\n| where Computer startswith \"{ComputerName}\"\r\n| summarize HeartBeatperHour = count() by bin(TimeGenerated,1h) ",
              "size": 0,
              "title": "HeartBeat",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "showLegend": true
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "query - 13"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Heartbeat  \r\n| where Computer startswith \"{ComputerName}\"\r\n| extend E2EIngestionLatency = todouble(datetime_diff(\"Second\",ingestion_time(),TimeGenerated)) \r\n| extend AgentLatency        = todouble(datetime_diff(\"Second\",_TimeReceived,TimeGenerated)) \r\n| summarize avg(E2EIngestionLatency),avg(AgentLatency) by bin(TimeGenerated,1h) \r\n| project TimeGenerated, avgE2Elatency = avg_E2EIngestionLatency, avgAgentLatency = avg_AgentLatency\r\n",
              "size": 0,
              "title": "Latency",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "avgE2E",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  }
                ]
              },
              "tileSettings": {
                "showBorder": false
              },
              "chartSettings": {
                "showLegend": true,
                "ySettings": {
                  "unit": 24,
                  "min": null,
                  "max": null
                }
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "query - 14"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Heartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\r\n| extend State = iff(LastHeartbeat < ago({UnhealthyCriteria}), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1s), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| extend Packed = pack_all()\r\n) on Computer\r\n| where TimeGenerated == LastHeartbeat\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| make-series InternalTrend=iff(count() > 0, 1, 0) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {UnhealthyCriteria} by Computer\r\n| extend Trend=array_slice(InternalTrend, array_length(InternalTrend) - 30, array_length(InternalTrend)-1)\r\n| extend (s_min, s_minId, s_max, s_maxId, s_avg, s_var, s_stdev) = series_stats(Trend)\r\n| project Computer, Trend, s_avg\r\n) on Computer\r\n| order by State, s_avg asc, TimeAgo\r\n| project [\"_ComputerName_\"] = Computer, [\"Computer\"]=Computer, State, [\"Environment\"] = iff(ComputerEnvironment == \"Azure\", ComputerEnvironment, Category), [\"OS\"]=iff(isempty(OSName), OSType, OSName), [\"Azure Resource\"]=ResourceId, [\"Time\"]=strcat('ðŸ•’ ', TimeAgo), [\"Heartbeat Trend\"]=Trend, [\"Details\"]=Packed",
              "size": 0,
              "title": "All Agent Heartbeat info : {TimeRange:label}",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Computer",
              "exportParameterName": "exportComputer",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "_ComputerName_",
                    "formatter": 5,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Computer",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 18,
                    "formatOptions": {
                      "showIcon": true,
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Healthy",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unhealthy",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Environment",
                    "formatter": 18,
                    "formatOptions": {
                      "showIcon": true,
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Azure",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Direct Agent",
                          "representation": "magenta",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "SCOM Agent",
                          "representation": "purple",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "SCOM Management Server",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Heartbeat Trend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "redGreen",
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 5,
                    "formatOptions": {
                      "showIcon": true
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_number_Computer_1",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_number_Computer_1",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "query - 16"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type =~ \"microsoft.compute/virtualmachines\"\r\n| where name =~ '{exportComputer}'\r\n| extend status = tostring(properties.extended.instanceView.powerState.displayStatus)\r\n| summarize  by status, id, name\r\n",
              "size": 4,
              "title": "Azure PowerState: {exportComputer} ",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "name": "query - 9"
          },
          {
            "type": 1,
            "content": {
              "json": "Measures the HeartBeat of a specific Computer, and then shows latency by comparing the result of the ingestion_time() function to the TimeGenerated property",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Latency"
            },
            "name": "text - 15"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Latency"
      },
      "name": "group - latency"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Cost",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "b2d72148-33fb-4afc-9860-476d2afb7b7f",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Overview",
                  "subTarget": "overview",
                  "style": "link"
                },
                {
                  "id": "bb092bc8-2753-40d1-9044-507915dcbbe8",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Table Analysis ",
                  "subTarget": "table",
                  "style": "link"
                },
                {
                  "id": "ed5e9da0-5b84-413d-a198-0338b248f2b7",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Microsoft Sentinel ",
                  "subTarget": "sentinel",
                  "style": "link"
                },
                {
                  "id": "f23e1ce4-a2b5-4947-9dc3-6211e1021765",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Defender for Cloud",
                  "subTarget": "asc",
                  "style": "link"
                },
                {
                  "id": "68478fa5-e791-4eb7-836f-4c7ba3002fda",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Syslog",
                  "subTarget": "syslog",
                  "style": "link"
                },
                {
                  "id": "7728c496-7831-4089-afc2-133fbe5fa06b",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "Common Security Format (CEF)",
                  "subTarget": "cef",
                  "style": "link"
                }
              ]
            },
            "name": "links - 20"
          },
          {
            "type": 1,
            "content": {
              "json": "### Workspace Pricing\r\n\r\nPrice Parameter: Please provide an estimated cost so that we can get a value in the \"Estimated Table Price\" column, in the [Workspace Info] tab.   \r\ni.e If your Log Analytics PAYG is Â£2.00 per GB enter 2.00.  You can enter an interger (without a currency symbol), in format 1.0, 2.0, 3.1 etc...  \r\nIf you want to see the combined Log Analytics + Sentinel estimated cost please use both PAYG prices i.e. 2.00 + 2.00 = 4.00.  Please see the licence pages for both products.\r\n\r\nBase value on 7th July 2020, using an example of Sentinel ($2.46 US Central PAYG) + Log Analytics ($2.76 US Central PAYG) \r\n\r\n\r\nNote: No capacity reservation is taken into account.\r\n\r\n\r\n### Anomoly Detection\r\nSome reports now show anomoly detection, this explains the Score:\r\nhttps://docs.microsoft.com/azure/data-explorer/anomaly-detection#time-series-anomaly-detection\r\n\r\nAnomaly scores above 1.5 or below -1.5 indicate a mild anomaly rise or decline respectively. Anomaly scores above 3.0 or below -3.0 indicate a strong anomaly.",
              "style": "info"
            },
            "customWidth": "48",
            "conditionalVisibilities": [
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "Cost"
              },
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 15"
          },
          {
            "type": 1,
            "content": {
              "json": "### Microsoft Defender for Cloud (formally Azure Security Center) \r\n\r\nDefender for Cloud allows for 500MB/day (0.5GBytes) of *free* data to be sent by each Computer. Please see the licencing link at the bottom of this text box.\r\nYou have two variables\r\n1. The total allowed: < number of computers> * 0.5GB  (this is a pooled metric). \t\r\n\te.g 4 computers * 0.5GB = 2.0GB, the maximum value which is allowed to be sent for free.  Any data over this number will have the standard (Sentinel + Log Analytics) charge applied.     \r\n2. The actual data sent by each computer\r\n\te.g 4 * computers * 0.1GB = 0.4GB, which is allowed for free.\r\n\r\nTo fully calculate the Microsoft Sentinel average GBytes per day, if D4C data is present, we need to  take #1 from the total or #2.  This is shown as the \"Revised GB Number\". \r\n\r\n### Note: Licencing is subject to change, you must fully investigate and understand from the current documentation the implications.\r\nhttps://azure.microsoft.com/pricing/details/security-center/  correct as of 17th September 2020. \r\nRESOURCE TYPE\tFREE TIER\tSTANDARD TIER (a.k.a \"Azure Defender ON\")\r\nVirtual Machine\tFree\t$0.02/Server/Hour\r\nIncluded data - 500 MB/day",
              "style": "info"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "Cost"
              },
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 15 - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Sentinel Usage",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"a75e3f3a-2661-410b-82fb-d300d37dea2d\" width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><defs><linearGradient id=\"aff60ddf-eec1-40bf-8bf5-f3e3b50e8818\" x1=\"9\" y1=\"16.21\" x2=\"9\" y2=\"0.62\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#1b93eb\"/><stop offset=\"0.21\" stop-color=\"#2095eb\"/><stop offset=\"0.44\" stop-color=\"#2e9ced\"/><stop offset=\"0.69\" stop-color=\"#45a7ef\"/><stop offset=\"0.95\" stop-color=\"#64b6f1\"/><stop offset=\"1\" stop-color=\"#6bb9f2\"/></linearGradient></defs><title>Icon-security-248</title><path d=\"M16,8.44c0,4.57-5.53,8.25-6.73,9a.43.43,0,0,1-.46,0C7.57,16.69,2,13,2,8.44V2.94a.44.44,0,0,1,.43-.44C6.77,2.39,5.78.5,9,.5s2.23,1.89,6.53,2a.44.44,0,0,1,.43.44Z\" fill=\"#1b93eb\"/><path d=\"M15.38,8.48c0,4.2-5.07,7.57-6.17,8.25a.4.4,0,0,1-.42,0c-1.1-.68-6.17-4.05-6.17-8.25v-5A.41.41,0,0,1,3,3c3.94-.11,3-1.83,6-1.83S11.05,2.93,15,3a.41.41,0,0,1,.39.4Z\" fill=\"url(#aff60ddf-eec1-40bf-8bf5-f3e3b50e8818)\"/><path d=\"M9,6.53A2.88,2.88,0,0,1,11.84,9a.49.49,0,0,0,.49.4h1.4a.49.49,0,0,0,.5-.53,5.26,5.26,0,0,0-10.46,0,.49.49,0,0,0,.5.53h1.4A.49.49,0,0,0,6.16,9,2.88,2.88,0,0,1,9,6.53Z\" fill=\"#c3f1ff\"/><circle cx=\"9\" cy=\"9.4\" r=\"1.91\" fill=\"#fff\"/></svg>"
                  },
                  "name": "text - 7"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "923d55a3-75ac-4ce2-8820-50b4a530a553",
                        "version": "KqlParameterItem/1.0",
                        "name": "SentinelPrice",
                        "type": 1,
                        "description": "Enter a value for Sentinel Data cost, default: 2.0",
                        "value": "2.0",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "f809d158-af16-4583-95af-980cd064e15f",
                        "version": "KqlParameterItem/1.0",
                        "name": "Retention",
                        "label": "Retention price per GB",
                        "type": 1,
                        "description": "Obtain a value from the Azure Pricing Calculator, default: 0.10",
                        "value": "0.10"
                      },
                      {
                        "id": "8de07ce7-c61a-417b-a364-5fd3e52ad622",
                        "version": "KqlParameterItem/1.0",
                        "name": "retentionDays",
                        "label": "How many days retention are required? Defaults to current setting",
                        "type": 1,
                        "description": "Do you need to retain data for more than 90days in Sentinel? Defaults to current setting, alter for an estimate e.g 180days, max 730days. 1yr=365, 2yr=720, 3yr=1095, 4yr=1460, 5yr=1825, 6yr=2190 & 7yr=2555",
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n| project retentionDays",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "f87b71cc-4738-41b7-8625-63656640e6ad",
                        "version": "KqlParameterItem/1.0",
                        "name": "SentinelCap",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 200 , sku = \"capacityreservation\"\r\n//\r\n| project capacityReservationLevel\r\n\r\n\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "72f36500-a03a-42ed-bac1-db83d92ca534",
                        "version": "KqlParameterItem/1.0",
                        "name": "discountRate",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 2000 , sku = \"capacityreservation\"\r\n| extend discountRate = case(\r\ncapacityReservationLevel == 100,50,\r\ncapacityReservationLevel == 200,55,\r\ncapacityReservationLevel == 300,57,\r\ncapacityReservationLevel == 400,58,\r\ncapacityReservationLevel == 500,60,\r\ncapacityReservationLevel == 1000,61,\r\ncapacityReservationLevel == 2000,63,\r\ncapacityReservationLevel >= 5000,65,\r\n// else\r\n0\r\n)\r\n| project discountRate\r\n\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "lawCap",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| project capacityReservationLevel = properties.sku.capacityReservationLevel\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "id": "2665b7ce-d7df-4130-a67f-1486b598edb7"
                      },
                      {
                        "id": "2b57d534-a06f-43c3-a6da-b01158540eab",
                        "version": "KqlParameterItem/1.0",
                        "name": "SentinelSku",
                        "type": 1,
                        "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| project sku = tolower(properties.sku.name)",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "above",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n| where id has \"{Workspace}\"\r\n| extend sku = tolower(properties.sku.name)\r\n| extend capacityReservationLevel = properties.sku.capacityReservationLevel\r\n// add fake level for testing\r\n//| extend capacityReservationLevel = 5000 , sku = \"capacityreservation\"\r\n//\r\n| extend pricingTier = case(\r\nsku == 'capacityreservation' and capacityReservationLevel == 100,\r\n'100 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 200,\r\n'200 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 300,\r\n'300 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 400,\r\n'400 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 500,\r\n'500 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 1000,\r\n'1000 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel == 2000,\r\n'2000 GB/day Commitment Tier',\r\nsku == 'capacityreservation' and capacityReservationLevel >= 5000,\r\n'5000 GB/day and above Commitment Tier',\r\nsku == 'free',\r\n'Free',\r\nsku == 'standard',\r\n'Standard',\r\nsku == 'premium',\r\n'Premium',\r\nsku == 'standalone',\r\n'Standalone',\r\nsku == 'pernode',\r\n'Per Node',\r\nsku == 'lacluster',\r\n'Cluster Level Capacity Reservation',\r\nsku == 'pergb2018' or sku == 'pergb',\r\n'Pay-as-you-go',\r\nstrcat('Unknown:',sku))\r\n| extend discountRate = case(\r\ncapacityReservationLevel == 100,50,\r\ncapacityReservationLevel == 200,55,\r\ncapacityReservationLevel == 300,57,\r\ncapacityReservationLevel == 400,58,\r\ncapacityReservationLevel == 500,60,\r\ncapacityReservationLevel == 1000,61,\r\ncapacityReservationLevel == 2000,63,\r\ncapacityReservationLevel >= 5000,65,\r\n// else\r\n0\r\n)\r\n| extend retentionInSentinel = iif({retentionDays} > 90,({retentionDays} -90) * {GBperday} * {Retention} ,toreal(0))\r\n| project ['Workspace Name']=id,  location, sku, commitmentTier = capacityReservationLevel, discountRate ,  tags, dataRetention = {retentionDays}, dataRetentionMinusFree = {retentionDays}-90, RetentionEstimatedPrice = retentionInSentinel\r\n\r\n\r\n",
                    "size": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RetentionEstimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Workspace",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 16"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == True\r\n| summarize dataPerDay = sum(Quantity)/1000  by bin(TimeGenerated,1d), SentinelCT='{SentinelCap}'\r\n| extend higherCT = case(\r\n                   dataPerDay < 100, 100,\r\n                   dataPerDay > 100  and dataPerDay < 200, 200,\r\n                   dataPerDay > 200  and dataPerDay < 300, 300,\r\n                   dataPerDay > 300  and dataPerDay < 400, 400,\r\n                   dataPerDay > 400  and dataPerDay < 500, 500,\r\n                   dataPerDay > 500  and dataPerDay < 1000, 1000,\r\n                   dataPerDay > 1000 and dataPerDay < 10000, 10000,\r\n                   dataPerDay > 2000 and dataPerDay < 20000, 20000,\r\n                   dataPerDay > 5000 and dataPerDay < 50000, 50000,\r\n                   // else\r\n                   0\r\n                   )\r\n//| extend lowerCT= (higherCT - 100)\r\n\r\n\r\n\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "showAnnotations": true,
                    "title": "Actual Data Volume and Commitment Tier.  Data from: {TimeRange:label}.  ",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Column1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "dataPerDay",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "yAxis": [
                        "higherCT",
                        "SentinelCT",
                        "dataPerDay"
                      ],
                      "seriesLabelSettings": [
                        {
                          "seriesName": "higherCT",
                          "label": "Next Commitment Tier"
                        },
                        {
                          "seriesName": "SentinelCT",
                          "label": "Actual Commitment Tier",
                          "color": "purple"
                        },
                        {
                          "seriesName": "dataPerDay",
                          "color": "green"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "query - chart of CR"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier Insight\r\nThis report, shows the Average GB/day (based on the TimeRange parameter), which is rounded up to the nearest whole number, this is the number the Azure Pricing Calculator requires. https://azure.microsoft.com/pricing/calculator/ for Sentinel.\r\n- The Pay as You Go (PAYG_estimate) is the GB/day multiplied by the [Sentinel Price] parameter, default is 2.0 (the price in $ for EAST US).  This is location and currency neutral, so adjust to your own preferred value.  This is the Daily estimate of the price.\r\n- The Pay as You Go (PAYG_estimate_mthly) is the Monthly (31day) estimate of the price.\r\n- Commitment Tier_Estimate_Monthly is the (PAYG_estimate_mthly) minus any discount for the commitment Tier that is *currently* set.\r\n- Data ingested into Sentinel exceeding the selected daily commitment tier is charged at the effective tier prices. source: https://azure.microsoft.com/pricing/details/azure-sentinel/"
                  },
                  "name": "text - 5 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " project actual_ = '{GBperday}' , roundUp_ = round(toreal('{GBperday}'),0)\r\n| extend lookBack = 31\r\n| extend roundUp_ = iif(isnan(roundUp_),toreal(0),toreal(roundUp_))\r\n| extend PAYG_estimate = roundUp_ * {SentinelPrice}\r\n| extend discountRate = iif(isempty('{discountRate}'),\"0\",'{discountRate}')    \r\n| extend PAYG_estimate_mthly = (PAYG_estimate * lookBack)\r\n| extend CT_estimate_mthly = PAYG_estimate_mthly * tolong(discountRate) / 100\r\n| summarize by ['avg GB/day']=roundUp_, PAYG_estimate, PAYG_estimate_mthly, CT_estimate_mthly",
                    "size": 4,
                    "aggregation": 5,
                    "showAnnotations": true,
                    "title": "Commitment Tier. Price per GB:{SentinelPrice},  Discount %: {discountRate} ",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "PAYG_estimate",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "PAYG_estimate_mthly",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "avgDataPerDay",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "PAYG_estimate_daily",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "CT_estimate_mthly",
                          "label": "Commitment Tier estimate mthly",
                          "comment": "Estimated Monthly price"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "name": "query - billing - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### Commitment Tier for your Average GB/day value?  \r\nThis report helps you decide:\r\n- A green circle in a Status column ðŸŸ¢ indicates your are on the Optimal setting, based on your average data ingestion (GB/day) and Pay As You Go/commitment tier settings.\r\n- A recommend value of \"0\" / zero, means that you are on a setting (SKU) such as Free, PerGB etc.. rather than a commitment tier setting.\r\n- If the 'recommend' Sentinel or Workspace setting doesn't match the 'current' setting you will get a Red Cross in the Status columns âŒ.\r\n- Please read https://azure.microsoft.com/pricing/details/azure-sentinel/ and https://azure.microsoft.com/pricing/details/monitor/ before deciding. "
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " project actual_ = '{GBperday}' , roundUp_ = round(toreal('{GBperday}'),0)\r\n| extend lookBack = 31\r\n| extend i = roundUp_ //* 100\r\n| extend i = iif(isnan(i),toreal(0),toreal(i))\r\n// Sentinel commitment tier logic\r\n| extend recommendedSentinelCT = case(\r\n    i  <= 50,\"0\",\r\n    i between (51 .. 180),\"100\",\r\n    i between (181 .. 286),\"200\",\r\n    i between (287 .. 390),\"300\",\r\n    i between (391 .. 476),\"400\",\r\n    i between (477 .. 975),\"500\",\r\n    i between (976 .. 1897),\"1000\",\r\n    i between (1898 .. 4729),\"2000\",\r\n    i >= 4730 ,\"5000\",\r\n    //else\r\n    strcat(\"unknown Sentinel CT: \", i)\r\n)\r\n// Azure Log Analytics (LAW) commitment tier logic\r\n| extend recommendedWorkspaceCT = case(\r\n    i <= 85,\"0\",\r\n    i between (86 .. 187),\"100\",\r\n    i between (188 .. 293),\"200\",\r\n    i between (294 .. 391),\"300\",\r\n    i between (392 .. 491),\"400\",\r\n    i between (492 .. 982),\"500\",\r\n    i between (983 .. 1952),\"1000\",\r\n    i between (1953 .. 4849),\"2000\",\r\n    i >= 4850 ,\"5000\",\r\n    //else\r\n    strcat(\"unknown LAW CT: \", i)\r\n)\r\n| extend avgDataPerDay = i\r\n| extend currentSentinelCT = iif(isempty('{SentinelCap}'),\"0\",'{SentinelCap}')\r\n| extend currentWorkspaceCT = iif(isempty('{lawCap}'),\"0\",'{lawCap}')\r\n| extend sentinelOptimal = iif(recommendedSentinelCT == currentSentinelCT,1,0)\r\n| extend lawOptimal = iif(recommendedWorkspaceCT == currentWorkspaceCT,1,0)\r\n| summarize by ['avg GB/day']=avgDataPerDay,['Sentinel Status']=sentinelOptimal, ['Log Analytics Status']=lawOptimal, recommendedSentinelCT, recommendedWorkspaceCT,currentSentinelCT, currentWorkspaceCT",
                    "size": 4,
                    "title": "Commitment Tier Recommendations",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Sentinel Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "failed",
                                "text": ""
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "If Current and Recommended settings dont match the avg. GB/day - look to adjust? "
                          }
                        },
                        {
                          "columnMatch": "Log Analytics Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "failed",
                                "text": ""
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "If Current and Recommended settings dont match the avg. GB/day - look to adjust? "
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - CR optimal"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "sentinel"
            },
            "name": "group - capReservation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Defender for Cloud Usage",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"fe62c4da-ab98-4bb3-a1a5-9a22b229614c\" width=\"18\" height=\"18\" viewBox=\"0 0 18 18\"><defs><linearGradient id=\"f36136e6-f568-4134-ab6f-c0fefbc04f83\" x1=\"9\" y1=\"16.795\" x2=\"9\" y2=\"1.205\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#5e9624\"/><stop offset=\"0.321\" stop-color=\"#639d26\"/><stop offset=\"0.794\" stop-color=\"#6fb12a\"/><stop offset=\"0.999\" stop-color=\"#76bc2d\"/></linearGradient></defs><g><path d=\"M16.083,8.438c0,4.571-5.626,8.25-6.85,9a.449.449,0,0,1-.466,0c-1.224-.747-6.85-4.426-6.85-9v-5.5A.44.44,0,0,1,2.351,2.5C6.728,2.386,5.72.5,9,.5s2.272,1.886,6.649,2a.44.44,0,0,1,.434.435Z\" fill=\"#76bc2d\"/><path d=\"M15.5,8.485c0,4.191-5.16,7.566-6.282,8.25a.412.412,0,0,1-.428,0C7.664,16.051,2.5,12.676,2.5,8.485V3.441a.4.4,0,0,1,.4-.4C6.916,2.935,5.992,1.205,9,1.205s2.084,1.73,6.1,1.837a.4.4,0,0,1,.4.4Z\" fill=\"url(#f36136e6-f568-4134-ab6f-c0fefbc04f83)\"/><path d=\"M11.853,7.66h-.408l0-1.417a2.652,2.652,0,0,0-.7-1.809,2.358,2.358,0,0,0-3.483,0,2.606,2.606,0,0,0-.7,1.808V7.66H6.147a.328.328,0,0,0-.326.32v3.682a.329.329,0,0,0,.326.32h5.706a.329.329,0,0,0,.326-.32V7.98A.328.328,0,0,0,11.853,7.66Zm-1.549,0H7.7V6.219a1.434,1.434,0,0,1,.41-.99,1.2,1.2,0,0,1,1.788,0,1.394,1.394,0,0,1,.153.2h0a1.445,1.445,0,0,1,.258.791Z\" fill=\"#fff\"/><path d=\"M6.148,7.658h5.705a.328.328,0,0,1,.21.08L5.938,11.9a.313.313,0,0,1-.116-.241V7.979A.328.328,0,0,1,6.148,7.658Z\" fill=\"#b3b3b3\" opacity=\"0.15\"/><path d=\"M11.853,7.658H6.147a.328.328,0,0,0-.209.08L12.062,11.9a.314.314,0,0,0,.117-.241V7.979A.329.329,0,0,0,11.853,7.658Z\" fill=\"#a3a3a3\" opacity=\"0.09\"/></g></svg>"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Defender for Cloud : Usage Reports\r\n- - - "
                  },
                  "name": "text - 15"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "The following two charts help you understand Microsoft Defender for Cloud / **SecuityEvent** data if its present.\r\n- Top 10 computers, sending that SecuityEvent logs information & the capacity SecuityEvent \r\n- The final chart shows the potential allowance (each Defender for Cloud licence allows for 500MB/day). \r\n\t\r\n\t- Defender for Cloud / a.k.a \"Azure Defender ON\" was formally \"ASC standard\". \r\n\t- You can see what was Used vs. Allowed  (where allowed = 500MB * < count of servers>) "
                  },
                  "conditionalVisibility": {
                    "parameterName": "Help",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// https://docs.microsoft.com/azure/azure-monitor/logs/manage-cost-storage#log-analytics-and-security-center\r\nlet ascTables = dynamic(['WindowsEvent', 'SecurityAlert', 'SecurityBaseline', 'SecurityBaselineSummary', 'SecurityDetection', 'SecurityEvent','WindowsFirewall', 'MaliciousIPCommunication', 'LinuxAuditLog', 'SysmonEvent', 'ProtectionStatus']);\r\nunion withsource = tt *\r\n| where TimeGenerated > ago(30d)\r\n| where _IsBillable == True\r\n// Calculate the daily GB size per billable Table and unique Server count \r\n| summarize allGBytes =sum(_BilledSize)/(1024*1024*1024), ascGBytes=sumif(_BilledSize, Type in (ascTables))/(1024*1024*1024), ascComputerCount = dcountif(Computer,tt in (ascTables)) by bin(TimeGenerated, 1d)\r\n// Calculate daily GB average, and average ASC server count.  Each Server is allowed max 0.5GB each\r\n| summarize avg(allGBytes), avg(ascGBytes),ascComputers=round(avg(ascComputerCount),0),ascMaxGB = avg(ascComputerCount) * 0.5\r\n// If ASC sends less than the allowed max, revise the GB averge per day, else use the max allowed (all servers * 0.5)\r\n| extend revisedNumber = iif(avg_ascGBytes <= ascMaxGB, allMinusASCused = (avg_allGBytes - avg_ascGBytes),allMinusASCused = (avg_allGBytes - ascMaxGB) )\r\n| extend withinPool = iif(avg_ascGBytes >= ascMaxGB,\"Yes\",\"No\")\r\n| extend overBy = iif(round(avg_ascGBytes,2) - round(ascMaxGB,2) < 0 , toreal(0),  round(avg_ascGBytes,2) - round(ascMaxGB,2)  )\r\n| project ['Raw Average GB']   = avg_allGBytes,\r\n          ['Defender has used, GB'] = strcat(round(avg_ascGBytes,1),\" GB of \" ,round(ascMaxGB,1), \" GB across \", ascComputers , \" Computers\"), \r\n          ['Revised GB Number']= round(revisedNumber,2),\r\n          ['Help'] =\"Please toggle [Show Help] to Yes,  for more information\", \r\n          ['Sent more than allocation?'] = withinPool,\r\n          ['Overage in GB'] =  overBy\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
                    "size": 4,
                    "aggregation": 3,
                    "title": "Average GB per day: past 30days only",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Raw Average GB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "ASC has used, GB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Sent more than allocation?",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "yes",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ASC has used",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Revised Number",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Average GB/day",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Average GB per day",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Adjusted for ASC standard 500MB allowance",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "sum_ASCs",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "ASCsize",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Adjusted for ASC standard",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_TotalGBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "name": "query - 20"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "find in (WindowsEvent, SecurityAlert, SecurityBaseline, SecurityBaselineSummary, SecurityDetection, SecurityEvent,WindowsFirewall, MaliciousIPCommunication, LinuxAuditLog, SysmonEvent, ProtectionStatus) where isnotempty(_BilledSize) project _BilledSize, Computer\r\n| summarize MBytes=sum(_BilledSize) by Computer\r\n| top 10 by  MBytes desc",
                    "size": 1,
                    "aggregation": 3,
                    "title": "Top 10 Computers, using Defender for Cloud, from: {TimeRange:label} ",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "barchart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "MBytes",
                          "formatter": 0,
                          "formatOptions": {},
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "formatOptions": {},
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ]
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 36,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - 20 - top 10 d4cloud"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "find in (WindowsEvent, SecurityAlert, SecurityBaseline, SecurityBaselineSummary, SecurityDetection, SecurityEvent,WindowsFirewall, MaliciousIPCommunication, LinuxAuditLog, SysmonEvent, ProtectionStatus) where isnotempty(_BilledSize) project _BilledSize, Computer, TimeGenerated\r\n// ASC Standard allows 500MB per machine - in a pool \r\n| summarize  allowedMBytes=524288000  * dcount(Computer), usedMBytes=sum(_BilledSize) , dcount(Computer)  by bin(TimeGenerated,{TimeRange:grain})\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Defender for Cloud, allowance vs. in use, Last 30days",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "unstackedbar",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "MBytes",
                          "formatter": 0,
                          "formatOptions": {},
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "formatOptions": {},
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 36,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - 20 - allowance"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "The following three charts help you understand SecuityEvent data if its present.\r\n- SecurityEvents are captured in Groups: All, Common, Minimal and None\r\n- Using https://docs.microsoft.com/azure/data-explorer/kusto/query/series-decompose-anomaliesfunction we will look at this data\r\n- There are displays for Activity and EventIds that are captured in _Minimal_ and _Common_. Note _Minimal_ is a subset of _Common_\r\n- _\"All\"_ is a special case, as there isn't a list of those, I have listed any EventIds found, but only those not within _Common_\r\n- Using anomoliesfunction, we look at the expected count, actual count, give that a score (the higer varienences are marked in Red), a baseline and and Trend for the TimeRange ",
                    "style": "info"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Cost"
                    },
                    {
                      "parameterName": "Help",
                      "comparison": "isEqualTo",
                      "value": "Yes"
                    }
                  ],
                  "name": "text -ASC help for minimal common and all "
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "9f998673-d827-4bbf-97c3-16bd0b85bd5f",
                        "version": "KqlParameterItem/1.0",
                        "name": "AnomalyTuning",
                        "type": 10,
                        "description": "Anomaly scores above 1.5 or below -1.5 indicate a mild anomaly rise or decline respectively. Anomaly scores above 3.0 or below -3.0 indicate a strong anomaly. 2.0 added for a Medium range.",
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n { \"value\": \"0\",  \"label\": \"None\" },\r\n { \"value\": \"1.5\", \"label\": \"Mild\" },\r\n { \"value\": \"2.0\", \"label\": \"Medium\", \"selected\":true },\r\n { \"value\": \"3.0\", \"label\": \"Strong\"}\r\n]\r\n",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 10"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// source: https://docs.microsoft.com/azure/security-center/security-center-enable-data-collection#data-collection-tier\r\n//\r\nlet minimal = dynamic([1102,4624,4625,4657,4663,4688,4700,4702,4719,4720,4722,4723,4724,4727,4728,4732,4735,4737,4739,4740,4754,4755,\r\n4756,4767,4799,4825,4946,4948,4956,5024,5033,8001,8002,8003,8004,8005,8006,8007,8222]);\r\nSecurityEvent\r\n| where EventID in (minimal)\r\n| summarize Count = count(), BilledSize= sum(_BilledSize) by EventID, Activity\r\n| order by EventID asc \r\n| join \r\n( \r\n    SecurityEvent\r\n    | make-series Trend = count() on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step {TimeRange:grain} by EventID\r\n    | extend (anomalies, score, baseline) = series_decompose_anomalies(Trend, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\r\n    | extend Score = score[-1]\r\n    | extend expectedEventCounts=baseline[-1], actualEventCount=Trend[-1], Score = score[-1], Trend\r\n    | project-away score\r\n) on EventID\r\n| where Score > {AnomalyTuning} or Score < toreal(strcat(\"-\",{AnomalyTuning}))\r\n| project-away EventID1\r\n| project Activity, expectedEventCounts, actualEventCount, Score, Trend, baseline, anomalies, Count, BilledSize\r\n//https://docs.microsoft.com/azure/data-explorer/anomaly-detection#time-series-anomaly-detection",
                    "size": 1,
                    "title": "\"minimal\" data set - {TimeRange:label}. anomaly-detection: {AnomalyTuning:label}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "expectedEventCounts",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Score",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "pink"
                          }
                        },
                        {
                          "columnMatch": "baseline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "anomalies",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "EventID",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Score_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Score_3",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "EventID",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 2,
                      "topContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "EventID",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "nodeIdField": "Activity",
                      "sourceIdField": "Activity",
                      "targetIdField": "EventID",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "GBytes",
                        "type": 1,
                        "colorPalette": "cool"
                      },
                      "hivesMargin": 5
                    }
                  },
                  "name": "query - MD4C minimal"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// source: https://docs.microsoft.com/azure/security-center/security-center-enable-data-collection#data-collection-tier\r\n//\r\nlet common = dynamic([1,299,300,324,340,403,404,410,411,412,413,431,500,501,1100,1102,1107,1108,4608,4610,4611,4614,4622,\r\n4624,4625,4634,4647,4648,4649,4657,4661,4662,4663,4665,4666,4667,4688,4670,4672,4673,4674,4675,4689,4697,\r\n4700,4702,4704,4705,4716,4717,4718,4719,4720,4722,4723,4724,4725,4726,4727,4728,4729,4733,4732,4735,4737,\r\n4738,4739,4740,4742,4744,4745,4746,4750,4751,4752,4754,4755,4756,4757,4760,4761,4762,4764,4767,4768,4771,\r\n4774,4778,4779,4781,4793,4797,4798,4799,4800,4801,4802,4803,4825,4826,4870,4886,4887,4888,4893,4898,4902,\r\n4904,4905,4907,4931,4932,4933,4946,4948,4956,4985,5024,5033,5059,5136,5137,5140,5145,5632,6144,6145,6272,\r\n6273,6278,6416,6423,6424,8001,8002,8003,8004,8005,8006,8007,8222,26401,30004]);\r\nSecurityEvent\r\n| where EventID in (common)\r\n| summarize Count = count(), BilledSize= sum(_BilledSize) by EventID, Activity\r\n| order by EventID asc \r\n| join \r\n( \r\n    SecurityEvent\r\n    | make-series Trend = count() on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step {TimeRange:grain} by EventID\r\n    | extend (anomalies, score, baseline) = series_decompose_anomalies(Trend, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\r\n    | extend Score = score[-1]\r\n    | extend expectedEventCounts=baseline[-1], actualEventCount=Trend[-1], Score = score[-1], Trend\r\n    | project-away score\r\n) on EventID\r\n| where Score > {AnomalyTuning} or Score < toreal(strcat(\"-\",{AnomalyTuning}))\r\n| project-away EventID1\r\n| project Activity, expectedEventCounts, actualEventCount, Score, Trend, baseline, anomalies, Count, BilledSize",
                    "size": 1,
                    "title": "\"common\" data set - {TimeRange:label}. anomaly-detection: {AnomalyTuning:label}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "expectedEventCounts",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Score",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "10ch"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "minimumFractionDigits": 2,
                              "maximumSignificantDigits": 1
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Look for large positive numbers"
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "pink"
                          }
                        },
                        {
                          "columnMatch": "baseline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "anomalies",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "EventID",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Score_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Score_3",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "EventID",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 2,
                      "topContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "EventID",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "nodeIdField": "Activity",
                      "sourceIdField": "Activity",
                      "targetIdField": "EventID",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "GBytes",
                        "type": 1,
                        "colorPalette": "cool"
                      },
                      "hivesMargin": 5
                    }
                  },
                  "name": "query - ASC common"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// source: https://docs.microsoft.com/azure/security-center/security-center-enable-data-collection#data-collection-tier\r\n//\r\nlet common = dynamic([1,299,300,324,340,403,404,410,411,412,413,431,500,501,1100,1102,1107,1108,4608,4610,4611,4614,4622,\r\n4624,4625,4634,4647,4648,4649,4657,4661,4662,4663,4665,4666,4667,4688,4670,4672,4673,4674,4675,4689,4697,\r\n4700,4702,4704,4705,4716,4717,4718,4719,4720,4722,4723,4724,4725,4726,4727,4728,4729,4733,4732,4735,4737,\r\n4738,4739,4740,4742,4744,4745,4746,4750,4751,4752,4754,4755,4756,4757,4760,4761,4762,4764,4767,4768,4771,\r\n4774,4778,4779,4781,4793,4797,4798,4799,4800,4801,4802,4803,4825,4826,4870,4886,4887,4888,4893,4898,4902,\r\n4904,4905,4907,4931,4932,4933,4946,4948,4956,4985,5024,5033,5059,5136,5137,5140,5145,5632,6144,6145,6272,\r\n6273,6278,6416,6423,6424,8001,8002,8003,8004,8005,8006,8007,8222,26401,30004]);\r\nSecurityEvent\r\n| where EventID !in (common)\r\n| summarize Count = count(), BilledSize=sum(_BilledSize) by EventID, Activity, TimeGenerated\r\n| order by EventID asc \r\n| join \r\n( \r\n    SecurityEvent\r\n    //\r\n    // anomalies - seasonality baseline that captures the repetitive pattern. Outliers can be clearly spotted in the Score\r\n    //\r\n    | make-series Trend = count() on TimeGenerated from startofday({TimeRange:start}) to startofday({TimeRange:end}) step {TimeRange:grain} by EventID\r\n    | extend (anomalies, score, baseline) = series_decompose_anomalies(Trend, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\r\n    | extend Score = score[-1]\r\n    | extend expectedEventCounts=baseline[-1], actualEventCount=Trend[-1], Score = score[-1], Trend\r\n    | project-away score\r\n) on EventID\r\n| where Score > {AnomalyTuning} or Score < toreal(strcat(\"-\",{AnomalyTuning}))\r\n| project-away EventID1\r\n| project Activity, expectedEventCounts, actualEventCount, Score, Trend, baseline, anomalies, Count, BilledSize\r\n",
                    "size": 0,
                    "title": "possible \"all\" data set - EventsIDs found that are not in \"common\" or \"minmal\" - {TimeRange:label}. anomaly-detection: {AnomalyTuning:label}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "expectedEventCounts",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Score",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "10ch"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "pink"
                          }
                        },
                        {
                          "columnMatch": "baseline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "anomalies",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "score",
                          "formatter": 5,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_Score_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_Score_3",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "EventID",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 2,
                      "topContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "EventID",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "nodeIdField": "Activity",
                      "sourceIdField": "Activity",
                      "targetIdField": "EventID",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "GBytes",
                        "type": 1,
                        "colorPalette": "cool"
                      },
                      "hivesMargin": 5
                    }
                  },
                  "name": "query - All SecurityEvents with Trend"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let _lookback = 31;\r\nSecurityEvent\r\n| where TimeGenerated > startofday(ago(31d))\r\n| where _IsBillable == True\r\n| extend _ResourceId = iif(isempty(_ResourceId),Computer,_ResourceId)\r\n| parse _ResourceId with * \"/subscriptions/\" SubscriptionId \"/resourcegroups/\" resourceGroups \"/\" *\r\n| summarize sum(_BilledSize)  by _ResourceId, SubscriptionId, resourceGroups\r\n//| project DeviceName =_ResourceId, sum__BilledSize, ['Estimated Price'] =  (sum__BilledSize/(1024*1024*1024) - ( 0.5 * _lookback)) * {Price}  \r\n| project DeviceName =_ResourceId, sum__BilledSize, adjustedNumber = (sum__BilledSize/(1024*1024*1024) - ( 0.5 * _lookback)) * {Price} , SubscriptionId, resourceGroups\r\n| extend adjustedNumber = iif(adjustedNumber <= 0,toreal(\"Included\"),adjustedNumber) \r\n| order by adjustedNumber desc\r\n",
                    "size": 0,
                    "title": "BilledSize vs. Overage per resource, Month View",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "adjustedNumber",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "thresholdValue": "0",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0} Overage"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Price",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_adjustedNumber_2",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        },
                        {
                          "columnId": "adjustedNumber",
                          "label": "Estimated Price"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_adjustedNumber_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "query - 9"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "asc"
            },
            "name": "group - ASC"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "CEF Usage",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## CommonSecurityLog (CEF) Insights\r\n- - - "
                  },
                  "name": "text - 15"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize count(), sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} , ProductCount=dcount(DeviceProduct), ProductList=make_set(DeviceProduct) by DeviceVendor\r\n| order by sum__BilledSize desc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "CEF DeviceVendor, count of activity and BilledSize",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "ProductCount",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "whiteBlack",
                            "customColumnWidthSetting": "23ch"
                          }
                        },
                        {
                          "columnMatch": "gb",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "MBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "DeviceVendor",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Count"
                        },
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "DeviceVendor",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DeviceVendor",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "gb",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "estimatedPrice",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 18,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Estimated Cost"
                        }
                      },
                      "showBorder": false
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - CEF chart"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize count(LogSeverity),sum(_BilledSize)  by LogSeverity \r\n| join (CommonSecurityLog\r\n  | make-series Trend = count(LogSeverity) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by LogSeverity\r\n) on LogSeverity\r\n//| extend LogSeverity = round(tolong(LogSeverity),2)\r\n| order by LogSeverity asc\r\n",
                    "size": 0,
                    "title": "CEF count by Severity, BilledSize and Trend",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "LogSeverity",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "is Empty",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        },
                        "tooltipFormat": {
                          "tooltip": "Log Severity Value"
                        }
                      },
                      "subtitleContent": {
                        "columnMatch": "sum__BilledSize",
                        "formatter": 8,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 36,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_LogSeverity",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": ""
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 21,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n// add price column \r\n| summarize sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} by DeviceVendor, DeviceName, DeviceProduct\r\n| order by DeviceVendor asc\r\n// add cost by facility \r\n",
                    "size": 1,
                    "aggregation": 3,
                    "title": "Data by CEF Vendors, from: {TimeRange:label} , count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "DeviceVendor"
                        ],
                        "expandTopLevel": true
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - CEF chart - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize count(), sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price}  by DeviceEventClassID, DeviceVendor, DeviceName, DeviceProduct, LogSeverity\r\n| order by sum__BilledSize, estimatedPrice desc\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "title": "Data by CEF Vendors, from: {TimeRange:label} , filter by DeviceEventClassID, count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "DeviceVendor"
                        ],
                        "expandTopLevel": true
                      }
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - CEF DeviceEventClassID"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| summarize dcount(DeviceEventClassID),  sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price}  by DeviceVendor,  SourceIP, DestinationIP, _ResourceId\r\n",
                    "size": 1,
                    "title": "CEF: data set - {TimeRange:label}, count: {$rowCount}",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "_ResourceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "expectedEventCounts",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Score",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "pink"
                          }
                        },
                        {
                          "columnMatch": "baseline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "anomalies",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "EventID",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "dcount_DeviceEventClassID",
                          "label": "Count of unique ClassIDs",
                          "comment": "DeviceEventClassIDs"
                        },
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        },
                        {
                          "columnId": "estimatedPrice",
                          "label": "Estimated Price"
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "EventID",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 2,
                      "topContent": {
                        "columnMatch": "Activity",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "EventID",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "nodeIdField": "Activity",
                      "sourceIdField": "Activity",
                      "targetIdField": "EventID",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "GBytes",
                        "type": 1,
                        "colorPalette": "cool"
                      },
                      "hivesMargin": 5
                    }
                  },
                  "name": "query - CEF events"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "cef"
            },
            "name": "group - CEF"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Syslog Usage",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Syslog\r\n| where _IsBillable == true\r\n| summarize count(), sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} by Facility\r\n| order by count_ desc\r\n",
                    "size": 0,
                    "title": "Syslog Facility, count of activity and BilledSize",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "50ch"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Count"
                        },
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "query - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Syslog\r\n| where _IsBillable == true\r\n| summarize count(SeverityLevel), sum(_BilledSize) by SeverityLevel \r\n| join (Syslog\r\n  | make-series Trend = count(SeverityLevel) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SeverityLevel\r\n) on SeverityLevel\r\n",
                    "size": 0,
                    "title": "Syslog count by Severity, BilledSize and Trend",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "50ch"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SeverityLevel",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "info",
                              "representation": "1",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "warn",
                              "representation": "2",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "notice",
                              "representation": "Important",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "err",
                              "representation": "error",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "alert",
                              "representation": "warning",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        },
                        "tooltipFormat": {}
                      },
                      "subtitleContent": {
                        "columnMatch": "sum__BilledSize",
                        "formatter": 8,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 36,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_SeverityLevel",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Count"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 21,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "tooltipFormat": {
                          "tooltip": "Trend"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 0 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Syslog\r\n| where _IsBillable == true\r\n| summarize sum(_BilledSize), estimatedPrice = sum(_BilledSize)/(1024*1024*1024) * {Price} by HostName, SeverityLevel, Facility, SyslogMessage, ProcessName\r\n| order by sum__BilledSize desc ",
                    "size": 0,
                    "title": "Syslog by Hostname: detailed view",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SeverityLevel",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "warn",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "info",
                                "representation": "info",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "err",
                                "representation": "error",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "alert",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "notice",
                                "representation": "Normal",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "customColumnWidthSetting": "50ch"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "estimatedPrice",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "HostName",
                          "Facility"
                        ]
                      },
                      "labelSettings": [
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SeverityLevel",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "info",
                              "representation": "1",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "warn",
                              "representation": "2",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "notice",
                              "representation": "Important",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "err",
                              "representation": "error",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "alert",
                              "representation": "warning",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": "{0}{1}"
                            }
                          ]
                        },
                        "tooltipFormat": {}
                      },
                      "subtitleContent": {
                        "columnMatch": "sum__BilledSize",
                        "formatter": 8,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "BilledSize"
                        }
                      },
                      "leftContent": {
                        "columnMatch": "count_SeverityLevel",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Count"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 21,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "tooltipFormat": {
                          "tooltip": "Trend"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "query - 0 - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "syslog"
            },
            "name": "group - syslog"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Cost Overview",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| summarize ['Table Size'] =sum(Quantity)/1000 by ['Table Name'] =DataType,['IsBillable'] =IsBillable\r\n| order by ['Table Size']  desc\r\n ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "{Workspace:name} Status for {TimeRange:label}, Billable Tables have an  average use of: {GBperday} GB per day, Billable Tables have a Total size of {GBtotal} GB",
                    "exportFieldName": "Table Name",
                    "exportParameterName": "Table",
                    "exportDefaultValue": "All Tables",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Name",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "green",
                                "text": "True"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Table Size_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Table Size_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "70",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Basic"
                  },
                  "name": "query - 2 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=TableName1 *\r\n| where TimeGenerated > ago(30d)\r\n| summarize Entries = count(), Size = sumif(_BilledSize, _IsBillable==true), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by TableName1, _IsBillable\r\n| project ['Table Name'] = TableName1, ['Table Size'] = Size , ['% of Total GB'] = (Size /(1024*1024*1024)) / {GBtotal}  * 100,['IsBillable'] = _IsBillable, ['Last Record Received'] =  last_log , ['Estimated Table Price'] =  (estimate/(1024*1024*1024)) * {Price}\r\n | order by ['Table Size']  desc\r\n\r\n ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "{Workspace:name} Details for 30days, total: {GBtotal} GB",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "Table Name",
                    "exportParameterName": "Table",
                    "exportDefaultValue": "All Tables",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "%",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true,
                              "maximumFractionDigits": 2,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Table Price",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "orange"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "Table Size",
                          "label": "",
                          "comment": "Capacity of the Table"
                        },
                        {
                          "columnId": "IsBillable",
                          "comment": "Is the Table Free or Billable?"
                        },
                        {
                          "columnId": "Last Record Received",
                          "comment": "When did the last record arrive?"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "75",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Advanced"
                  },
                  "name": "query - 2 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| extend IsBillable = iif(IsBillable == True,\"Billable\",\"Free\")\r\n| summarize sum(Quantity) by IsBillable\r\n\r\n\r\n ",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "{Workspace:name} Data use % {selectDepthLevel}",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "exportFieldName": "Table Name",
                    "exportParameterName": "Table",
                    "exportDefaultValue": "All Tables",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Entries",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Size per Entry",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "palette": "orange"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "blueDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Table Price",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "True",
                          "label": "Billable"
                        },
                        {
                          "seriesName": "False",
                          "label": "Free"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumSignificantDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Advanced"
                  },
                  "name": "query - 2 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| summarize sum(Quantity) by tostring(IsBillable) ",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "{Workspace:name} Data use % ",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "exportFieldName": "Table Name",
                    "exportParameterName": "Table",
                    "exportDefaultValue": "All Tables",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "sum_Quantity",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "IsBillable"
                      },
                      "leftContent": {
                        "columnMatch": "sum_Quantity",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "True",
                          "label": "Billable"
                        },
                        {
                          "seriesName": "False",
                          "label": "Free"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumSignificantDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Basic"
                  },
                  "name": "query - 2 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// Predict data volume for the next month\r\n//\r\nlet endDate   = now();     // what is the date now\r\nlet projectTo = now()+90d; // project forward nn days\r\nlet projectForward = 90;   // must be same as projectTo value\r\nUsage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == true\r\n| make-series GBytesToday=sum(Quantity) default=0 on TimeGenerated from {TimeRange:start} to projectTo step 1d \r\n| extend GBytesForecast = series_decompose_forecast(GBytesToday, projectForward)\r\n\r\n",
                    "size": 0,
                    "aggregation": 5,
                    "showAnnotations": true,
                    "title": "Actual Data Volume vs. 90 day Prediction.  Data from: {TimeRange:label}.  Minimum 30days suggested, ideally 90days ",
                    "exportFieldName": "y",
                    "exportParameterName": "yAxis",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "linechart",
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "GBytesToday",
                          "color": "blueDark"
                        },
                        {
                          "seriesName": "GBytesForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 38,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumSignificantDigits": 3
                          }
                        }
                      }
                    }
                  },
                  "name": "query - 20 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//\r\n// Predict data volume for the next month\r\n//\r\nlet startDate = {TimeRange:start}; // go back in time nn days\r\nlet endDate   = now();     // what is the date now\r\nlet projectTo = now()+90d; // project forward nn days\r\nlet projectForward = 90;   // must be same as projectTo value\r\n//union withsource = TableName1 *\r\n//| where TimeGenerated between (startDate .. endDate )\r\nUsage\r\n| where IsBillable == True\r\n| make-series GBytesToday=sum(Quantity)/1000 default=0 on TimeGenerated from {TimeRange:start} to projectTo step 1d \r\n| extend GBytesForecast = series_decompose_forecast(GBytesToday, projectForward)\r\n| extend dayBacks = (toint('{TimeRange:seconds}') / toint(86400))-1\r\n| extend  todayVolume = array_slice(GBytesToday, dayBacks, dayBacks)[0], \r\n          predictionVolume = array_slice(GBytesForecast, array_length( GBytesForecast)-1, array_length( GBytesForecast)-1)[0]\r\n| project priceToday =  todayVolume * {Price},\r\n          pricePrediction = predictionVolume * {Price}, todayVolume, predictionVolume\r\n\r\n",
                    "size": 4,
                    "title": "Actual Data Volume and Price vs. 90 day Prediction. ",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "priceToday",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "pricePrediction",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "todayVolume",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "predictionVolume",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "UserSelectedAxis",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "GBytesToday",
                          "color": "blueDark"
                        },
                        {
                          "seriesName": "GBytesForecast",
                          "color": "redBright"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 5,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "69",
                  "name": "query - Price Predict"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "print volume = {yAxis}, price = {yAxis} * {Price}",
                    "size": 4,
                    "title": "User selected Y-Axis details.  ",
                    "noDataMessage": "Please click on a point on the trend line in the graph above.",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "volume",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "price",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "29",
                  "name": "query - 14"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n// get logs for previous 3 months\r\n| where TimeGenerated between(startofmonth(now(),-3) ..endofmonth(endofmonth(now(),-1)) )\r\n| summarize GBytesTotal=sum(Quantity) / 1000 by month=bin(datepart(\"Month\", TimeGenerated), 1)\r\n// format month so we can sort it\r\n| extend month = case(month==1,strcat(month,'. Jan'),month==2,strcat(month,'. Feb'),month==3, strcat(month,'. Mar'),month==4,strcat(month,'. Apr'),month==5,strcat(month,'. May'),month==6,strcat(month,'. Jun'),month==7, strcat(month,'. Jul'),month==8,strcat(month,'. Aug'),month==9,strcat(month,'. Sep'),month==10,strcat(month,'. Oct'),month==11,strcat(month,'. Nov'),month==12,strcat(month,'. Dec'),\"error\")\r\n| order by month asc\r\n",
                    "size": 0,
                    "title": "Month on Month report - Data Volume",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "categoricalbar",
                    "chartSettings": {
                      "customThresholdLine": "50",
                      "customThresholdLineStyle": 3,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 39,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "name": "query - monthly history"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "This Tables show the details of which Data is changing, the Top billable Tables and a breakdown by resources and Windows Events.  \r\n- Use these to identify a change in data use, or the most costly data Tables or Resources.",
                    "style": "info"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Cost"
                    },
                    {
                      "parameterName": "Help",
                      "comparison": "isEqualTo",
                      "value": "Yes"
                    }
                  ],
                  "name": "text - 9 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = _TableName *\r\n| make-series bill_ = sum(_BilledSize) on TimeGenerated from ago(90d) to now() step 1d  by _TableName\r\n| extend (anomalies, score, baseline) = series_decompose_anomalies(bill_, 1.5, 7, 'linefit', 1, 'ctukey', 0.01)\r\n| where anomalies[-1] == 1 or anomalies[-1] == -1  \r\n| extend Score = score[-1]\r\n| where Score > 3 or Score < -3\r\n| project [\"Table Name\"] = _TableName, expectedCounts=baseline[-1], actualCount=bill_[-1] , Score = score[-1], Trend = bill_, Baseline = baseline\r\n\r\n// https://docs.microsoft.com/azure/data-explorer/anomaly-detection#time-series-anomaly-detection\r\n// Anomaly scores above 1.5 or below -1.5 indicate a mild anomaly rise or decline respectively. Anomaly scores above 3.0 or below -3.0 indicate a strong anomaly.",
                    "size": 1,
                    "title": "BilledSize Anomalies: 90day, fixed look back period. anomaly-detection: Strong",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "expectedCounts",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "actualCount",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Score",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": " Anomaly scores above 3.0 or below -3.0 indicate a strong anomaly"
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "pink"
                          }
                        },
                        {
                          "columnMatch": "Baseline",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_Score_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_Score_3",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "query - billedSize Anomalies"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//union withsource = TableName1 *\r\n//| where _IsBillable == True\r\n//| summarize  totalGBytes =round(sum(_BilledSize/(1024*1024*1024)),2)  by bin(TimeGenerated, 7d)\r\nUsage\r\n| where StartTime {TimeRange:value}\r\n| where IsBillable == True\r\n| summarize  totalGBytes =sum(Quantity) by bin(TimeGenerated, 7d)\r\n| order by TimeGenerated asc\r\n| serialize \r\n| extend changeInGB = totalGBytes - prev(totalGBytes,1)\r\n| extend pctChange = (changeInGB * 100) / prev(totalGBytes,1)\r\n| extend TimeGenerated = strcat( format_datetime(TimeGenerated, 'yyyy-MM-dd'), \", Week of year: \", week_of_year(TimeGenerated) )\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Data change (GBytes) and % , from: {TimeRange:label} grouping: Weekly",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "totalGBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "changeInGB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "pctChange",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "changeInGB",
                          "label": "Change from last period (GBytes)"
                        },
                        {
                          "columnId": "pctChange",
                          "label": "% Change"
                        }
                      ]
                    },
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 20 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = TableName1 *\r\n| where _IsBillable == True\r\n| summarize  rgtotalGBytes =sumif(_BilledSize, isnotempty(ResourceGroup)), notRGtotalGBytes =sumif(_BilledSize, isempty(ResourceGroup))  by ResourceGroup\r\n| order by rgtotalGBytes desc\r\n\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "ResourceGroup from: {TimeRange:label}",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "rgtotalGBytes",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "notRGtotalGBytes",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "changeInGB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "pctChange",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_rgtotalGBytes_1",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "rgtotalGBytes",
                          "label": "BilledSize by Resource Group "
                        },
                        {
                          "columnId": "notRGtotalGBytes",
                          "label": "BilledSize not in a Resource Group"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_rgtotalGBytes_1",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - RG"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| summarize by   sName = strcat(\"/subscriptions/\", subscriptionId), sId = subscriptionId\r\n\r\n",
                    "size": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "value::selected"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "hide",
                    "comparison": "isEqualTo",
                    "value": "hide"
                  },
                  "name": "query - mergeIn_1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where IsBillable == True\r\n| parse ResourceUri with *'/subscriptions/' SubscriptionId '/resourcegroups/'*\r\n| summarize Gbytes = sum(Quantity)/1000  by SubscriptionId\r\n| project SubscriptionId, Gbytes, ['Estimated Price'] =  (Gbytes * {Price})\r\n| order by  ['Estimated Price'] desc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Subscription from: {TimeRange:label}",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Price",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "rgtotalGBytes",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "notRGtotalGBytes",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 27,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "changeInGB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "pctChange",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "hide",
                    "comparison": "isEqualTo",
                    "value": "hide"
                  },
                  "name": "query - by Subscription_1 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"e551a41f-8bef-4fbb-a170-04837d9161be\",\"mergeType\":\"rightouter\",\"leftTable\":\"query - mergeIn_1\",\"rightTable\":\"query - by Subscription_1 - Copy\",\"leftColumn\":\"sId\",\"rightColumn\":\"SubscriptionId\"}],\"projectRename\":[{\"originalName\":\"sName\",\"mergedName\":\"sName\",\"fromId\":\"unknown\"},{\"originalName\":\"sId\",\"mergedName\":\"sId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - mergeIn_1].sName\",\"mergedName\":\"sName1\",\"fromId\":\"e551a41f-8bef-4fbb-a170-04837d9161be\"},{\"originalName\":\"[query - mergeIn_1].sId\",\"mergedName\":\"sId1\",\"fromId\":\"e551a41f-8bef-4fbb-a170-04837d9161be\"},{\"originalName\":\"[query - by Subscription_1 - Copy].SubscriptionId\",\"mergedName\":\"SubscriptionId\",\"fromId\":\"e551a41f-8bef-4fbb-a170-04837d9161be\"},{\"originalName\":\"[query - by Subscription_1 - Copy].Gbytes\",\"mergedName\":\"Gbytes\",\"fromId\":\"e551a41f-8bef-4fbb-a170-04837d9161be\"},{\"originalName\":\"[query - by Subscription_1 - Copy].Estimated Price\",\"mergedName\":\"Estimated Price\",\"fromId\":\"e551a41f-8bef-4fbb-a170-04837d9161be\"}]}",
                    "size": 0,
                    "title": "Subscription from: Last 30 days",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "sId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Gbytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 39,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Price",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "SubscriptionId",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "sName1",
                          "label": "Subscription Name",
                          "comment": "if known?"
                        },
                        {
                          "columnId": "Gbytes",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "SubscriptionId",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "50",
                  "showPin": false,
                  "name": "query - 13"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = TableName1 *\r\n//| project SubscriptionId, _BilledSize, ResourceGroup, _IsBillable\r\n| where _IsBillable == True\r\n| summarize sum(_BilledSize) by SubscriptionId, ResourceGroup, Resource, _ResourceId\r\n| extend SubscriptionId = iif(isempty(SubscriptionId),'Data not associated with a Subscription',SubscriptionId)\r\n| project SubscriptionId, sum__BilledSize, ['Estimated Price'] =  (sum__BilledSize/(1024*1024*1024)) * {Price},  ResourceGroup, Resource, _ResourceId\r\n| order by ['Estimated Price'] desc",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Subscription(s) BilledSize and Price from: {TimeRange:label},Query Time: {$queryTime}",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SubscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Price",
                          "formatter": 0,
                          "formatOptions": {
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ResourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Total_",
                          "formatter": 0,
                          "formatOptions": {
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "SubscriptionId",
                          "ResourceGroup"
                        ],
                        "expandTopLevel": false
                      },
                      "labelSettings": [
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Basic"
                  },
                  "name": "query - by Subscription  - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let billedSizeBySub = materialize (union withsource = TableName1 *\r\n| project SubscriptionId, _BilledSize, ResourceGroup, _IsBillable\r\n| where _IsBillable == True\r\n| summarize sum(_BilledSize) by SubscriptionId, ResourceGroup\r\n| extend SubscriptionId = iif(isempty(SubscriptionId),'Data not assocated with a Subscription',SubscriptionId)\r\n| project SubscriptionId, sum__BilledSize, ['Estimated Price'] =  (sum__BilledSize/(1024*1024*1024)) * {Price},  ResourceGroup\r\n| order by ['Estimated Price'] desc);\r\nbilledSizeBySub \r\n| union\r\n    (billedSizeBySub \r\n      | summarize sum__BilledSize = sum(sum__BilledSize), ['Estimated Price'] = sum(['Estimated Price'])\r\n    ) \r\n| extend SubscriptionId = iif(isempty(SubscriptionId),'Final Total',SubscriptionId)",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Subscription(s) BilledSize and Price from: {TimeRange:label},Query Time: {$queryTime}",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SubscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed",
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated Price",
                          "formatter": 0,
                          "formatOptions": {
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ResourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Total_",
                          "formatter": 0,
                          "formatOptions": {
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "SubscriptionId",
                          "ResourceGroup"
                        ],
                        "expandTopLevel": false
                      },
                      "labelSettings": [
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectDepthLevel",
                    "comparison": "isEqualTo",
                    "value": "Advanced"
                  },
                  "name": "query - by Subscription  - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "group - Cost Overview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Table Analysis",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where StartTime {TimeRange:value}\r\n| summarize ['Table Size'] =sum(Quantity), Price = {Price} * sum(Quantity)/1000 by ['Table Name'] =DataType,['IsBillable'] =IsBillable\r\n| order by ['Table Size']  desc\r\n// | top 10 by ['Table Size']  desc\r\n\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top billable Tables, from: {TimeRange:label} data, count: {$rowCount}",
                    "exportFieldName": "Table Name",
                    "exportParameterName": "exportTblName",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Price",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 20 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "find in ({exportTblName}) where isnotempty(Computer)\r\n| summarize GB = sum(_BilledSize) by Computer\r\n| order by GB desc",
                    "size": 0,
                    "title": "Details by Computer (this will only work for Tables that have a [Computer] column)",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "GB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "exportTblName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union\r\n(SecurityEvent\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (SecurityEvent | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n),\r\n(\r\nCommonSecurityLog\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (CommonSecurityLog | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n),\r\n(\r\nSyslog\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (Syslog | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n),\r\n(\r\nEvent\r\n| make-series GBperDay=sum(_BilledSize)/(1024*1024*1024) on bin(TimeGenerated,1d) from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId, Type\r\n| join (Event | summarize  ['Table Size']=sum(_BilledSize) by _ResourceId) on _ResourceId\r\n| project-away _ResourceId1, TimeGenerated\r\n)\r\n| top 10 by ['Table Size']  desc",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top 10 Costs by Resource, from: {TimeRange:label} data",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "GBperDay",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "GBytesToday",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Cost"
                  },
                  "name": "query - 20 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//find where TimeGenerated {TimeRange:Query} project _BilledSize, _IsBillable, Computer, _ResourceId, EventID\r\nfind withsource=TableName1 in (Event, SecurityEvent, Syslog, CommonSecurityLog) where TimeGenerated {TimeRange:Query} project _BilledSize, _IsBillable, Computer, _ResourceId, EventID, Activity, SyslogMessage, RenderedDescription\r\n| where _IsBillable == true\r\n| summarize ['Table Size'] = sum(_BilledSize) by TableName=TableName1 , EventID,  Activity, RenderedDescription, SyslogMessage\r\n| extend EventDescription = iif(isempty(Activity),RenderedDescription,Activity)\r\n| extend EventDescription = iif(isempty(EventDescription),SyslogMessage,EventDescription)\r\n| project-away RenderedDescription, SyslogMessage, Activity\r\n| top 10 by ['Table Size']  desc",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top 10 Costs by EventId, from: {TimeRange:label} data",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Cost"
                  },
                  "name": "query - 20 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=TableName1 Event, SecurityEvent, Syslog, CommonSecurityLog\r\n| where _IsBillable == true\r\n| summarize ['Table Size'] = sum(_BilledSize), any(RenderedDescription), any(Activity) by TableName = TableName1 , EventID, Computer //, Activity, RenderedDescription, SyslogMessage\r\n//| extend EventDescription = iif(isempty(Activity),RenderedDescription,Activity)\r\n//| extend EventDescription = iif(isempty(EventDescription),SyslogMessage,EventDescription)\r\n//| project-away RenderedDescription, SyslogMessage, Activity\r\n| top 20 by ['Table Size']  desc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Top 20 Costs by Event, from: {TimeRange:label} data by Computer",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table Size",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "any_Activity",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "any_Activity",
                        "sortOrder": 1
                      }
                    ],
                    "chartSettings": {
                      "showMetrics": false,
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "Cost"
                  },
                  "name": "query - 20 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "https://docs.microsoft.com/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor",
                    "style": "info"
                  },
                  "name": "text - 24"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//union withsource=TableName1 *\r\nfind where TimeGenerated {TimeRange:Query} project _BilledSize, _IsBillable, Computer, _ResourceId\r\n| where _isBillable=true and isnotempty(Computer) \r\n| summarize billedData = sumif(_BilledSize, _IsBillable=~true),\r\n            freeData   = sumif(_BilledSize, _IsBillable=~false) by Computer, _ResourceId\r\n| order by billedData desc\r\n\r\n",
                    "size": 1,
                    "aggregation": 3,
                    "title": "GB used by Computers",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15%"
                          }
                        },
                        {
                          "columnMatch": "billedData",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "freeData",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "MBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Table Size",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "bill",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_billedData_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_billedData_2",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "BillingVolumeNow",
                          "color": "green"
                        },
                        {
                          "seriesName": "BillingForecast",
                          "color": "redBright"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 20 - GB per Computer"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource = TableName1 *\r\n| where isnotempty(SubscriptionId) and _IsBillable==true\r\n| summarize sum(_BilledSize) by SubscriptionId, TableName=TableName1\r\n\r\n",
                    "size": 0,
                    "title": "Billing by Subscription",
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SubscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "sum__BilledSize",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 36,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "sum__BilledSize",
                          "label": "BilledSize"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "name": "query - 9"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "table"
            },
            "name": "group - Table"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Cost"
      },
      "name": "group - cost"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Regular Checks",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "fc113fd5-ae1b-41d9-b34e-5bfe93d8f666",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "| 1ï¸âƒ£ Daily |",
                  "subTarget": "Daily",
                  "style": "link"
                },
                {
                  "id": "9fe38fa7-0453-4d11-8ed5-c54b017d9b70",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "| 7ï¸âƒ£ Weekly |",
                  "subTarget": "Weekly",
                  "style": "link"
                },
                {
                  "id": "04b5d677-9b0e-4d82-8735-00f1da101f35",
                  "cellValue": "selectedTab1",
                  "linkTarget": "parameter",
                  "linkLabel": "| ðŸ“… Monthly | ",
                  "subTarget": "Monthly",
                  "style": "link"
                }
              ]
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "Checks"
            },
            "name": "links - 39"
          },
          {
            "type": 1,
            "content": {
              "json": "This Tab is used to recommend tasks to perform on a Daily, Weekly or Monthly basis.  These tasks have been taken from work in the community.",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selectedTab",
                "comparison": "isEqualTo",
                "value": "Checks"
              },
              {
                "parameterName": "Help",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 16"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Group: Daily Checks",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": " Daily Operational Tasks\t\r\n1. Data Connectors \r\nLook through active Data Connector and verify the Last Log Received date/time is current to ensure data is flowing.\r\n2. Investigate Incidents \r\nInvestigate Incidents to determine if any Analytics Alerts rules were triggered. Set status and begin investigation. Resolve or reassign.\t\r\n3. Hunting Queries and Bookmarks (links provided)\t\r\nExplore the built-in query results. Update existing hunting queries and bookmarks. Manually generate new or update old Incidents if applicable. Apply automation (Playbooks) where required.\t\r\n4. Analytics Rules (links provided)\t\r\nIdentify any newly released (or newly available due to recently connected Data Connectors) Analytics Rules and enable those that are applicable. Apply automation (Playbooks) where essential.\t\r\n\r\n\t",
                    "style": "success"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Daily"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "text - 46"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "union withsource=TableName1 *\r\n| where TimeGenerated {TimeRange:query}\r\n| where TableName1 !endswith \"_RST\" and TableName1 !endswith \"_SRCH\"\r\n| summarize Entries = count(), last_log = datetime_diff(\"second\",now(), max(TimeGenerated))  by TableName1, _IsBillable\r\n| project ['Table Name'] = TableName1,  ['Last Record Received'] =  last_log \r\n| order by  ['Last Record Received'] desc\r\n\r\n\r\n",
                    "size": 0,
                    "title": "1. Data Connector",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Daily"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "query - 39"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityIncident\r\n| summarize IncidentCount=count(), arg_max(LastActivityTime,LastActivityTime, CreatedTime, Title) by IncidentNumber, Title, IncidentUrl\r\n| top 200  by IncidentNumber desc\r\n| project-away Title1, LastActivityTime1\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "2. Daily Incident check (Top 200)",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "IncidentUrl",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Open Incident"
                          }
                        },
                        {
                          "columnMatch": "TenantId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "IncidentCount",
                          "label": "Alert Count"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Daily"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "query - 39 - Copy"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "3cc494b9-3cde-4ac4-831d-e01ee44ce787",
                        "cellValue": "https://github.com/Azure/Azure-Sentinel/tree/master/Hunting%20Queries",
                        "linkTarget": "Url",
                        "linkLabel": "https://github.com/Azure/Azure-Sentinel/tree/master/Hunting%20Queries",
                        "preText": "3. Hunting Queries",
                        "postText": "",
                        "style": "link"
                      },
                      {
                        "id": "2df3d076-e803-4654-a803-df5ccfdaf581",
                        "cellValue": "https://github.com/Azure/Azure-Sentinel/tree/master/Detections",
                        "linkTarget": "Url",
                        "linkLabel": "https://github.com/Azure/Azure-Sentinel/tree/master/Detections",
                        "preText": "4. Analytic Rules",
                        "style": "link"
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Daily"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "links - 47"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "Daily"
            },
            "name": "group - Daily",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Group: Weekly",
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "22b2f176-7f2b-4d52-be98-816801a90e07",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "| ðŸ•µï¸ Agents |",
                        "subTarget": "agents",
                        "preText": "Agents",
                        "style": "link"
                      },
                      {
                        "id": "a6e78c51-911a-4cc8-858a-3709feefaf75",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "| ðŸ“š Workbooks | ",
                        "subTarget": "workbooks",
                        "style": "link"
                      },
                      {
                        "id": "7797b21c-05e1-4ec8-8d9a-d8d250089215",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "| ðŸ“ Rules |",
                        "subTarget": "rules",
                        "style": "link"
                      },
                      {
                        "id": "34a06bc8-c5f8-4263-bf81-44e1c08c61ab",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "| Playbooks | ",
                        "subTarget": "playbooks",
                        "style": "link"
                      },
                      {
                        "id": "56fd063a-31a0-4bff-a49a-721368f423be",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "| Content Hub |",
                        "subTarget": "content",
                        "style": "link"
                      },
                      {
                        "id": "43353f45-6e74-4b7e-bad2-971546d6e983",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "| ðŸ—„ï¸ Retention |",
                        "subTarget": "retention",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "links - 25"
                },
                {
                  "type": 1,
                  "content": {
                    "json": " Weekly Operational Tasks\t\r\n1. Log Analytics Agent\r\nVerify the servers (or workstations) are showing a connected status in the workspace. Troubleshoot and remediate failed connections.\r\n2. Workbooks Updates \r\nVerify in the Sentinel Dashboard blade if an installed Workbook has an update that needs installed.\r\n3. GitHub Alert Rules, Workbooks, Hunting queries, Content Hub and Playbooks\t\r\nVisit and review the Sentinel GitHub repository and explore if there are new or updated Detection Rules, Workbooks, Hunting queries, Content Hub or Playbooks of value that can be added to the environment.\t\r\n\t",
                    "style": "success"
                  },
                  "name": "text - 46 - Copy"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "SubGroup: Agents",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| summarize  count_ = dcount(Computer)  by bin(TimeGenerated, 7d)\r\n| order by TimeGenerated asc\r\n| serialize \r\n| extend changeInCount = count_ - prev(count_,1)\r\n| extend changeInPct     = (changeInCount * 100) / prev(count_,1)\r\n\r\n",
                          "size": 1,
                          "title": "1. Weekly: Log Analytics Agent count change summary (7 days)",
                          "timeContext": {
                            "durationMs": 604800000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "changeInCount",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "coldHot"
                                }
                              },
                              {
                                "columnMatch": "changeInPct",
                                "formatter": 0,
                                "formatOptions": {},
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "changePct",
                                "formatter": 0,
                                "formatOptions": {},
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "_ComputerName_",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "Details",
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true,
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Unhealthy",
                                      "representation": "4",
                                      "text": "{0}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}"
                                    }
                                  ]
                                },
                                "tooltipFormat": {
                                  "tooltip": "Click to see details of the last event sent by this computer."
                                }
                              },
                              {
                                "columnMatch": "Environment",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Azure",
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "magenta",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Heartbeat Trend",
                                "formatter": 10,
                                "formatOptions": {
                                  "palette": "redGreen"
                                },
                                "tooltipFormat": {
                                  "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                                }
                              },
                              {
                                "columnMatch": "Details",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Last Record Received",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "coldHot"
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 3
                                  }
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "count_",
                                "label": "Computer Count"
                              },
                              {
                                "columnId": "changeInCount",
                                "label": "Change count "
                              },
                              {
                                "columnId": "changeInPct",
                                "label": "Change  (%)"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "State",
                              "formatter": 1,
                              "formatOptions": {}
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {},
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "rightContent": {
                              "columnMatch": "State",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unhealthy",
                                    "representation": "4",
                                    "text": ""
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": ""
                                  }
                                ]
                              }
                            },
                            "showBorder": false,
                            "rowLimit": 100
                          }
                        },
                        "customWidth": "50",
                        "name": "query - heartbeat"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| summarize  count_ = dcount(Computer)  by bin(TimeGenerated, 7d)\r\n| order by TimeGenerated asc\r\n\r\n",
                          "size": 1,
                          "title": "1. Weekly: Log Analytics Agent count change summary",
                          "timeContext": {
                            "durationMs": 604800000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "changeInCount",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "coldHot"
                                }
                              },
                              {
                                "columnMatch": "changePct",
                                "formatter": 0,
                                "formatOptions": {},
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "_ComputerName_",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "Details",
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true,
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Unhealthy",
                                      "representation": "4",
                                      "text": "{0}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}"
                                    }
                                  ]
                                },
                                "tooltipFormat": {
                                  "tooltip": "Click to see details of the last event sent by this computer."
                                }
                              },
                              {
                                "columnMatch": "Environment",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Azure",
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "magenta",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Heartbeat Trend",
                                "formatter": 10,
                                "formatOptions": {
                                  "palette": "redGreen"
                                },
                                "tooltipFormat": {
                                  "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                                }
                              },
                              {
                                "columnMatch": "Details",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Last Record Received",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "coldHot"
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 3
                                  }
                                }
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "State",
                              "formatter": 1,
                              "formatOptions": {}
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {},
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "rightContent": {
                              "columnMatch": "State",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unhealthy",
                                    "representation": "4",
                                    "text": ""
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": ""
                                  }
                                ]
                              }
                            },
                            "showBorder": false,
                            "rowLimit": 100
                          }
                        },
                        "customWidth": "50",
                        "name": "query - heartbeat 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "281e8743-964f-4e81-9683-7ad7af4504e7",
                              "version": "KqlParameterItem/1.0",
                              "name": "UnhealthyCriteria",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n    { \"value\":\"1m\", \"label\":\"1 minute without heartbeat\", \"selected\":false },\r\n    { \"value\":\"5m\", \"label\":\"5 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"30m\", \"label\":\"30 minutes without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1h\", \"label\":\"1 hour without heartbeat\", \"selected\":true },\r\n    { \"value\":\"2h\", \"label\":\"2 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"8h\", \"label\":\"8 hours without heartbeat\", \"selected\":false },\r\n    { \"value\":\"1d\", \"label\":\"1 day without heartbeat\", \"selected\":false },\r\n    { \"value\":\"2d\", \"label\":\"2 days without heartbeat\", \"selected\":false },\r\n    { \"value\":\"7d\", \"label\":\"7 days without heartbeat\", \"selected\":false }\r\n]",
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "EPStimerange",
                              "value": "8h"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "customWidth": "50",
                        "name": "parameters - 42"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Heartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize LastHeartbeat = max(TimeGenerated) by Computer\r\n| extend State = iff(LastHeartbeat < ago({UnhealthyCriteria}), 'Unhealthy', 'Healthy')\r\n| extend TimeFromNow = now() - LastHeartbeat\r\n| extend [\"TimeAgo\"] = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| extend Packed = pack_all()\r\n) on Computer\r\n| where TimeGenerated == LastHeartbeat\r\n| join (\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n| make-series InternalTrend=iff(count() > 0, 1, 0) default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {UnhealthyCriteria} by Computer\r\n| extend Trend=array_slice(InternalTrend, array_length(InternalTrend) - 30, array_length(InternalTrend)-1)\r\n| extend (s_min, s_minId, s_max, s_maxId, s_avg, s_var, s_stdev) = series_stats(Trend)\r\n| project Computer, Trend, s_avg\r\n) on Computer\r\n| order by State, s_avg asc, TimeAgo\r\n| project [\"_ComputerName_\"] = Computer, [\"Computer\"]=strcat('ðŸ–¥ï¸ ', Computer), State, [\"Environment\"] = iff(ComputerEnvironment == \"Azure\", ComputerEnvironment, Category), [\"OS\"]=iff(isempty(OSName), OSType, OSName), [\"Azure Resource\"]=ResourceId, [\"Time\"]=strcat('ðŸ•’ ', TimeAgo), [\"Heartbeat Trend\"]=Trend, [\"Details\"]=Packed\r\n\r\n",
                          "size": 2,
                          "title": "1. Weekly: Log Analytics Agent check",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ComputerName_",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "State",
                                "formatter": 18,
                                "formatOptions": {
                                  "linkColumn": "Details",
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true,
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Unhealthy",
                                      "representation": "4",
                                      "text": "{0}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}"
                                    }
                                  ]
                                },
                                "tooltipFormat": {
                                  "tooltip": "Click to see details of the last event sent by this computer."
                                }
                              },
                              {
                                "columnMatch": "Environment",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Azure",
                                      "representation": "blue",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "magenta",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Heartbeat Trend",
                                "formatter": 10,
                                "formatOptions": {
                                  "palette": "redGreen"
                                },
                                "tooltipFormat": {
                                  "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                                }
                              },
                              {
                                "columnMatch": "Details",
                                "formatter": 5,
                                "formatOptions": {}
                              },
                              {
                                "columnMatch": "Last Record Received",
                                "formatter": 3,
                                "formatOptions": {
                                  "palette": "coldHot"
                                },
                                "numberFormat": {
                                  "unit": 24,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 3
                                  }
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "Computer",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Time",
                                "label": "Last Heartbeat"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Computer",
                              "sortOrder": 2
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "State",
                              "formatter": 1,
                              "formatOptions": {}
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {},
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "rightContent": {
                              "columnMatch": "State",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": "==",
                                    "thresholdValue": "Unhealthy",
                                    "representation": "4",
                                    "text": ""
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "success",
                                    "text": ""
                                  }
                                ]
                              }
                            },
                            "showBorder": false,
                            "rowLimit": 100
                          }
                        },
                        "name": "query - Heartbeat agent check "
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where \"{Subscription:Id}\" has subscriptionId or \"{Subscription}\" == \"\"\r\n//| where \"{resourceGroup:label}\" contains resourceGroup or \"{resourceGroup}\" == \"\"\r\n| where type has 'microsoft.compute/virtualmachines/extensions' or type has 'microsoft.hybridcompute/machines/extensions'\r\n| where name has 'MicrosoftMonitoringAgent' or name has 'OmsAgentForLinux' \r\n| extend Computer = extract('virtualMachines/(.*)/extensions',1,id) \r\n| summarize count()",
                          "size": 4,
                          "title": "Machines with MMA",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - MMA"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where \"{Subscription:Id}\" has subscriptionId or \"{Subscription}\" == \"\"\r\n| where type has 'microsoft.compute/virtualmachines/extensions' or type has 'microsoft.hybridcompute/machines/extensions'\r\n| where name has 'AzureMonitorWindowsAgent' or name has 'AzureMonitorLinuxAgent' \r\n| extend AzureVM = extract('virtualMachines/(.*)/extensions',1,id), ArcVM = extract('machines/(.*)/extensions',1,id) \r\n| summarize count() by AzureVM, ArcVM, subscriptionId, resourceGroup \r\n| project AzureVM, ArcVM, resourceGroup\r\n| summarize count()",
                          "size": 4,
                          "title": "Machines with AMA",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - AMA"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where \"{Subscription:Id}\" has subscriptionId or \"{Subscription}\" == \"\"\r\n| where type has 'microsoft.compute/virtualmachines/extensions' or  type has 'microsoft.hybridcompute/machines/extensions'\r\n| where name has 'MicrosoftMonitoringAgent' or name has 'OmsAgentForLinux' or name has 'AzureMonitorWindowsAgent' or name has 'AzureMonitorLinuxAgent'\r\n| extend AzureVM = extract('virtualMachines/(.*)/extensions',1,id), ArcVM = extract('machines/(.*)/extensions',1,id)\r\n| summarize count() by AzureVM=tolower(AzureVM), ArcVM=tolower(ArcVM), subscriptionId, resourceGroup \r\n| extend hasBoth = iff(count_ > 1, 'Yes', 'No') | where count_ > 1 \r\n| join (resources | where type has 'microsoft.compute/virtualmachines/extensions' or type has 'microsoft.hybridcompute/machines/extensions'\r\n| where name has 'MicrosoftMonitoringAgent' or name has 'OmsAgentForLinux' \r\n| extend AzureVM = extract('virtualMachines/(.*)/extensions',1,id)) on AzureVM  \r\n| summarize count()",
                          "size": 4,
                          "title": "Machines with Both Agents",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - both AMA & MMA"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where \"{Subscription:Id}\" has subscriptionId or \"{Subscription}\" == \"\"\r\n| where type has 'microsoft.compute/virtualmachines/extensions' or  type has 'microsoft.hybridcompute/machines/extensions'\r\n| where name has 'MicrosoftMonitoringAgent' or name has 'OmsAgentForLinux' or name has 'AzureMonitorWindowsAgent' or name has 'AzureMonitorLinuxAgent'\r\n| extend AzureVM = extract('virtualMachines/(.*)/extensions',1,id), ArcVM = extract('machines/(.*)/extensions',1,id)\r\n| summarize count() by AzureVM=tolower(AzureVM), ArcVM=tolower(ArcVM), subscriptionId, resourceGroup, AgentType=name\r\n| extend hasBoth = iff(count_ > 1, 'Yes', 'No') //| where count_ > 1 \r\n\r\n",
                          "size": 1,
                          "title": "Machines with Both Agents, count: {$rowCount}",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "hasBoth",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "hasBoth",
                              "sortOrder": 2
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 3,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "name": "query - both AMA & MMA - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "agents"
                  },
                  "name": "group - Agents"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "SubGroup: Workbooks",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n | where type == \"microsoft.insights/workbooks\"\r\n | project properties.displayName, properties.timeModified, location, kind,\r\n           resourceGroup, properties.category, properties.serializedData, properties.version,  properties.tags[0] , properties.tags[1] , properties.userId, properties.sourceId\r\n| order by tostring(properties_timeModified) asc",
                          "size": 1,
                          "title": "2. Workbook Check with keyword search ðŸ”, count: {$rowCount}",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "properties_displayName",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "kind",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "properties_serializedData",
                                "formatter": 5
                              }
                            ],
                            "filter": true,
                            "labelSettings": [
                              {
                                "columnId": "properties_displayName",
                                "label": "DisplayName"
                              },
                              {
                                "columnId": "properties_timeModified",
                                "label": "TimeLastModified"
                              },
                              {
                                "columnId": "properties_category",
                                "label": "Category"
                              },
                              {
                                "columnId": "properties_version",
                                "label": "Version"
                              },
                              {
                                "columnId": "properties_tags_0",
                                "label": "Tags"
                              },
                              {
                                "columnId": "properties_tags_1",
                                "label": "Tag1"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "name": "query - workbook - Private"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "workbooks"
                  },
                  "name": "group - workbooks"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "SubGroup: Rules",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "fe3a12f8-7dcf-4cd3-93b8-e2cc504839eb",
                              "version": "KqlParameterItem/1.0",
                              "name": "countRuleTemplates",
                              "type": 1,
                              "description": "used in a Tile later - hidden",
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 12
                            },
                            {
                              "id": "6905ed27-7271-4d75-9402-adf21383f002",
                              "version": "KqlParameterItem/1.0",
                              "name": "countActiveRules",
                              "type": 1,
                              "description": "used in a Tile later - hidden",
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 12
                            },
                            {
                              "id": "6036245c-70ea-448d-9643-8d1c99b97742",
                              "version": "KqlParameterItem/1.0",
                              "name": "huntingQueries",
                              "type": 1,
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/SavedSearches\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value..properties[?(@ == \\\"Hunting Queries\\\")]\",\"columns\":[]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 0
                              },
                              "timeContextFromParameter": "TimeRange",
                              "queryType": 12
                            },
                            {
                              "id": "3e824f1e-1817-448e-aacd-4abd357a2fad",
                              "version": "KqlParameterItem/1.0",
                              "name": "activeRulesUpdatedDate",
                              "type": 1,
                              "description": "used in a Tile later - hidden",
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastMod\"}]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 12
                            },
                            {
                              "id": "91c045fb-d5a1-406c-93d3-dbc92014bec8",
                              "version": "KqlParameterItem/1.0",
                              "name": "countbyCategory",
                              "type": 1,
                              "description": "used in a Tile later - hidden",
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 12
                            },
                            {
                              "id": "b7fa83fb-adc9-4be0-b06e-9f61c41c649e",
                              "version": "KqlParameterItem/1.0",
                              "name": "countByActiveCategory",
                              "type": 1,
                              "description": "used in a Tile later - hidden",
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 12
                            }
                          ],
                          "style": "above",
                          "queryType": 12
                        },
                        "name": "parameters - 27"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "e437111e-7cb9-4295-bd47-522e5b924f6c",
                              "version": "KqlParameterItem/1.0",
                              "name": "RuleByDate",
                              "type": 1,
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup:name}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.createdDateUTC\",\"columnid\":\"createdDateUTC\"}]}}]}",
                              "isHiddenWhenLocked": true,
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 12
                            }
                          ],
                          "style": "pills",
                          "queryType": 12
                        },
                        "name": "parameters - 28"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Use Usage as a common Table that always exists - its data isnt required. \r\nunion isfuzzy=true \r\n(\r\n Usage\r\n | project a = '{countRuleTemplates:value}'\r\n | limit 1\r\n | extend a = split(a,\",\"), name_= \"Available Rule Templates\"\r\n | mv-expand a\r\n | summarize count(), rt=count() by name_\r\n),\r\n(\r\n Usage\r\n | project c = '{countActiveRules:value}', utw = '{activeRulesUpdatedDate:value}'\r\n | limit 1\r\n | extend c = split(c,\",\"), name_= \"Active Rules\", utw = split(utw,\",\")\r\n | mv-expand c, utw\r\n | summarize count(), updateThisWeek = countif(todatetime(utw) between (ago(7d) .. now())), ar=count() by name_\r\n),\r\n(\r\n Usage\r\n | project d = '{huntingQueries:value}'\r\n | limit 1\r\n | extend d = split(trim(@\"[^\\w]+\",d),\",\"), name_= \"Hunting Queries\"\r\n | mv-expand d to typeof(string)\r\n | summarize count() by name_\r\n)\r\n| order by name_ asc\r\n\r\n\r\n\r\n",
                          "size": 4,
                          "title": "3. Rule Statistics",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "tiles",
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "name_"
                            },
                            "leftContent": {
                              "columnMatch": "updateThisWeek",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": ">",
                                    "thresholdValue": "0",
                                    "representation": "up",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Blank",
                                    "text": "{0}{1}"
                                  }
                                ]
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              },
                              "tooltipFormat": {
                                "tooltip": "Updates in last 7days"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - Rule Statistics"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// use a table that exists - Usage was picked but isnt used.\r\nUsage\r\n| project  a = split('{RuleByDate}',\",\")\r\n| limit 1\r\n| mv-expand todynamic(a)\r\n| project b= split(trim(@\"[^\\w]+\",tostring(a)),\"T\").[0]\r\n| summarize count() by todatetime(b)\r\n| order by b asc\r\n| top 10 by b ",
                          "size": 1,
                          "title": "Rule templates vs. created by Date",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "categoricalbar"
                        },
                        "customWidth": "50",
                        "name": "query - Rule template bar chart"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": " Usage\r\n | project a = '{countbyCategory:value}'\r\n | limit 1\r\n | extend a = split(trim(@\"[^\\w]+\",a),\",\") \r\n | mv-expand a\r\n | summarize count() by trim(\" \", tostring(a))\r\n | order by count_ desc",
                          "size": 0,
                          "title": "Rule Templates by Type",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "coldHot"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Column1",
                                "label": "Rule Type"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "name_"
                            },
                            "leftContent": {
                              "columnMatch": "updateThisWeek",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": ">",
                                    "thresholdValue": "0",
                                    "representation": "up",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Blank",
                                    "text": "{0}{1}"
                                  }
                                ]
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              },
                              "tooltipFormat": {
                                "tooltip": "Updates in last 7days"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - Rule templates by Type"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": " Usage\r\n | project a = '{countByActiveCategory:value}'\r\n | limit 1\r\n | extend a = split(trim(@\"[^\\w]+\",a),\",\") \r\n | mv-expand a\r\n | summarize count() by trim(\" \", tostring(a))\r\n | order by count_ desc",
                          "size": 0,
                          "title": "3.Active Rules by Type",
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "count_",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "coldHot"
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "Column1",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Column1",
                                "label": "Rule type"
                              },
                              {
                                "columnId": "count_",
                                "label": "Count"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Column1",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              }
                            },
                            "subtitleContent": {
                              "columnMatch": "name_"
                            },
                            "leftContent": {
                              "columnMatch": "updateThisWeek",
                              "formatter": 18,
                              "formatOptions": {
                                "thresholdsOptions": "icons",
                                "thresholdsGrid": [
                                  {
                                    "operator": ">",
                                    "thresholdValue": "0",
                                    "representation": "up",
                                    "text": "{0}{1}"
                                  },
                                  {
                                    "operator": "Default",
                                    "thresholdValue": null,
                                    "representation": "Blank",
                                    "text": "{0}{1}"
                                  }
                                ]
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              },
                              "tooltipFormat": {
                                "tooltip": "Updates in last 7days"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 28 - Copy - Copy"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "e3d05f38-33a6-4718-9a3a-d16b2629b094",
                              "version": "KqlParameterItem/1.0",
                              "name": "showRules",
                              "label": "Show Rules",
                              "type": 10,
                              "description": "Enables you to see ALL or SelectRule Types to show",
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n { \"value\": \"all\", \"label\": \"Show All\", \"selected\":true },\r\n { \"value\": \"filter\", \"label\": \"Filtered View\" }\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 15"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Filtered View",
                          "items": [
                            {
                              "type": 9,
                              "content": {
                                "version": "KqlParameterItem/1.0",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "parameters": [
                                  {
                                    "id": "3d9b40a8-fd74-482c-b482-0d90c89abd28",
                                    "version": "KqlParameterItem/1.0",
                                    "name": "selectRuleType",
                                    "type": 2,
                                    "description": "Select the Rule Type ",
                                    "isRequired": true,
                                    "query": " Usage\r\n | project a = '{countbyCategory:value}'\r\n | limit 1\r\n | extend a = split(trim(@\"[^\\w]+\",a),\",\") \r\n | mv-expand a\r\n | distinct tostring(a)\r\n | project a = trim(\" \",a)\r\n | distinct a\r\n | project  value=strcat(\"@.kind=='\",a,\"'\") ,display=a, selected=iif(a=='Scheduled',true,false)\r\n | order by display asc\r\n",
                                    "crossComponentResources": [
                                      "{Workspace}"
                                    ],
                                    "typeSettings": {
                                      "additionalResourceOptions": [],
                                      "showDefault": false
                                    },
                                    "timeContext": {
                                      "durationMs": 0
                                    },
                                    "timeContextFromParameter": "TimeRange",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  }
                                ],
                                "style": "above",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces"
                              },
                              "name": "parameters - 38"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?({selectRuleType})]\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.status\",\"columnid\":\"status\"},{\"path\":\"properties.createdDateUTC\",\"columnid\":\"createdDateUTC\"},{\"path\":\"properties.lastUpdatedDateUTC\",\"columnid\":\"lastUpdatedDateUTC\"},{\"path\":\"properties.requiredDataConnectors\",\"columnid\":\"requiredDataConnectors\"},{\"path\":\"properties.productFilter\",\"columnid\":\"productFilter\"},{\"path\":\"properties.requiredDataConnectors[:1].connectorId\",\"columnid\":\"connectorName\"},{\"path\":\"properties.requiredDataConnectors[*].dataTypes[0]\",\"columnid\":\"connectorTable\"},{\"path\":\"properties.query\",\"columnid\":\"queryText\"}]}}]}",
                                "size": 1,
                                "title": "3. Rule Templates via Rest API. {selectRuleType}, count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 12,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "requiredDataConnectors",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "Data Connectors",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal",
                                          "useGrouping": false
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "resourcegroup",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    }
                                  ],
                                  "rowLimit": 500,
                                  "filter": true
                                },
                                "sortBy": []
                              },
                              "showPin": false,
                              "name": "query - 21 - Rules"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?({selectRuleType})]\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.enabled\",\"columnid\":\"status\"},{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastModifiedUtc\"},{\"path\":\"properties.queryFrequency\",\"columnid\":\"queryFrequency\"},{\"path\":\"properties.queryPeriod\",\"columnid\":\"queryPeriod\"},{\"path\":\"properties.productFilter\",\"columnid\":\"productFilter\"},{\"path\":\"properties.tactics\",\"columnid\":\"tactics\"},{\"path\":\"properties.techniques\",\"columnid\":\"techniques\"},{\"path\":\"properties.query\",\"columnid\":\"queryText\"},{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"properties\",\"columnid\":\"propertiesAll\"}]}}]}",
                                "size": 1,
                                "title": "3a. Active Rules via Rest API. {selectRuleType}, count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 12,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "kind",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "status",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "false",
                                            "representation": "disabled",
                                            "text": "Disabled"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "Enabled"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "tactics",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "resourcegroup",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    }
                                  ],
                                  "filter": true,
                                  "sortBy": [
                                    {
                                      "itemKey": "queryFrequency",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "queryFrequency",
                                    "sortOrder": 2
                                  }
                                ]
                              },
                              "showPin": false,
                              "name": "query - 21 - Rules in use "
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8c021a32-814f-445a-8f20-55847f6750c2\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 21 - Rules\",\"rightTable\":\"query - 21 - Rules in use \",\"leftColumn\":\"displayName\",\"rightColumn\":\"displayName\"}],\"projectRename\":[{\"originalName\":\"[query - 21 - Rules].displayName\",\"mergedName\":\"displayName\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].kind\",\"mergedName\":\"kind\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].status\",\"mergedName\":\"status\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].createdDateUTC\",\"mergedName\":\"createdDateUTC\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].lastUpdatedDateUTC\",\"mergedName\":\"lastUpdatedDateUTC\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].queryText\",\"mergedName\":\"queryText\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].lastModifiedUtc\",\"mergedName\":\"lastModifiedUtc\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].queryText\",\"mergedName\":\"queryText1\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"MismatchedQuery\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"queryText\",\"operator\":\"!=\",\"rightValType\":\"column\",\"rightVal\":\"queryText1\",\"resultValType\":\"static\",\"resultVal\":\"Query Text is different\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - 21 - Rules in use ].name\",\"mergedName\":\"name\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].techniques\",\"mergedName\":\"techniques\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].queryFrequency\",\"mergedName\":\"queryFrequency\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].queryPeriod\",\"mergedName\":\"queryPeriod\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].propertiesAll\",\"mergedName\":\"propertiesAll\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].displayName\"},{\"originalName\":\"[query - 21 - Rules in use ].kind\"},{\"originalName\":\"[query - 21 - Rules in use ].status\"},{\"originalName\":\"[query - 21 - Rules in use ].productFilter\"},{\"originalName\":\"[query - 21 - Rules in use ].tactics\"},{\"originalName\":\"[query - 21 - Rules].requiredDataConnectors\"},{\"originalName\":\"[query - 21 - Rules].productFilter\"},{\"originalName\":\"[query - 21 - Rules].connectorName\"},{\"originalName\":\"[query - 21 - Rules].connectorTable\"}]}",
                                "size": 0,
                                "title": "3a. Compare Deployed Rules to Rules api.  Count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "kind",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText1",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "MismatchedQuery",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "startsWith",
                                            "thresholdValue": "Query",
                                            "representation": "pink",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "rowLimit": 500,
                                  "filter": true,
                                  "sortBy": [
                                    {
                                      "itemKey": "lastModifiedUtc",
                                      "sortOrder": 2
                                    }
                                  ],
                                  "labelSettings": [
                                    {
                                      "columnId": "lastModifiedUtc",
                                      "label": "Rule in Use - LastModifiedUTC"
                                    },
                                    {
                                      "columnId": "queryText1",
                                      "label": "Rule in Use - QueryText"
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "lastModifiedUtc",
                                    "sortOrder": 2
                                  }
                                ]
                              },
                              "showPin": false,
                              "name": "query - 30 merge Rules"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "showRules",
                          "comparison": "isEqualTo",
                          "value": "filter"
                        },
                        "name": "group - Filtered Rules"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "View All Rules",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRuleTemplates\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.status\",\"columnid\":\"status\"},{\"path\":\"properties.createdDateUTC\",\"columnid\":\"createdDateUTC\"},{\"path\":\"properties.lastUpdatedDateUTC\",\"columnid\":\"lastUpdatedDateUTC\"},{\"path\":\"properties.requiredDataConnectors\",\"columnid\":\"requiredDataConnectors\"},{\"path\":\"properties.productFilter\",\"columnid\":\"productFilter\"},{\"path\":\"properties.requiredDataConnectors[:1].connectorId\",\"columnid\":\"connectorName\"},{\"path\":\"properties.requiredDataConnectors[*].dataTypes[0]\",\"columnid\":\"connectorTable\"},{\"path\":\"properties.query\",\"columnid\":\"queryText\"}]}}]}",
                                "size": 1,
                                "title": "3. Rule Templates via Rest API. count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 12,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "requiredDataConnectors",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkLabel": "Data Connectors",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal",
                                          "useGrouping": false
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "resourcegroup",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    }
                                  ],
                                  "rowLimit": 500,
                                  "filter": true
                                },
                                "sortBy": []
                              },
                              "showPin": false,
                              "name": "query - 21 - Rules"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-11-01\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.description\",\"columnid\":\"description\"},{\"path\":\"properties.severity\",\"columnid\":\"severity\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"properties.enabled\",\"columnid\":\"status\"},{\"path\":\"properties.lastModifiedUtc\",\"columnid\":\"lastModifiedUtc\"},{\"path\":\"properties.queryFrequency\",\"columnid\":\"queryFrequency\"},{\"path\":\"properties.queryPeriod\",\"columnid\":\"queryPeriod\"},{\"path\":\"properties.productFilter\",\"columnid\":\"productFilter\"},{\"path\":\"properties.tactics\",\"columnid\":\"tactics\"},{\"path\":\"properties.techniques\",\"columnid\":\"techniques\"},{\"path\":\"properties.query\",\"columnid\":\"queryText\"},{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"properties.alertRuleTemplateName\",\"columnid\":\"templateId\"}]}}]}",
                                "size": 1,
                                "title": "3a. Active Rules via Rest API. count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 12,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "kind",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "status",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "false",
                                            "representation": "disabled",
                                            "text": "Disabled"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "Enabled"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "tactics",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "resourcegroup",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    }
                                  ],
                                  "filter": true,
                                  "sortBy": [
                                    {
                                      "itemKey": "productFilter",
                                      "sortOrder": 1
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "productFilter",
                                    "sortOrder": 1
                                  }
                                ]
                              },
                              "showPin": false,
                              "name": "query - 21 - Rules in use "
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8c021a32-814f-445a-8f20-55847f6750c2\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 21 - Rules\",\"rightTable\":\"query - 21 - Rules in use \",\"leftColumn\":\"displayName\",\"rightColumn\":\"displayName\"}],\"projectRename\":[{\"originalName\":\"[query - 21 - Rules].displayName\",\"mergedName\":\"displayName\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].kind\",\"mergedName\":\"kind\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].status\",\"mergedName\":\"status\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"MismatchedQuery\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"queryText\",\"operator\":\"!=\",\"rightValType\":\"column\",\"rightVal\":\"queryText1\",\"resultValType\":\"static\",\"resultVal\":\"Query Text is different\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - 21 - Rules].createdDateUTC\",\"mergedName\":\"createdDateUTC\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].lastUpdatedDateUTC\",\"mergedName\":\"lastUpdatedDateUTC\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules].queryText\",\"mergedName\":\"queryText\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].lastModifiedUtc\",\"mergedName\":\"lastModifiedUtc\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].queryText\",\"mergedName\":\"queryText1\",\"fromId\":\"8c021a32-814f-445a-8f20-55847f6750c2\"},{\"originalName\":\"[query - 21 - Rules in use ].name\",\"mergedName\":\"name\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].techniques\",\"mergedName\":\"techniques\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].queryFrequency\",\"mergedName\":\"queryFrequency\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].queryPeriod\",\"mergedName\":\"queryPeriod\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].templateId\",\"mergedName\":\"templateId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 21 - Rules in use ].displayName\"},{\"originalName\":\"[query - 21 - Rules in use ].kind\"},{\"originalName\":\"[query - 21 - Rules in use ].status\"},{\"originalName\":\"[query - 21 - Rules in use ].productFilter\"},{\"originalName\":\"[query - 21 - Rules in use ].tactics\"},{\"originalName\":\"[query - 21 - Rules].requiredDataConnectors\"},{\"originalName\":\"[query - 21 - Rules].productFilter\"},{\"originalName\":\"[query - 21 - Rules].connectorName\"},{\"originalName\":\"[query - 21 - Rules].connectorTable\"}]}",
                                "size": 0,
                                "title": "3a. Compare the deployed Rule to the original Rules from the Sentinel Github. Look for \"mismatched Query\" if the query text differs. Count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "kind",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText1",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "MismatchedQuery",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "startsWith",
                                            "thresholdValue": "Query",
                                            "representation": "pink",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "rowLimit": 500,
                                  "filter": true,
                                  "labelSettings": [
                                    {
                                      "columnId": "lastModifiedUtc",
                                      "label": "Rule in Use - LastModifiedUTC"
                                    },
                                    {
                                      "columnId": "queryText1",
                                      "label": "Rule in Use - QueryText"
                                    }
                                  ]
                                },
                                "sortBy": []
                              },
                              "showPin": false,
                              "name": "query - 30 merge Rules"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/AlertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.description\",\"columnid\":\"description\"},{\"path\":\"properties.queryFrequency\",\"columnid\":\"queryFrequency\"},{\"path\":\"properties.queryPeriod\",\"columnid\":\"queryPeriod\"},{\"path\":\"properties.triggerOperator\",\"columnid\":\"triggerOperator\"},{\"path\":\"properties.triggerThreshold\",\"columnid\":\"triggerThreshold\"},{\"path\":\"properties.eventGroupingSettings.aggregationKind\",\"columnid\":\"eventGroupingSettings\"},{\"path\":\"properties.severity\",\"columnid\":\"severity\"},{\"path\":\"properties.query\",\"columnid\":\"query\"},{\"path\":\"properties.suppresionDuration\",\"columnid\":\"suppresionDuration\"},{\"path\":\"properties.suppresionEnabled\",\"columnid\":\"suppresionEnabled\"},{\"path\":\"properties.incidentConfiguration\",\"columnid\":\"incidentConfiguration\"},{\"path\":\"properties.entityMappings\",\"columnid\":\"entityMappings\"},{\"path\":\"properties.tactics\",\"columnid\":\"tactics\"},{\"path\":\"properties.techniques\",\"columnid\":\"techniques\"},{\"path\":\"properties.enabled\",\"columnid\":\"enabled\"}]}}]}",
                                "size": 1,
                                "title": "Active Rules - showing Frequency, Triggers and Grouping. count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 12,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "triggerThreshold",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "palette": "whiteBlack"
                                      }
                                    },
                                    {
                                      "columnMatch": "eventGroupingSettings",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "severity",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Medium",
                                            "representation": "Sev2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Low",
                                            "representation": "Sev3",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Informational",
                                            "representation": "Sev4",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "High",
                                            "representation": "Sev1",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "Blank",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "entityMappings",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "tactics",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "kind",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "status",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "false",
                                            "representation": "disabled",
                                            "text": "Disabled"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "Enabled"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "resourcegroup",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "filter": true,
                                  "sortBy": [
                                    {
                                      "itemKey": "techniques",
                                      "sortOrder": 2
                                    }
                                  ]
                                },
                                "sortBy": [
                                  {
                                    "itemKey": "techniques",
                                    "sortOrder": 2
                                  }
                                ]
                              },
                              "showPin": false,
                              "name": "query - 21 - Rules in use  - by settings"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/SavedSearches\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"},{\"key\":\"$orderby\",\"value\":\"properties/createdDateUTC desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.category == \\\"Hunting Queries\\\")]\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.query\",\"columnid\":\"query\"},{\"path\":\"properties.tags\",\"columnid\":\"tags\"},{\"path\":\"properties.version\",\"columnid\":\"version\"},{\"path\":\"id\",\"columnid\":\"id_\"},{\"path\":\"etag\",\"columnid\":\"etag\"}]}}]}",
                                "size": 1,
                                "title": "Active Hunting Rules - showing all Data. count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 12,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "tags",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "id",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "triggerThreshold",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "palette": "whiteBlack"
                                      }
                                    },
                                    {
                                      "columnMatch": "eventGroupingSettings",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      },
                                      "numberFormat": {
                                        "unit": 0,
                                        "options": {
                                          "style": "decimal"
                                        }
                                      }
                                    },
                                    {
                                      "columnMatch": "severity",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Medium",
                                            "representation": "Sev2",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Low",
                                            "representation": "Sev3",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "Informational",
                                            "representation": "Sev4",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "==",
                                            "thresholdValue": "High",
                                            "representation": "Sev1",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "Blank",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "entityMappings",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "tactics",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "kind",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "status",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "==",
                                            "thresholdValue": "false",
                                            "representation": "disabled",
                                            "text": "Disabled"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "success",
                                            "text": "Enabled"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "queryText",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "resourcegroup",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "filter": true
                                },
                                "sortBy": []
                              },
                              "showPin": false,
                              "name": "query - 21 - Rules in use  - Hunting "
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "AzureActivity \r\n| where OperationNameValue startswith \"MICROSOFT.SECURITYINSIGHTS/ALERTRULES\" or OperationNameValue startswith 'Microsoft.SecurityInsights/automationRules'\r\n| summarize count(), arg_max(TimeGenerated, OperationName, Caller, CallerIpAddress, Category, Level, Resource) by OperationName, Caller, CallerIpAddress, Category, Level, Resource, Properties\r\n| order by TimeGenerated desc\r\n",
                                "size": 1,
                                "title": "3a. Audit of Rules in AzureActivity - Detailed, count: {$rowCount}",
                                "timeContextFromParameter": "TimeRange",
                                "exportFieldName": "Resource",
                                "exportParameterName": "exportResource",
                                "showExportToExcel": true,
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{Workspace}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "OperationName",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "startsWith",
                                            "thresholdValue": "Update",
                                            "representation": "orange",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "startsWith",
                                            "thresholdValue": "Delete",
                                            "representation": "redBright",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "Properties",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    },
                                    {
                                      "columnMatch": "count_",
                                      "formatter": 8,
                                      "formatOptions": {
                                        "palette": "greenRed"
                                      }
                                    }
                                  ],
                                  "filter": true
                                }
                              },
                              "conditionalVisibility": {
                                "parameterName": "hide",
                                "comparison": "isEqualTo",
                                "value": "hide"
                              },
                              "name": "query - 31 - AuditRules All"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 21 - Rules in use \",\"rightTable\":\"query - 31 - AuditRules All\",\"leftColumn\":\"name\",\"rightColumn\":\"Resource\"}],\"projectRename\":[{\"originalName\":\"[query - 21 - Rules in use ].displayName\",\"mergedName\":\"displayName\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].kind\",\"mergedName\":\"kind\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].OperationName\",\"mergedName\":\"OperationName\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].Caller\",\"mergedName\":\"Caller\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].lastModifiedUtc\",\"mergedName\":\"lastModifiedUtc\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].queryFrequency\",\"mergedName\":\"queryFrequency\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].queryPeriod\",\"mergedName\":\"queryPeriod\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].productFilter\",\"mergedName\":\"productFilter\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].tactics\",\"mergedName\":\"tactics\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].status\",\"mergedName\":\"status\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].techniques\",\"mergedName\":\"techniques\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].queryText\",\"mergedName\":\"queryText\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].name\",\"mergedName\":\"name\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 21 - Rules in use ].templateId\",\"mergedName\":\"templateId\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].CallerIpAddress\",\"mergedName\":\"CallerIpAddress\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].Category\",\"mergedName\":\"Category\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].Level\",\"mergedName\":\"Level\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].Resource\",\"mergedName\":\"Resource\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].Properties\",\"mergedName\":\"Properties\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].count_\",\"mergedName\":\"count_\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].TimeGenerated\",\"mergedName\":\"TimeGenerated\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].Resource1\",\"mergedName\":\"Resource1\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c7da\"},{\"originalName\":\"[query - 31 - AuditRules All].OperationName1\"},{\"originalName\":\"[query - 31 - AuditRules All].Caller1\"},{\"originalName\":\"[query - 31 - AuditRules All].CallerIpAddress1\"},{\"originalName\":\"[query - 31 - AuditRules All].Category1\"},{\"originalName\":\"[query - 31 - AuditRules All].Level1\"}]}",
                                "size": 0,
                                "title": "Audit of Active Rules vs. AzureActivity Table activity, count: {$rowCount}",
                                "showExportToExcel": true,
                                "queryType": 7,
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "OperationName",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "orange",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "Caller",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "gray",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "Properties",
                                      "formatter": 7,
                                      "formatOptions": {
                                        "linkTarget": "CellDetails",
                                        "linkIsContextBlade": true
                                      }
                                    }
                                  ],
                                  "filter": true
                                }
                              },
                              "showPin": false,
                              "name": "query - active rules vs activity table"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "showRules",
                          "comparison": "isEqualTo",
                          "value": "all"
                        },
                        "name": "group -All Rules"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "AzureActivity \r\n| where OperationNameValue startswith \"MICROSOFT.SECURITYINSIGHTS/ALERTRULES\" or OperationNameValue startswith 'Microsoft.SecurityInsights/automationRules'\r\n| summarize count(), arg_max(TimeGenerated, OperationName, Caller, CallerIpAddress, Category, Level, Resource) by OperationName//, Caller, CallerIpAddress, Category, Level, Resource\r\n| order by TimeGenerated desc\r\n",
                          "size": 4,
                          "title": "3a. Audit of Rules in AzureActivity, count: {$rowCount}",
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "piechart",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "OperationName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "startsWith",
                                      "thresholdValue": "Update",
                                      "representation": "orange",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "startsWith",
                                      "thresholdValue": "Delete",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "count_",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "greenRed"
                                }
                              }
                            ],
                            "filter": true
                          }
                        },
                        "name": "query - 31"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/automationRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-01-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.triggeringLogic.isEnabled\",\"columnid\":\"IsEnabled\"},{\"path\":\"name\",\"columnid\":\"nameGUID\"},{\"path\":\"properties.order\",\"columnid\":\"order\"},{\"path\":\"properties.createdTimeUtc\",\"columnid\":\"createdTimeUtc\"},{\"path\":\"properties.lastModifiedTimeUtc\",\"columnid\":\"lastlastModifiedTimeUtc\"},{\"path\":\"properties.createdBy.userPrincipalName\",\"columnid\":\"createdBy\"},{\"path\":\"properties.lastModifiedBy.name\",\"columnid\":\"lastModifiedBy\"},{\"path\":\"properties.triggeringLogic\",\"columnid\":\"triggeringLogic\"},{\"path\":\"properties.createdBy\",\"columnid\":\"propertiesCreatedBy\"},{\"path\":\"properties.lastModifiedBy\",\"columnid\":\"propertiesLastModifiedBy\"}]}}]}",
                          "size": 1,
                          "title": "3. automationRules via Rest API",
                          "exportFieldName": "nameGUID",
                          "exportParameterName": "exportNameGUID",
                          "showExportToExcel": true,
                          "queryType": 12,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "IsEnabled",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "!=",
                                      "thresholdValue": "true",
                                      "representation": "disabled",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "true{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "requiredDataConnectors",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkLabel": "Data Connectors",
                                  "linkIsContextBlade": true
                                }
                              },
                              {
                                "columnMatch": "queryText",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  }
                                }
                              },
                              {
                                "columnMatch": "resourcegroup",
                                "formatter": 14,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "id",
                                "formatter": 5
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "name": "query - 21 - automationRules"
                      },
                      {
                        "type": 11,
                        "content": {
                          "version": "LinkItem/1.0",
                          "style": "list",
                          "links": [
                            {
                              "id": "c1f77487-5aee-4f0d-a16b-4ca6de161272",
                              "cellValue": "https://github.com/Azure/Azure-Sentinel/tree/master/Detections",
                              "linkTarget": "Url",
                              "linkLabel": "https://github.com/Azure/Azure-Sentinel/tree/master/",
                              "preText": "3. GitHub Alert Rules, Workbooks, Hunting queries, and Playbooks",
                              "style": "link"
                            }
                          ]
                        },
                        "name": "links - 47 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "rules"
                  },
                  "name": "group - rules"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.Logic/workflows/\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-05-01\"},{\"key\":\"$orderby\",\"value\":\"createdTime desc\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"location\",\"columnid\":\"location\"},{\"path\":\"properties.provisioningState\",\"columnid\":\"provisioningState\"},{\"path\":\"properties.createdTime\",\"columnid\":\"createdTimeUTC\"},{\"path\":\"properties.changedTime\",\"columnid\":\"changedTimeUTC\"},{\"path\":\"properties\",\"columnid\":\"properties\"},{\"path\":\"properties.state\",\"columnid\":\"Enabled\"}]}}]}",
                    "size": 1,
                    "title": "3b. Playbooks via Rest API",
                    "showExportToExcel": true,
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Enabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Disabled",
                                "representation": "disabled",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "state",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "!=",
                                "thresholdValue": "Succeeded",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "resourcegroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "playbooks"
                  },
                  "name": "query - Playbooks"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "SubGroup: Retention",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"TableName\"},{\"path\":\"$.properties.schema.tableType\",\"columnid\":\"TableType\"},{\"path\":\"$.properties.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.properties.retentionInDays\",\"columnid\":\"TableInteractivePeriod\"},{\"path\":\"$.properties.archiveRetentionInDays\",\"columnid\":\"TableArchivePeriod\"},{\"path\":\"$.properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"},{\"path\":\"$.properties.lastPlanModifiedDate\",\"columnid\":\"lastPlanModifiedDate\",\"columnType\":\"datetime\"}]}}]}",
                          "size": 4,
                          "title": "Retention settings for All Tables",
                          "showRefreshButton": true,
                          "queryType": 12,
                          "visualization": "table",
                          "gridSettings": {
                            "rowLimit": 1000,
                            "sortBy": [
                              {
                                "itemKey": "TableInteractivePeriod",
                                "sortOrder": 1
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "TableInteractivePeriod",
                              "sortOrder": 1
                            }
                          ],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "TablePlan",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "TableInteractivePeriod",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "ShowHiddenObjects",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "TableRetentionQuery"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Usage\r\n| summarize arg_max(TimeGenerated, *), size = sum(Quantity) / 1000 by DataType\r\n| project\r\n    ['Table'] = DataType,\r\n    ['Table Size'] = size,\r\n    IsBillable\r\n| order by Table asc",
                          "size": 0,
                          "title": "Tables Found in the {WorkspaceName} workspace",
                          "timeContextFromParameter": "TimeRange",
                          "exportFieldName": "DataType",
                          "exportParameterName": "DataType",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Table Size",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 39,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Estimated Ingestion Cost",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Esitmated Workspace Retention Cost",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Estimated Data Archive Cost",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "IsBillable",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "IsBillable",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "ShowHiddenObjects",
                          "comparison": "isEqualTo",
                          "value": "Yes"
                        },
                        "name": "LAWTableQuery"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\",\"mergeType\":\"inner\",\"leftTable\":\"TableRetentionQuery\",\"rightTable\":\"LAWTableQuery\",\"leftColumn\":\"TableName\",\"rightColumn\":\"Table\"}],\"projectRename\":[{\"originalName\":\"[TableRetentionQuery].TableName\",\"mergedName\":\"TableName\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TableType\",\"mergedName\":\"TableType\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TablePlan\",\"mergedName\":\"TablePlan\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TableInteractivePeriod\",\"mergedName\":\"InteractiveRetention\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TableArchivePeriod\",\"mergedName\":\"ArchiveRetention\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TotalRetentionPeriod\",\"mergedName\":\"TotalRetention\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[LAWTableQuery].Table Size\",\"mergedName\":\"LAW Table Size\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].lastPlanModifiedDate\",\"mergedName\":\"lastPlanModifiedDate\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Is Archived\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"ArchiveRetention\",\"operator\":\">\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"static\",\"resultVal\":\"Yes\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"No\"}}]},{\"originalName\":\"[LAWTableQuery].IsBillable\",\"mergedName\":\"IsBillable\",\"fromId\":\"unknown\"},{\"originalName\":\"[LAWTableQuery].DataType\"},{\"originalName\":\"[LAWTableQuery].Table\"},{\"originalName\":\"[LAWTableQuery].size\"},{\"originalName\":\"[LAWTableQuery].Estimated Data Archive Cost\"},{\"originalName\":\"[LAWTableQuery].Estimated Ingestion Cost\"},{\"originalName\":\"[LAWTableQuery].Esitmated Workspace Retention Cost\"}]}",
                          "size": 1,
                          "title": "Table details, count: {$rowCount}",
                          "noDataMessage": "It appears your workspace doesn't currently have any tables that support Basic Plans or there are not any archived tables.",
                          "showRefreshButton": true,
                          "exportedParameters": [
                            {
                              "fieldName": "TableName",
                              "parameterName": "TableName",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "TablePlan",
                              "parameterName": "TablePlan",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "InteractiveRetention",
                              "parameterName": "InteractiveRetention",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "ArchiveRetention",
                              "parameterName": "ArchiveRetention",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "TotalRetention",
                              "parameterName": "TotalRetention",
                              "parameterType": 1
                            },
                            {
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "TableName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "35.2857ch"
                                }
                              },
                              {
                                "columnMatch": "TableType",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15.8571ch"
                                }
                              },
                              {
                                "columnMatch": "TablePlan",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "15ch"
                                }
                              },
                              {
                                "columnMatch": "InteractiveRetention",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "ArchiveRetention",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 2555,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "20.8571ch"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "TotalRetention",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 90,
                                  "max": 2555,
                                  "palette": "turquoise",
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": [
                                      {
                                        "columnName": "Is Archived",
                                        "color": "blue"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "18.2857ch"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "LAW Table Size",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                },
                                "numberFormat": {
                                  "unit": 39,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "lastPlanModifiedDate",
                                "formatter": 6,
                                "formatOptions": {
                                  "customColumnWidthSetting": "33.1429ch"
                                }
                              },
                              {
                                "columnMatch": "Is Archived",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Yes",
                                      "representation": "Clock",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "IsBillable",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "16ch"
                                }
                              },
                              {
                                "columnMatch": "TableInteractivePeriod",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "26.5714ch"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "TableArchivePeriod",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "24ch"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "TotalRetentionPeriod",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "{workspaceRetention}",
                                      "representation": "yellow",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": null,
                                      "text": "{0}{1}"
                                    }
                                  ],
                                  "customColumnWidthSetting": "23.4286ch"
                                },
                                "numberFormat": {
                                  "unit": 27,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Table Size",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                },
                                "numberFormat": {
                                  "unit": 39,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Estimated Ingestion Cost",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Esitmated Workspace Retention Cost",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              },
                              {
                                "columnMatch": "Estimated Data Archive Cost",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              },
                              {
                                "columnMatch": "TableSize",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "SizeUnit",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "14ch"
                                }
                              },
                              {
                                "columnMatch": "Last Updated Time",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "26ch"
                                }
                              }
                            ],
                            "rowLimit": 10000,
                            "filter": true,
                            "sortBy": [
                              {
                                "itemKey": "$gen_thresholds_Is Archived_8",
                                "sortOrder": 2
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_thresholds_Is Archived_8",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "name": "query -Table Details "
                      }
                    ],
                    "exportParameters": true
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "retention"
                  },
                  "name": "Retention"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "SubGroup: Content Hub Solutions",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/metadata\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$..value\",\"columns\":[{\"path\":\"properties.source.name\",\"columnid\":\"friendlyName\"},{\"path\":\"type\",\"columnid\":\"type\"},{\"path\":\"properties.dependencies.criteria\",\"columnid\":\"dependencies\"},{\"path\":\"properties.firstPublishDate\",\"columnid\":\"firstPublished\"},{\"path\":\"properties.lastPublishDate\",\"columnid\":\"lastPublished\"},{\"path\":\"systemData.createdAt\",\"columnid\":\"createdAt\"},{\"path\":\"systemData.createdBy\",\"columnid\":\"createdBy\"},{\"path\":\"systemData.lastModifiedAt\",\"columnid\":\"lastModifiedAt\"},{\"path\":\"systemData.lastModifiedBy\",\"columnid\":\"lastModifiedBy\"},{\"path\":\"systemData\",\"columnid\":\"systemData\"},{\"path\":\"properties\",\"columnid\":\"properties\"},{\"path\":\"name\",\"columnid\":\"name\"}]}}]}",
                          "size": 1,
                          "title": "Content Hub, Solutions deployed. count: {$rowCount}",
                          "showExportToExcel": true,
                          "queryType": 12,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "dependencies",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true
                                }
                              },
                              {
                                "columnMatch": "triggerThreshold",
                                "formatter": 8,
                                "formatOptions": {
                                  "palette": "whiteBlack"
                                }
                              },
                              {
                                "columnMatch": "eventGroupingSettings",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  }
                                }
                              },
                              {
                                "columnMatch": "severity",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Medium",
                                      "representation": "Sev2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Low",
                                      "representation": "Sev3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Informational",
                                      "representation": "Sev4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "High",
                                      "representation": "Sev1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "id",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "entityMappings",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true
                                }
                              },
                              {
                                "columnMatch": "tactics",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true
                                }
                              },
                              {
                                "columnMatch": "kind",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "gray",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "status",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "false",
                                      "representation": "disabled",
                                      "text": "Disabled"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "Enabled"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "queryText",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true
                                }
                              },
                              {
                                "columnMatch": "resourcegroup",
                                "formatter": 14,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ],
                            "filter": true
                          },
                          "sortBy": []
                        },
                        "showPin": false,
                        "name": "query - Solutions"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "content"
                  },
                  "name": "group - content hub"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "Weekly"
            },
            "name": "group - weekly",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Group: Monthly",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "Monthly Operational Tasks\t\r\n1. Log Analytics Agent\r\nEnsure the agent is up-to-date and auto-upgrades are working. For those not auto upgraded, perform a manual update.\r\n2. Log Analytics Workspace\t\r\nReview that your Log Analytics Workspace retention policy still aligns with your current configuration. Run the Data Usage queries to help maintain costs and retention determinations.\r\n3. Ad-hoc: \tAccess review\r\nHas your SOC team changed? Review RBAC and IAM to verify those that need access have proper access â€“ and those accounts no longer needing access are removed.\r\n4. Ad-hoc: \tReview workspace locations\r\nAre your workspaces in the right Regions, or are there any new ones?\t\r\n\t",
                    "style": "success"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "text - 46 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/microsoft.insights/myworkbooks\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-02-12\"},{\"key\":\"$orderby\",\"value\":\"properties/timeModified desc\"},{\"key\":\"$top\",\"value\":\"10\"},{\"key\":\"\",\"value\":\"\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"properties.displayName\",\"columnid\":\"WorkbookName\"},{\"path\":\"properties.timeModified\",\"columnid\":\"TimeModified\"},{\"path\":\"location\",\"columnid\":\"Location\"},{\"path\":\"id\",\"columnid\":\"resourceGroup\"}]}}]}",
                    "size": 4,
                    "title": "Top 10: Shared and Private Workbooks",
                    "queryType": 12,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TimeModified",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeModified",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "SelectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Weekly"
                    },
                    {
                      "parameterName": "SelectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "query - 17"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| summarize dcount(Computer) by Version",
                    "size": 1,
                    "title": "1. Monthly: Agent Check by version",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "id",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null
                          }
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null
                          }
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 1,
                          "formatOptions": {
                            "linkColumn": "Status",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "linkColumn": "Details",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true,
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "4",
                                "text": "{0}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}"
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "Click to see details of the last event sent by this computer."
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          },
                          "tooltipFormat": {
                            "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "State",
                        "formatter": 1,
                        "formatOptions": {}
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {},
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "State",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Unhealthy",
                              "representation": "4",
                              "text": ""
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "showBorder": false,
                      "rowLimit": 100
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "MonthlyAgentCheck"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Heartbeat\r\n| summarize make_set(Version) by Computer\r\n| extend a = array_length(set_Version)\r\n| where a > 1\r\n| order by a desc, Computer asc\r\n\r\n",
                    "size": 1,
                    "title": "1. Monthly: Agent Check - version change detected",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "a",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "dcount_Version",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "greenRed"
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null
                          }
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null
                          }
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 1,
                          "formatOptions": {
                            "linkColumn": "Status",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "linkColumn": "Details",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true,
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "4",
                                "text": "{0}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}"
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "Click to see details of the last event sent by this computer."
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          },
                          "tooltipFormat": {
                            "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "set_Version",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "set_Version",
                          "label": "Agent version"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "set_Version",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "State",
                        "formatter": 1,
                        "formatOptions": {}
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {},
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "State",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Unhealthy",
                              "representation": "4",
                              "text": ""
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "showBorder": false,
                      "rowLimit": 100
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "MonthlyAgentCheck - Copy"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "916bd214-247c-4204-9e72-6e456e5c1049",
                        "cellValue": "\"\"",
                        "linkTarget": "GenericDetails",
                        "linkLabel": "{Workspace:label}",
                        "preText": "2. Log Analytics Workspace",
                        "postText": "please check the [Workspace Info] tab in this Workbook",
                        "style": "link",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "6ff3da41-03ac-42dc-a534-6f2395409e6b",
                        "cellValue": "\"\"",
                        "linkTarget": "GenericDetails",
                        "linkLabel": "{Workspace:label}",
                        "preText": "3. Ad-hoc: Access review",
                        "postText": "check ",
                        "style": "link"
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "links - 47 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where  type == \"microsoft.operationalinsights/workspaces\"\r\n| summarize count() by location",
                    "size": 0,
                    "title": "4. Monthly: Ad-hoc Workspace location check 1 of 2",
                    "exportFieldName": "",
                    "exportParameterName": "exportMap",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "map",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Status",
                          "formatter": 1,
                          "formatOptions": {
                            "linkColumn": "Status",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "linkColumn": "Details",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true,
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "4",
                                "text": "{0}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}"
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "Click to see details of the last event sent by this computer."
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          },
                          "tooltipFormat": {
                            "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "State",
                        "formatter": 1,
                        "formatOptions": {}
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {},
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "State",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Unhealthy",
                              "representation": "4",
                              "text": ""
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "showBorder": false,
                      "rowLimit": 100
                    },
                    "mapSettings": {
                      "locInfo": "AzureLoc",
                      "locInfoColumn": "location",
                      "sizeSettings": "count_",
                      "sizeAggregation": "Sum",
                      "labelSettings": "location",
                      "legendMetric": "count_",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "count_",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "66",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "MonthlyAgentCheck - Copy",
                  "styleSettings": {
                    "margin": "66"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "project details = '{exportMap}'\r\n| limit 1\r\n| mv-expand todynamic(details)\r\n",
                    "size": 3,
                    "title": "4. Monthly: Ad-hoc Workspace location check 1 of 2 drill-in details",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Status",
                          "formatter": 1,
                          "formatOptions": {
                            "linkColumn": "Status",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "linkColumn": "Details",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true,
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "4",
                                "text": "{0}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}"
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "Click to see details of the last event sent by this computer."
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          },
                          "tooltipFormat": {
                            "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "State",
                        "formatter": 1,
                        "formatOptions": {}
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {},
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "State",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Unhealthy",
                              "representation": "4",
                              "text": ""
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "showBorder": false,
                      "rowLimit": 100
                    },
                    "mapSettings": {
                      "locInfo": "AzureLoc",
                      "locInfoColumn": "location",
                      "sizeSettings": "count_",
                      "sizeAggregation": "Sum",
                      "labelSettings": "location",
                      "legendMetric": "count_",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "count_",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "30",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "MonthlyAgentCheck - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces' \r\n//| where id has \"{Workspace}\"\r\n| extend state = trim(' ', tostring(properties.provisioningState))\r\n\t\t,sku   = trim(' ', tostring(properties.sku.name))\r\n        ,skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate))\r\n\t\t,retentionDays = trim(' ', tostring(properties.retentionInDays))\r\n\t\t,dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"Not set\")\r\n| extend skuUpdate    = iif(strlen(skuUpdate) > 0, skuUpdate,\"Unknown\")\r\n| extend sentinel     = iif(toint(retentionDays) < 90,\"If you have Sentinel, you can change your retention to 90days (free)?\",\"\")\r\n| project ['Workspace Name']=id, ['Resource Group']=resourceGroup, location, ['Data Retention(days)']=retentionDays, ['Last known SKU update']=skuUpdate, ['Daily Data Cap']=dailyquotaGB, ['Licence']=sku, ['Notes'] = sentinel, tags, properties\r\n| order by ['Workspace Name'] asc",
                    "size": 3,
                    "title": "4. Monthly: Ad-hoc Workspace check 2 of 2",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Notes",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 1,
                          "formatOptions": {
                            "linkColumn": "Status",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "_ComputerName_",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 18,
                          "formatOptions": {
                            "linkColumn": "Details",
                            "linkTarget": "CellDetails",
                            "linkIsContextBlade": true,
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Unhealthy",
                                "representation": "4",
                                "text": "{0}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}"
                              }
                            ]
                          },
                          "tooltipFormat": {
                            "tooltip": "Click to see details of the last event sent by this computer."
                          }
                        },
                        {
                          "columnMatch": "Heartbeat Trend",
                          "formatter": 10,
                          "formatOptions": {
                            "palette": "redGreen"
                          },
                          "tooltipFormat": {
                            "tooltip": "Each bar represents the bucket of time based on the Unhealthy Criteria. Showing last 30 buckets max."
                          }
                        },
                        {
                          "columnMatch": "Details",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "Last Record Received",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "State",
                        "formatter": 1,
                        "formatOptions": {}
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {},
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "rightContent": {
                        "columnMatch": "State",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Unhealthy",
                              "representation": "4",
                              "text": ""
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "success",
                              "text": ""
                            }
                          ]
                        }
                      },
                      "showBorder": false,
                      "rowLimit": 100
                    },
                    "mapSettings": {
                      "locInfo": "AzureLoc",
                      "locInfoColumn": "location",
                      "sizeSettings": "count_",
                      "sizeAggregation": "Sum",
                      "labelSettings": "location",
                      "legendMetric": "count_",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "count_",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab1",
                      "comparison": "isEqualTo",
                      "value": "Monthly"
                    },
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "Checks"
                    }
                  ],
                  "name": "MonthlyAgentCheck - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab1",
              "comparison": "isEqualTo",
              "value": "Monthly"
            },
            "name": "group - Monthly",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Checks"
      },
      "name": "group - checks"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: ADX",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "bullets",
              "links": [
                {
                  "id": "6183148c-62b0-47aa-bf7b-697cba09d6b5",
                  "cellValue": "community-Workbooks/ADXCluster/AtScale",
                  "linkTarget": "WorkbookTemplate",
                  "linkLabel": "Azure Data Explorer Insights",
                  "preText": "Open",
                  "style": "link",
                  "linkIsContextBlade": true
                }
              ]
            },
            "name": "links - 0"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "ADX"
      },
      "name": "group - ADX"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Data Collection Rules and Transformations",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "dd1b7dbf-83b7-42ca-8589-f91a7a4504d9",
                  "version": "KqlParameterItem/1.0",
                  "name": "countDCR",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/providers/Microsoft.Insights/dataCollectionRules?api-version=2021-04-01\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$..value\",\"columns\":[{\"path\":\"kind\",\"columnid\":\"kind\"}]}}]}",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                }
              ],
              "style": "pills",
              "queryType": 12
            },
            "conditionalVisibility": {
              "parameterName": "hide",
              "comparison": "isEqualTo",
              "value": "hide"
            },
            "name": "parameters - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage // use a known table \r\n| limit 1\r\n| project a= split(trim(@\"[^\\w]+\",tostring('{countDCR:value}')),\",\")\r\n| mv-expand a to typeof(string)\r\n| where isnotempty(a)\r\n| summarize count() by DCRkind=a",
              "size": 4,
              "title": "DCR by kind",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart"
            },
            "name": "query - 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/providers/Microsoft.Insights/dataCollectionRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-04-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"$..workspaceResourceId\",\"columnid\":\"Workspace\"},{\"path\":\"kind\",\"columnid\":\"OS\"},{\"path\":\"properties.dataFlows[*].streams[0]\",\"columnid\":\"Streams\",\"substringRegexMatch\":\"(Microsoft-Table-)*(\\\\w+)\",\"substringReplace\":\"$2\"},{\"path\":\"$..xPathQueries\",\"columnid\":\"xPath\"},{\"path\":\"location\",\"columnid\":\"Location\"},{\"path\":\"$..facilityNames\",\"columnid\":\"SyslogFacilities\"}]}}]}",
              "size": 0,
              "title": "Get all DCRs under: {Subscription:label}, count: {$rowCount}",
              "exportFieldName": "Name",
              "exportParameterName": "DCR",
              "showExportToExcel": true,
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "workspace2",
                    "formatter": 5
                  }
                ],
                "rowLimit": 500,
                "filter": true
              }
            },
            "name": "Get DCRs and associations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/resourceGroups/{resourceGroup}/providers/Microsoft.Insights/dataCollectionRules/{DCR}/associations\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-04-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"id\",\"columnid\":\"VMs\",\"columnType\":\"string\",\"substringRegexMatch\":\"(\\\\/subscriptions.*)(\\\\/providers.*|Providers.*)\",\"substringReplace\":\"$1\"}]}}]}",
              "size": 4,
              "title": "VMs associated to the selected DCR",
              "noDataMessage": "No VMs found or no DCR selected above",
              "showExportToExcel": true,
              "queryType": 12
            },
            "conditionalVisibility": {
              "parameterName": "DCR",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - DCR VMs"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:Id}/providers/Microsoft.Insights/dataCollectionRules?api-version=2021-04-01\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$..value[?(@.kind=='WorkspaceTransforms')]\",\"columns\":[{\"path\":\"id\",\"columnid\":\"Name\"},{\"path\":\"properties.dataFlows[*].streams[0]\",\"columnid\":\"Tables\",\"substringRegexMatch\":\"(Microsoft-Table-)*(\\\\w+)\",\"substringReplace\":\"$2\"},{\"path\":\"kind\",\"columnid\":\"kind\"},{\"path\":\"location\",\"columnid\":\"location\"},{\"path\":\"type\",\"columnid\":\"type\"},{\"path\":\"tags\",\"columnid\":\"tags\"},{\"path\":\"systemData.createdBy\",\"columnid\":\"createdby\"},{\"path\":\"systemData.createdAt\",\"columnid\":\"createdAt\"},{\"path\":\"systemData.lastModifiedBy\",\"columnid\":\"lastModifiedBy\"},{\"path\":\"systemData.lastModifiedAt\",\"columnid\":\"lastModifiedAt\"},{\"path\":\"properties.dataFlows\",\"columnid\":\"dataFlows\"},{\"path\":\"properties\",\"columnid\":\"properties\"},{\"path\":\"systemData\",\"columnid\":\"systemData\"}]}}]}",
              "size": 0,
              "title": "Transformation DCRs, count: {$rowCount} by Table Name",
              "showExportToExcel": true,
              "queryType": 12,
              "gridSettings": {
                "rowLimit": 500,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "type",
                    "Tables"
                  ],
                  "expandTopLevel": true
                }
              }
            },
            "name": "query - transforms "
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "dcr"
      },
      "name": "group - DCR"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Group: Function or Parser",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "dd1b7dbf-83b7-42ca-8589-f91a7a4504d9",
                  "version": "KqlParameterItem/1.0",
                  "name": "countFunctions",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/SavedSearches\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.functionAlias)]\",\"columns\":[{\"path\":\"properties.category\",\"columnid\":\"category\"}]}}]}",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                }
              ],
              "style": "pills",
              "queryType": 12
            },
            "conditionalVisibility": {
              "parameterName": "hide",
              "comparison": "isEqualTo",
              "value": "hide"
            },
            "name": "parameters - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage // use a known table \r\n| limit 1\r\n| project a= split(trim(@\"[^\\w]+\",tostring('{countFunctions:value}')),\",\")\r\n| mv-expand a to typeof(string)\r\n| where isnotempty(a)\r\n| summarize count() by FunctionCategory=a",
              "size": 4,
              "title": "FunctionAlias by Category",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart"
            },
            "name": "query - func by Category"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/SavedSearches\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.functionAlias)]\",\"columns\":[{\"path\":\"properties.functionAlias\",\"columnid\":\"functionAlias\"},{\"path\":\"properties.displayName\",\"columnid\":\"displayName\"},{\"path\":\"properties.category\",\"columnid\":\"category\"},{\"path\":\"properties.query\",\"columnid\":\"query\"},{\"path\":\"properties.version\",\"columnid\":\"version\"},{\"path\":\"name\",\"columnid\":\"name\"},{\"path\":\"properties.functionParameters\",\"columnid\":\"parameters\"}]}}]}",
              "size": 1,
              "title": "Function Alias in Use (possible Parser detected), count: {$rowCount}, click row to see Query",
              "noDataMessage": "no saved queries found in {Workspace:name}",
              "exportedParameters": [
                {
                  "fieldName": "query",
                  "parameterName": "query",
                  "parameterType": 1,
                  "defaultValue": " "
                },
                {
                  "fieldName": "displayName",
                  "parameterName": "name",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "functionAlias",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "gray",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "query",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "category",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "category",
                  "sortOrder": 2
                }
              ]
            },
            "name": "functionAlias"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\",\"mergeType\":\"table\",\"leftTable\":\"functionAlias\"}],\"projectRename\":[{\"originalName\":\"[functionAlias].functionAlias\",\"mergedName\":\"functionAlias\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[functionAlias].displayName\",\"mergedName\":\"displayName\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[functionAlias].category\",\"mergedName\":\"category\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[functionAlias].query\",\"mergedName\":\"query\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[functionAlias].version\",\"mergedName\":\"version\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[functionAlias].name\",\"mergedName\":\"name\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[functionAlias].parameters\",\"mergedName\":\"parameters\",\"fromId\":\"9ceef7ea-3c45-4078-9120-9b7bfdc0c9ad\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Added column\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"query\",\"operator\":\"contains\",\"rightValType\":\"column\",\"rightVal\":\"functionAlias\",\"resultValType\":\"static\",\"resultVal\":\"Yes\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]}]}",
              "size": 0,
              "queryType": 7,
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "Added column",
                    "label": "Alias used in same Query (Y/N)"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "0",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "showPin": false,
            "name": "query - 2"
          },
          {
            "type": 1,
            "content": {
              "json": "### KQL Query text:\r\n\r\n{query}"
            },
            "conditionalVisibility": {
              "parameterName": "query",
              "comparison": "isNotEqualTo"
            },
            "name": "text - 1"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "function"
      },
      "name": "group - function"
    }
  ],
  "fromTemplateId": "sentinel-WorkspaceUsageWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}