# Connector Documentation Generator

**Script:** `generate_connector_docs.py`

## Overview

Generates browsable markdown documentation from the CSV data produced by `map_solutions_connectors_tables.py` and `collect_table_info.py`. The documentation includes:

- Three index pages (solutions, connectors, tables)
- Individual pages for each solution with connector details and **content item tables**
- Individual pages for each connector with table transformation and ingestion API support information
- Individual pages for ALL tables with enriched metadata from Azure Monitor documentation
- **AI-rendered setup instructions** extracted from connector UI definitions

### Content Item Tables

Solution pages display tables extracted from content items (analytics rules, hunting queries, playbooks, workbooks, etc.):

- Tables are grouped by content item type
- Each table links to its detailed documentation page
- **Playbook tables show usage indicators**: `(read)`, `(write)`, or `(read/write)` to show whether the playbook reads from, writes to, or both reads and writes to each table

### Table Index

The tables index includes:
- All tables ingested by connectors
- All tables referenced by content items
- **All tables from Azure Monitor reference** (`tables_reference.csv`), even if not used by any solution

This ensures complete coverage of known Microsoft Sentinel tables, even those that exist in Azure Monitor but aren't directly used by any solution in the repository.

## Output

The script generates the **Microsoft Sentinel Data Connector Reference** documentation in the `connector-docs/` directory:

- **[Solutions Index](../connector-docs/solutions-index.md)** - All solutions organized alphabetically (with and without connectors)
- **[Connectors Index](../connector-docs/connectors-index.md)** - All unique connectors with metadata
- **[Tables Index](../connector-docs/tables-index.md)** - All unique tables with solution references
- **Individual Solution Pages** - Detailed pages for each solution with connector and table information (in [`solutions/`](../connector-docs/solutions/) directory)
- **Individual Connector Pages** - Detailed pages for each connector with usage information (in [`connectors/`](../connector-docs/connectors/) directory)

See the [connector-docs README](../connector-docs/README.md) for full documentation.

## Prerequisites

### 1. Clone the Azure-Sentinel Repository

This script reads solution and connector files from the [Azure-Sentinel GitHub repository](https://github.com/Azure/Azure-Sentinel):

```bash
# Clone the repository
git clone https://github.com/Azure/Azure-Sentinel.git

# Or if you already have it, update to latest
cd Azure-Sentinel
git pull origin master
```

### 2. Python Environment

- Python 3.7 or higher

### 3. Input CSV Files

The script requires CSV files generated by the other scripts:
- `solutions_connectors_tables_mapping.csv` from `map_solutions_connectors_tables.py`
- `tables_reference.csv` from `collect_table_info.py`

By default, the script automatically generates these files if they don't exist or are outdated. Use `--skip-input-generation` to skip this step.

## Running the Script

From the `Tools/Solutions Analyzer` directory:

```bash
# Full run (automatically generates input CSVs first)
python generate_connector_docs.py

# Skip input generation (use existing CSV files)
python generate_connector_docs.py --skip-input-generation
```

The script automatically calls `map_solutions_connectors_tables.py` and `collect_table_info.py` before generating documentation, unless `--skip-input-generation` is specified.

## Command Line Options

| Option | Default | Description |
|--------|---------|-------------|
| `--input` | `solutions_connectors_tables_mapping.csv` | Path to connector mapping CSV |
| `--tables-csv` | `tables_reference.csv` | Path to tables reference CSV |
| `--output-dir` | `connector-docs/` | Output directory for documentation |
| `--solutions-dir` | `../../Solutions` | Path to Solutions directory for reading ReleaseNotes.md and connector documentation files |
| `--solutions` | All | Generate docs only for specific solutions |
| `--overrides-csv` | `solution_analyzer_overrides.csv` | Path to overrides CSV file for additional_information and other doc-only fields |
| `--skip-input-generation` | `False` | Skip running input CSV generation scripts |

## Output Structure

The generated documentation is organized as:

```
connector-docs/
â”œâ”€â”€ README.md                    # Documentation guide
â”œâ”€â”€ solutions-index.md           # Alphabetical list of all solutions
â”œâ”€â”€ connectors-index.md          # Alphabetical list of all connectors
â”œâ”€â”€ tables-index.md              # Alphabetical list of all tables with transformation/API support
â”œâ”€â”€ content/                     # Content item documentation
â”‚   â”œâ”€â”€ content-index.md         # Main content index
â”‚   â”œâ”€â”€ analytic-rules.md        # Analytics rules index with letter sub-pages
â”‚   â”œâ”€â”€ hunting-queries.md       # Hunting queries index
â”‚   â”œâ”€â”€ playbooks.md             # Playbooks index
â”‚   â”œâ”€â”€ workbooks.md             # Workbooks index
â”‚   â”œâ”€â”€ parsers.md               # Parsers index
â”‚   â”œâ”€â”€ watchlists.md            # Watchlists index
â”‚   â””â”€â”€ *.md                     # Individual content item pages
â”œâ”€â”€ solutions/                   # Individual solution pages
â”‚   â”œâ”€â”€ 1password.md
â”‚   â”œâ”€â”€ aws-cloudfront.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ connectors/                  # Individual connector pages
â”‚   â”œâ”€â”€ 1passwordeventreporter.md
â”‚   â”œâ”€â”€ awscloudfront.md
â”‚   â””â”€â”€ ...
â””â”€â”€ tables/                      # Individual table pages
    â”œâ”€â”€ securityevent.md
    â”œâ”€â”€ syslog.md
    â””â”€â”€ ...
```

### Generated Content

**Solution Pages** include:
- Solution metadata (publisher, support, categories)
- List of connectors in the solution
- Setup instructions for each connector (AI-rendered)
- Required permissions and prerequisites
- Tables ingested by each connector
- Links to connector definition files
- **Release Notes** from `ReleaseNotes.md` (if present in solution directory)

**Connector Pages** include:
- Connector description and metadata
- **AI-rendered setup instructions and permissions** from connector UI definitions with step-by-step guidance
- Required permissions and prerequisites (rendered from Microsoft Sentinel permissions schema)
- List of solutions using this connector
- Tables ingested with transformation and ingestion API support indicators
- Links to GitHub connector definition files
- **Additional Documentation** from README.md files associated with the connector (see below)

**Table Pages** include:
- Table description from Azure Monitor documentation
- Category and resource types
- Basic Logs eligibility
- Transformation support status
- Ingestion API compatibility
- Links to Azure Monitor and Defender XDR documentation
- List of solutions and connectors using the table

**Index Pages** provide:
- Alphabetical navigation
- Quick statistics
- Cross-references between solutions, connectors, and tables

## AI-Rendered Setup Instructions and Permissions

The "Setup Instructions" and "Permissions" sections in the generated connector documentation are **automatically rendered from connector UI definition files**. These sections interpret the UI-centric JSON structures that define the Azure Portal configuration interface and convert them into readable documentation.

### âš ï¸ Important Disclaimer

**These AI-rendered instructions and permissions may not be fully accurate.** They are generated by interpreting UI definition metadata and should always be verified against the actual Microsoft Sentinel portal before implementation. The content provides a helpful starting point but is not a substitute for official documentation or hands-on portal verification.

### How It Works

The rendering process involves several steps:

1. **JSON Parsing**: The script extracts `instructionSteps` and `permissions` objects from connector definition files in the Solutions directory
2. **UI Type Detection**: Each instruction step has a `type` property (e.g., `DataConnectorsGrid`, `ContextPane`, `GCPGrid`) that determines how it should be interpreted
3. **Permissions Schema Parsing**: Permission objects are rendered according to the Microsoft Sentinel permissions schema, including:
   - **resourceProvider**: Azure resource provider permissions with scope, required actions (read/write/delete/action)
   - **customs**: Custom prerequisites with names and descriptions
   - **licenses**: Required Microsoft 365 licenses with friendly names
   - **tenant**: Azure AD tenant permissions with required roles
4. **AI-Powered Rendering**: Specialized handlers for each UI type convert the JSON structure into descriptive markdown:
   - Form fields (textboxes, dropdowns) are described with their purposes and validation requirements
   - Management grids and data selectors are explained with their configuration options
   - Portal-only interfaces are identified and marked with clear indicators
   - Permission requirements are formatted with clear scope and action descriptions
5. **Markdown Formatting**: The rendered content is formatted with emoji indicators, step numbers, and disclaimers

### UI Types Supported

The script includes specialized handlers for connector UI configuration types based on the [official Microsoft Sentinel data connector UI definitions reference](https://learn.microsoft.com/en-us/azure/sentinel/data-connector-ui-definitions-reference#instructionsteps):

**Standard Instruction Types:**

- **OAuthForm**: OAuth authentication forms with client credentials
- **Textbox**: Input fields for text, passwords, numbers, and email addresses
- **Dropdown**: Selection lists with single or multi-select options
- **Markdown**: Formatted text content with links and formatting
- **CopyableLabel**: Text fields with copy-to-clipboard functionality
- **InfoMessage**: Inline information messages with contextual help
- **ConnectionToggleButton**: Connect/disconnect toggle controls
- **InstructionStepsGroup**: Collapsible groups of nested instructions
- **InstallAgent**: Links to Azure portal sections for agent installation (18 link types supported)

**UI-Centric Configuration Types:**

- **DataConnectorsGrid**: Interactive data connector management interface with enable/disable controls
- **ContextPane**: Sidebar configuration panels with detailed settings
- **GCPGrid** / **GCPContextPane**: Google Cloud Platform specific configuration interfaces
- **AADDataTypes**: Azure Active Directory data type selectors
- **MCasDataTypes**: Microsoft Defender for Cloud Apps data type selectors  
- **OfficeDataTypes**: Microsoft 365 data type selectors

Instructions for 74 connectors using these UI-centric configuration interfaces have been enhanced with AI-rendered setup guidance.

### Example Output

Instructions are formatted with:

- ðŸ“‹ Portal-only interfaces clearly marked
- ðŸ“ Form fields with descriptions and placeholders
- âš ï¸ Disclaimers about AI generation and accuracy
- ðŸ”— Links to GitHub connector definition files

## Additional Documentation Sources

The documentation generator enriches pages with content from markdown files in the Solutions directory:

### Release Notes (Solution Pages)

The script looks for `ReleaseNotes.md` in each solution's root directory (e.g., `Solutions/{SolutionName}/ReleaseNotes.md`). If found, the release notes are included in the solution documentation page under a "Release Notes" section. This typically includes a version history table with dates and change descriptions.

### Connector Documentation Files (Connector Pages)

The script attempts to find and include markdown documentation associated with each connector. The association rules are:

1. **Dedicated subfolder**: If the connector has a dedicated subfolder in the Data Connectors directory with `.md` files (e.g., `Data Connectors/ConnectorName/*.md`), the README.md is preferred, otherwise the first `.md` file found is used.

2. **Filename-based association**: Any `.md` file with a name matching the connector ID (e.g., `ConnectorName.md` or `ConnectorName_README.md`).

3. **Single connector fallback**: If a solution has only one connector and there are `.md` files directly in the Data Connectors folder, README.md is preferred, otherwise the first `.md` file is used.

The documentation content is included in an "Additional Documentation" section with a link to the source file in GitHub.

> **Note**: The generator searches for all markdown files (`.md`) in the `Data Connectors` folder and its subfolders, following various naming conventions used across solutions.

## Documentation Overrides and Additional Information

The `--overrides-csv` option allows you to add curated documentation links to table, connector, and solution pages through an "Additional Information" section.

### Override File Format

The override CSV uses the same format as the main override system (see [main README](../README.md)):

```csv
Entity,Pattern,Field,Value
table,CommonSecurityLog,additional_information,"[CEF Field Mapping Reference](https://learn.microsoft.com/en-us/azure/sentinel/cef-syslog-ama-overview#cef-field-mapping)"
connector,CEF,additional_information,"[Get CEF-formatted logs from your device](https://learn.microsoft.com/en-us/azure/sentinel/connect-cef-ama)"
```

### Supported Entities

- **table**: Adds Additional Information section to table pages (after the attributes table)
- **connector**: Adds Additional Information section to connector pages (before Additional Documentation)
- **solution**: Adds Additional Information section to solution pages (before Additional Documentation)

### Field Format

The `additional_information` field value should be valid markdown, typically links to Microsoft Learn documentation:

```csv
table,SecurityEvent,additional_information,"[Windows Security Event ID Reference](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor)"
```

The pattern field supports regex matching (case-insensitive), allowing wildcards like `SecurityEvent|WindowsEvent|Event` to apply the same override to multiple entities.

### Default Overrides

The default `solution_analyzer_overrides.csv` includes 21 curated documentation links for key tables and connectors:

- **Tables**: CommonSecurityLog, Syslog, SecurityAlert, SecurityEvent, WindowsEvent, Event, ASimDnsActivityLogs, DnsEvents, MicrosoftPurviewInformationProtection, SigninLogs, AuditLogs, OfficeActivity
- **Connectors**: CEF, CefAma, Syslog, SyslogAma, SecurityEvents, WindowsSecurityEvents, DNS, AzureActiveDirectory, Office365

## Usage in Pipeline

The recommended order of script execution:

1. **`collect_table_info.py`** - Generate `tables_reference.csv` with Azure Monitor metadata
2. **`map_solutions_connectors_tables.py`** - Generate connector mappings (uses `tables_reference.csv`)
3. **`generate_connector_docs.py`** - Generate documentation (uses both CSVs)

By default, `generate_connector_docs.py` handles steps 1-2 automatically unless `--skip-input-generation` is specified.
