# Connector Documentation Generator

**Script:** `generate_connector_docs.py`

## Table of Contents

- [Overview](#overview)
- [Output](#output)
- [Prerequisites](#prerequisites)
- [Running the Script](#running-the-script)
- [Command Line Options](#command-line-options)
- [Output Structure](#output-structure)
- [AI-Rendered Setup Instructions and Permissions](#ai-rendered-setup-instructions-and-permissions)
- [Additional Documentation Sources](#additional-documentation-sources)
- [Documentation Overrides and Additional Information](#documentation-overrides-and-additional-information)
- [Usage in Pipeline](#usage-in-pipeline)

## Overview

Generates browsable markdown documentation from the CSV data produced by `map_solutions_connectors_tables.py` and `collect_table_info.py`. 


The script generates the **Microsoft Sentinel Data Connector Reference** documentation in the `connector-docs/` directory:

- **[Solutions Index](../connector-docs/solutions-index.md)** - All solutions organized alphabetically (with and without connectors)
- **[Connectors Index](../connector-docs/connectors-index.md)** - All unique connectors with metadata
- **[Tables Index](../connector-docs/tables-index.md)** - 
   - All tables ingested by connectors
   - All tables referenced by content items
   - **All tables from Azure Monitor reference** (`tables_reference.csv`), even if not used by any solution.
- **[Content Index](../connector-docs/content/content-index.md)** - All content items organized by type
- **[Parsers Index](../connector-docs/parsers/parsers-index.md)** - All non-ASIM parsers organized by solution
- **[ASIM Index](../connector-docs/asim/asim-index.md)** - All ASIM parsers organized by schema
- **[Collection Methods Index](../connector-docs/collection-methods/collection-methods-index.md)** - Connectors grouped by data collection method
- **[Statistics](../connector-docs/statistics.md)** - Comprehensive statistics and metrics
- **Individual Solution Pages** - Detailed pages for each solution with connector and table information (in [`solutions/`](../connector-docs/solutions/) directory)
- **Individual Connector Pages** - Detailed pages for each connector with usage information (in [`connectors/`](../connector-docs/connectors/) directory)
- **Individual Table Pages** - Detailed pages for each table with metadata (in [`tables/`](../connector-docs/tables/) directory)
- **Individual Content Item Pages** - Detailed pages for each content item (in [`content/`](../connector-docs/content/) directory)
- **Individual Parser Pages** - Detailed pages for each parser (in [`parsers/`](../connector-docs/parsers/) and [`asim/`](../connector-docs/asim/) directories)

See the [connector-docs README](../connector-docs/README.md) for full documentation.

## Prerequisites

### 1. Clone the Azure-Sentinel Repository

This script reads solution and connector files from the [Azure-Sentinel GitHub repository](https://github.com/Azure/Azure-Sentinel):

```bash
# Clone the repository
git clone https://github.com/Azure/Azure-Sentinel.git

# Or if you already have it, update to latest
cd Azure-Sentinel
git pull origin master
```

### 2. Python Environment

- Python 3.7 or higher

### 3. Input CSV Files

The script requires CSV files generated by the other scripts:
- `solutions_connectors_tables_mapping.csv` from `map_solutions_connectors_tables.py`
- `connectors.csv` from `map_solutions_connectors_tables.py`
- `solutions.csv` from `map_solutions_connectors_tables.py`
- `tables.csv` from `map_solutions_connectors_tables.py`
- `content_items.csv` from `map_solutions_connectors_tables.py`
- `content_tables_mapping.csv` from `map_solutions_connectors_tables.py`
- `parsers.csv` from `map_solutions_connectors_tables.py`
- `asim_parsers.csv` from `map_solutions_connectors_tables.py`
- `tables_reference.csv` from `collect_table_info.py`

By default, the script automatically generates these files if they don't exist or are outdated. Use `--skip-input-generation` to skip this step.

## Running the Script

From the `Tools/Solutions Analyzer` directory:

```bash
# Full run (automatically generates input CSVs first)
python generate_connector_docs.py

# Skip input generation (use existing CSV files)
python generate_connector_docs.py --skip-input-generation
```

The script automatically calls `map_solutions_connectors_tables.py` and `collect_table_info.py` before generating documentation, unless `--skip-input-generation` is specified.

## Command Line Options

| Option | Default | Description |
|--------|---------|-------------|
| `--input` | `solutions_connectors_tables_mapping.csv` | Path to connector mapping CSV |
| `--connectors-csv` | `connectors.csv` | Path to connectors CSV file with collection methods |
| `--tables-csv` | `tables_reference.csv` | Path to tables reference CSV from Azure Monitor docs |
| `--tables-overrides-csv` | `tables.csv` | Path to tables CSV with solution-specific overrides |
| `--output-dir` | `connector-docs/` | Output directory for documentation |
| `--solutions-dir` | `../../Solutions` | Path to Solutions directory for reading ReleaseNotes.md and connector documentation files |
| `--solutions` | All | Generate docs only for specific solutions |
| `--content-items-csv` | `content_items.csv` | Path to content items CSV file |
| `--content-tables-csv` | `content_tables_mapping.csv` | Path to content-to-tables mapping CSV file |
| `--solutions-csv` | `solutions.csv` | Path to solutions CSV file with logo/description |
| `--overrides-csv` | `solution_analyzer_overrides.csv` | Path to overrides CSV file for additional_information and other doc-only fields |
| `--asim-parsers-csv` | `asim_parsers.csv` | Path to ASIM parsers CSV file |
| `--parsers-csv` | `parsers.csv` | Path to parsers CSV file |
| `--solution-dependencies-csv` | `solution_dependencies.csv` | Path to solution dependencies CSV file |
| `--skip-input-generation` | `False` | Skip running input CSV generation scripts |

## Output Structure

The generated documentation is organized as:

```
connector-docs/
â”œâ”€â”€ README.md                    # Documentation guide
â”œâ”€â”€ statistics.md                # Comprehensive statistics and metrics
â”œâ”€â”€ solutions-index.md           # Alphabetical list of all solutions
â”œâ”€â”€ connectors-index.md          # Alphabetical list of all connectors
â”œâ”€â”€ tables-index.md              # Alphabetical list of all tables with transformation/API support
â”œâ”€â”€ collection-methods/          # Collection method documentation
â”‚   â”œâ”€â”€ collection-methods-index.md  # Connectors by collection method
â”‚   â”œâ”€â”€ ama.md                   # Azure Monitor Agent connectors
â”‚   â”œâ”€â”€ mma.md                   # Log Analytics Agent (legacy) connectors
â”‚   â”œâ”€â”€ azure-diagnostics.md    # Azure Diagnostics connectors
â”‚   â”œâ”€â”€ ccf.md                   # Codeless Connector Framework connectors
â”‚   â”œâ”€â”€ ccf-push.md              # CCF Push mode connectors
â”‚   â”œâ”€â”€ azure-function.md       # Azure Function-based connectors
â”‚   â”œâ”€â”€ native.md                # Native Microsoft integrations
â”‚   â”œâ”€â”€ rest-api.md              # REST API/webhook connectors
â”‚   â””â”€â”€ unknown.md               # Connectors with unknown method
â”œâ”€â”€ content/                     # Content item documentation
â”‚   â”œâ”€â”€ content-index.md         # Main content index with type summary table
â”‚   â”œâ”€â”€ analytic-rules.md        # Analytics rules main index
â”‚   â”œâ”€â”€ analytic-rules-a.md      # Analytics rules starting with A
â”‚   â”œâ”€â”€ analytic-rules-b.md      # Analytics rules starting with B
â”‚   â”œâ”€â”€ ...                      # Letter sub-pages (a-z, other)
â”‚   â”œâ”€â”€ hunting-queries.md       # Hunting queries index
â”‚   â”œâ”€â”€ playbooks.md             # Playbooks index
â”‚   â”œâ”€â”€ workbooks.md             # Workbooks index
â”‚   â”œâ”€â”€ watchlists.md            # Watchlists index
â”‚   â”œâ”€â”€ summary-rules.md         # Summary rules index
â”‚   â””â”€â”€ {solution}-{name}-*.md   # Individual content item pages
â”œâ”€â”€ parsers/                     # Parser documentation
â”‚   â”œâ”€â”€ parsers-index.md         # All parsers organized by solution
â”‚   â””â”€â”€ {parser-name}.md         # Individual parser pages
â”œâ”€â”€ asim/                        # ASIM parser documentation
â”‚   â”œâ”€â”€ asim-index.md            # ASIM parsers organized by schema
â”‚   â”œâ”€â”€ asim-products-index.md   # ASIM parsers organized by product
â”‚   â””â”€â”€ {parser-name}.md         # Individual ASIM parser pages
â”œâ”€â”€ solutions/                   # Individual solution pages
â”‚   â”œâ”€â”€ 1password.md
â”‚   â”œâ”€â”€ aws-cloudfront.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ connectors/                  # Individual connector pages
â”‚   â”œâ”€â”€ 1passwordeventreporter.md
â”‚   â”œâ”€â”€ awscloudfront.md
â”‚   â””â”€â”€ ...
â””â”€â”€ tables/                      # Individual table pages
    â”œâ”€â”€ securityevent.md
    â”œâ”€â”€ syslog.md
    â””â”€â”€ ...
```

### Generated Content

**Solution Pages** include:
- **Solution logo** from Solution JSON (displayed at top of page)
- **Rich description** extracted from `createUiDefinition.json`
- **Solution Information** section with metadata (publisher, support tier, categories, version, author, first/last published dates, dependencies)
- **Additional Information** section (from overrides, if configured)
- **Dependencies** section listing explicit and ASIM-based dependency solutions (from `solution_dependencies.csv`)
- **Supported Products** section for solutions using ASIM parsers
- **Data Connectors** section with connector details, plus dependency connectors marked with "(dependency on solution X)"
- **Tables Used** section showing tables from content items and dependency connectors (with ASIM parsers separated, dependency connectors marked with "(dependency)")
- **Content Items** section organized by type (analytics rules, hunting queries, workbooks, playbooks, parsers, watchlists, summary rules) with âš ï¸ indicators for items not in Solution JSON
- **Additional Documentation** from README.md files in the solution directory
- **Release Notes** from `ReleaseNotes.md` (if present in solution directory)

**Connector Pages** include:
- Connector title with status icons (deprecated, unpublished, discovered)
- **Solution logo** from Solution JSON (displayed at top of page)
- **Metadata table** with connector ID, publisher, solutions, collection method, connector definition files, CCF configuration link and capabilities (for CCF/CCF Push connectors)
- **Description** from connector definition
- **Additional Information** section (from overrides, if configured)
- **Tables Ingested** section with transformation, ingestion API, lake-only support, and selection criteria
- **Permissions** section (AI-rendered from connector UI definitions)
- **Setup Instructions** section (AI-rendered from connector UI definitions with disclaimer)
- **Additional Documentation** from README.md files associated with the connector

**Table Pages** include:
- **Table description** from Azure Monitor documentation
- **Metadata table** with category, basic logs eligibility, transformation support, ingestion API, lake-only ingestion, search job support, plan, and documentation links
- **Additional Information** section (from overrides, if configured)
- **Solutions** section listing all solutions using this table
- **Connectors** section listing connectors ingesting this table with selection criteria
- **Content Items Using This Table** section organized by content type and solution
- **Parsers Using This Table** section with ASIM and non-ASIM parsers and selection criteria
- **Resource Types** section (for Azure resource tables)
- **Selection Criteria Summary** section with statistics by criteria and grouped field values (DeviceProduct/DeviceVendor, etc.)
- **Retention** section with default and maximum retention periods

**Content Item Pages** include:
- Content item title with ASIM badge if applicable
- **Status banner** for retired/deprecated items
- **Description** from YAML/JSON definition
- **Metadata table** with type, solution, ID, severity, status, kind, tactics, techniques, required connectors, and source link
- **ASIM Parsers Used** section (if applicable)
- **Tables Used** section with transformation/ingestion API support and selection criteria
- **Associated Connectors** section (for Standalone/GitHub Only items)
- **Additional Documentation** from playbook README.md files (for playbooks only)

**Parser Pages** include:
- Parser name with discovered indicator (âš ï¸) if applicable
- **Description** from YAML definition
- **Parser Information** section with title, location, solution, version, last updated, category, file type, and source link
- **Source Tables** section with transformation/ingestion API support and selection criteria

**ASIM Parser Pages** include:
- Parser title with ASIM badge
- **Parser Information** section with parser name, built-in parser alias, schema, schema version, parser type, product, parser version with changelog link, last updated, unifying parser link, and source file link
- **Description** from parser definition
- **Products** section with sub-parser list and product mapping (for union parsers)
- **Source Tables** section with transformation/ingestion API support and selection criteria
- **Parameters** section with parameter names, types, and defaults
- **Associated Connectors** section with connector-solution mappings (for source parsers)
- **References** section with documentation links

**Collection Method Pages** include:
- Method name and description
- **Documentation** link to Microsoft Learn
- **Statistics** with connector and solution counts
- **Connectors Using This Method** table with connector title, solution, and support tier

**Statistics Page** includes:
- **Terminology** section with definitions for key concepts (Published, Deprecated, Discovered, Standalone, GitHub Only, etc.)
- **Solutions** section with statistics by publication status, support tier, and content
- **Connectors** section with statistics by collection method, deprecation status, and support tier cross-tabulation
- **CCF Capabilities** subsection with connector kind distribution, authentication methods, and request features for CCF/CCF Push/CCF Legacy connectors
- **Tables** section with statistics by source, category, and usage
- **Content Items** section with statistics by type and source classification
- **ASIM Parsers** section with statistics by schema and type
- **Non-ASIM Parsers** section with statistics by location

**Index Pages** provide:
- "Browse by" navigation between all index pages (solutions, connectors, tables, content, parsers, ASIM, collection methods, statistics)
- Alphabetical navigation with letter sub-pages for large indexes
- Quick statistics (counts, percentages)
- Deprecated connectors section (in connectors index)
- Cross-references between solutions, connectors, tables, content, and parsers

## AI-Rendered Setup Instructions and Permissions

The "Setup Instructions" and "Permissions" sections in the generated connector documentation are **automatically rendered from connector UI definition files**. These sections interpret the UI-centric JSON structures that define the Azure Portal configuration interface and convert them into readable documentation.

### âš ï¸ Important Disclaimer

**These AI-rendered instructions and permissions may not be fully accurate.** They are generated by interpreting UI definition metadata and should always be verified against the actual Microsoft Sentinel portal before implementation. The content provides a helpful starting point but is not a substitute for official documentation or hands-on portal verification.

### How It Works

The rendering process involves several steps:

1. **JSON Parsing**: The script extracts `instructionSteps` and `permissions` objects from connector definition files in the Solutions directory
2. **UI Type Detection**: Each instruction step has a `type` property (e.g., `DataConnectorsGrid`, `ContextPane`, `GCPGrid`) that determines how it should be interpreted
3. **Permissions Schema Parsing**: Permission objects are rendered according to the Microsoft Sentinel permissions schema, including:
   - **resourceProvider**: Azure resource provider permissions with scope, required actions (read/write/delete/action)
   - **customs**: Custom prerequisites with names and descriptions
   - **licenses**: Required Microsoft 365 licenses with friendly names
   - **tenant**: Azure AD tenant permissions with required roles
4. **AI-Powered Rendering**: Specialized handlers for each UI type convert the JSON structure into descriptive markdown:
   - Form fields (textboxes, dropdowns) are described with their purposes and validation requirements
   - Management grids and data selectors are explained with their configuration options
   - Portal-only interfaces are identified and marked with clear indicators
   - Permission requirements are formatted with clear scope and action descriptions
5. **Markdown Formatting**: The rendered content is formatted with emoji indicators, step numbers, and disclaimers

### UI Types Supported

The script includes specialized handlers for connector UI configuration types based on the [official Microsoft Sentinel data connector UI definitions reference](https://learn.microsoft.com/en-us/azure/sentinel/data-connector-ui-definitions-reference#instructionsteps):

**Standard Instruction Types:**

- **OAuthForm**: OAuth authentication forms with client credentials
- **Textbox**: Input fields for text, passwords, numbers, and email addresses
- **Dropdown**: Selection lists with single or multi-select options
- **Markdown**: Formatted text content with links and formatting
- **CopyableLabel**: Text fields with copy-to-clipboard functionality
- **InfoMessage**: Inline information messages with contextual help
- **ConnectionToggleButton**: Connect/disconnect toggle controls
- **InstructionStepsGroup**: Collapsible groups of nested instructions
- **InstallAgent**: Links to Azure portal sections for agent installation (18 link types supported)

**UI-Centric Configuration Types:**

- **DataConnectorsGrid**: Interactive data connector management interface with enable/disable controls
- **ContextPane**: Sidebar configuration panels with detailed settings
- **GCPGrid** / **GCPContextPane**: Google Cloud Platform specific configuration interfaces
- **AADDataTypes**: Azure Active Directory data type selectors
- **MCasDataTypes**: Microsoft Defender for Cloud Apps data type selectors  
- **OfficeDataTypes**: Microsoft 365 data type selectors

Instructions for 74 connectors using these UI-centric configuration interfaces have been enhanced with AI-rendered setup guidance.

### Example Output

Instructions are formatted with:

- ðŸ“‹ Portal-only interfaces clearly marked
- ðŸ“ Form fields with descriptions and placeholders
- âš ï¸ Disclaimers about AI generation and accuracy
- ðŸ”— Links to GitHub connector definition files

## Additional Documentation Sources

The documentation generator enriches pages with content from markdown files in the Solutions directory:

### Release Notes (Solution Pages)

The script looks for `ReleaseNotes.md` in each solution's root directory (e.g., `Solutions/{SolutionName}/ReleaseNotes.md`). If found, the release notes are included in the solution documentation page under a "Release Notes" section. This typically includes a version history table with dates and change descriptions.

### Connector Documentation Files (Connector Pages)

The script attempts to find and include markdown documentation associated with each connector. The association rules are:

1. **Dedicated subfolder**: If the connector has a dedicated subfolder in the Data Connectors directory with `.md` files (e.g., `Data Connectors/ConnectorName/*.md`), the README.md is preferred, otherwise the first `.md` file found is used.

2. **Filename-based association**: Any `.md` file with a name matching the connector ID (e.g., `ConnectorName.md` or `ConnectorName_README.md`).

3. **Single connector fallback**: If a solution has only one connector and there are `.md` files directly in the Data Connectors folder, README.md is preferred, otherwise the first `.md` file is used.

The documentation content is included in an "Additional Documentation" section with a link to the source file in GitHub.

> **Note**: The generator searches for all markdown files (`.md`) in the `Data Connectors` folder and its subfolders, following various naming conventions used across solutions.

## Documentation Overrides and Additional Information

The `--overrides-csv` option allows you to add curated documentation links to table, connector, and solution pages through an "Additional Information" section.

### Override File Format

The override CSV uses the same format as the main override system (see [main README](../README.md)):

```csv
Entity,Pattern,Field,Value
table,CommonSecurityLog,additional_information,"[CEF Field Mapping Reference](https://learn.microsoft.com/en-us/azure/sentinel/cef-syslog-ama-overview#cef-field-mapping)"
connector,CEF,additional_information,"[Get CEF-formatted logs from your device](https://learn.microsoft.com/en-us/azure/sentinel/connect-cef-ama)"
```

### Supported Entities

- **table**: Adds Additional Information section to table pages (after the attributes table)
- **connector**: Adds Additional Information section to connector pages (before Additional Documentation)
- **solution**: Adds Additional Information section to solution pages (before Additional Documentation)

### Field Format

The `additional_information` field value should be valid markdown, typically links to Microsoft Learn documentation:

```csv
table,SecurityEvent,additional_information,"[Windows Security Event ID Reference](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor)"
```

The pattern field supports regex matching (case-insensitive), allowing wildcards like `SecurityEvent|WindowsEvent|Event` to apply the same override to multiple entities.

### Default Overrides

The default `solution_analyzer_overrides.csv` includes 21 curated documentation links for key tables and connectors:

- **Tables**: CommonSecurityLog, Syslog, SecurityAlert, SecurityEvent, WindowsEvent, Event, ASimDnsActivityLogs, DnsEvents, MicrosoftPurviewInformationProtection, SigninLogs, AuditLogs, OfficeActivity
- **Connectors**: CEF, CefAma, Syslog, SyslogAma, SecurityEvents, WindowsSecurityEvents, DNS, AzureActiveDirectory, Office365

## Usage in Pipeline

The recommended order of script execution:

1. **`compare_connector_catalogs.py`** - Generate comparison data between solution and standalone connectors
2. **`collect_table_info.py`** - Generate `tables_reference.csv` with Azure Monitor metadata
3. **`map_solutions_connectors_tables.py`** - Generate connector mappings (uses `tables_reference.csv`)
4. **`generate_connector_docs.py`** - Generate documentation (uses all CSVs)

By default, `generate_connector_docs.py` handles steps 1-3 automatically unless `--skip-input-generation` is specified.
