# Apache Log4j Vulnerability Detection

## Solution Information

| Attribute | Value |
|:------------------------|:------|
| **Publisher** | Microsoft Corporation |
| **Support Tier** | Microsoft |
| **Support Link** | [https://support.microsoft.com/](https://support.microsoft.com/) |
| **Categories** | domains |
| **First Published** | 2021-12-15 |
| **Solution Folder** | [https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection) |

## Data Connectors

**This solution does not include data connectors.**

This solution may contain other components such as analytics rules, workbooks, hunting queries, or playbooks.

## Tables Reference

This solution queries **28 table(s)** from its content items:

| Table | Used By Content |
|-------|----------------|
| [`AADNonInteractiveUserSignInLogs`](../tables/aadnoninteractiveusersigninlogs.md) | Analytics |
| [`ASimWebSessionLogs`](../tables/asimwebsessionlogs.md) | Analytics |
| [`AWSCloudTrail`](../tables/awscloudtrail.md) | Analytics |
| [`AZFWApplicationRule`](../tables/azfwapplicationrule.md) | Analytics |
| [`ApacheHTTPServer_CL`](../tables/apachehttpserver-cl.md) | Analytics |
| [`AzureActivity`](../tables/azureactivity.md) | Analytics |
| [`AzureDiagnostics`](../tables/azurediagnostics.md) | Analytics, Hunting |
| [`CommonSecurityLog`](../tables/commonsecuritylog.md) | Analytics, Hunting |
| [`DeviceNetworkEvents`](../tables/devicenetworkevents.md) | Analytics |
| [`DnsEvents`](../tables/dnsevents.md) | Analytics |
| [`Event`](../tables/event.md) | Analytics |
| [`M365SecureScoreControls_CL`](../tables/m365securescorecontrols-cl.md) | Workbooks |
| [`MDfEExposureScore_CL`](../tables/mdfeexposurescore-cl.md) | Workbooks |
| [`MDfERecommendations_CL`](../tables/mdferecommendations-cl.md) | Workbooks |
| [`MDfEVulnerabilitiesList_CL`](../tables/mdfevulnerabilitieslist-cl.md) | Workbooks |
| [`OfficeActivity`](../tables/officeactivity.md) | Analytics |
| [`SecurityNestedRecommendation`](../tables/securitynestedrecommendation.md) | Analytics, Workbooks |
| [`SecurityResources`](../tables/securityresources.md) | Workbooks |
| [`SigninLogs`](../tables/signinlogs.md) | Analytics |
| [`SquidProxy_CL`](../tables/squidproxy-cl.md) | Analytics |
| [`Syslog`](../tables/syslog.md) | Hunting, Workbooks |
| [`VMConnection`](../tables/vmconnection.md) | Analytics |
| [`VectraStream_CL`](../tables/vectrastream-cl.md) | Analytics |
| [`W3CIISLog`](../tables/w3ciislog.md) | Analytics |
| [`barracuda_CL`](../tables/barracuda-cl.md) | Analytics |
| [`log4j_execve`](../tables/log4j-execve.md) | Hunting |
| [`meraki_CL`](../tables/meraki-cl.md) | Analytics |
| [`securityresources`](../tables/securityresources.md) | Workbooks |

### Internal Tables

The following **2 table(s)** are used internally by this solution's playbooks:

| Table | Used By Content |
|-------|----------------|
| [`SecurityAlert`](../tables/securityalert.md) | Workbooks |
| [`SecurityIncident`](../tables/securityincident.md) | Workbooks |

## Content Items

This solution includes **18 content item(s)**:

| Content Type | Count |
|:-------------|:------|
| Hunting Queries | 10 |
| Analytic Rules | 4 |
| Workbooks | 3 |
| Playbooks | 1 |

### Analytic Rules

| Name | Severity | Tactics | Tables Used |
|:-----|:---------|:--------|:------------|
| [Azure WAF matching for Log4j vuln(CVE-2021-44228)](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Analytic%20Rules/AzureWAFmatching_log4j_vuln.yaml) | High | InitialAccess | [`AzureDiagnostics`](../tables/azurediagnostics.md) |
| [Log4j vulnerability exploit aka Log4Shell IP IOC](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Analytic%20Rules/Log4J_IPIOC_Dec112021.yaml) | High | CommandAndControl | [`AADNonInteractiveUserSignInLogs`](../tables/aadnoninteractiveusersigninlogs.md)<br>[`AWSCloudTrail`](../tables/awscloudtrail.md)<br>[`AzureActivity`](../tables/azureactivity.md)<br>[`AzureDiagnostics`](../tables/azurediagnostics.md)<br>[`CommonSecurityLog`](../tables/commonsecuritylog.md)<br>[`DeviceNetworkEvents`](../tables/devicenetworkevents.md)<br>[`DnsEvents`](../tables/dnsevents.md)<br>[`Event`](../tables/event.md)<br>[`OfficeActivity`](../tables/officeactivity.md)<br>[`SigninLogs`](../tables/signinlogs.md)<br>[`VMConnection`](../tables/vmconnection.md)<br>[`W3CIISLog`](../tables/w3ciislog.md) |
| [User agent search for log4j exploitation attempt](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Analytic%20Rules/UserAgentSearch_log4j.yaml) | High | InitialAccess | [`ASimWebSessionLogs`](../tables/asimwebsessionlogs.md)<br>[`AZFWApplicationRule`](../tables/azfwapplicationrule.md)<br>[`ApacheHTTPServer_CL`](../tables/apachehttpserver-cl.md)<br>[`CommonSecurityLog`](../tables/commonsecuritylog.md)<br>[`SquidProxy_CL`](../tables/squidproxy-cl.md)<br>[`VectraStream_CL`](../tables/vectrastream-cl.md)<br>[`W3CIISLog`](../tables/w3ciislog.md)<br>[`barracuda_CL`](../tables/barracuda-cl.md)<br>[`meraki_CL`](../tables/meraki-cl.md) |
| [Vulnerable Machines related to log4j CVE-2021-44228](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Analytic%20Rules/Log4jVulnerableMachines.yaml) | High | InitialAccess, Execution | [`SecurityNestedRecommendation`](../tables/securitynestedrecommendation.md) |

### Hunting Queries

| Name | Tactics | Tables Used |
|:-----|:--------|:------------|
| [Azure WAF Log4j CVE-2021-44228 hunting](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/WAF_log4j_vulnerability.yaml) | InitialAccess | [`AzureDiagnostics`](../tables/azurediagnostics.md) |
| [Linux security related process termination activity detected](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Process_Termination_Activity.yaml) | DefenseEvasion | [`Syslog`](../tables/syslog.md) |
| [Malicious Connection to LDAP port for CVE-2021-44228 vulnerability](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/NetworkConnectionldap_log4j.yaml) | CommandAndControl | - |
| [Network Connection to New External LDAP Server](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/NetworkConnectionToNewExternalLDAPServer.yaml) | InitialAccess | [`CommonSecurityLog`](../tables/commonsecuritylog.md) |
| [Possible Container Miner related artifacts detected](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Container_Miner_Activity.yaml) | Impact, Execution | [`Syslog`](../tables/syslog.md) |
| [Possible Linux attack toolkit detected via Syslog data](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Linux_Toolkit_Detected.yaml) | Reconnaissance, Execution | [`Syslog`](../tables/syslog.md) |
| [Possible exploitation of Apache log4j component detected](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Apache_log4j_Vulnerability.yaml) | Persistence, Execution | [`Syslog`](../tables/syslog.md)<br>[`log4j_execve`](../tables/log4j-execve.md) |
| [Suspicious Base64 download activity detected](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Base64_Download_Activity.yaml) | Persistence, Execution | [`Syslog`](../tables/syslog.md) |
| [Suspicious Shell script detected](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Suspicious_ShellScript_Activity.yaml) | Persistence, Execution | [`Syslog`](../tables/syslog.md) |
| [Suspicious manipulation of firewall detected via Syslog data](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Hunting%20Queries/Firewall_Disable_Activity.yaml) | DefenseEvasion | [`Syslog`](../tables/syslog.md) |

### Workbooks

| Name | Tables Used |
|:-----|:------------|
| [Log4j](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Workbooks/Log4j.json) | - |
| [Log4jImpactAssessment](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Workbooks/Log4jImpactAssessment.json) | [`M365SecureScoreControls_CL`](../tables/m365securescorecontrols-cl.md)<br>[`MDfEExposureScore_CL`](../tables/mdfeexposurescore-cl.md)<br>[`MDfERecommendations_CL`](../tables/mdferecommendations-cl.md)<br>[`MDfEVulnerabilitiesList_CL`](../tables/mdfevulnerabilitieslist-cl.md)<br>[`SecurityResources`](../tables/securityresources.md)<br>[`securityresources`](../tables/securityresources.md)<br>*Internal use:*<br>[`SecurityAlert`](../tables/securityalert.md)<br>[`SecurityIncident`](../tables/securityincident.md) |
| [Log4jPostCompromiseHunting](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Workbooks/Log4jPostCompromiseHunting.json) | [`SecurityNestedRecommendation`](../tables/securitynestedrecommendation.md)<br>[`Syslog`](../tables/syslog.md) |

### Playbooks

| Name | Description | Tables Used |
|:-----|:------------|:------------|
| [Log4jIndicatorProcessor](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Apache%20Log4j%20Vulnerability%20Detection/Playbooks/IndicatorProcessor/Log4jIndicatorProcessor.json) | These playbooks automate the ingest of threat indicators into the ThreatIntelligenceIndicator table ... | - |

## Release Notes

| **Version** | **Date Modified (DD-MM-YYYY)** | **Change History**                                                         |
|-------------|--------------------------------|----------------------------------------------------------------------------|
| 3.0.8       | 25-08-2025                     | Hardcoded the **Watchlist** description to resolve a deployment issue.|
| 3.0.7       | 21-07-2025                     | Removed 'BatchImportToSentinel' & Updated 'Log4jIndicatorProcessor' **Playbook** to handle new STIX action.                 |
| 3.0.6       | 21-01-2025                     | Fixed query in  **Analytical Rule** UserAgentSearch_log4j.yaml.             |
| 3.0.5       | 26-07-2024                     | Updated **Analytical Rule** for missing TTP. 								|
| 3.0.4       | 31-05-2024                     | Added missing AMA **Data Connector** reference in **Analytic rules** and **Hunting Query**.      |
| 3.0.3       | 15-02-2024                     | Updated the solution to fix **Analytic Rules** deployment issue.            |
| 3.0.2       | 07-02-2024                     | Updated solution description.                                               |
| 3.0.1       | 02-01-2024                     | Tagged for dependent solutions for deployment.                              |
| 3.0.0       | 06-11-2023                     | Modified text as there is rebranding from Azure Active Directory to Microsoft Entra ID.   |

---

**Browse:**

- [‚Üê Back to Solutions Index](../solutions-index.md)
- [Connectors Index](../connectors-index.md)
- [Tables Index](../tables-index.md)
